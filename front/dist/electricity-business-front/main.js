(self.webpackChunkelectricity_business_front=self.webpackChunkelectricity_business_front||[]).push([[179],{836:(wh,Ql,ec)=>{"use strict";function An(t){return"function"==typeof t}function $c(t){const r=t(n=>{Error.call(n),n.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}const Ch=$c(t=>function(r){t(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((n,i)=>`${i+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function _(t,e){if(t){const r=t.indexOf(e);0<=r&&t.splice(r,1)}}class Wn{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const l of r)l.remove(this);else r.remove(this);const{initialTeardown:n}=this;if(An(n))try{n()}catch(l){e=l instanceof Ch?l.errors:[l]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const l of i)try{nn(l)}catch(h){e=e??[],h instanceof Ch?e=[...e,...h.errors]:e.push(h)}}if(e)throw new Ch(e)}}add(e){var r;if(e&&e!==this)if(this.closed)nn(e);else{if(e instanceof Wn){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}}_hasParent(e){const{_parentage:r}=this;return r===e||Array.isArray(r)&&r.includes(e)}_addParent(e){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e}_removeParent(e){const{_parentage:r}=this;r===e?this._parentage=null:Array.isArray(r)&&_(r,e)}remove(e){const{_finalizers:r}=this;r&&_(r,e),e instanceof Wn&&e._removeParent(this)}}Wn.EMPTY=(()=>{const t=new Wn;return t.closed=!0,t})();const Ho=Wn.EMPTY;function wo(t){return t instanceof Wn||t&&"closed"in t&&An(t.remove)&&An(t.add)&&An(t.unsubscribe)}function nn(t){An(t)?t():t.unsubscribe()}const be={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Go={setTimeout(t,e,...r){const{delegate:n}=Go;return n?.setTimeout?n.setTimeout(t,e,...r):setTimeout(t,e,...r)},clearTimeout(t){const{delegate:e}=Go;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Bi(t){Go.setTimeout(()=>{const{onUnhandledError:e}=be;if(!e)throw t;e(t)})}function Un(){}const tc=si("C",void 0,void 0);function si(t,e,r){return{kind:t,value:e,error:r}}let ro=null;function jn(t){if(be.useDeprecatedSynchronousErrorHandling){const e=!ro;if(e&&(ro={errorThrown:!1,error:null}),t(),e){const{errorThrown:r,error:n}=ro;if(ro=null,r)throw n}}else t()}class Do extends Wn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,wo(e)&&e.add(this)):this.destination=ms}static create(e,r,n){return new io(e,r,n)}next(e){this.isStopped?Eo(function qo(t){return si("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Eo(function ll(t){return si("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Eo(tc,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Vi=Function.prototype.bind;function ya(t,e){return Vi.call(t,e)}class Zo{constructor(e){this.partialObserver=e}next(e){const{partialObserver:r}=this;if(r.next)try{r.next(e)}catch(n){Ui(n)}}error(e){const{partialObserver:r}=this;if(r.error)try{r.error(e)}catch(n){Ui(n)}else Ui(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(r){Ui(r)}}}class io extends Do{constructor(e,r,n){let i;if(super(),An(e)||!e)i={next:e??void 0,error:r??void 0,complete:n??void 0};else{let l;this&&be.useDeprecatedNextContext?(l=Object.create(e),l.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&ya(e.next,l),error:e.error&&ya(e.error,l),complete:e.complete&&ya(e.complete,l)}):i=e}this.destination=new Zo(i)}}function Ui(t){be.useDeprecatedSynchronousErrorHandling?function Co(t){be.useDeprecatedSynchronousErrorHandling&&ro&&(ro.errorThrown=!0,ro.error=t)}(t):Bi(t)}function Eo(t,e){const{onStoppedNotification:r}=be;r&&Go.setTimeout(()=>r(t,e))}const ms={closed:!0,next:Un,error:function _a(t){throw t},complete:Un},xt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Gr(t){return t}function $i(t){return 0===t.length?Gr:1===t.length?t[0]:function(r){return t.reduce((n,i)=>i(n),r)}}let hn=(()=>{class t{constructor(r){r&&(this._subscribe=r)}lift(r){const n=new t;return n.source=this,n.operator=r,n}subscribe(r,n,i){const l=function xa(t){return t&&t instanceof Do||function va(t){return t&&An(t.next)&&An(t.error)&&An(t.complete)}(t)&&wo(t)}(r)?r:new io(r,n,i);return jn(()=>{const{operator:h,source:f}=this;l.add(h?h.call(l,f):f?this._subscribe(l):this._trySubscribe(l))}),l}_trySubscribe(r){try{return this._subscribe(r)}catch(n){r.error(n)}}forEach(r,n){return new(n=gs(n))((i,l)=>{const h=new io({next:f=>{try{r(f)}catch(w){l(w),h.unsubscribe()}},error:l,complete:i});this.subscribe(h)})}_subscribe(r){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(r)}[xt](){return this}pipe(...r){return $i(r)(this)}toPromise(r){return new(r=gs(r))((n,i)=>{let l;this.subscribe(h=>l=h,h=>i(h),()=>n(l))})}}return t.create=e=>new t(e),t})();function gs(t){var e;return null!==(e=t??be.Promise)&&void 0!==e?e:Promise}const ba=$c(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Cr=(()=>{class t extends hn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const n=new Xo(this,this);return n.operator=r,n}_throwIfClosed(){if(this.closed)throw new ba}next(r){jn(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(r)}})}error(r){jn(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:n}=this;for(;n.length;)n.shift().error(r)}})}complete(){jn(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:n,isStopped:i,observers:l}=this;return n||i?Ho:(this.currentObservers=null,l.push(r),new Wn(()=>{this.currentObservers=null,_(l,r)}))}_checkFinalizedStatuses(r){const{hasError:n,thrownError:i,isStopped:l}=this;n?r.error(i):l&&r.complete()}asObservable(){const r=new hn;return r.source=this,r}}return t.create=(e,r)=>new Xo(e,r),t})();class Xo extends Cr{constructor(e,r){super(),this.destination=e,this.source=r}next(e){var r,n;null===(n=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===n||n.call(r,e)}error(e){var r,n;null===(n=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===n||n.call(r,e)}complete(){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===r||r.call(e)}_subscribe(e){var r,n;return null!==(n=null===(r=this.source)||void 0===r?void 0:r.subscribe(e))&&void 0!==n?n:Ho}}class fr extends Cr{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const r=super._subscribe(e);return!r.closed&&e.next(this._value),r}getValue(){const{hasError:e,thrownError:r,_value:n}=this;if(e)throw r;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}function Ko(t){return An(t?.lift)}function pn(t){return e=>{if(Ko(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function $n(t,e,r,n,i){return new cl(t,e,r,n,i)}class cl extends Do{constructor(e,r,n,i,l,h){super(e),this.onFinalize=l,this.shouldUnsubscribe=h,this._next=r?function(f){try{r(f)}catch(w){e.error(w)}}:super._next,this._error=i?function(f){try{i(f)}catch(w){e.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(f){e.error(f)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:r}=this;super.unsubscribe(),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function $t(t,e){return pn((r,n)=>{let i=0;r.subscribe($n(n,l=>{n.next(t.call(e,l,i++))}))})}function mr(t){return this instanceof mr?(this.v=t,this):new mr(t)}function Qo(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,e=t[Symbol.asyncIterator];return e?e.call(t):(t=function we(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(l){r[l]=t[l]&&function(h){return new Promise(function(f,w){!function i(l,h,f,w){Promise.resolve(w).then(function(E){l({value:E,done:f})},h)}(f,w,(h=t[l](h)).done,h.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const so=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function bs(t){return An(t?.then)}function ws(t){return An(t[xt])}function Gs(t){return Symbol.asyncIterator&&An(t?.[Symbol.asyncIterator])}function Cs(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const k=function G(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function N(t){return An(t?.[k])}function j(t){return function _i(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=r.apply(t,e||[]),l=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",function h(J){return function(he){return Promise.resolve(he).then(J,O)}}),i[Symbol.asyncIterator]=function(){return this},i;function f(J,he){n[J]&&(i[J]=function(xe){return new Promise(function(Ie,ke){l.push([J,xe,Ie,ke])>1||w(J,xe)})},he&&(i[J]=he(i[J])))}function w(J,he){try{!function E(J){J.value instanceof mr?Promise.resolve(J.value.v).then(P,O):Z(l[0][2],J)}(n[J](he))}catch(xe){Z(l[0][3],xe)}}function P(J){w("next",J)}function O(J){w("throw",J)}function Z(J,he){J(he),l.shift(),l.length&&w(l[0][0],l[0][1])}}(this,arguments,function*(){const r=t.getReader();try{for(;;){const{value:n,done:i}=yield mr(r.read());if(i)return yield mr(void 0);yield yield mr(n)}}finally{r.releaseLock()}})}function H(t){return An(t?.getReader)}function Q(t){if(t instanceof hn)return t;if(null!=t){if(ws(t))return function ie(t){return new hn(e=>{const r=t[xt]();if(An(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(so(t))return function ne(t){return new hn(e=>{for(let r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}(t);if(bs(t))return function te(t){return new hn(e=>{t.then(r=>{e.closed||(e.next(r),e.complete())},r=>e.error(r)).then(null,Bi)})}(t);if(Gs(t))return _e(t);if(N(t))return function oe(t){return new hn(e=>{for(const r of t)if(e.next(r),e.closed)return;e.complete()})}(t);if(H(t))return function Pe(t){return _e(j(t))}(t)}throw Cs(t)}function _e(t){return new hn(e=>{(function ye(t,e){var r,n,i,l;return function So(t,e,r,n){return new(r||(r=Promise))(function(l,h){function f(P){try{E(n.next(P))}catch(O){h(O)}}function w(P){try{E(n.throw(P))}catch(O){h(O)}}function E(P){P.done?l(P.value):function i(l){return l instanceof r?l:new r(function(h){h(l)})}(P.value).then(f,w)}E((n=n.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){try{for(r=Qo(t);!(n=yield r.next()).done;)if(e.next(n.value),e.closed)return}catch(h){i={error:h}}finally{try{n&&!n.done&&(l=r.return)&&(yield l.call(r))}finally{if(i)throw i.error}}e.complete()})})(t,e).catch(r=>e.error(r))})}function Ke(t,e,r,n=0,i=!1){const l=e.schedule(function(){r(),i?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(l),!i)return l}function ze(t,e,r=1/0){return An(e)?ze((n,i)=>$t((l,h)=>e(n,l,i,h))(Q(t(n,i))),r):("number"==typeof e&&(r=e),pn((n,i)=>function st(t,e,r,n,i,l,h,f){const w=[];let E=0,P=0,O=!1;const Z=()=>{O&&!w.length&&!E&&e.complete()},J=xe=>E<n?he(xe):w.push(xe),he=xe=>{l&&e.next(xe),E++;let Ie=!1;Q(r(xe,P++)).subscribe($n(e,ke=>{i?.(ke),l?J(ke):e.next(ke)},()=>{Ie=!0},void 0,()=>{if(Ie)try{for(E--;w.length&&E<n;){const ke=w.shift();h?Ke(e,h,()=>he(ke)):he(ke)}Z()}catch(ke){e.error(ke)}}))};return t.subscribe($n(e,J,()=>{O=!0,Z()})),()=>{f?.()}}(n,i,t,r)))}function dt(t=1/0){return ze(Gr,t)}const ht=new hn(t=>t.complete());function Ht(t){return t[t.length-1]}function vn(t){return An(Ht(t))?t.pop():void 0}function Xn(t){return function Lt(t){return t&&An(t.schedule)}(Ht(t))?t.pop():void 0}function Rr(t,e=0){return pn((r,n)=>{r.subscribe($n(n,i=>Ke(n,t,()=>n.next(i),e),()=>Ke(n,t,()=>n.complete(),e),i=>Ke(n,t,()=>n.error(i),e)))})}function qs(t,e=0){return pn((r,n)=>{n.add(t.schedule(()=>r.subscribe(n),e))})}function Gc(t,e){if(!t)throw new Error("Iterable cannot be null");return new hn(r=>{Ke(r,e,()=>{const n=t[Symbol.asyncIterator]();Ke(r,e,()=>{n.next().then(i=>{i.done?r.complete():r.next(i.value)})},0,!0)})})}function gr(t,e){return e?function qc(t,e){if(null!=t){if(ws(t))return function fl(t,e){return Q(t).pipe(qs(e),Rr(e))}(t,e);if(so(t))return function jc(t,e){return new hn(r=>{let n=0;return e.schedule(function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())})})}(t,e);if(bs(t))return function Dn(t,e){return Q(t).pipe(qs(e),Rr(e))}(t,e);if(Gs(t))return Gc(t,e);if(N(t))return function Hc(t,e){return new hn(r=>{let n;return Ke(r,e,()=>{n=t[k](),Ke(r,e,()=>{let i,l;try{({value:i,done:l}=n.next())}catch(h){return void r.error(h)}l?r.complete():r.next(i)},0,!0)}),()=>An(n?.return)&&n.return()})}(t,e);if(H(t))return function nd(t,e){return Gc(j(t),e)}(t,e)}throw Cs(t)}(t,e):Q(t)}function wt(...t){return gr(t,Xn(t))}function Zc(t={}){const{connector:e=(()=>new Cr),resetOnError:r=!0,resetOnComplete:n=!0,resetOnRefCountZero:i=!0}=t;return l=>{let h,f,w,E=0,P=!1,O=!1;const Z=()=>{f?.unsubscribe(),f=void 0},J=()=>{Z(),h=w=void 0,P=O=!1},he=()=>{const xe=h;J(),xe?.unsubscribe()};return pn((xe,Ie)=>{E++,!O&&!P&&Z();const ke=w=w??e();Ie.add(()=>{E--,0===E&&!O&&!P&&(f=rc(he,i))}),ke.subscribe(Ie),!h&&E>0&&(h=new io({next:Ee=>ke.next(Ee),error:Ee=>{O=!0,Z(),f=rc(J,r,Ee),ke.error(Ee)},complete:()=>{P=!0,Z(),f=rc(J,n),ke.complete()}}),Q(xe).subscribe(h))})(l)}}function rc(t,e,...r){if(!0===e)return void t();if(!1===e)return;const n=new io({next:()=>{n.unsubscribe(),t()}});return Q(e(...r)).subscribe(n)}function ji(t,e){return pn((r,n)=>{let i=null,l=0,h=!1;const f=()=>h&&!i&&n.complete();r.subscribe($n(n,w=>{i?.unsubscribe();let E=0;const P=l++;Q(t(w,P)).subscribe(i=$n(n,O=>n.next(e?e(w,O,P,E++):O),()=>{i=null,f()}))},()=>{h=!0,f()}))})}function ml(t,e){return t===e}function rn(t){for(let e in t)if(t[e]===rn)return e;throw Error("Could not find renamed property on target object.")}function Ea(t,e){for(const r in e)e.hasOwnProperty(r)&&!t.hasOwnProperty(r)&&(t[r]=e[r])}function Kn(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Kn).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const r=e.indexOf("\n");return-1===r?e:e.substring(0,r)}function Ds(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const Wc=rn({__forward_ref__:rn});function En(t){return t.__forward_ref__=En,t.toString=function(){return Kn(this())},t}function Ct(t){return Pn(t)?t():t}function Pn(t){return"function"==typeof t&&t.hasOwnProperty(Wc)&&t.__forward_ref__===En}function Ws(t){return t&&!!t.\u0275providers}const Xc="https://g.co/ng/security#xss";class Ne extends Error{constructor(e,r){super(function Xs(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,r)),this.code=e}}function At(t){return"string"==typeof t?t:null==t?"":String(t)}function Ia(t,e){throw new Ne(-201,!1)}function ui(t,e){null==t&&function cn(t,e,r,n){throw new Error(`ASSERTION ERROR: ${t}`+(null==n?"":` [Expected=> ${r} ${n} ${e} <=Actual]`))}(e,t,null,"!=")}function ft(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function qi(t){return{providers:t.providers||[],imports:t.imports||[]}}function sc(t){return ld(t,Ta)||ld(t,ac)}function ld(t,e){return t.hasOwnProperty(e)?t[e]:null}function cd(t){return t&&(t.hasOwnProperty(Sa)||t.hasOwnProperty(eu))?t[Sa]:null}const Ta=rn({\u0275prov:rn}),Sa=rn({\u0275inj:rn}),ac=rn({ngInjectableDef:rn}),eu=rn({ngInjectorDef:rn});var _t=(()=>((_t=_t||{})[_t.Default=0]="Default",_t[_t.Host=1]="Host",_t[_t.Self=2]="Self",_t[_t.SkipSelf=4]="SkipSelf",_t[_t.Optional=8]="Optional",_t))();let lc;function Fr(t){const e=lc;return lc=t,e}function Es(t,e,r){const n=sc(t);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:r&_t.Optional?null:void 0!==e?e:void Ia(Kn(t))}const fn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Zt={},In="__NG_DI_FLAG__",Tn="ngTempTokenPath",Ma=/\n/gm,ud="__source";let Ks;function ao(t){const e=Ks;return Ks=t,e}function _l(t,e=_t.Default){if(void 0===Ks)throw new Ne(-203,!1);return null===Ks?Es(t,void 0,e):Ks.get(t,e&_t.Optional?null:void 0,e)}function lt(t,e=_t.Default){return(function tu(){return lc}()||_l)(Ct(t),e)}function rt(t,e=_t.Default){return lt(t,vl(e))}function vl(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Pa(t){const e=[];for(let r=0;r<t.length;r++){const n=Ct(t[r]);if(Array.isArray(n)){if(0===n.length)throw new Ne(900,!1);let i,l=_t.Default;for(let h=0;h<n.length;h++){const f=n[h],w=lo(f);"number"==typeof w?-1===w?i=f.token:l|=w:i=f}e.push(lt(i,l))}else e.push(lt(n))}return e}function Is(t,e){return t[In]=e,t.prototype[In]=e,t}function lo(t){return t[In]}function Mo(t){return{toString:t}.toString()}var qr=(()=>((qr=qr||{})[qr.OnPush=0]="OnPush",qr[qr.Default=1]="Default",qr))(),Lr=(()=>{return(t=Lr||(Lr={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",Lr;var t})();const vi={},un=[],Ys=rn({\u0275cmp:rn}),cc=rn({\u0275dir:rn}),uc=rn({\u0275pipe:rn}),ka=rn({\u0275mod:rn}),co=rn({\u0275fac:rn}),Ts=rn({__NG_ELEMENT_ID__:rn}),Ra=rn({__NG_ENV_ID__:rn});function Js(t,e,r){let n=t.length;for(;;){const i=t.indexOf(e,r);if(-1===i)return i;if(0===i||t.charCodeAt(i-1)<=32){const l=e.length;if(i+l===n||t.charCodeAt(i+l)<=32)return i}r=i+1}}function Qs(t,e,r){let n=0;for(;n<r.length;){const i=r[n];if("number"==typeof i){if(0!==i)break;n++;const l=r[n++],h=r[n++],f=r[n++];t.setAttribute(e,h,f,l)}else{const l=i,h=r[++n];Fa(l)?t.setProperty(e,l,h):t.setAttribute(e,l,h),n++}}return n}function ru(t){return 3===t||4===t||6===t}function Fa(t){return 64===t.charCodeAt(0)}function La(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let r=-1;for(let n=0;n<e.length;n++){const i=e[n];"number"==typeof i?r=i:0===r||iu(t,r,i,null,-1===r||2===r?e[++n]:null)}}return t}function iu(t,e,r,n,i){let l=0,h=t.length;if(-1===e)h=-1;else for(;l<t.length;){const f=t[l++];if("number"==typeof f){if(f===e){h=-1;break}if(f>e){h=l-1;break}}}for(;l<t.length;){const f=t[l];if("number"==typeof f)break;if(f===r){if(null===n)return void(null!==i&&(t[l+1]=i));if(n===t[l+1])return void(t[l+2]=i)}l++,null!==n&&l++,null!==i&&l++}-1!==h&&(t.splice(h,0,e),l=h+1),t.splice(l++,0,r),null!==n&&t.splice(l++,0,n),null!==i&&t.splice(l++,0,i)}const ou="ng-template";function Oa(t,e,r){let n=0,i=!0;for(;n<t.length;){let l=t[n++];if("string"==typeof l&&i){const h=t[n++];if(r&&"class"===l&&-1!==Js(h.toLowerCase(),e,0))return!0}else{if(1===l){for(;n<t.length&&"string"==typeof(l=t[n++]);)if(l.toLowerCase()===e)return!0;return!1}"number"==typeof l&&(i=!1)}}return!1}function su(t){return 4===t.type&&t.value!==ou}function xl(t,e,r){return e===(4!==t.type||r?t.value:ou)}function bl(t,e,r){let n=4;const i=t.attrs||[],l=function Ss(t){for(let e=0;e<t.length;e++)if(ru(t[e]))return e;return t.length}(i);let h=!1;for(let f=0;f<e.length;f++){const w=e[f];if("number"!=typeof w){if(!h)if(4&n){if(n=2|1&n,""!==w&&!xl(t,w,r)||""===w&&1===e.length){if(Hn(n))return!1;h=!0}}else{const E=8&n?w:e[++f];if(8&n&&null!==t.attrs){if(!Oa(t.attrs,E,r)){if(Hn(n))return!1;h=!0}continue}const O=wl(8&n?"class":w,i,su(t),r);if(-1===O){if(Hn(n))return!1;h=!0;continue}if(""!==E){let Z;Z=O>l?"":i[O+1].toLowerCase();const J=8&n?Z:null;if(J&&-1!==Js(J,E,0)||2&n&&E!==Z){if(Hn(n))return!1;h=!0}}}}else{if(!h&&!Hn(n)&&!Hn(w))return!1;if(h&&Hn(w))continue;h=!1,n=w|1&n}}return Hn(n)||h}function Hn(t){return 0==(1&t)}function wl(t,e,r,n){if(null===e)return-1;let i=0;if(n||!r){let l=!1;for(;i<e.length;){const h=e[i];if(h===t)return i;if(3===h||6===h)l=!0;else{if(1===h||2===h){let f=e[++i];for(;"string"==typeof f;)f=e[++i];continue}if(4===h)break;if(0===h){i+=4;continue}}i+=l?1:2}return-1}return function hd(t,e){let r=t.indexOf(4);if(r>-1)for(r++;r<t.length;){const n=t[r];if("number"==typeof n)return-1;if(n===e)return r;r++}return-1}(e,t)}function xi(t,e,r=!1){for(let n=0;n<e.length;n++)if(bl(t,e[n],r))return!0;return!1}function Na(t,e){return t?":not("+e.trim()+")":e}function au(t){let e=t[0],r=1,n=2,i="",l=!1;for(;r<t.length;){let h=t[r];if("string"==typeof h)if(2&n){const f=t[++r];i+="["+h+(f.length>0?'="'+f+'"':"")+"]"}else 8&n?i+="."+h:4&n&&(i+=" "+h);else""!==i&&!Hn(h)&&(e+=Na(l,i),i=""),n=h,l=l||!Hn(n);r++}return""!==i&&(e+=Na(l,i)),e}function sr(t){return Mo(()=>{const e=lu(t),r={...e,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===qr.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:null,data:t.data||{},encapsulation:t.encapsulation||Lr.Emulated,styles:t.styles||un,_:null,schemas:t.schemas||null,tView:null,id:""};pd(r);const n=t.dependencies;return r.directiveDefs=Dl(n,!1),r.pipeDefs=Dl(n,!0),r.id=function uu(t){let e=0;const r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const i of r)e=Math.imul(31,e)+i.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(r),r})}function ns(t){return on(t)||Zr(t)}function et(t){return null!==t}function Zi(t){return Mo(()=>({type:t.type,bootstrap:t.bootstrap||un,declarations:t.declarations||un,imports:t.imports||un,exports:t.exports||un,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function rs(t,e){if(null==t)return vi;const r={};for(const n in t)if(t.hasOwnProperty(n)){let i=t[n],l=i;Array.isArray(i)&&(l=i[1],i=i[0]),r[i]=n,e&&(e[i]=l)}return r}function Tt(t){return Mo(()=>{const e=lu(t);return pd(e),e})}function Be(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function on(t){return t[Ys]||null}function Zr(t){return t[cc]||null}function Wr(t){return t[uc]||null}function bi(t,e){const r=t[ka]||null;if(!r&&!0===e)throw new Error(`Type ${Kn(t)} does not have '\u0275mod' property.`);return r}function lu(t){const e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,exportAs:t.exportAs||null,standalone:!0===t.standalone,selectors:t.selectors||un,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:rs(t.inputs,e),outputs:rs(t.outputs)}}function pd(t){t.features?.forEach(e=>e(t))}function Dl(t,e){if(!t)return null;const r=e?Wr:ns;return()=>("function"==typeof t?t():t).map(n=>r(n)).filter(et)}const tr=0,tt=1,vt=2,bn=3,Wi=4,Xi=5,Er=6,Ao=7,Gn=8,Or=9,mn=10,St=11,As=12,du=13,ta=14,nr=15,El=16,di=17,wi=18,it=19,gt=20,Pi=21,uo=22,ho=23,ar=24,Ot=25,dc=1,os=2,gn=7,qn=8,Ps=9,m=11;function u(t){return Array.isArray(t)&&"object"==typeof t[dc]}function p(t){return Array.isArray(t)&&!0===t[dc]}function y(t){return 0!=(4&t.flags)}function x(t){return t.componentOffset>-1}function C(t){return 1==(1&t.flags)}function T(t){return!!t.template}function S(t){return 0!=(512&t[vt])}function ct(t,e){return t.hasOwnProperty(co)?t[co]:null}let Ir=fn.WeakRef??class Cn{constructor(e){this.ref=e}deref(){return this.ref}},Ro=0,Nr=null,hi=!1;function yn(t){const e=Nr;return Nr=t,e}class Fo{constructor(){this.id=Ro++,this.ref=function Po(t){return new Ir(t)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[e,r]of this.producers){const n=r.producerNode.deref();if(void 0!==n&&r.atTrackingVersion===this.trackingVersion){if(n.producerPollStatus(r.seenValueVersion))return!0}else this.producers.delete(e),n?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const e=hi;hi=!0;try{for(const[r,n]of this.consumers){const i=n.consumerNode.deref();void 0!==i&&i.trackingVersion===n.atTrackingVersion?i.onConsumerDependencyMayHaveChanged():(this.consumers.delete(r),i?.producers.delete(this.id))}}finally{hi=e}}producerAccessed(){if(hi)throw new Error("");if(null===Nr)return;let e=Nr.producers.get(this.id);void 0===e?(e={consumerNode:Nr.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Nr.trackingVersion},Nr.producers.set(this.id,e),this.consumers.set(Nr.id,e)):(e.seenValueVersion=this.valueVersion,e.atTrackingVersion=Nr.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Nr?.consumerAllowSignalWrites}producerPollStatus(e){return this.valueVersion!==e||(this.onProducerUpdateValueVersion(),this.valueVersion!==e)}}let Rn=null;const ks=()=>{};class ra extends Fo{constructor(e,r,n){super(),this.watch=e,this.schedule=r,this.dirty=!1,this.cleanupFn=ks,this.registerOnCleanup=i=>{this.cleanupFn=i},this.consumerAllowSignalWrites=n}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const e=yn(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=ks,this.watch(this.registerOnCleanup)}finally{yn(e)}}cleanup(){this.cleanupFn()}}class hc{constructor(e,r,n){this.previousValue=e,this.currentValue=r,this.firstChange=n}isFirstChange(){return this.firstChange}}function fo(){return Lf}function Lf(t){return t.type.prototype.ngOnChanges&&(t.setInput=pu),zh}function zh(){const t=Rs(this),e=t?.current;if(e){const r=t.previous;if(r===vi)t.previous=e;else for(let n in e)r[n]=e[n];t.current=null,this.ngOnChanges(e)}}function pu(t,e,r,n){const i=this.declaredInputs[r],l=Rs(t)||function as(t,e){return t[Il]=e}(t,{previous:vi,current:null}),h=l.current||(l.current={}),f=l.previous,w=f[i];h[i]=new hc(w&&w.currentValue,e,f===vi),t[n]=e}fo.ngInherit=!0;const Il="__ngSimpleChanges__";function Rs(t){return t[Il]||null}const Di=function(t,e,r){};function zt(t){for(;Array.isArray(t);)t=t[tr];return t}function fu(t,e){return zt(e[t])}function Sr(t,e){return zt(e[t.index])}function mu(t,e){return t.data[e]}function Va(t,e){return t[e]}function ki(t,e){const r=e[t];return u(r)?r:r[tr]}function gu(t){return 128==(128&t[vt])}function Ls(t,e){return null==e?null:t[e]}function zf(t){t[di]=0}function Uh(t){1024&t[vt]||(t[vt]|=1024,jh(t,1))}function $h(t){1024&t[vt]&&(t[vt]&=-1025,jh(t,-1))}function jh(t,e){let r=t[bn];if(null===r)return;r[Xi]+=e;let n=r;for(r=r[bn];null!==r&&(1===e&&1===n[Xi]||-1===e&&0===n[Xi]);)r[Xi]+=e,n=r,r=r[bn]}const Dt={lFrame:Hf(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function pi(){return Dt.bindingsEnabled}function Le(){return Dt.lFrame.lView}function tn(){return Dt.lFrame.tView}function lr(t){return Dt.lFrame.contextLView=t,t[Gn]}function cr(t){return Dt.lFrame.contextLView=null,t}function Xr(){let t=Uf();for(;null!==t&&64===t.type;)t=t.parent;return t}function Uf(){return Dt.lFrame.currentTNode}function ls(t,e){const r=Dt.lFrame;r.currentTNode=t,r.isParent=e}function vu(){return Dt.lFrame.isParent}function Ri(){const t=Dt.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}function ia(){return Dt.lFrame.bindingIndex}function oa(){return Dt.lFrame.bindingIndex++}function Os(t){const e=Dt.lFrame,r=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,r}function my(t,e){const r=Dt.lFrame;r.bindingIndex=r.bindingRootIndex=t,qh(e)}function qh(t){Dt.lFrame.currentDirectiveIndex=t}function Wh(t){Dt.lFrame.currentQueryIndex=t}function yy(t){const e=t[tt];return 2===e.type?e.declTNode:1===e.type?t[Er]:null}function md(t,e,r){if(r&_t.SkipSelf){let i=e,l=t;for(;!(i=i.parent,null!==i||r&_t.Host||(i=yy(l),null===i||(l=l[ta],10&i.type))););if(null===i)return!1;e=i,t=l}const n=Dt.lFrame=Rl();return n.currentTNode=e,n.lView=t,!0}function Xh(t){const e=Rl(),r=t[tt];Dt.lFrame=e,e.currentTNode=r.firstChild,e.lView=t,e.tView=r,e.contextLView=t,e.bindingIndex=r.bindingStartIndex,e.inI18n=!1}function Rl(){const t=Dt.lFrame,e=null===t?null:t.child;return null===e?Hf(t):e}function Hf(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function Yn(){const t=Dt.lFrame;return Dt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const bu=Yn;function gd(){const t=Yn();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Br(){return Dt.lFrame.selectedIndex}function Ua(t){Dt.lFrame.selectedIndex=t}function Jn(){const t=Dt.lFrame;return mu(t.tView,t.selectedIndex)}let fc=!0;function vd(){return fc}function Ns(t){fc=t}function mc(t,e){for(let r=e.directiveStart,n=e.directiveEnd;r<n;r++){const l=t.data[r].type.prototype,{ngAfterContentInit:h,ngAfterContentChecked:f,ngAfterViewInit:w,ngAfterViewChecked:E,ngOnDestroy:P}=l;h&&(t.contentHooks??=[]).push(-r,h),f&&((t.contentHooks??=[]).push(r,f),(t.contentCheckHooks??=[]).push(r,f)),w&&(t.viewHooks??=[]).push(-r,w),E&&((t.viewHooks??=[]).push(r,E),(t.viewCheckHooks??=[]).push(r,E)),null!=P&&(t.destroyHooks??=[]).push(r,P)}}function gc(t,e,r){Gf(t,e,3,r)}function yc(t,e,r,n){(3&t[vt])===r&&Gf(t,e,r,n)}function Qh(t,e){let r=t[vt];(3&r)===e&&(r&=4095,r+=1,t[vt]=r)}function Gf(t,e,r,n){const l=n??-1,h=e.length-1;let f=0;for(let w=void 0!==n?65535&t[di]:0;w<h;w++)if("number"==typeof e[w+1]){if(f=e[w],null!=n&&f>=n)break}else e[w]<0&&(t[di]+=65536),(f<l||-1==l)&&(xy(t,r,e,w),t[di]=(4294901760&t[di])+w+2),w++}function qf(t,e){Di(4,t,e);const r=yn(null);try{e.call(t)}finally{yn(r),Di(5,t,e)}}function xy(t,e,r,n){const i=r[n]<0,l=r[n+1],f=t[i?-r[n]:r[n]];i?t[vt]>>12<t[di]>>16&&(3&t[vt])===e&&(t[vt]+=4096,qf(f,l)):qf(f,l)}const _c=-1;class Lo{constructor(e,r,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=n}}function Zf(t){return t!==_c}function xd(t){return 32767&t}function bd(t,e){let r=function Ty(t){return t>>16}(t),n=e;for(;r>0;)n=n[ta],r--;return n}let Cu=!0;function ja(t){const e=Cu;return Cu=t,e}const Xf=255,Kf=5;let Sy=0;const Ki={};function wd(t,e){const r=Jf(t,e);if(-1!==r)return r;const n=e[tt];n.firstCreatePass&&(t.injectorIndex=e.length,ep(n.data,t),ep(e,null),ep(n.blueprint,null));const i=tp(t,e),l=t.injectorIndex;if(Zf(i)){const h=xd(i),f=bd(i,e),w=f[tt].data;for(let E=0;E<8;E++)e[l+E]=f[h+E]|w[h+E]}return e[l+8]=i,l}function ep(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Jf(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function tp(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let r=0,n=null,i=e;for(;null!==i;){if(n=ap(i),null===n)return _c;if(r++,i=i[ta],-1!==n.injectorIndex)return n.injectorIndex|r<<16}return _c}function np(t,e,r){!function Yf(t,e,r){let n;"string"==typeof r?n=r.charCodeAt(0)||0:r.hasOwnProperty(Ts)&&(n=r[Ts]),null==n&&(n=r[Ts]=Sy++);const i=n&Xf;e.data[t+(i>>Kf)]|=1<<i}(t,e,r)}function rp(t,e,r){if(r&_t.Optional||void 0!==t)return t;Ia()}function Cd(t,e,r,n){if(r&_t.Optional&&void 0===n&&(n=null),!(r&(_t.Self|_t.Host))){const i=t[Or],l=Fr(void 0);try{return i?i.get(e,n,r&_t.Optional):Es(e,n,r&_t.Optional)}finally{Fr(l)}}return rp(n,0,r)}function Qf(t,e,r,n=_t.Default,i){if(null!==t){if(2048&e[vt]&&!(n&_t.Self)){const h=function sp(t,e,r,n,i){let l=t,h=e;for(;null!==l&&null!==h&&2048&h[vt]&&!(512&h[vt]);){const f=ip(l,h,r,n|_t.Self,Ki);if(f!==Ki)return f;let w=l.parent;if(!w){const E=h[gt];if(E){const P=E.get(r,Ki,n);if(P!==Ki)return P}w=ap(h),h=h[ta]}l=w}return i}(t,e,r,n,Ki);if(h!==Ki)return h}const l=ip(t,e,r,n,Ki);if(l!==Ki)return l}return Cd(e,r,n,i)}function ip(t,e,r,n,i){const l=function Ay(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(Ts)?t[Ts]:void 0;return"number"==typeof e?e>=0?e&Xf:Py:e}(r);if("function"==typeof l){if(!md(e,t,n))return n&_t.Host?rp(i,0,n):Cd(e,r,n,i);try{const h=l(n);if(null!=h||n&_t.Optional)return h;Ia()}finally{bu()}}else if("number"==typeof l){let h=null,f=Jf(t,e),w=_c,E=n&_t.Host?e[nr][Er]:null;for((-1===f||n&_t.SkipSelf)&&(w=-1===f?tp(t,e):e[f+8],w!==_c&&op(n,!1)?(h=e[tt],f=xd(w),e=bd(w,e)):f=-1);-1!==f;){const P=e[tt];if(tm(l,f,P.data)){const O=em(f,e,r,h,n,E);if(O!==Ki)return O}w=e[f+8],w!==_c&&op(n,e[tt].data[f+8]===E)&&tm(l,f,e)?(h=P,f=xd(w),e=bd(w,e)):f=-1}}return i}function em(t,e,r,n,i,l){const h=e[tt],f=h.data[t+8],P=function Du(t,e,r,n,i){const l=t.providerIndexes,h=e.data,f=1048575&l,w=t.directiveStart,P=l>>20,Z=i?f+P:t.directiveEnd;for(let J=n?f:f+P;J<Z;J++){const he=h[J];if(J<w&&r===he||J>=w&&he.type===r)return J}if(i){const J=h[w];if(J&&T(J)&&J.type===r)return w}return null}(f,h,r,null==n?x(f)&&Cu:n!=h&&0!=(3&f.type),i&_t.Host&&l===f);return null!==P?Fl(e,h,P,f):Ki}function Fl(t,e,r,n){let i=t[r];const l=e.data;if(function by(t){return t instanceof Lo}(i)){const h=i;h.resolving&&function Eh(t,e){const r=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new Ne(-200,`Circular dependency in DI detected for ${t}${r}`)}(function xn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():At(t)}(l[r]));const f=ja(h.canSeeViewProviders);h.resolving=!0;const w=h.injectImpl?Fr(h.injectImpl):null;md(t,n,_t.Default);try{i=t[r]=h.factory(void 0,l,t,n),e.firstCreatePass&&r>=n.directiveStart&&function vy(t,e,r){const{ngOnChanges:n,ngOnInit:i,ngDoCheck:l}=e.type.prototype;if(n){const h=Lf(e);(r.preOrderHooks??=[]).push(t,h),(r.preOrderCheckHooks??=[]).push(t,h)}i&&(r.preOrderHooks??=[]).push(0-t,i),l&&((r.preOrderHooks??=[]).push(t,l),(r.preOrderCheckHooks??=[]).push(t,l))}(r,l[r],e)}finally{null!==w&&Fr(w),ja(f),h.resolving=!1,bu()}}return i}function tm(t,e,r){return!!(r[e+(t>>Kf)]&1<<t)}function op(t,e){return!(t&_t.Self||t&_t.Host&&e)}class vc{constructor(e,r){this._tNode=e,this._lView=r}get(e,r,n){return Qf(this._tNode,this._lView,e,vl(n),r)}}function Py(){return new vc(Xr(),Le())}function yr(t){return Mo(()=>{const e=t.prototype.constructor,r=e[co]||_r(e),n=Object.prototype;let i=Object.getPrototypeOf(t.prototype).constructor;for(;i&&i!==n;){const l=i[co]||_r(i);if(l&&l!==r)return l;i=Object.getPrototypeOf(i)}return l=>new l})}function _r(t){return Pn(t)?()=>{const e=_r(Ct(t));return e&&e()}:ct(t)}function ap(t){const e=t[tt],r=e.type;return 2===r?e.declTNode:1===r?t[Er]:null}const go="__parameters__";function Yi(t,e,r){return Mo(()=>{const n=function Dd(t){return function(...r){if(t){const n=t(...r);for(const i in n)this[i]=n[i]}}}(e);function i(...l){if(this instanceof i)return n.apply(this,l),this;const h=new i(...l);return f.annotation=h,f;function f(w,E,P){const O=w.hasOwnProperty(go)?w[go]:Object.defineProperty(w,go,{value:[]})[go];for(;O.length<=P;)O.push(null);return(O[P]=O[P]||[]).push(h),w}}return r&&(i.prototype=Object.create(r.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i})}function Su(t,e){t.forEach(r=>Array.isArray(r)?Su(r,e):e(r))}function cp(t,e,r){e>=t.length?t.push(r):t.splice(e,0,r)}function wc(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function Ii(t,e,r){let n=Ll(t,e);return n>=0?t[1|n]=r:(n=~n,function Dc(t,e,r,n){let i=t.length;if(i==e)t.push(r,n);else if(1===i)t.push(n,t[0]),t[0]=r;else{for(i--,t.push(t[i-1],t[i]);i>e;)t[i]=t[i-2],i--;t[e]=r,t[e+1]=n}}(t,n,e,r)),n}function dp(t,e){const r=Ll(t,e);if(r>=0)return t[1|r]}function Ll(t,e){return function rm(t,e,r){let n=0,i=t.length>>r;for(;i!==n;){const l=n+(i-n>>1),h=t[l<<r];if(e===h)return l<<r;h>e?i=l:n=l+1}return~(i<<r)}(t,e,1)}const cs=Is(Yi("Optional"),8),Mu=Is(Yi("SkipSelf"),4);function Nn(t){return 128==(128&t.flags)}var Fi=(()=>((Fi=Fi||{})[Fi.Important=1]="Important",Fi[Fi.DashCase=2]="DashCase",Fi))();const Ru=new Map;let Ad=0;const kd="__ngContext__";function fi(t,e){u(e)?(t[kd]=e[it],function Ip(t){Ru.set(t[it],t)}(e)):t[kd]=e}let g;function v(t,e){return g(t,e)}function D(t){const e=t[bn];return p(e)?e[bn]:e}function R(t){return B(t[As])}function L(t){return B(t[Wi])}function B(t){for(;null!==t&&!p(t);)t=t[Wi];return t}function V(t,e,r,n,i){if(null!=n){let l,h=!1;p(n)?l=n:u(n)&&(h=!0,n=n[tr]);const f=zt(n);0===t&&null!==r?null==i?Rt(e,r,f):nt(e,r,f,i||null,!0):1===t&&null!==r?nt(e,r,f,i||null,!0):2===t?function Qr(t,e,r){const n=Ti(t,e);n&&function zn(t,e,r,n){t.removeChild(e,r,n)}(t,n,e,r)}(e,f,h):3===t&&e.destroyNode(f),null!=l&&function ei(t,e,r,n,i){const l=r[gn];l!==zt(r)&&V(e,t,n,l,i);for(let f=m;f<r.length;f++){const w=r[f];Qn(w[tt],w,t,e,n,l)}}(e,t,l,r,i)}}function ue(t,e,r){return t.createElement(e,r)}function ot(t,e){const r=t[Ps],n=r.indexOf(e);$h(e),r.splice(n,1)}function qe(t,e){if(t.length<=m)return;const r=m+e,n=t[r];if(n){const i=n[El];null!==i&&i!==t&&ot(i,n),e>0&&(t[r-1][Wi]=n[Wi]);const l=wc(t,m+e);!function ge(t,e){Qn(t,e,e[St],2,null,null),e[tr]=null,e[Er]=null}(n[tt],n);const h=l[wi];null!==h&&h.detachView(l[tt]),n[bn]=null,n[Wi]=null,n[vt]&=-129}return n}function $e(t,e){if(!(256&e[vt])){const r=e[St];e[ho]?.destroy(),e[ar]?.destroy(),r.destroyNode&&Qn(t,e,r,3,null,null),function Se(t){let e=t[As];if(!e)return Ve(t[tt],t);for(;e;){let r=null;if(u(e))r=e[As];else{const n=e[m];n&&(r=n)}if(!r){for(;e&&!e[Wi]&&e!==t;)u(e)&&Ve(e[tt],e),e=e[bn];null===e&&(e=t),u(e)&&Ve(e[tt],e),r=e&&e[Wi]}e=r}}(e)}}function Ve(t,e){if(!(256&e[vt])){e[vt]&=-129,e[vt]|=256,function Ge(t,e){let r;if(null!=t&&null!=(r=t.destroyHooks))for(let n=0;n<r.length;n+=2){const i=e[r[n]];if(!(i instanceof Lo)){const l=r[n+1];if(Array.isArray(l))for(let h=0;h<l.length;h+=2){const f=i[l[h]],w=l[h+1];Di(4,f,w);try{w.call(f)}finally{Di(5,f,w)}}else{Di(4,i,l);try{l.call(i)}finally{Di(5,i,l)}}}}}(t,e),function We(t,e){const r=t.cleanup,n=e[Ao];if(null!==r)for(let l=0;l<r.length-1;l+=2)if("string"==typeof r[l]){const h=r[l+3];h>=0?n[h]():n[-h].unsubscribe(),l+=2}else r[l].call(n[r[l+1]]);null!==n&&(e[Ao]=null);const i=e[Pi];if(null!==i){e[Pi]=null;for(let l=0;l<i.length;l++)(0,i[l])()}}(t,e),1===e[tt].type&&e[St].destroy();const r=e[El];if(null!==r&&p(e[bn])){r!==e[bn]&&ot(r,e);const n=e[wi];null!==n&&n.detachView(t)}!function yo(t){Ru.delete(t[it])}(e)}}function Oe(t,e,r){return function pt(t,e,r){let n=e;for(;null!==n&&40&n.type;)n=(e=n).parent;if(null===n)return r[tr];{const{componentOffset:i}=n;if(i>-1){const{encapsulation:l}=t.data[n.directiveStart+i];if(l===Lr.None||l===Lr.Emulated)return null}return Sr(n,r)}}(t,e.parent,r)}function nt(t,e,r,n,i){t.insertBefore(e,r,n,i)}function Rt(t,e,r){t.appendChild(e,r)}function kn(t,e,r,n,i){null!==n?nt(t,e,r,n,i):Rt(t,e,r)}function Ti(t,e){return t.parentNode(e)}let Ur,Lu,Ou,Vr=function vr(t,e,r){return 40&t.type?Sr(t,r):null};function Zn(t,e,r,n){const i=Oe(t,n,e),l=e[St],f=function ir(t,e,r){return Vr(t,e,r)}(n.parent||e[Er],n,e);if(null!=i)if(Array.isArray(r))for(let w=0;w<r.length;w++)kn(l,i,r[w],f,!1);else kn(l,i,r,f,!1);void 0!==Ur&&Ur(l,n,e,r,i)}function dr(t,e){if(null!==e){const r=e.type;if(3&r)return Sr(e,t);if(4&r)return Jr(-1,t[e.index]);if(8&r){const n=e.child;if(null!==n)return dr(t,n);{const i=t[e.index];return p(i)?Jr(-1,i):zt(i)}}if(32&r)return v(e,t)()||zt(t[e.index]);{const n=Yr(t,e);return null!==n?Array.isArray(n)?n[0]:dr(D(t[nr]),n):dr(t,e.next)}}return null}function Yr(t,e){return null!==e?t[nr][Er].projection[e.projection]:null}function Jr(t,e){const r=m+t+1;if(r<e.length){const n=e[r],i=n[tt].firstChild;if(null!==i)return dr(n,i)}return e[gn]}function Fn(t,e,r,n,i,l,h){for(;null!=r;){const f=n[r.index],w=r.type;if(h&&0===e&&(f&&fi(zt(f),n),r.flags|=2),32!=(32&r.flags))if(8&w)Fn(t,e,r.child,n,i,l,!1),V(e,t,i,f,l);else if(32&w){const E=v(r,n);let P;for(;P=E();)V(e,t,i,P,l);V(e,t,i,f,l)}else 16&w?Oi(t,e,n,r,i,l):V(e,t,i,f,l);r=h?r.projectionNext:r.next}}function Qn(t,e,r,n,i,l){Fn(r,n,t.firstChild,e,i,l,!1)}function Oi(t,e,r,n,i,l){const h=r[nr],w=h[Er].projection[n.projection];if(Array.isArray(w))for(let E=0;E<w.length;E++)V(e,t,i,w[E],l);else{let E=w;const P=h[bn];Nn(n)&&(E.flags|=128),Fn(t,e,E,P,i,l,!0)}}function Bo(t,e,r){""===r?t.removeAttribute(e,"class"):t.setAttribute(e,"class",r)}function Vo(t,e,r){const{mergedAttrs:n,classes:i,styles:l}=r;null!==n&&Qs(t,e,n),null!==i&&Bo(t,e,i),null!==l&&function zo(t,e,r){t.setAttribute(e,"style",r)}(t,e,l)}function Sm(t){return function Nu(){if(void 0===Ou&&(Ou=null,fn.trustedTypes))try{Ou=fn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Ou}()?.createScriptURL(t)||t}class Mm{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Xc})`}}function Ga(t){return t instanceof Mm?t.changingThisBreaksApplicationSecurity:t}function zi(t,e){const r=function Nd(t){return t instanceof Mm&&t.getTypeName()||null}(t);if(null!=r&&r!==e){if("ResourceURL"===r&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${r} (see ${Xc})`)}return r===e}const pT=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var ni=(()=>((ni=ni||{})[ni.NONE=0]="NONE",ni[ni.HTML=1]="HTML",ni[ni.STYLE=2]="STYLE",ni[ni.SCRIPT=3]="SCRIPT",ni[ni.URL=4]="URL",ni[ni.RESOURCE_URL=5]="RESOURCE_URL",ni))();function Jy(t){const e=Fp();return e?e.sanitize(ni.URL,t)||"":zi(t,"URL")?Ga(t):function Wy(t){return(t=String(t)).match(pT)?t:"unsafe:"+t}(At(t))}function E0(t){const e=Fp();if(e)return Sm(e.sanitize(ni.RESOURCE_URL,t)||"");if(zi(t,"ResourceURL"))return Sm(Ga(t));throw new Ne(904,!1)}function Fp(){const t=Le();return t&&t[mn].sanitizer}class ut{constructor(e,r){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=ft({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Lp=new ut("ENVIRONMENT_INITIALIZER"),T0=new ut("INJECTOR",-1),S0=new ut("INJECTOR_DEF_TYPES");class M0{get(e,r=Zt){if(r===Zt){const n=new Error(`NullInjectorError: No provider for ${Kn(e)}!`);throw n.name="NullInjectorError",n}return r}}function IT(...t){return{\u0275providers:A0(0,t),\u0275fromNgModule:!0}}function A0(t,...e){const r=[],n=new Set;let i;return Su(e,l=>{const h=l;e_(h,r,[],n)&&(i||=[],i.push(h))}),void 0!==i&&P0(i,r),r}function P0(t,e){for(let r=0;r<t.length;r++){const{providers:i}=t[r];t_(i,l=>{e.push(l)})}}function e_(t,e,r,n){if(!(t=Ct(t)))return!1;let i=null,l=cd(t);const h=!l&&on(t);if(l||h){if(h&&!h.standalone)return!1;i=t}else{const w=t.ngModule;if(l=cd(w),!l)return!1;i=w}const f=n.has(i);if(h){if(f)return!1;if(n.add(i),h.dependencies){const w="function"==typeof h.dependencies?h.dependencies():h.dependencies;for(const E of w)e_(E,e,r,n)}}else{if(!l)return!1;{if(null!=l.imports&&!f){let E;n.add(i);try{Su(l.imports,P=>{e_(P,e,r,n)&&(E||=[],E.push(P))})}finally{}void 0!==E&&P0(E,e)}if(!f){const E=ct(i)||(()=>new i);e.push({provide:i,useFactory:E,deps:un},{provide:S0,useValue:i,multi:!0},{provide:Lp,useValue:()=>lt(i),multi:!0})}const w=l.providers;null==w||f||t_(w,P=>{e.push(P)})}}return i!==t&&void 0!==t.providers}function t_(t,e){for(let r of t)Ws(r)&&(r=r.\u0275providers),Array.isArray(r)?t_(r,e):e(r)}const TT=rn({provide:String,useValue:rn});function n_(t){return null!==t&&"object"==typeof t&&TT in t}function zu(t){return"function"==typeof t}const r_=new ut("Set Injector scope."),Pm={},MT={};let i_;function km(){return void 0===i_&&(i_=new M0),i_}class qa{}class o_ extends qa{get destroyed(){return this._destroyed}constructor(e,r,n,i){super(),this.parent=r,this.source=n,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,a_(e,h=>this.processProvider(h)),this.records.set(T0,Vd(void 0,this)),i.has("environment")&&this.records.set(qa,Vd(void 0,this));const l=this.records.get(r_);null!=l&&"string"==typeof l.value&&this.scopes.add(l.value),this.injectorDefTypes=new Set(this.get(S0.multi,un,_t.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const r=ao(this),n=Fr(void 0);try{return e()}finally{ao(r),Fr(n)}}get(e,r=Zt,n=_t.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(Ra))return e[Ra](this);n=vl(n);const i=ao(this),l=Fr(void 0);try{if(!(n&_t.SkipSelf)){let f=this.records.get(e);if(void 0===f){const w=function FT(t){return"function"==typeof t||"object"==typeof t&&t instanceof ut}(e)&&sc(e);f=w&&this.injectableDefInScope(w)?Vd(s_(e),Pm):null,this.records.set(e,f)}if(null!=f)return this.hydrate(e,f)}return(n&_t.Self?km():this.parent).get(e,r=n&_t.Optional&&r===Zt?null:r)}catch(h){if("NullInjectorError"===h.name){if((h[Tn]=h[Tn]||[]).unshift(Kn(e)),i)throw h;return function dd(t,e,r,n){const i=t[Tn];throw e[ud]&&i.unshift(e[ud]),t.message=function nu(t,e,r,n=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let i=Kn(e);if(Array.isArray(e))i=e.map(Kn).join(" -> ");else if("object"==typeof e){let l=[];for(let h in e)if(e.hasOwnProperty(h)){let f=e[h];l.push(h+":"+("string"==typeof f?JSON.stringify(f):Kn(f)))}i=`{${l.join(", ")}}`}return`${r}${n?"("+n+")":""}[${i}]: ${t.replace(Ma,"\n  ")}`}("\n"+t.message,i,r,n),t.ngTokenPath=i,t[Tn]=null,t}(h,e,"R3InjectorError",this.source)}throw h}finally{Fr(l),ao(i)}}resolveInjectorInitializers(){const e=ao(this),r=Fr(void 0);try{const n=this.get(Lp.multi,un,_t.Self);for(const i of n)i()}finally{ao(e),Fr(r)}}toString(){const e=[],r=this.records;for(const n of r.keys())e.push(Kn(n));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ne(205,!1)}processProvider(e){let r=zu(e=Ct(e))?e:Ct(e&&e.provide);const n=function PT(t){return n_(t)?Vd(void 0,t.useValue):Vd(F0(t),Pm)}(e);if(zu(e)||!0!==e.multi)this.records.get(r);else{let i=this.records.get(r);i||(i=Vd(void 0,Pm,!0),i.factory=()=>Pa(i.multi),this.records.set(r,i)),r=e,i.multi.push(e)}this.records.set(r,n)}hydrate(e,r){return r.value===Pm&&(r.value=MT,r.value=r.factory()),"object"==typeof r.value&&r.value&&function RT(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(r.value)&&this._ngOnDestroyHooks.add(r.value),r.value}injectableDefInScope(e){if(!e.providedIn)return!1;const r=Ct(e.providedIn);return"string"==typeof r?"any"===r||this.scopes.has(r):this.injectorDefTypes.has(r)}removeOnDestroy(e){const r=this._onDestroyHooks.indexOf(e);-1!==r&&this._onDestroyHooks.splice(r,1)}}function s_(t){const e=sc(t),r=null!==e?e.factory:ct(t);if(null!==r)return r;if(t instanceof ut)throw new Ne(204,!1);if(t instanceof Function)return function AT(t){const e=t.length;if(e>0)throw function Cc(t,e){const r=[];for(let n=0;n<t;n++)r.push(e);return r}(e,"?"),new Ne(204,!1);const r=function Mh(t){return t&&(t[Ta]||t[ac])||null}(t);return null!==r?()=>r.factory(t):()=>new t}(t);throw new Ne(204,!1)}function F0(t,e,r){let n;if(zu(t)){const i=Ct(t);return ct(i)||s_(i)}if(n_(t))n=()=>Ct(t.useValue);else if(function R0(t){return!(!t||!t.useFactory)}(t))n=()=>t.useFactory(...Pa(t.deps||[]));else if(function k0(t){return!(!t||!t.useExisting)}(t))n=()=>lt(Ct(t.useExisting));else{const i=Ct(t&&(t.useClass||t.provide));if(!function kT(t){return!!t.deps}(t))return ct(i)||s_(i);n=()=>new i(...Pa(t.deps))}return n}function Vd(t,e,r=!1){return{factory:t,value:e,multi:r?[]:void 0}}function a_(t,e){for(const r of t)Array.isArray(r)?a_(r,e):r&&Ws(r)?a_(r.\u0275providers,e):e(r)}const Rm=new ut("AppId",{providedIn:"root",factory:()=>LT}),LT="ng",L0=new ut("Platform Initializer"),Bu=new ut("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),O0=new ut("CSP nonce",{providedIn:"root",factory:()=>function _o(){if(void 0!==Lu)return Lu;if(typeof document<"u")return document;throw new Ne(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let z0=(t,e)=>null;function B0(t,e){return z0(t,e)}class HT{}class $0{}class qT{resolveComponentFactory(e){throw function GT(t){const e=Error(`No component factory found for ${Kn(t)}.`);return e.ngComponent=t,e}(e)}}let zm=(()=>{const e=class{};let t=e;return e.NULL=new qT,t})();function ZT(){return Ud(Xr(),Le())}function Ud(t,e){return new us(Sr(t,e))}let us=(()=>{const e=class{constructor(n){this.nativeElement=n}};let t=e;return e.__NG_ELEMENT_ID__=ZT,t})();class H0{}let Vl=(()=>{const e=class{};let t=e;return e.__NG_ELEMENT_ID__=()=>function XT(){const t=Le(),r=ki(Xr().index,t);return(u(r)?r:t)[St]}(),t})(),KT=(()=>{const e=class{};let t=e;return e.\u0275prov=ft({token:e,providedIn:"root",factory:()=>null}),t})();class Bp{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const YT=new Bp("16.0.6"),__={};function Vp(t){for(;t;){t[vt]|=64;const e=D(t);if(S(t)&&!e)return t;t=e}return null}function v_(t){return t.ngOriginalError}class Vu{constructor(){this._console=console}handleError(e){const r=this._findOriginalError(e);this._console.error("ERROR",e),r&&this._console.error("ORIGINAL ERROR",r)}_findOriginalError(e){let r=e&&v_(e);for(;r&&v_(r);)r=v_(r);return r||null}}const Z0=new ut("",{providedIn:"root",factory:()=>!1});function Ul(t){return t instanceof Function?t():t}class J0 extends Fo{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(e){this._lView=e}onConsumerDependencyMayHaveChanged(){Vp(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(e,r,n){const i=yn(this);this.trackingVersion++;try{e(r,n)}finally{yn(i)}}destroy(){this.trackingVersion++}}let Vm=null;function Q0(){return Vm??=new J0,Vm}function eb(t,e){return t[e]??Q0()}function tb(t,e){const r=Q0();r.hasReadASignal&&(t[e]=Vm,r.lView=t,Vm=new J0)}const Ut={};function Re(t){nb(tn(),Le(),Br()+t,!1)}function nb(t,e,r,n){if(!n)if(3==(3&e[vt])){const l=t.preOrderCheckHooks;null!==l&&gc(e,l,r)}else{const l=t.preOrderHooks;null!==l&&yc(e,l,0,r)}Ua(r)}function sb(t,e=null,r=null,n){const i=ab(t,e,r,n);return i.resolveInjectorInitializers(),i}function ab(t,e=null,r=null,n,i=new Set){const l=[r||un,IT(t)];return n=n||("object"==typeof t?void 0:Kn(t)),new o_(l,e||km(),n||null,i)}let Za=(()=>{const e=class{static create(n,i){if(Array.isArray(n))return sb({name:""},i,n,"");{const l=n.name??"";return sb({name:l},n.parent,n.providers,l)}}};let t=e;return e.THROW_IF_NOT_FOUND=Zt,e.NULL=new M0,e.\u0275prov=ft({token:e,providedIn:"any",factory:()=>lt(T0)}),e.__NG_ELEMENT_ID__=-1,t})();function Me(t,e=_t.Default){const r=Le();return null===r?lt(t,e):Qf(Xr(),r,Ct(t),e)}function Um(t,e,r,n,i,l,h,f,w,E,P){const O=e.blueprint.slice();return O[tr]=i,O[vt]=140|n,(null!==E||t&&2048&t[vt])&&(O[vt]|=2048),zf(O),O[bn]=O[ta]=t,O[Gn]=r,O[mn]=h||t&&t[mn],O[St]=f||t&&t[St],O[Or]=w||t&&t[Or]||null,O[Er]=l,O[it]=function Dm(){return Ad++}(),O[uo]=P,O[gt]=E,O[nr]=2==e.type?t[nr]:O,O}function jd(t,e,r,n,i){let l=t.data[e];if(null===l)l=function x_(t,e,r,n,i){const l=Uf(),h=vu(),w=t.data[e]=function _S(t,e,r,n,i,l){let h=e?e.injectorIndex:-1,f=0;return function Ml(){return null!==Dt.skipHydrationRootTNode}()&&(f|=128),{type:r,index:n,insertBeforeIndex:null,injectorIndex:h,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:f,providerIndexes:0,value:i,attrs:l,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,h?l:l&&l.parent,r,e,n,i);return null===t.firstChild&&(t.firstChild=w),null!==l&&(h?null==l.child&&null!==w.parent&&(l.child=w):null===l.next&&(l.next=w,w.prev=l)),w}(t,e,r,n,i),function kl(){return Dt.lFrame.inI18n}()&&(l.flags|=32);else if(64&l.type){l.type=r,l.value=n,l.attrs=i;const h=function Al(){const t=Dt.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();l.injectorIndex=null===h?-1:h.injectorIndex}return ls(l,!0),l}function Up(t,e,r,n){if(0===r)return-1;const i=e.length;for(let l=0;l<r;l++)e.push(n),t.blueprint.push(n),t.data.push(null);return i}function cb(t,e,r,n,i){const l=eb(e,ho),h=Br(),f=2&n;try{if(Ua(-1),f&&e.length>Ot&&nb(t,e,Ot,!1),Di(f?2:0,i),f)l.runInContext(r,n,i);else{const E=yn(null);try{r(n,i)}finally{yn(E)}}}finally{f&&null===e[ho]&&tb(e,ho),Ua(h),Di(f?3:1,i)}}function b_(t,e,r){if(y(e)){const n=yn(null);try{const l=e.directiveEnd;for(let h=e.directiveStart;h<l;h++){const f=t.data[h];f.contentQueries&&f.contentQueries(1,r[h],h)}}finally{yn(n)}}}function w_(t,e,r){pi()&&(function ES(t,e,r,n){const i=r.directiveStart,l=r.directiveEnd;x(r)&&function kS(t,e,r){const n=Sr(e,t),h=$m(t,Um(t,ub(r),null,r.onPush?64:16,n,e,null,t[mn].rendererFactory.createRenderer(n,r),null,null,null));t[e.index]=h}(e,r,t.data[i+r.componentOffset]),t.firstCreatePass||wd(r,e),fi(n,e);const h=r.initialInputs;for(let f=i;f<l;f++){const w=t.data[f],E=Fl(e,t,f,r);fi(E,e),null!==h&&RS(0,f-i,E,w,0,h),T(w)&&(ki(r.index,e)[Gn]=Fl(e,t,f,r))}}(t,e,r,Sr(r,e)),64==(64&r.flags)&&mb(t,e,r))}function C_(t,e,r=Sr){const n=e.localNames;if(null!==n){let i=e.index+1;for(let l=0;l<n.length;l+=2){const h=n[l+1],f=-1===h?r(e,t):t[h];t[i++]=f}}}function ub(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=D_(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):e}function D_(t,e,r,n,i,l,h,f,w,E,P){const O=Ot+n,Z=O+i,J=function hS(t,e){const r=[];for(let n=0;n<e;n++)r.push(n<t?null:Ut);return r}(O,Z),he="function"==typeof E?E():E;return J[tt]={type:t,blueprint:J,template:r,queries:null,viewQuery:f,declTNode:e,data:J.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:Z,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof l?l():l,pipeRegistry:"function"==typeof h?h():h,firstChild:null,schemas:w,consts:he,incompleteFirstPass:!1,ssrId:P}}let db=t=>null;function hb(t,e,r,n){for(let i in t)if(t.hasOwnProperty(i)){r=null===r?{}:r;const l=t[i];null===n?pb(r,e,i,l):n.hasOwnProperty(i)&&pb(r,e,n[i],l)}return r}function pb(t,e,r,n){t.hasOwnProperty(r)?t[r].push(e,n):t[r]=[e,n]}function E_(t,e,r,n){if(pi()){const i=null===n?null:{"":-1},l=function TS(t,e){const r=t.directiveRegistry;let n=null,i=null;if(r)for(let l=0;l<r.length;l++){const h=r[l];if(xi(e,h.selectors,!1))if(n||(n=[]),T(h))if(null!==h.findHostDirectiveDefs){const f=[];i=i||new Map,h.findHostDirectiveDefs(h,f,i),n.unshift(...f,h),I_(t,e,f.length)}else n.unshift(h),I_(t,e,0);else i=i||new Map,h.findHostDirectiveDefs?.(h,n,i),n.push(h)}return null===n?null:[n,i]}(t,r);let h,f;null===l?h=f=null:[h,f]=l,null!==h&&fb(t,e,r,h,i,f),i&&function SS(t,e,r){if(e){const n=t.localNames=[];for(let i=0;i<e.length;i+=2){const l=r[e[i+1]];if(null==l)throw new Ne(-301,!1);n.push(e[i],l)}}}(r,n,i)}r.mergedAttrs=La(r.mergedAttrs,r.attrs)}function fb(t,e,r,n,i,l){for(let E=0;E<n.length;E++)np(wd(r,e),t,n[E].type);!function AS(t,e,r){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+r,t.providerIndexes=e}(r,t.data.length,n.length);for(let E=0;E<n.length;E++){const P=n[E];P.providersResolver&&P.providersResolver(P)}let h=!1,f=!1,w=Up(t,e,n.length,null);for(let E=0;E<n.length;E++){const P=n[E];r.mergedAttrs=La(r.mergedAttrs,P.hostAttrs),PS(t,r,e,w,P),MS(w,P,i),null!==P.contentQueries&&(r.flags|=4),(null!==P.hostBindings||null!==P.hostAttrs||0!==P.hostVars)&&(r.flags|=64);const O=P.type.prototype;!h&&(O.ngOnChanges||O.ngOnInit||O.ngDoCheck)&&((t.preOrderHooks??=[]).push(r.index),h=!0),!f&&(O.ngOnChanges||O.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(r.index),f=!0),w++}!function vS(t,e,r){const i=e.directiveEnd,l=t.data,h=e.attrs,f=[];let w=null,E=null;for(let P=e.directiveStart;P<i;P++){const O=l[P],Z=r?r.get(O):null,he=Z?Z.outputs:null;w=hb(O.inputs,P,w,Z?Z.inputs:null),E=hb(O.outputs,P,E,he);const xe=null===w||null===h||su(e)?null:FS(w,P,h);f.push(xe)}null!==w&&(w.hasOwnProperty("class")&&(e.flags|=8),w.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=f,e.inputs=w,e.outputs=E}(t,r,l)}function mb(t,e,r){const n=r.directiveStart,i=r.directiveEnd,l=r.index,h=function gy(){return Dt.lFrame.currentDirectiveIndex}();try{Ua(l);for(let f=n;f<i;f++){const w=t.data[f],E=e[f];qh(f),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&IS(w,E)}}finally{Ua(-1),qh(h)}}function IS(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function I_(t,e,r){e.componentOffset=r,(t.components??=[]).push(e.index)}function MS(t,e,r){if(r){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)r[e.exportAs[n]]=t;T(e)&&(r[""]=t)}}function PS(t,e,r,n,i){t.data[n]=i;const l=i.factory||(i.factory=ct(i.type)),h=new Lo(l,T(i),Me);t.blueprint[n]=h,r[n]=h,function CS(t,e,r,n,i){const l=i.hostBindings;if(l){let h=t.hostBindingOpCodes;null===h&&(h=t.hostBindingOpCodes=[]);const f=~e.index;(function DS(t){let e=t.length;for(;e>0;){const r=t[--e];if("number"==typeof r&&r<0)return r}return 0})(h)!=f&&h.push(f),h.push(r,n,l)}}(t,e,n,Up(t,r,i.hostVars,Ut),i)}function Wa(t,e,r,n,i,l){const h=Sr(t,e);!function T_(t,e,r,n,i,l,h){if(null==l)t.removeAttribute(e,i,r);else{const f=null==h?At(l):h(l,n||"",i);t.setAttribute(e,i,f,r)}}(e[St],h,l,t.value,r,n,i)}function RS(t,e,r,n,i,l){const h=l[e];if(null!==h)for(let f=0;f<h.length;)gb(n,r,h[f++],h[f++],h[f++])}function gb(t,e,r,n,i){const l=yn(null);try{null!==t.setInput?t.setInput(e,i,r,n):e[n]=i}finally{yn(l)}}function FS(t,e,r){let n=null,i=0;for(;i<r.length;){const l=r[i];if(0!==l)if(5!==l){if("number"==typeof l)break;if(t.hasOwnProperty(l)){null===n&&(n=[]);const h=t[l];for(let f=0;f<h.length;f+=2)if(h[f]===e){n.push(l,h[f+1],r[i+1]);break}}i+=2}else i+=2;else i+=4}return n}function yb(t,e,r,n){return[t,!0,!1,e,null,0,n,r,null,null,null]}function _b(t,e){const r=t.contentQueries;if(null!==r)for(let n=0;n<r.length;n+=2){const l=r[n+1];if(-1!==l){const h=t.data[l];Wh(r[n]),h.contentQueries(2,e[l],l)}}}function $m(t,e){return t[As]?t[du][Wi]=e:t[As]=e,t[du]=e,e}function S_(t,e,r){Wh(0);const n=yn(null);try{e(t,r)}finally{yn(n)}}function wb(t,e){const r=t[Or],n=r?r.get(Vu,null):null;n&&n.handleError(e)}function M_(t,e,r,n,i){for(let l=0;l<r.length;){const h=r[l++],f=r[l++];gb(t.data[h],e[h],n,f,i)}}function $l(t,e,r){const n=fu(e,t);!function ee(t,e,r){t.setValue(e,r)}(t[St],n,r)}function LS(t,e){const r=ki(e,t),n=r[tt];!function OS(t,e){for(let r=e.length;r<t.blueprint.length;r++)e.push(t.blueprint[r])}(n,r);const i=r[tr];null!==i&&null===r[uo]&&(r[uo]=B0(i,r[Or])),A_(n,r,r[Gn])}function A_(t,e,r){Xh(e);try{const n=t.viewQuery;null!==n&&S_(1,n,r);const i=t.template;null!==i&&cb(t,e,i,1,r),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&_b(t,e),t.staticViewQueries&&S_(2,t.viewQuery,r);const l=t.components;null!==l&&function NS(t,e){for(let r=0;r<e.length;r++)LS(t,e[r])}(e,l)}catch(n){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),n}finally{e[vt]&=-5,gd()}}let Cb=(()=>{const e=class{constructor(){this.all=new Set,this.queue=new Map}create(n,i,l){const h=typeof Zone>"u"?null:Zone.current,f=new ra(n,P=>{this.all.has(P)&&this.queue.set(P,h)},l);let w;this.all.add(f),f.notify();const E=()=>{f.cleanup(),w?.(),this.all.delete(f),this.queue.delete(f)};return w=i?.onDestroy(E),{destroy:E}}flush(){if(0!==this.queue.size)for(const[n,i]of this.queue)this.queue.delete(n),i?i.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}};let t=e;return e.\u0275prov=ft({token:e,providedIn:"root",factory:()=>new e}),t})();function jm(t,e,r){let n=r?t.styles:null,i=r?t.classes:null,l=0;if(null!==e)for(let h=0;h<e.length;h++){const f=e[h];"number"==typeof f?l=f:1==l?i=Ds(i,f):2==l&&(n=Ds(n,f+": "+e[++h]+";"))}r?t.styles=n:t.stylesWithoutHost=n,r?t.classes=i:t.classesWithoutHost=i}function $p(t,e,r,n,i=!1){for(;null!==r;){const l=e[r.index];if(null!==l&&n.push(zt(l)),p(l)){for(let f=m;f<l.length;f++){const w=l[f],E=w[tt].firstChild;null!==E&&$p(w[tt],w,E,n)}l[gn]!==l[tr]&&n.push(l[gn])}const h=r.type;if(8&h)$p(t,e,r.child,n);else if(32&h){const f=v(r,e);let w;for(;w=f();)n.push(w)}else if(16&h){const f=Yr(e,r);if(Array.isArray(f))n.push(...f);else{const w=D(e[nr]);$p(w[tt],w,f,n,!0)}}r=i?r.projectionNext:r.next}return n}function Hm(t,e,r,n=!0){const i=e[mn].rendererFactory;i.begin&&i.begin();try{Gm(t,e,t.template,r)}catch(h){throw n&&wb(e,h),h}finally{i.end&&i.end(),e[mn].effectManager?.flush()}}function Gm(t,e,r,n){const i=e[vt];if(256!=(256&i)){e[mn].effectManager?.flush(),Xh(e);try{zf(e),function xu(t){return Dt.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==r&&cb(t,e,r,2,n);const h=3==(3&i);if(h){const E=t.preOrderCheckHooks;null!==E&&gc(e,E,null)}else{const E=t.preOrderHooks;null!==E&&yc(e,E,0,null),Qh(e,0)}if(function jS(t){for(let e=R(t);null!==e;e=L(e)){if(!e[os])continue;const r=e[Ps];for(let n=0;n<r.length;n++){Uh(r[n])}}}(e),function $S(t){for(let e=R(t);null!==e;e=L(e))for(let r=m;r<e.length;r++){const n=e[r],i=n[tt];gu(n)&&Gm(i,n,i.template,n[Gn])}}(e),null!==t.contentQueries&&_b(t,e),h){const E=t.contentCheckHooks;null!==E&&gc(e,E)}else{const E=t.contentHooks;null!==E&&yc(e,E,1),Qh(e,1)}!function dS(t,e){const r=t.hostBindingOpCodes;if(null===r)return;const n=eb(e,ar);try{for(let i=0;i<r.length;i++){const l=r[i];if(l<0)Ua(~l);else{const h=l,f=r[++i],w=r[++i];my(f,h),n.runInContext(w,2,e[h])}}}finally{null===e[ar]&&tb(e,ar),Ua(-1)}}(t,e);const f=t.components;null!==f&&function GS(t,e){for(let r=0;r<e.length;r++)HS(t,e[r])}(e,f);const w=t.viewQuery;if(null!==w&&S_(2,w,n),h){const E=t.viewCheckHooks;null!==E&&gc(e,E)}else{const E=t.viewHooks;null!==E&&yc(e,E,2),Qh(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),e[vt]&=-73,$h(e)}finally{gd()}}}function HS(t,e){const r=ki(e,t);if(gu(r)){const n=r[tt];80&r[vt]?Gm(n,r,n.template,r[Gn]):r[Xi]>0&&P_(r)}}function P_(t){for(let n=R(t);null!==n;n=L(n))for(let i=m;i<n.length;i++){const l=n[i];if(gu(l))if(1024&l[vt]){const h=l[tt];Gm(h,l,h.template,l[Gn])}else l[Xi]>0&&P_(l)}const r=t[tt].components;if(null!==r)for(let n=0;n<r.length;n++){const i=ki(r[n],t);gu(i)&&i[Xi]>0&&P_(i)}}class jp{get rootNodes(){const e=this._lView,r=e[tt];return $p(r,e,r.firstChild,[])}constructor(e,r){this._lView=e,this._cdRefInjectingView=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Gn]}set context(e){this._lView[Gn]=e}get destroyed(){return 256==(256&this._lView[vt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[bn];if(p(e)){const r=e[qn],n=r?r.indexOf(this):-1;n>-1&&(qe(e,n),wc(r,n))}this._attachedToViewContainer=!1}$e(this._lView[tt],this._lView)}onDestroy(e){!function Sl(t,e){if(256==(256&t[vt]))throw new Ne(911,!1);null===t[Pi]&&(t[Pi]=[]),t[Pi].push(e)}(this._lView,e)}markForCheck(){Vp(this._cdRefInjectingView||this._lView)}detach(){this._lView[vt]&=-129}reattach(){this._lView[vt]|=128}detectChanges(){Hm(this._lView[tt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ne(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function fe(t,e){Qn(t,e,e[St],2,null,null)}(this._lView[tt],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Ne(902,!1);this._appRef=e}}class qS extends jp{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Hm(e[tt],e,e[Gn],!1)}checkNoChanges(){}get context(){return null}}class Db extends zm{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const r=on(e);return new Hp(r,this.ngModule)}}function Eb(t){const e=[];for(let r in t)t.hasOwnProperty(r)&&e.push({propName:t[r],templateName:r});return e}class WS{constructor(e,r){this.injector=e,this.parentInjector=r}get(e,r,n){n=vl(n);const i=this.injector.get(e,__,n);return i!==__||r===__?i:this.parentInjector.get(e,r,n)}}class Hp extends $0{get inputs(){return Eb(this.componentDef.inputs)}get outputs(){return Eb(this.componentDef.outputs)}constructor(e,r){super(),this.componentDef=e,this.ngModule=r,this.componentType=e.type,this.selector=function Lh(t){return t.map(au).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!r}create(e,r,n,i){let l=(i=i||this.ngModule)instanceof qa?i:i?.injector;l&&null!==this.componentDef.getStandaloneInjector&&(l=this.componentDef.getStandaloneInjector(l)||l);const h=l?new WS(e,l):e,f=h.get(H0,null);if(null===f)throw new Ne(407,!1);const P={rendererFactory:f,sanitizer:h.get(KT,null),effectManager:h.get(Cb,null)},O=f.createRenderer(null,this.componentDef),Z=this.componentDef.selectors[0][0]||"div",J=n?function pS(t,e,r,n){const l=n.get(Z0,!1)||r===Lr.ShadowDom,h=t.selectRootElement(e,l);return function fS(t){db(t)}(h),h}(O,n,this.componentDef.encapsulation,h):ue(O,Z,function ZS(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(Z)),he=this.componentDef.onPush?576:528,xe=D_(0,null,null,1,0,null,null,null,null,null,null),Ie=Um(null,xe,null,he,null,null,P,O,h,null,null);let ke,Ee;Xh(Ie);try{const mt=this.componentDef;let yt,Kt=null;mt.findHostDirectiveDefs?(yt=[],Kt=new Map,mt.findHostDirectiveDefs(mt,yt,Kt),yt.push(mt)):yt=[mt];const fs=function KS(t,e){const r=t[tt],n=Ot;return t[n]=e,jd(r,n,2,"#host",null)}(Ie,J),ay=function YS(t,e,r,n,i,l,h){const f=i[tt];!function JS(t,e,r,n){for(const i of t)e.mergedAttrs=La(e.mergedAttrs,i.hostAttrs);null!==e.mergedAttrs&&(jm(e,e.mergedAttrs,!0),null!==r&&Vo(n,r,e))}(n,t,e,h);let w=null;null!==e&&(w=B0(e,i[Or]));const E=l.rendererFactory.createRenderer(e,r),P=Um(i,ub(r),null,r.onPush?64:16,i[t.index],t,l,E,null,null,w);return f.firstCreatePass&&I_(f,t,n.length-1),$m(i,P),i[t.index]=P}(fs,J,mt,yt,Ie,P,O);Ee=mu(xe,Ot),J&&function eM(t,e,r,n){if(n)Qs(t,r,["ng-version",YT.full]);else{const{attrs:i,classes:l}=function Oh(t){const e=[],r=[];let n=1,i=2;for(;n<t.length;){let l=t[n];if("string"==typeof l)2===i?""!==l&&e.push(l,t[++n]):8===i&&r.push(l);else{if(!Hn(i))break;i=l}n++}return{attrs:e,classes:r}}(e.selectors[0]);i&&Qs(t,r,i),l&&l.length>0&&Bo(t,r,l.join(" "))}}(O,mt,J,n),void 0!==r&&function tM(t,e,r){const n=t.projection=[];for(let i=0;i<e.length;i++){const l=r[i];n.push(null!=l?Array.from(l):null)}}(Ee,this.ngContentSelectors,r),ke=function QS(t,e,r,n,i,l){const h=Xr(),f=i[tt],w=Sr(h,i);fb(f,i,h,r,null,n);for(let P=0;P<r.length;P++)fi(Fl(i,f,h.directiveStart+P,h),i);mb(f,i,h),w&&fi(w,i);const E=Fl(i,f,h.directiveStart+h.componentOffset,h);if(t[Gn]=i[Gn]=E,null!==l)for(const P of l)P(E,e);return b_(f,h,t),E}(ay,mt,yt,Kt,Ie,[nM]),A_(xe,Ie,null)}finally{gd()}return new XS(this.componentType,ke,Ud(Ee,Ie),Ie,Ee)}}class XS extends HT{constructor(e,r,n,i,l){super(),this.location=n,this._rootLView=i,this._tNode=l,this.previousInputValues=null,this.instance=r,this.hostView=this.changeDetectorRef=new qS(i),this.componentType=e}setInput(e,r){const n=this._tNode.inputs;let i;if(null!==n&&(i=n[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),r))return;const l=this._rootLView;M_(l[tt],l,i,e,r),this.previousInputValues.set(e,r),Vp(ki(this._tNode.index,l))}}get injector(){return new vc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function nM(){const t=Xr();mc(Le()[tt],t)}function Bn(t){let e=function Ib(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),r=!0;const n=[t];for(;e;){let i;if(T(t))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Ne(903,!1);i=e.\u0275dir}if(i){if(r){n.push(i);const h=t;h.inputs=k_(t.inputs),h.declaredInputs=k_(t.declaredInputs),h.outputs=k_(t.outputs);const f=i.hostBindings;f&&sM(t,f);const w=i.viewQuery,E=i.contentQueries;if(w&&iM(t,w),E&&oM(t,E),Ea(t.inputs,i.inputs),Ea(t.declaredInputs,i.declaredInputs),Ea(t.outputs,i.outputs),T(i)&&i.data.animation){const P=t.data;P.animation=(P.animation||[]).concat(i.data.animation)}}const l=i.features;if(l)for(let h=0;h<l.length;h++){const f=l[h];f&&f.ngInherit&&f(t),f===Bn&&(r=!1)}}e=Object.getPrototypeOf(e)}!function rM(t){let e=0,r=null;for(let n=t.length-1;n>=0;n--){const i=t[n];i.hostVars=e+=i.hostVars,i.hostAttrs=La(i.hostAttrs,r=La(r,i.hostAttrs))}}(n)}function k_(t){return t===vi?{}:t===un?[]:t}function iM(t,e){const r=t.viewQuery;t.viewQuery=r?(n,i)=>{e(n,i),r(n,i)}:e}function oM(t,e){const r=t.contentQueries;t.contentQueries=r?(n,i,l)=>{e(n,i,l),r(n,i,l)}:e}function sM(t,e){const r=t.hostBindings;t.hostBindings=r?(n,i)=>{e(n,i),r(n,i)}:e}function qm(t){return!!R_(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function R_(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Xa(t,e,r){return t[e]=r}function eo(t,e,r){return!Object.is(t[e],r)&&(t[e]=r,!0)}function Uu(t,e,r,n){const i=eo(t,e,r);return eo(t,e+1,n)||i}function Zm(t,e,r,n,i){const l=Uu(t,e,r,n);return eo(t,e+2,i)||l}function Ka(t,e,r,n){const i=Le();return eo(i,oa(),e)&&(tn(),Wa(Jn(),i,t,e,r,n)),Ka}function Wd(t,e,r,n,i,l,h,f,w,E){const O=function Bs(t,e,r,n,i,l){const h=Uu(t,e,r,n);return Uu(t,e+2,i,l)||h}(t,ia(),r,i,h,w);return Os(4),O?e+At(r)+n+At(i)+l+At(h)+f+At(w)+E:Ut}function Sn(t,e,r,n,i,l,h,f){const w=Le(),E=tn(),P=t+Ot,O=E.firstCreatePass?function PM(t,e,r,n,i,l,h,f,w){const E=e.consts,P=jd(e,t,4,h||null,Ls(E,f));E_(e,r,P,Ls(E,w)),mc(e,P);const O=P.tView=D_(2,P,n,i,l,e.directiveRegistry,e.pipeRegistry,null,e.schemas,E,null);return null!==e.queries&&(e.queries.template(e,P),O.queries=e.queries.embeddedTView(P)),P}(P,E,w,e,r,n,i,l,h):E.data[P];ls(O,!1);const Z=$b(E,w,O,t);vd()&&Zn(E,w,Z,O),fi(Z,w),$m(w,w[P]=yb(Z,w,Z,O)),C(O)&&w_(E,w,O),null!=h&&C_(w,O,f)}let $b=function jb(t,e,r,n){return Ns(!0),e[St].createComment("")};function Ze(t,e,r){const n=Le();return eo(n,oa(),e)&&function ds(t,e,r,n,i,l,h,f){const w=Sr(e,r);let P,E=e.inputs;!f&&null!=E&&(P=E[n])?(M_(t,r,P,n,i),x(e)&&function bS(t,e){const r=ki(e,t);16&r[vt]||(r[vt]|=64)}(r,e.index)):3&e.type&&(n=function xS(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(n),i=null!=h?h(i,e.value||"",n):i,l.setProperty(w,n,i))}(tn(),Jn(),n,t,e,n[St],r,!1),Ze}function B_(t,e,r,n,i){const h=i?"class":"style";M_(t,r,e.inputs[h],h,n)}function le(t,e,r,n){const i=Le(),l=tn(),h=Ot+t,f=i[St],w=l.firstCreatePass?function OM(t,e,r,n,i,l){const h=e.consts,w=jd(e,t,2,n,Ls(h,i));return E_(e,r,w,Ls(h,l)),null!==w.attrs&&jm(w,w.attrs,!1),null!==w.mergedAttrs&&jm(w,w.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,w),w}(h,l,i,e,r,n):l.data[h],E=Hb(l,i,w,f,e,t);i[h]=E;const P=C(w);return ls(w,!0),Vo(f,E,w),32!=(32&w.flags)&&vd()&&Zn(l,i,E,w),0===function dy(){return Dt.lFrame.elementDepthCount}()&&fi(E,i),function hy(){Dt.lFrame.elementDepthCount++}(),P&&(w_(l,i,w),b_(l,w,i)),null!==n&&C_(i,w),le}function ce(){let t=Xr();vu()?function Pl(){Dt.lFrame.isParent=!1}():(t=t.parent,ls(t,!1));const e=t;(function Gh(t){return Dt.skipHydrationRootTNode===t})(e)&&function Vf(){Dt.skipHydrationRootTNode=null}(),function Ei(){Dt.lFrame.elementDepthCount--}();const r=tn();return r.firstCreatePass&&(mc(r,t),y(t)&&r.queries.elementEnd(t)),null!=e.classesWithoutHost&&function Cy(t){return 0!=(8&t.flags)}(e)&&B_(r,e,Le(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function Dy(t){return 0!=(16&t.flags)}(e)&&B_(r,e,Le(),e.stylesWithoutHost,!1),ce}function Vs(t,e,r,n){return le(t,e,r,n),ce(),Vs}let Hb=(t,e,r,n,i,l)=>(Ns(!0),ue(n,i,function Jh(){return Dt.lFrame.currentNamespace}()));function ca(){return Le()}function Xp(t){return!!t&&"function"==typeof t.then}function Zb(t){return!!t&&"function"==typeof t.subscribe}function Ye(t,e,r,n){const i=Le(),l=tn(),h=Xr();return function Xb(t,e,r,n,i,l,h){const f=C(n),E=t.firstCreatePass&&function xb(t){return t.cleanup||(t.cleanup=[])}(t),P=e[Gn],O=function vb(t){return t[Ao]||(t[Ao]=[])}(e);let Z=!0;if(3&n.type||h){const xe=Sr(n,e),Ie=h?h(xe):xe,ke=O.length,Ee=h?yt=>h(zt(yt[n.index])):n.index;let mt=null;if(!h&&f&&(mt=function $M(t,e,r,n){const i=t.cleanup;if(null!=i)for(let l=0;l<i.length-1;l+=2){const h=i[l];if(h===r&&i[l+1]===n){const f=e[Ao],w=i[l+2];return f.length>w?f[w]:null}"string"==typeof h&&(l+=2)}return null}(t,e,i,n.index)),null!==mt)(mt.__ngLastListenerFn__||mt).__ngNextListenerFn__=l,mt.__ngLastListenerFn__=l,Z=!1;else{l=Yb(n,e,P,l,!1);const yt=r.listen(Ie,i,l);O.push(l,yt),E&&E.push(i,Ee,ke,ke+1)}}else l=Yb(n,e,P,l,!1);const J=n.outputs;let he;if(Z&&null!==J&&(he=J[i])){const xe=he.length;if(xe)for(let Ie=0;Ie<xe;Ie+=2){const Kt=e[he[Ie]][he[Ie+1]].subscribe(l),fs=O.length;O.push(l,Kt),E&&E.push(i,n.index,fs,-(fs+1))}}}(l,i,i[St],h,t,e,n),Ye}function Kb(t,e,r,n){try{return Di(6,e,r),!1!==r(n)}catch(i){return wb(t,i),!1}finally{Di(7,e,r)}}function Yb(t,e,r,n,i){return function l(h){if(h===Function)return n;Vp(t.componentOffset>-1?ki(t.index,e):e);let w=Kb(e,r,n,h),E=l.__ngNextListenerFn__;for(;E;)w=Kb(e,r,E,h)&&w,E=E.__ngNextListenerFn__;return i&&!1===w&&h.preventDefault(),w}}function Mn(t=1){return function yd(t){return(Dt.lFrame.contextLView=function _d(t,e){for(;t>0;)e=e[ta],t--;return e}(t,Dt.lFrame.contextLView))[Gn]}(t)}function Ym(t,e){return t<<17|e<<2}function Pc(t){return t>>17&32767}function j_(t){return 2|t}function $u(t){return(131068&t)>>2}function H_(t,e){return-131069&t|e<<2}function G_(t){return 1|t}function aw(t,e,r,n,i){const l=t[r+1],h=null===e;let f=n?Pc(l):$u(l),w=!1;for(;0!==f&&(!1===w||h);){const P=t[f+1];YM(t[f],e)&&(w=!0,t[f+1]=n?G_(P):j_(P)),f=n?Pc(P):$u(P)}w&&(t[r+1]=n?j_(l):G_(l))}function YM(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&Ll(t,e)>=0}function Jm(t,e){return function ua(t,e,r,n){const i=Le(),l=tn(),h=Os(2);l.firstUpdatePass&&function gw(t,e,r,n){const i=t.data;if(null===i[r+1]){const l=i[Br()],h=function mw(t,e){return e>=t.expandoStartIndex}(t,r);(function xw(t,e){return 0!=(t.flags&(e?8:16))})(l,n)&&null===e&&!h&&(e=!1),e=function sA(t,e,r,n){const i=function Zh(t){const e=Dt.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let l=n?e.residualClasses:e.residualStyles;if(null===i)0===(n?e.classBindings:e.styleBindings)&&(r=Kp(r=q_(null,t,e,r,n),e.attrs,n),l=null);else{const h=e.directiveStylingLast;if(-1===h||t[h]!==i)if(r=q_(i,t,e,r,n),null===l){let w=function aA(t,e,r){const n=r?e.classBindings:e.styleBindings;if(0!==$u(n))return t[Pc(n)]}(t,e,n);void 0!==w&&Array.isArray(w)&&(w=q_(null,t,e,w[1],n),w=Kp(w,e.attrs,n),function lA(t,e,r,n){t[Pc(r?e.classBindings:e.styleBindings)]=n}(t,e,n,w))}else l=function cA(t,e,r){let n;const i=e.directiveEnd;for(let l=1+e.directiveStylingLast;l<i;l++)n=Kp(n,t[l].hostAttrs,r);return Kp(n,e.attrs,r)}(t,e,n)}return void 0!==l&&(n?e.residualClasses=l:e.residualStyles=l),r}(i,l,e,n),function XM(t,e,r,n,i,l){let h=l?e.classBindings:e.styleBindings,f=Pc(h),w=$u(h);t[n]=r;let P,E=!1;if(Array.isArray(r)?(P=r[1],(null===P||Ll(r,P)>0)&&(E=!0)):P=r,i)if(0!==w){const Z=Pc(t[f+1]);t[n+1]=Ym(Z,f),0!==Z&&(t[Z+1]=H_(t[Z+1],n)),t[f+1]=function ZM(t,e){return 131071&t|e<<17}(t[f+1],n)}else t[n+1]=Ym(f,0),0!==f&&(t[f+1]=H_(t[f+1],n)),f=n;else t[n+1]=Ym(w,0),0===f?f=n:t[w+1]=H_(t[w+1],n),w=n;E&&(t[n+1]=j_(t[n+1])),aw(t,P,n,!0),aw(t,P,n,!1),function KM(t,e,r,n,i){const l=i?t.residualClasses:t.residualStyles;null!=l&&"string"==typeof e&&Ll(l,e)>=0&&(r[n+1]=G_(r[n+1]))}(e,P,t,n,l),h=Ym(f,w),l?e.classBindings=h:e.styleBindings=h}(i,l,e,r,h,n)}}(l,t,h,n),e!==Ut&&eo(i,h,e)&&function _w(t,e,r,n,i,l,h,f){if(!(3&e.type))return;const w=t.data,E=w[f+1],P=function WM(t){return 1==(1&t)}(E)?vw(w,e,r,i,$u(E),h):void 0;Qm(P)||(Qm(l)||function qM(t){return 2==(2&t)}(E)&&(l=vw(w,null,r,i,f,h)),function mi(t,e,r,n,i){if(e)i?t.addClass(r,n):t.removeClass(r,n);else{let l=-1===n.indexOf("-")?void 0:Fi.DashCase;null==i?t.removeStyle(r,n,l):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),l|=Fi.Important),t.setStyle(r,n,i,l))}}(n,h,fu(Br(),r),i,l))}(l,l.data[Br()],i,i[St],t,i[h+1]=function pA(t,e){return null==t||""===t||("string"==typeof e?t+=e:"object"==typeof t&&(t=Kn(Ga(t)))),t}(e,r),n,h)}(t,e,null,!0),Jm}function q_(t,e,r,n,i){let l=null;const h=r.directiveEnd;let f=r.directiveStylingLast;for(-1===f?f=r.directiveStart:f++;f<h&&(l=e[f],n=Kp(n,l.hostAttrs,i),l!==t);)f++;return null!==t&&(r.directiveStylingLast=f),n}function Kp(t,e,r){const n=r?1:2;let i=-1;if(null!==e)for(let l=0;l<e.length;l++){const h=e[l];"number"==typeof h?i=h:i===n&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Ii(t,h,!!r||e[++l]))}return void 0===t?null:t}function vw(t,e,r,n,i,l){const h=null===e;let f;for(;i>0;){const w=t[i],E=Array.isArray(w),P=E?w[1]:w,O=null===P;let Z=r[i+1];Z===Ut&&(Z=O?un:void 0);let J=O?dp(Z,n):P===n?Z:void 0;if(E&&!Qm(J)&&(J=dp(w,n)),Qm(J)&&(f=J,h))return f;const he=t[i+1];i=h?Pc(he):$u(he)}if(null!==e){let w=l?e.residualClasses:e.residualStyles;null!=w&&(f=dp(w,n))}return f}function Qm(t){return void 0!==t}function Ae(t,e=""){const r=Le(),n=tn(),i=t+Ot,l=n.firstCreatePass?jd(n,i,1,e,null):n.data[i],h=bw(n,r,l,e,t);r[i]=h,vd()&&Zn(n,r,h,l),ls(l,!1)}let bw=(t,e,r,n,i)=>(Ns(!0),function $(t,e){return t.createText(e)}(e[St],n));function hr(t){return Qa("",t,""),hr}function Qa(t,e,r){const n=Le(),i=function Gd(t,e,r,n){return eo(t,oa(),r)?e+At(r)+n:Ut}(n,t,e,r);return i!==Ut&&$l(n,Br(),i),Qa}function eg(t,e,r,n,i){const l=Le(),h=function qd(t,e,r,n,i,l){const f=Uu(t,ia(),r,i);return Os(2),f?e+At(r)+n+At(i)+l:Ut}(l,t,e,r,n,i);return h!==Ut&&$l(l,Br(),h),eg}function Z_(t,e,r,n,i,l,h){const f=Le(),w=function Zd(t,e,r,n,i,l,h,f){const E=Zm(t,ia(),r,i,h);return Os(3),E?e+At(r)+n+At(i)+l+At(h)+f:Ut}(f,t,e,r,n,i,l,h);return w!==Ut&&$l(f,Br(),w),Z_}function W_(t,e,r,n,i,l,h,f,w){const E=Le(),P=Wd(E,t,e,r,n,i,l,h,f,w);return P!==Ut&&$l(E,Br(),P),W_}const ju=void 0;var LA=["en",[["a","p"],["AM","PM"],ju],[["AM","PM"],ju,ju],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ju,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ju,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ju,"{1} 'at' {0}",ju],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function FA(t){const r=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===r&&0===n?1:5}];let eh={};function vo(t){const e=function OA(t){return t.toLowerCase().replace(/_/g,"-")}(t);let r=Bw(e);if(r)return r;const n=e.split("-")[0];if(r=Bw(n),r)return r;if("en"===n)return LA;throw new Ne(701,!1)}function Bw(t){return t in eh||(eh[t]=fn.ng&&fn.ng.common&&fn.ng.common.locales&&fn.ng.common.locales[t]),eh[t]}var at=(()=>((at=at||{})[at.LocaleId=0]="LocaleId",at[at.DayPeriodsFormat=1]="DayPeriodsFormat",at[at.DayPeriodsStandalone=2]="DayPeriodsStandalone",at[at.DaysFormat=3]="DaysFormat",at[at.DaysStandalone=4]="DaysStandalone",at[at.MonthsFormat=5]="MonthsFormat",at[at.MonthsStandalone=6]="MonthsStandalone",at[at.Eras=7]="Eras",at[at.FirstDayOfWeek=8]="FirstDayOfWeek",at[at.WeekendRange=9]="WeekendRange",at[at.DateFormat=10]="DateFormat",at[at.TimeFormat=11]="TimeFormat",at[at.DateTimeFormat=12]="DateTimeFormat",at[at.NumberSymbols=13]="NumberSymbols",at[at.NumberFormats=14]="NumberFormats",at[at.CurrencyCode=15]="CurrencyCode",at[at.CurrencySymbol=16]="CurrencySymbol",at[at.CurrencyName=17]="CurrencyName",at[at.Currencies=18]="Currencies",at[at.Directionality=19]="Directionality",at[at.PluralCase=20]="PluralCase",at[at.ExtraData=21]="ExtraData",at))();const th="en-US";let Vw=th;function Y_(t,e,r,n,i){if(t=Ct(t),Array.isArray(t))for(let l=0;l<t.length;l++)Y_(t[l],e,r,n,i);else{const l=tn(),h=Le();let f=zu(t)?t:Ct(t.provide),w=F0(t);const E=Xr(),P=1048575&E.providerIndexes,O=E.directiveStart,Z=E.providerIndexes>>20;if(zu(t)||!t.multi){const J=new Lo(w,i,Me),he=Q_(f,e,i?P:P+Z,O);-1===he?(np(wd(E,h),l,f),J_(l,t,e.length),e.push(f),E.directiveStart++,E.directiveEnd++,i&&(E.providerIndexes+=1048576),r.push(J),h.push(J)):(r[he]=J,h[he]=J)}else{const J=Q_(f,e,P+Z,O),he=Q_(f,e,P,P+Z),Ie=he>=0&&r[he];if(i&&!Ie||!i&&!(J>=0&&r[J])){np(wd(E,h),l,f);const ke=function R2(t,e,r,n,i){const l=new Lo(t,r,Me);return l.multi=[],l.index=e,l.componentProviders=0,d1(l,i,n&&!r),l}(i?k2:P2,r.length,i,n,w);!i&&Ie&&(r[he].providerFactory=ke),J_(l,t,e.length,0),e.push(f),E.directiveStart++,E.directiveEnd++,i&&(E.providerIndexes+=1048576),r.push(ke),h.push(ke)}else J_(l,t,J>-1?J:he,d1(r[i?he:J],w,!i&&n));!i&&n&&Ie&&r[he].componentProviders++}}}function J_(t,e,r,n){const i=zu(e),l=function ST(t){return!!t.useClass}(e);if(i||l){const w=(l?Ct(e.useClass):e).prototype.ngOnDestroy;if(w){const E=t.destroyHooks||(t.destroyHooks=[]);if(!i&&e.multi){const P=E.indexOf(r);-1===P?E.push(r,[n,w]):E[P+1].push(n,w)}else E.push(r,w)}}}function d1(t,e,r){return r&&t.componentProviders++,t.multi.push(e)-1}function Q_(t,e,r,n){for(let i=r;i<n;i++)if(e[i]===t)return i;return-1}function P2(t,e,r,n){return ev(this.multi,[])}function k2(t,e,r,n){const i=this.multi;let l;if(this.providerFactory){const h=this.providerFactory.componentProviders,f=Fl(r,r[tt],this.providerFactory.index,n);l=f.slice(0,h),ev(i,l);for(let w=h;w<f.length;w++)l.push(f[w])}else l=[],ev(i,l);return l}function ev(t,e){for(let r=0;r<t.length;r++)e.push((0,t[r])());return e}function pr(t,e=[]){return r=>{r.providersResolver=(n,i)=>function A2(t,e,r){const n=tn();if(n.firstCreatePass){const i=T(t);Y_(r,n.data,n.blueprint,i,!0),Y_(e,n.data,n.blueprint,i,!1)}}(n,i?i(t):t,e)}}class nh{}class h1{}class tv extends nh{constructor(e,r,n){super(),this._parent=r,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Db(this);const i=bi(e);this._bootstrapComponents=Ul(i.bootstrap),this._r3Injector=ab(e,r,[{provide:nh,useValue:this},{provide:zm,useValue:this.componentFactoryResolver},...n],Kn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class nv extends h1{constructor(e){super(),this.moduleType=e}create(e){return new tv(this.moduleType,e,[])}}class p1 extends nh{constructor(e){super(),this.componentFactoryResolver=new Db(this),this.instance=null;const r=new o_([...e.providers,{provide:nh,useValue:this},{provide:zm,useValue:this.componentFactoryResolver}],e.parent||km(),e.debugName,new Set(["environment"]));this.injector=r,e.runEnvironmentInitializers&&r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function rv(t,e,r=null){return new p1({providers:t,parent:e,debugName:r,runEnvironmentInitializers:!0}).injector}let O2=(()=>{const e=class{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const i=A0(0,n.type),l=i.length>0?rv([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,l)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}};let t=e;return e.\u0275prov=ft({token:e,providedIn:"environment",factory:()=>new e(lt(qa))}),t})();function f1(t){t.getStandaloneInjector=e=>e.get(O2).getOrCreateStandaloneInjector(t)}function nf(t,e){const r=t[e];return r===Ut?void 0:r}function D1(t,e,r,n,i,l,h){const f=e+r;return Uu(t,f,i,l)?Xa(t,f+2,h?n.call(h,i,l):n(i,l)):nf(t,f+2)}function og(t,e){const r=tn();let n;const i=t+Ot;r.firstCreatePass?(n=function Q2(t,e){if(e)for(let r=e.length-1;r>=0;r--){const n=e[r];if(t===n.name)return n}}(e,r.pipeRegistry),r.data[i]=n,n.onDestroy&&(r.destroyHooks??=[]).push(i,n.onDestroy)):n=r.data[i];const l=n.factory||(n.factory=ct(n.type)),h=Fr(Me);try{const f=ja(!1),w=l();return ja(f),function FM(t,e,r,n){r>=t.data.length&&(t.data[r]=null,t.blueprint[r]=null),e[r]=n}(r,Le(),i,w),w}finally{Fr(h)}}function ov(t,e,r,n){const i=t+Ot,l=Le(),h=Va(l,i);return rf(l,i)?D1(l,Ri(),e,h.transform,r,n,h):h.transform(r,n)}function S1(t,e,r,n,i){const l=t+Ot,h=Le(),f=Va(h,l);return rf(h,l)?function E1(t,e,r,n,i,l,h,f){const w=e+r;return Zm(t,w,i,l,h)?Xa(t,w+3,f?n.call(f,i,l,h):n(i,l,h)):nf(t,w+3)}(h,Ri(),e,f.transform,r,n,i,f):f.transform(r,n,i)}function rf(t,e){return t[tt].data[e].pure}function sv(t){return e=>{setTimeout(t,void 0,e)}}const Pr=class rP extends Cr{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,r,n){let i=e,l=r||(()=>null),h=n;if(e&&"object"==typeof e){const w=e;i=w.next?.bind(w),l=w.error?.bind(w),h=w.complete?.bind(w)}this.__isAsync&&(l=sv(l),i&&(i=sv(i)),h&&(h=sv(h)));const f=super.subscribe({next:i,error:l,complete:h});return e instanceof Wn&&e.add(f),f}};let jl=(()=>{const e=class{};let t=e;return e.__NG_ELEMENT_ID__=aP,t})();const oP=jl,sP=class extends oP{constructor(e,r,n){super(),this._declarationLView=e,this._declarationTContainer=r,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,r){return this.createEmbeddedViewImpl(e,r,null)}createEmbeddedViewImpl(e,r,n){const i=this._declarationTContainer.tView,l=Um(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,r||null,n||null);l[El]=this._declarationLView[this._declarationTContainer.index];const f=this._declarationLView[wi];return null!==f&&(l[wi]=f.createEmbeddedView(i)),A_(i,l,e),new jp(l)}};function aP(){return function sg(t,e){return 4&t.type?new sP(e,t,Ud(t,e)):null}(Xr(),Le())}let ha=(()=>{const e=class{};let t=e;return e.__NG_ELEMENT_ID__=fP,t})();function fP(){return function F1(t,e){let r;const n=e[t.index];return p(n)?r=n:(r=yb(n,e,null,t),e[t.index]=r,$m(e,r)),L1(r,e,t,n),new k1(r,t,e)}(Xr(),Le())}const mP=ha,k1=class extends mP{constructor(e,r,n){super(),this._lContainer=e,this._hostTNode=r,this._hostLView=n}get element(){return Ud(this._hostTNode,this._hostLView)}get injector(){return new vc(this._hostTNode,this._hostLView)}get parentInjector(){const e=tp(this._hostTNode,this._hostLView);if(Zf(e)){const r=bd(e,this._hostLView),n=xd(e);return new vc(r[tt].data[n+8],r)}return new vc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const r=R1(this._lContainer);return null!==r&&r[e]||null}get length(){return this._lContainer.length-m}createEmbeddedView(e,r,n){let i,l;"number"==typeof n?i=n:null!=n&&(i=n.index,l=n.injector);const f=e.createEmbeddedViewImpl(r||{},l,null);return this.insertImpl(f,i,false),f}createComponent(e,r,n,i,l){const h=e&&!function bc(t){return"function"==typeof t}(e);let f;if(h)f=r;else{const xe=r||{};f=xe.index,n=xe.injector,i=xe.projectableNodes,l=xe.environmentInjector||xe.ngModuleRef}const w=h?e:new Hp(on(e)),E=n||this.parentInjector;if(!l&&null==w.ngModule){const Ie=(h?E:this.parentInjector).get(qa,null);Ie&&(l=Ie)}on(w.componentType??{});const J=w.create(E,i,null,l);return this.insertImpl(J.hostView,f,false),J}insert(e,r){return this.insertImpl(e,r,!1)}insertImpl(e,r,n){const i=e._lView,l=i[tt];if(function cy(t){return p(t[bn])}(i)){const w=this.indexOf(e);if(-1!==w)this.detach(w);else{const E=i[bn],P=new k1(E,E[Er],E[bn]);P.detach(P.indexOf(e))}}const h=this._adjustIndex(r),f=this._lContainer;if(function Te(t,e,r,n){const i=m+n,l=r.length;n>0&&(r[i-1][Wi]=e),n<l-m?(e[Wi]=r[i],cp(r,m+n,e)):(r.push(e),e[Wi]=null),e[bn]=r;const h=e[El];null!==h&&r!==h&&function Je(t,e){const r=t[Ps];e[nr]!==e[bn][bn][nr]&&(t[os]=!0),null===r?t[Ps]=[e]:r.push(e)}(h,e);const f=e[wi];null!==f&&f.insertView(t),e[vt]|=128}(l,i,f,h),!n){const w=Jr(h,f),E=i[St],P=Ti(E,f[gn]);null!==P&&function ae(t,e,r,n,i,l){n[tr]=i,n[Er]=e,Qn(t,n,r,1,i,l)}(l,f[Er],E,i,P,w)}return e.attachToViewContainerRef(),cp(cv(f),h,e),e}move(e,r){return this.insert(e,r)}indexOf(e){const r=R1(this._lContainer);return null!==r?r.indexOf(e):-1}remove(e){const r=this._adjustIndex(e,-1),n=qe(this._lContainer,r);n&&(wc(cv(this._lContainer),r),$e(n[tt],n))}detach(e){const r=this._adjustIndex(e,-1),n=qe(this._lContainer,r);return n&&null!=wc(cv(this._lContainer),r)?new jp(n):null}_adjustIndex(e,r=0){return e??this.length+r}};function R1(t){return t[qn]}function cv(t){return t[qn]||(t[qn]=[])}let L1=function O1(t,e,r,n){if(t[gn])return;let i;i=8&r.type?zt(n):function gP(t,e){const r=t[St],n=r.createComment(""),i=Sr(e,t);return nt(r,Ti(r,i),n,function Kr(t,e){return t.nextSibling(e)}(r,i),!1),n}(e,r),t[gn]=i};const xv=new ut("Application Initializer");let bv=(()=>{const e=class{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i}),this.appInits=rt(xv,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const l of this.appInits){const h=l();if(Xp(h))n.push(h);else if(Zb(h)){const f=new Promise((w,E)=>{h.subscribe({complete:w,error:E})});n.push(f)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{i()}).catch(l=>{this.reject(l)}),0===n.length&&i(),this.initialized=!0}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),aC=(()=>{const e=class{log(n){console.log(n)}warn(n){console.warn(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();const Hl=new ut("LocaleId",{providedIn:"root",factory:()=>rt(Hl,_t.Optional|_t.SkipSelf)||function ZP(){return typeof $localize<"u"&&$localize.locale||th}()});let lg=(()=>{const e=class{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new fr(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class XP{constructor(e,r){this.ngModuleFactory=e,this.componentFactories=r}}let lC=(()=>{const e=class{compileModuleSync(n){return new nv(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),h=Ul(bi(n).declarations).reduce((f,w)=>{const E=on(w);return E&&f.push(new Hp(E)),f},[]);return new XP(i,h)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const JP=(()=>Promise.resolve(0))();function wv(t){typeof Zone>"u"?JP.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}function dC(...t){}class xr{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pr(!1),this.onMicrotaskEmpty=new Pr(!1),this.onStable=new Pr(!1),this.onError=new Pr(!1),typeof Zone>"u")throw new Ne(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!n&&r,i.shouldCoalesceRunChangeDetection=n,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function QP(){let t=fn.requestAnimationFrame,e=fn.cancelAnimationFrame;if(typeof Zone<"u"&&t&&e){const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r);const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function nk(t){const e=()=>{!function tk(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(fn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Dv(t),t.isCheckStableRunning=!0,Cv(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Dv(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,n,i,l,h,f)=>{try{return hC(t),r.invokeTask(i,l,h,f)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===l.type||t.shouldCoalesceRunChangeDetection)&&e(),pC(t)}},onInvoke:(r,n,i,l,h,f,w)=>{try{return hC(t),r.invoke(i,l,h,f,w)}finally{t.shouldCoalesceRunChangeDetection&&e(),pC(t)}},onHasTask:(r,n,i,l)=>{r.hasTask(i,l),n===i&&("microTask"==l.change?(t._hasPendingMicrotasks=l.microTask,Dv(t),Cv(t)):"macroTask"==l.change&&(t.hasPendingMacrotasks=l.macroTask))},onHandleError:(r,n,i,l)=>(r.handleError(i,l),t.runOutsideAngular(()=>t.onError.emit(l)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!xr.isInAngularZone())throw new Ne(909,!1)}static assertNotInAngularZone(){if(xr.isInAngularZone())throw new Ne(909,!1)}run(e,r,n){return this._inner.run(e,r,n)}runTask(e,r,n,i){const l=this._inner,h=l.scheduleEventTask("NgZoneEvent: "+i,e,ek,dC,dC);try{return l.runTask(h,r,n)}finally{l.cancelTask(h)}}runGuarded(e,r,n){return this._inner.runGuarded(e,r,n)}runOutsideAngular(e){return this._outer.run(e)}}const ek={};function Cv(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Dv(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function hC(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function pC(t){t._nesting--,Cv(t)}class rk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Pr,this.onMicrotaskEmpty=new Pr,this.onStable=new Pr,this.onError=new Pr}run(e,r,n){return e.apply(r,n)}runGuarded(e,r,n){return e.apply(r,n)}runOutsideAngular(e){return e()}runTask(e,r,n,i){return e.apply(r,n)}}const fC=new ut("",{providedIn:"root",factory:mC});function mC(){const t=rt(xr);let e=!0;return function nc(...t){const e=Xn(t),r=function Ln(t,e){return"number"==typeof Ht(t)?t.pop():e}(t,1/0),n=t;return n.length?1===n.length?Q(n[0]):dt(r)(gr(n,e)):ht}(new hn(i=>{e=t.isStable&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks,t.runOutsideAngular(()=>{i.next(e),i.complete()})}),new hn(i=>{let l;t.runOutsideAngular(()=>{l=t.onStable.subscribe(()=>{xr.assertNotInAngularZone(),wv(()=>{!e&&!t.hasPendingMacrotasks&&!t.hasPendingMicrotasks&&(e=!0,i.next(!0))})})});const h=t.onUnstable.subscribe(()=>{xr.assertInAngularZone(),e&&(e=!1,t.runOutsideAngular(()=>{i.next(!1)}))});return()=>{l.unsubscribe(),h.unsubscribe()}}).pipe(Zc()))}const gC=new ut(""),cg=new ut("");let Tv,Ev=(()=>{const e=class{constructor(n,i,l){this._ngZone=n,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Tv||(function ik(t){Tv=t}(l),l.addToWindow(i)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{xr.assertNotInAngularZone(),wv(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())wv(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,l){let h=-1;i&&i>0&&(h=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==h),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:h,updateCb:l})}whenStable(n,i,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,i,l){return[]}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(xr),lt(Iv),lt(cg))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})(),Iv=(()=>{const e=class{constructor(){this._applications=new Map}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return Tv?.findTestabilityInTree(this,n,i)??null}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})(),kc=null;const yC=new ut("AllowMultipleToken"),Sv=new ut("PlatformDestroyListeners"),Mv=new ut("appBootstrapListener");class vC{constructor(e,r){this.name=e,this.token=r}}function bC(t,e,r=[]){const n=`Platform: ${e}`,i=new ut(n);return(l=[])=>{let h=Av();if(!h||h.injector.get(yC,!1)){const f=[...r,...l,{provide:i,useValue:!0}];t?t(f):function ak(t){if(kc&&!kc.get(yC,!1))throw new Ne(400,!1);(function _C(){!function na(t){Rn=t}(()=>{throw new Ne(600,!1)})})(),kc=t;const e=t.get(CC);(function xC(t){t.get(L0,null)?.forEach(r=>r())})(t)}(function wC(t=[],e){return Za.create({name:e,providers:[{provide:r_,useValue:"platform"},{provide:Sv,useValue:new Set([()=>kc=null])},...t]})}(f,n))}return function ck(t){const e=Av();if(!e)throw new Ne(401,!1);return e}()}}function Av(){return kc?.get(CC)??null}let CC=(()=>{const e=class{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const l=function uk(t="zone.js",e){return"noop"===t?new rk:"zone.js"===t?new xr(e):t}(i?.ngZone,function DC(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return l.run(()=>{const h=function L2(t,e,r){return new tv(t,e,r)}(n.moduleType,this.injector,function MC(t){return[{provide:xr,useFactory:t},{provide:Lp,multi:!0,useFactory:()=>{const e=rt(hk,{optional:!0});return()=>e.initialize()}},{provide:SC,useFactory:dk},{provide:fC,useFactory:mC}]}(()=>l)),f=h.injector.get(Vu,null);return l.runOutsideAngular(()=>{const w=l.onError.subscribe({next:E=>{f.handleError(E)}});h.onDestroy(()=>{ug(this._modules,h),w.unsubscribe()})}),function EC(t,e,r){try{const n=r();return Xp(n)?n.catch(i=>{throw e.runOutsideAngular(()=>t.handleError(i)),i}):n}catch(n){throw e.runOutsideAngular(()=>t.handleError(n)),n}}(f,l,()=>{const w=h.injector.get(bv);return w.runInitializers(),w.donePromise.then(()=>(function Uw(t){ui(t,"Expected localeId to be defined"),"string"==typeof t&&(Vw=t.toLowerCase().replace(/_/g,"-"))}(h.injector.get(Hl,th)||th),this._moduleDoBootstrap(h),h))})})}bootstrapModule(n,i=[]){const l=IC({},i);return function ok(t,e,r){const n=new nv(r);return Promise.resolve(n)}(0,0,n).then(h=>this.bootstrapModuleFactory(h,l))}_moduleDoBootstrap(n){const i=n.injector.get(oh);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(l=>i.bootstrap(l));else{if(!n.instance.ngDoBootstrap)throw new Ne(-403,!1);n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ne(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get(Sv,null);n&&(n.forEach(i=>i()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(Za))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();function IC(t,e){return Array.isArray(e)?e.reduce(IC,t):{...t,...e}}let oh=(()=>{const e=class{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=rt(SC),this.zoneIsStable=rt(fC),this.componentTypes=[],this.components=[],this.isStable=rt(lg).hasPendingTasks.pipe(ji(n=>n?wt(!1):this.zoneIsStable),function Zs(t,e=Gr){return t=t??ml,pn((r,n)=>{let i,l=!0;r.subscribe($n(n,h=>{const f=e(h);(l||!t(i,f))&&(l=!1,i=f,n.next(h))}))})}(),Zc()),this._injector=rt(qa)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,i){const l=n instanceof $0;if(!this._injector.get(bv).done)throw!l&&function Ms(t){const e=on(t)||Zr(t)||Wr(t);return null!==e&&e.standalone}(n),new Ne(405,!1);let f;f=l?n:this._injector.get(zm).resolveComponentFactory(n),this.componentTypes.push(f.componentType);const w=function sk(t){return t.isBoundToModule}(f)?void 0:this._injector.get(nh),P=f.create(Za.NULL,[],i||f.selector,w),O=P.location.nativeElement,Z=P.injector.get(gC,null);return Z?.registerApplication(O),P.onDestroy(()=>{this.detachView(P.hostView),ug(this.components,P),Z?.unregisterApplication(O)}),this._loadComponent(P),P}tick(){if(this._runningTick)throw new Ne(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;ug(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const i=this._injector.get(Mv,[]);i.push(...this._bootstrapListeners),i.forEach(l=>l(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>ug(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Ne(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function ug(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const SC=new ut("",{providedIn:"root",factory:()=>rt(Vu).handleError.bind(void 0)});function dk(){const t=rt(xr),e=rt(Vu);return r=>t.runOutsideAngular(()=>e.handleError(r))}let hk=(()=>{const e=class{constructor(){this.zone=rt(xr),this.applicationRef=rt(oh)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();let dg=(()=>{const e=class{};let t=e;return e.__NG_ELEMENT_ID__=fk,t})();function fk(t){return function mk(t,e,r){if(x(t)&&!r){const n=ki(t.index,e);return new jp(n,n)}return 47&t.type?new jp(e[nr],e):null}(Xr(),Le(),16==(16&t))}class RC{constructor(){}supports(e){return qm(e)}create(e){return new bk(e)}}const xk=(t,e)=>e;class bk{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||xk}forEachItem(e){let r;for(r=this._itHead;null!==r;r=r._next)e(r)}forEachOperation(e){let r=this._itHead,n=this._removalsHead,i=0,l=null;for(;r||n;){const h=!n||r&&r.currentIndex<LC(n,i,l)?r:n,f=LC(h,i,l),w=h.currentIndex;if(h===n)i--,n=n._nextRemoved;else if(r=r._next,null==h.previousIndex)i++;else{l||(l=[]);const E=f-i,P=w-i;if(E!=P){for(let Z=0;Z<E;Z++){const J=Z<l.length?l[Z]:l[Z]=0,he=J+Z;P<=he&&he<E&&(l[Z]=J+1)}l[h.previousIndex]=P-E}}f!==w&&e(h,f,w)}}forEachPreviousItem(e){let r;for(r=this._previousItHead;null!==r;r=r._nextPrevious)e(r)}forEachAddedItem(e){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)e(r)}forEachMovedItem(e){let r;for(r=this._movesHead;null!==r;r=r._nextMoved)e(r)}forEachRemovedItem(e){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)e(r)}forEachIdentityChange(e){let r;for(r=this._identityChangesHead;null!==r;r=r._nextIdentityChange)e(r)}diff(e){if(null==e&&(e=[]),!qm(e))throw new Ne(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,l,h,r=this._itHead,n=!1;if(Array.isArray(e)){this.length=e.length;for(let f=0;f<this.length;f++)l=e[f],h=this._trackByFn(f,l),null!==r&&Object.is(r.trackById,h)?(n&&(r=this._verifyReinsertion(r,l,h,f)),Object.is(r.item,l)||this._addIdentityChange(r,l)):(r=this._mismatch(r,l,h,f),n=!0),r=r._next}else i=0,function pM(t,e){if(Array.isArray(t))for(let r=0;r<t.length;r++)e(t[r]);else{const r=t[Symbol.iterator]();let n;for(;!(n=r.next()).done;)e(n.value)}}(e,f=>{h=this._trackByFn(i,f),null!==r&&Object.is(r.trackById,h)?(n&&(r=this._verifyReinsertion(r,f,h,i)),Object.is(r.item,f)||this._addIdentityChange(r,f)):(r=this._mismatch(r,f,h,i),n=!0),r=r._next,i++}),this.length=i;return this._truncate(r),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,r,n,i){let l;return null===e?l=this._itTail:(l=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,r)||this._addIdentityChange(e,r),this._reinsertAfter(e,l,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,i))?(Object.is(e.item,r)||this._addIdentityChange(e,r),this._moveAfter(e,l,i)):e=this._addAfter(new wk(r,n),l,i),e}_verifyReinsertion(e,r,n,i){let l=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==l?e=this._reinsertAfter(l,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const r=e._next;this._addToRemovals(this._unlink(e)),e=r}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,r,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,l=e._nextRemoved;return null===i?this._removalsHead=l:i._nextRemoved=l,null===l?this._removalsTail=i:l._prevRemoved=i,this._insertAfter(e,r,n),this._addToMoves(e,n),e}_moveAfter(e,r,n){return this._unlink(e),this._insertAfter(e,r,n),this._addToMoves(e,n),e}_addAfter(e,r,n){return this._insertAfter(e,r,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,r,n){const i=null===r?this._itHead:r._next;return e._next=i,e._prev=r,null===i?this._itTail=e:i._prev=e,null===r?this._itHead=e:r._next=e,null===this._linkedRecords&&(this._linkedRecords=new FC),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const r=e._prev,n=e._next;return null===r?this._itHead=n:r._next=n,null===n?this._itTail=r:n._prev=r,e}_addToMoves(e,r){return e.previousIndex===r||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new FC),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,r){return e.item=r,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class wk{constructor(e,r){this.item=e,this.trackById=r,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Ck{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,r){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===r||r<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const r=e._prevDup,n=e._nextDup;return null===r?this._head=n:r._nextDup=n,null===n?this._tail=r:n._prevDup=r,null===this._head}}class FC{constructor(){this.map=new Map}put(e){const r=e.trackById;let n=this.map.get(r);n||(n=new Ck,this.map.set(r,n)),n.add(e)}get(e,r){const i=this.map.get(e);return i?i.get(e,r):null}remove(e){const r=e.trackById;return this.map.get(r).remove(e)&&this.map.delete(r),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function LC(t,e,r){const n=t.previousIndex;if(null===n)return n;let i=0;return r&&n<r.length&&(i=r[n]),n+e+i}class OC{constructor(){}supports(e){return e instanceof Map||R_(e)}create(){return new Dk}}class Dk{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let r;for(r=this._mapHead;null!==r;r=r._next)e(r)}forEachPreviousItem(e){let r;for(r=this._previousMapHead;null!==r;r=r._nextPrevious)e(r)}forEachChangedItem(e){let r;for(r=this._changesHead;null!==r;r=r._nextChanged)e(r)}forEachAddedItem(e){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)e(r)}forEachRemovedItem(e){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)e(r)}diff(e){if(e){if(!(e instanceof Map||R_(e)))throw new Ne(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r=this._mapHead;if(this._appendAfter=null,this._forEach(e,(n,i)=>{if(r&&r.key===i)this._maybeAddToChanges(r,n),this._appendAfter=r,r=r._next;else{const l=this._getOrCreateRecordForKey(i,n);r=this._insertBeforeOrAppend(r,l)}}),r){r._prev&&(r._prev._next=null),this._removalsHead=r;for(let n=r;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,r){if(e){const n=e._prev;return r._next=e,r._prev=n,e._prev=r,n&&(n._next=r),e===this._mapHead&&(this._mapHead=r),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=r,r._prev=this._appendAfter):this._mapHead=r,this._appendAfter=r,null}_getOrCreateRecordForKey(e,r){if(this._records.has(e)){const i=this._records.get(e);this._maybeAddToChanges(i,r);const l=i._prev,h=i._next;return l&&(l._next=h),h&&(h._prev=l),i._next=null,i._prev=null,i}const n=new Ek(e);return this._records.set(e,n),n.currentValue=r,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,r){Object.is(r,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=r,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,r){e instanceof Map?e.forEach(r):Object.keys(e).forEach(n=>r(e[n],n))}}class Ek{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function NC(){return new fg([new RC])}let fg=(()=>{const e=class{constructor(n){this.factories=n}static create(n,i){if(null!=i){const l=i.factories.slice();n=n.concat(l)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||NC()),deps:[[e,new Mu,new cs]]}}find(n){const i=this.factories.find(l=>l.supports(n));if(null!=i)return i;throw new Ne(901,!1)}};let t=e;return e.\u0275prov=ft({token:e,providedIn:"root",factory:NC}),t})();function zC(){return new af([new OC])}let af=(()=>{const e=class{constructor(n){this.factories=n}static create(n,i){if(i){const l=i.factories.slice();n=n.concat(l)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||zC()),deps:[[e,new Mu,new cs]]}}find(n){const i=this.factories.find(l=>l.supports(n));if(i)return i;throw new Ne(901,!1)}};let t=e;return e.\u0275prov=ft({token:e,providedIn:"root",factory:zC}),t})();const Sk=bC(null,"core",[]);let Mk=(()=>{const e=class{constructor(n){}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(oh))},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({}),t})();function sh(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}let Nv=null;function Rc(){return Nv}class Uk{}const hs=new ut("DocumentToken");let zv=(()=>{const e=class{historyGo(n){throw new Error("Not implemented")}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return rt(jk)},providedIn:"platform"}),t})();const $k=new ut("Location Initialized");let jk=(()=>{const e=class extends zv{constructor(){super(),this._doc=rt(hs),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rc().getBaseHref(this._doc)}onPopState(n){const i=Rc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=Rc().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,l){this._history.pushState(n,i,l)}replaceState(n,i,l){this._history.replaceState(n,i,l)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return new e},providedIn:"platform"}),t})();function Bv(t,e){if(0==t.length)return e;if(0==e.length)return t;let r=0;return t.endsWith("/")&&r++,e.startsWith("/")&&r++,2==r?t+e.substring(1):1==r?t+e:t+"/"+e}function GC(t){const e=t.match(/#|\?|$/),r=e&&e.index||t.length;return t.slice(0,r-("/"===t[r-1]?1:0))+t.slice(r)}function Gl(t){return t&&"?"!==t[0]?"?"+t:t}let Gu=(()=>{const e=class{historyGo(n){throw new Error("Not implemented")}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return rt(ZC)},providedIn:"root"}),t})();const qC=new ut("appBaseHref");let ZC=(()=>{const e=class extends Gu{constructor(n,i){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??rt(hs).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Bv(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Gl(this._platformLocation.search),l=this._platformLocation.hash;return l&&n?`${i}${l}`:i}pushState(n,i,l,h){const f=this.prepareExternalUrl(l+Gl(h));this._platformLocation.pushState(n,i,f)}replaceState(n,i,l,h){const f=this.prepareExternalUrl(l+Gl(h));this._platformLocation.replaceState(n,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(zv),lt(qC,8))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Hk=(()=>{const e=class extends Gu{constructor(n,i){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(n){const i=Bv(this._baseHref,n);return i.length>0?"#"+i:i}pushState(n,i,l,h){let f=this.prepareExternalUrl(l+Gl(h));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(n,i,f)}replaceState(n,i,l,h){let f=this.prepareExternalUrl(l+Gl(h));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(n,i,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(zv),lt(qC,8))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})(),Vv=(()=>{const e=class{constructor(n){this._subject=new Pr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._basePath=function Zk(t){if(new RegExp("^(https?:)?//").test(t)){const[,r]=t.split(/\/\/[^\/]+/);return r}return t}(GC(WC(i))),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Gl(i))}normalize(n){return e.stripTrailingSlash(function qk(t,e){if(!t||!e.startsWith(t))return e;const r=e.substring(t.length);return""===r||["/",";","?","#"].includes(r[0])?r:e}(this._basePath,WC(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",l=null){this._locationStrategy.pushState(l,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Gl(i)),l)}replaceState(n,i="",l=null){this._locationStrategy.replaceState(l,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Gl(i)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(l=>l(n,i))}subscribe(n,i,l){return this._subject.subscribe({next:n,error:i,complete:l})}};let t=e;return e.normalizeQueryParams=Gl,e.joinWithSlash=Bv,e.stripTrailingSlash=GC,e.\u0275fac=function(i){return new(i||e)(lt(Gu))},e.\u0275prov=ft({token:e,factory:function(){return function Gk(){return new Vv(lt(Gu))}()},providedIn:"root"}),t})();function WC(t){return t.replace(/\/index.html$/,"")}var $r=(()=>(($r=$r||{})[$r.Format=0]="Format",$r[$r.Standalone=1]="Standalone",$r))(),an=(()=>((an=an||{})[an.Narrow=0]="Narrow",an[an.Abbreviated=1]="Abbreviated",an[an.Wide=2]="Wide",an[an.Short=3]="Short",an))(),br=(()=>((br=br||{})[br.Short=0]="Short",br[br.Medium=1]="Medium",br[br.Long=2]="Long",br[br.Full=3]="Full",br))(),Mt=(()=>((Mt=Mt||{})[Mt.Decimal=0]="Decimal",Mt[Mt.Group=1]="Group",Mt[Mt.List=2]="List",Mt[Mt.PercentSign=3]="PercentSign",Mt[Mt.PlusSign=4]="PlusSign",Mt[Mt.MinusSign=5]="MinusSign",Mt[Mt.Exponential=6]="Exponential",Mt[Mt.SuperscriptingExponent=7]="SuperscriptingExponent",Mt[Mt.PerMille=8]="PerMille",Mt[Mt.Infinity=9]="Infinity",Mt[Mt.NaN=10]="NaN",Mt[Mt.TimeSeparator=11]="TimeSeparator",Mt[Mt.CurrencyDecimal=12]="CurrencyDecimal",Mt[Mt.CurrencyGroup=13]="CurrencyGroup",Mt))();function gg(t,e){return $s(vo(t)[at.DateFormat],e)}function yg(t,e){return $s(vo(t)[at.TimeFormat],e)}function _g(t,e){return $s(vo(t)[at.DateTimeFormat],e)}function Us(t,e){const r=vo(t),n=r[at.NumberSymbols][e];if(typeof n>"u"){if(e===Mt.CurrencyDecimal)return r[at.NumberSymbols][Mt.Decimal];if(e===Mt.CurrencyGroup)return r[at.NumberSymbols][Mt.Group]}return n}function KC(t){if(!t[at.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[at.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function $s(t,e){for(let r=e;r>-1;r--)if(typeof t[r]<"u")return t[r];throw new Error("Locale data API: locale data undefined")}function $v(t){const[e,r]=t.split(":");return{hours:+e,minutes:+r}}const sR=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,lf={},aR=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var yi=(()=>((yi=yi||{})[yi.Short=0]="Short",yi[yi.ShortGMT=1]="ShortGMT",yi[yi.Long=2]="Long",yi[yi.Extended=3]="Extended",yi))(),kt=(()=>((kt=kt||{})[kt.FullYear=0]="FullYear",kt[kt.Month=1]="Month",kt[kt.Date=2]="Date",kt[kt.Hours=3]="Hours",kt[kt.Minutes=4]="Minutes",kt[kt.Seconds=5]="Seconds",kt[kt.FractionalSeconds=6]="FractionalSeconds",kt[kt.Day=7]="Day",kt))(),Xt=(()=>((Xt=Xt||{})[Xt.DayPeriods=0]="DayPeriods",Xt[Xt.Days=1]="Days",Xt[Xt.Months=2]="Months",Xt[Xt.Eras=3]="Eras",Xt))();function lR(t,e,r,n){let i=function yR(t){if(QC(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[i,l=1,h=1]=t.split("-").map(f=>+f);return vg(i,l-1,h)}const r=parseFloat(t);if(!isNaN(t-r))return new Date(r);let n;if(n=t.match(sR))return function _R(t){const e=new Date(0);let r=0,n=0;const i=t[8]?e.setUTCFullYear:e.setFullYear,l=t[8]?e.setUTCHours:e.setHours;t[9]&&(r=Number(t[9]+t[10]),n=Number(t[9]+t[11])),i.call(e,Number(t[1]),Number(t[2])-1,Number(t[3]));const h=Number(t[4]||0)-r,f=Number(t[5]||0)-n,w=Number(t[6]||0),E=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return l.call(e,h,f,w,E),e}(n)}const e=new Date(t);if(!QC(e))throw new Error(`Unable to convert "${t}" into a date`);return e}(t);e=ql(r,e)||e;let f,h=[];for(;e;){if(f=aR.exec(e),!f){h.push(e);break}{h=h.concat(f.slice(1));const P=h.pop();if(!P)break;e=P}}let w=i.getTimezoneOffset();n&&(w=JC(n,w),i=function gR(t,e,r){const n=r?-1:1,i=t.getTimezoneOffset();return function mR(t,e){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+e),t}(t,n*(JC(e,i)-i))}(i,n,!0));let E="";return h.forEach(P=>{const O=function fR(t){if(Hv[t])return Hv[t];let e;switch(t){case"G":case"GG":case"GGG":e=er(Xt.Eras,an.Abbreviated);break;case"GGGG":e=er(Xt.Eras,an.Wide);break;case"GGGGG":e=er(Xt.Eras,an.Narrow);break;case"y":e=ii(kt.FullYear,1,0,!1,!0);break;case"yy":e=ii(kt.FullYear,2,0,!0,!0);break;case"yyy":e=ii(kt.FullYear,3,0,!1,!0);break;case"yyyy":e=ii(kt.FullYear,4,0,!1,!0);break;case"Y":e=Cg(1);break;case"YY":e=Cg(2,!0);break;case"YYY":e=Cg(3);break;case"YYYY":e=Cg(4);break;case"M":case"L":e=ii(kt.Month,1,1);break;case"MM":case"LL":e=ii(kt.Month,2,1);break;case"MMM":e=er(Xt.Months,an.Abbreviated);break;case"MMMM":e=er(Xt.Months,an.Wide);break;case"MMMMM":e=er(Xt.Months,an.Narrow);break;case"LLL":e=er(Xt.Months,an.Abbreviated,$r.Standalone);break;case"LLLL":e=er(Xt.Months,an.Wide,$r.Standalone);break;case"LLLLL":e=er(Xt.Months,an.Narrow,$r.Standalone);break;case"w":e=jv(1);break;case"ww":e=jv(2);break;case"W":e=jv(1,!0);break;case"d":e=ii(kt.Date,1);break;case"dd":e=ii(kt.Date,2);break;case"c":case"cc":e=ii(kt.Day,1);break;case"ccc":e=er(Xt.Days,an.Abbreviated,$r.Standalone);break;case"cccc":e=er(Xt.Days,an.Wide,$r.Standalone);break;case"ccccc":e=er(Xt.Days,an.Narrow,$r.Standalone);break;case"cccccc":e=er(Xt.Days,an.Short,$r.Standalone);break;case"E":case"EE":case"EEE":e=er(Xt.Days,an.Abbreviated);break;case"EEEE":e=er(Xt.Days,an.Wide);break;case"EEEEE":e=er(Xt.Days,an.Narrow);break;case"EEEEEE":e=er(Xt.Days,an.Short);break;case"a":case"aa":case"aaa":e=er(Xt.DayPeriods,an.Abbreviated);break;case"aaaa":e=er(Xt.DayPeriods,an.Wide);break;case"aaaaa":e=er(Xt.DayPeriods,an.Narrow);break;case"b":case"bb":case"bbb":e=er(Xt.DayPeriods,an.Abbreviated,$r.Standalone,!0);break;case"bbbb":e=er(Xt.DayPeriods,an.Wide,$r.Standalone,!0);break;case"bbbbb":e=er(Xt.DayPeriods,an.Narrow,$r.Standalone,!0);break;case"B":case"BB":case"BBB":e=er(Xt.DayPeriods,an.Abbreviated,$r.Format,!0);break;case"BBBB":e=er(Xt.DayPeriods,an.Wide,$r.Format,!0);break;case"BBBBB":e=er(Xt.DayPeriods,an.Narrow,$r.Format,!0);break;case"h":e=ii(kt.Hours,1,-12);break;case"hh":e=ii(kt.Hours,2,-12);break;case"H":e=ii(kt.Hours,1);break;case"HH":e=ii(kt.Hours,2);break;case"m":e=ii(kt.Minutes,1);break;case"mm":e=ii(kt.Minutes,2);break;case"s":e=ii(kt.Seconds,1);break;case"ss":e=ii(kt.Seconds,2);break;case"S":e=ii(kt.FractionalSeconds,1);break;case"SS":e=ii(kt.FractionalSeconds,2);break;case"SSS":e=ii(kt.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":e=bg(yi.Short);break;case"ZZZZZ":e=bg(yi.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=bg(yi.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":e=bg(yi.Long);break;default:return null}return Hv[t]=e,e}(P);E+=O?O(i,r,w):"''"===P?"'":P.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),E}function vg(t,e,r){const n=new Date(0);return n.setFullYear(t,e,r),n.setHours(0,0,0),n}function ql(t,e){const r=function Wk(t){return vo(t)[at.LocaleId]}(t);if(lf[r]=lf[r]||{},lf[r][e])return lf[r][e];let n="";switch(e){case"shortDate":n=gg(t,br.Short);break;case"mediumDate":n=gg(t,br.Medium);break;case"longDate":n=gg(t,br.Long);break;case"fullDate":n=gg(t,br.Full);break;case"shortTime":n=yg(t,br.Short);break;case"mediumTime":n=yg(t,br.Medium);break;case"longTime":n=yg(t,br.Long);break;case"fullTime":n=yg(t,br.Full);break;case"short":const i=ql(t,"shortTime"),l=ql(t,"shortDate");n=xg(_g(t,br.Short),[i,l]);break;case"medium":const h=ql(t,"mediumTime"),f=ql(t,"mediumDate");n=xg(_g(t,br.Medium),[h,f]);break;case"long":const w=ql(t,"longTime"),E=ql(t,"longDate");n=xg(_g(t,br.Long),[w,E]);break;case"full":const P=ql(t,"fullTime"),O=ql(t,"fullDate");n=xg(_g(t,br.Full),[P,O])}return n&&(lf[r][e]=n),n}function xg(t,e){return e&&(t=t.replace(/\{([^}]+)}/g,function(r,n){return null!=e&&n in e?e[n]:r})),t}function fa(t,e,r="-",n,i){let l="";(t<0||i&&t<=0)&&(i?t=1-t:(t=-t,l=r));let h=String(t);for(;h.length<e;)h="0"+h;return n&&(h=h.slice(h.length-e)),l+h}function ii(t,e,r=0,n=!1,i=!1){return function(l,h){let f=function uR(t,e){switch(t){case kt.FullYear:return e.getFullYear();case kt.Month:return e.getMonth();case kt.Date:return e.getDate();case kt.Hours:return e.getHours();case kt.Minutes:return e.getMinutes();case kt.Seconds:return e.getSeconds();case kt.FractionalSeconds:return e.getMilliseconds();case kt.Day:return e.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,l);if((r>0||f>-r)&&(f+=r),t===kt.Hours)0===f&&-12===r&&(f=12);else if(t===kt.FractionalSeconds)return function cR(t,e){return fa(t,3).substring(0,e)}(f,e);const w=Us(h,Mt.MinusSign);return fa(f,e,w,n,i)}}function er(t,e,r=$r.Format,n=!1){return function(i,l){return function dR(t,e,r,n,i,l){switch(r){case Xt.Months:return function Yk(t,e,r){const n=vo(t),l=$s([n[at.MonthsFormat],n[at.MonthsStandalone]],e);return $s(l,r)}(e,i,n)[t.getMonth()];case Xt.Days:return function Kk(t,e,r){const n=vo(t),l=$s([n[at.DaysFormat],n[at.DaysStandalone]],e);return $s(l,r)}(e,i,n)[t.getDay()];case Xt.DayPeriods:const h=t.getHours(),f=t.getMinutes();if(l){const E=function tR(t){const e=vo(t);return KC(e),(e[at.ExtraData][2]||[]).map(n=>"string"==typeof n?$v(n):[$v(n[0]),$v(n[1])])}(e),P=function nR(t,e,r){const n=vo(t);KC(n);const l=$s([n[at.ExtraData][0],n[at.ExtraData][1]],e)||[];return $s(l,r)||[]}(e,i,n),O=E.findIndex(Z=>{if(Array.isArray(Z)){const[J,he]=Z,xe=h>=J.hours&&f>=J.minutes,Ie=h<he.hours||h===he.hours&&f<he.minutes;if(J.hours<he.hours){if(xe&&Ie)return!0}else if(xe||Ie)return!0}else if(Z.hours===h&&Z.minutes===f)return!0;return!1});if(-1!==O)return P[O]}return function Xk(t,e,r){const n=vo(t),l=$s([n[at.DayPeriodsFormat],n[at.DayPeriodsStandalone]],e);return $s(l,r)}(e,i,n)[h<12?0:1];case Xt.Eras:return function Jk(t,e){return $s(vo(t)[at.Eras],e)}(e,n)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${r}`)}}(i,l,t,e,r,n)}}function bg(t){return function(e,r,n){const i=-1*n,l=Us(r,Mt.MinusSign),h=i>0?Math.floor(i/60):Math.ceil(i/60);switch(t){case yi.Short:return(i>=0?"+":"")+fa(h,2,l)+fa(Math.abs(i%60),2,l);case yi.ShortGMT:return"GMT"+(i>=0?"+":"")+fa(h,1,l);case yi.Long:return"GMT"+(i>=0?"+":"")+fa(h,2,l)+":"+fa(Math.abs(i%60),2,l);case yi.Extended:return 0===n?"Z":(i>=0?"+":"")+fa(h,2,l)+":"+fa(Math.abs(i%60),2,l);default:throw new Error(`Unknown zone width "${t}"`)}}}const hR=0,wg=4;function YC(t){return vg(t.getFullYear(),t.getMonth(),t.getDate()+(wg-t.getDay()))}function jv(t,e=!1){return function(r,n){let i;if(e){const l=new Date(r.getFullYear(),r.getMonth(),1).getDay()-1,h=r.getDate();i=1+Math.floor((h+l)/7)}else{const l=YC(r),h=function pR(t){const e=vg(t,hR,1).getDay();return vg(t,0,1+(e<=wg?wg:wg+7)-e)}(l.getFullYear()),f=l.getTime()-h.getTime();i=1+Math.round(f/6048e5)}return fa(i,t,Us(n,Mt.MinusSign))}}function Cg(t,e=!1){return function(r,n){return fa(YC(r).getFullYear(),t,Us(n,Mt.MinusSign),e)}}const Hv={};function JC(t,e){t=t.replace(/:/g,"");const r=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(r)?e:r}function QC(t){return t instanceof Date&&!isNaN(t.valueOf())}function rD(t,e){e=encodeURIComponent(e);for(const r of t.split(";")){const n=r.indexOf("="),[i,l]=-1==n?[r,""]:[r.slice(0,n),r.slice(n+1)];if(i.trim()===e)return decodeURIComponent(l)}return null}const Kv=/\s+/,iD=[];let oD=(()=>{const e=class{constructor(n,i,l,h){this._iterableDiffers=n,this._keyValueDiffers=i,this._ngEl=l,this._renderer=h,this.initialClasses=iD,this.stateMap=new Map}set klass(n){this.initialClasses=null!=n?n.trim().split(Kv):iD}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(Kv):n}ngDoCheck(){for(const i of this.initialClasses)this._updateState(i,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const i of n)this._updateState(i,!0);else if(null!=n)for(const i of Object.keys(n))this._updateState(i,!!n[i]);this._applyStateDiff()}_updateState(n,i){const l=this.stateMap.get(n);void 0!==l?(l.enabled!==i&&(l.changed=!0,l.enabled=i),l.touched=!0):this.stateMap.set(n,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const i=n[0],l=n[1];l.changed?(this._toggleClass(i,l.enabled),l.changed=!1):l.touched||(l.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),l.touched=!1}}_toggleClass(n,i){(n=n.trim()).length>0&&n.split(Kv).forEach(l=>{i?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(fg),Me(af),Me(us),Me(Vl))},e.\u0275dir=Tt({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),t})();class PR{constructor(e,r,n,i){this.$implicit=e,this.ngForOf=r,this.index=n,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let el=(()=>{const e=class{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,i,l){this._viewContainer=n,this._template=i,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((l,h,f)=>{if(null==l.previousIndex)i.createEmbeddedView(this._template,new PR(l.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)i.remove(null===h?void 0:h);else if(null!==h){const w=i.get(h);i.move(w,f),aD(w,l)}});for(let l=0,h=i.length;l<h;l++){const w=i.get(l).context;w.index=l,w.count=h,w.ngForOf=this._ngForOf}n.forEachIdentityChange(l=>{aD(i.get(l.currentIndex),l)})}static ngTemplateContextGuard(n,i){return!0}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(ha),Me(jl),Me(fg))},e.\u0275dir=Tt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function aD(t,e){t.context.$implicit=e.item}let Zl=(()=>{const e=class{constructor(n,i){this._viewContainer=n,this._context=new kR,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){lD("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){lD("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(ha),Me(jl))},e.\u0275dir=Tt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class kR{constructor(){this.$implicit=null,this.ngIf=null}}function lD(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Kn(e)}'.`)}function ma(t,e){return new Ne(2100,!1)}const GR=new ut("DATE_PIPE_DEFAULT_TIMEZONE"),qR=new ut("DATE_PIPE_DEFAULT_OPTIONS");let uD=(()=>{const e=class{constructor(n,i,l){this.locale=n,this.defaultTimezone=i,this.defaultOptions=l}transform(n,i,l,h){if(null==n||""===n||n!=n)return null;try{return lR(n,i??this.defaultOptions?.dateFormat??"mediumDate",h||this.locale,l??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(f){throw ma()}}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(Hl,16),Me(GR,24),Me(qR,24))},e.\u0275pipe=Be({name:"date",type:e,pure:!0,standalone:!0}),t})(),hD=(()=>{const e=class{transform(n,i,l){if(null==n)return null;if(!this.supports(n))throw ma();return n.slice(i,l)}supports(n){return"string"==typeof n||Array.isArray(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275pipe=Be({name:"slice",type:e,pure:!1,standalone:!0}),t})(),nF=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({}),t})();function fD(t){return"server"===t}let sF=(()=>{const e=class{};let t=e;return e.\u0275prov=ft({token:e,providedIn:"root",factory:()=>new aF(lt(hs),window)}),t})();class aF{constructor(e,r){this.document=e,this.window=r,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const r=function lF(t,e){const r=t.getElementById(e)||t.getElementsByName(e)[0];if(r)return r;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const n=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let i=n.currentNode;for(;i;){const l=i.shadowRoot;if(l){const h=l.getElementById(e)||l.querySelector(`[name="${e}"]`);if(h)return h}i=n.nextNode()}}return null}(this.document,e);r&&(this.scrollToElement(r),r.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const r=this.window.history;r&&r.scrollRestoration&&(r.scrollRestoration=e)}}scrollToElement(e){const r=e.getBoundingClientRect(),n=r.left+this.window.pageXOffset,i=r.top+this.window.pageYOffset,l=this.offset();this.window.scrollTo(n-l[0],i-l[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=mD(this.window.history)||mD(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function mD(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class gD{}class LF extends Uk{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class rx extends LF{static makeCurrent(){!function Vk(t){Nv||(Nv=t)}(new rx)}onAndCancel(e,r,n){return e.addEventListener(r,n),()=>{e.removeEventListener(r,n)}}dispatchEvent(e,r){e.dispatchEvent(r)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,r){return(r=r||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,r){return"window"===r?window:"document"===r?e:"body"===r?e.body:null}getBaseHref(e){const r=function OF(){return df=df||document.querySelector("base"),df?df.getAttribute("href"):null}();return null==r?null:function NF(t){Sg=Sg||document.createElement("a"),Sg.setAttribute("href",t);const e=Sg.pathname;return"/"===e.charAt(0)?e:`/${e}`}(r)}resetBaseElement(){df=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return rD(document.cookie,e)}}let Sg,df=null,BF=(()=>{const e=class{build(){return new XMLHttpRequest}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();const ix=new ut("EventManagerPlugins");let bD=(()=>{const e=class{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(l=>{l.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,l){return this._findPluginFor(i).addEventListener(n,i,l)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(h=>h.supports(n)),!i)throw new Ne(5101,!1);return this._eventNameToPlugin.set(n,i),i}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(ix),lt(xr))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();class wD{constructor(e){this._doc=e}}const ox="ng-app-id";let CD=(()=>{const e=class{constructor(n,i,l,h={}){this.doc=n,this.appId=i,this.nonce=l,this.platformId=h,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=fD(h),this.resetHostNodes()}addStyles(n){for(const i of n)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(n){for(const i of n)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(i=>i.remove()),n.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){const i=this.styleRef;i.get(n)?.elements?.forEach(l=>l.remove()),i.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${ox}="${this.appId}"]`);if(n?.length){const i=new Map;return n.forEach(l=>{null!=l.textContent&&i.set(l.textContent,l)}),i}return null}changeUsageCount(n,i){const l=this.styleRef;if(l.has(n)){const h=l.get(n);return h.usage+=i,h.usage}return l.set(n,{usage:i,elements:[]}),i}getStyleElement(n,i){const l=this.styleNodesInDOM,h=l?.get(i);if(h?.parentNode===n)return l.delete(i),h.removeAttribute(ox),h;{const f=this.doc.createElement("style");return this.nonce&&f.setAttribute("nonce",this.nonce),f.textContent=i,this.platformIsServer&&f.setAttribute(ox,this.appId),f}}addStyleToHost(n,i){const l=this.getStyleElement(n,i);n.appendChild(l);const h=this.styleRef,f=h.get(i)?.elements;f?f.push(l):h.set(i,{elements:[l],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(hs),lt(Rm),lt(O0,8),lt(Bu))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();const sx={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ax=/%COMP%/g,jF=new ut("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function ED(t,e){return e.map(r=>r.replace(ax,t))}let ID=(()=>{const e=class{constructor(n,i,l,h,f,w,E,P=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=l,this.removeStylesOnCompDestory=h,this.doc=f,this.platformId=w,this.ngZone=E,this.nonce=P,this.rendererByCompId=new Map,this.platformIsServer=fD(w),this.defaultRenderer=new lx(n,f,E,this.platformIsServer)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Lr.ShadowDom&&(i={...i,encapsulation:Lr.Emulated});const l=this.getOrCreateRenderer(n,i);return l instanceof SD?l.applyToHost(n):l instanceof cx&&l.applyStyles(),l}getOrCreateRenderer(n,i){const l=this.rendererByCompId;let h=l.get(i.id);if(!h){const f=this.doc,w=this.ngZone,E=this.eventManager,P=this.sharedStylesHost,O=this.removeStylesOnCompDestory,Z=this.platformIsServer;switch(i.encapsulation){case Lr.Emulated:h=new SD(E,P,i,this.appId,O,f,w,Z);break;case Lr.ShadowDom:return new ZF(E,P,n,i,f,w,this.nonce,Z);default:h=new cx(E,P,i,O,f,w,Z)}h.onDestroy=()=>l.delete(i.id),l.set(i.id,h)}return h}ngOnDestroy(){this.rendererByCompId.clear()}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(bD),lt(CD),lt(Rm),lt(jF),lt(hs),lt(Bu),lt(xr),lt(O0))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();class lx{constructor(e,r,n,i){this.eventManager=e,this.doc=r,this.ngZone=n,this.platformIsServer=i,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,r){return r?this.doc.createElementNS(sx[r]||r,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,r){(TD(e)?e.content:e).appendChild(r)}insertBefore(e,r,n){e&&(TD(e)?e.content:e).insertBefore(r,n)}removeChild(e,r){e&&e.removeChild(r)}selectRootElement(e,r){let n="string"==typeof e?this.doc.querySelector(e):e;if(!n)throw new Ne(5104,!1);return r||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,r,n,i){if(i){r=i+":"+r;const l=sx[i];l?e.setAttributeNS(l,r,n):e.setAttribute(r,n)}else e.setAttribute(r,n)}removeAttribute(e,r,n){if(n){const i=sx[n];i?e.removeAttributeNS(i,r):e.removeAttribute(`${n}:${r}`)}else e.removeAttribute(r)}addClass(e,r){e.classList.add(r)}removeClass(e,r){e.classList.remove(r)}setStyle(e,r,n,i){i&(Fi.DashCase|Fi.Important)?e.style.setProperty(r,n,i&Fi.Important?"important":""):e.style[r]=n}removeStyle(e,r,n){n&Fi.DashCase?e.style.removeProperty(r):e.style[r]=""}setProperty(e,r,n){e[r]=n}setValue(e,r){e.nodeValue=r}listen(e,r,n){if("string"==typeof e&&!(e=Rc().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${r}`);return this.eventManager.addEventListener(e,r,this.decoratePreventDefault(n))}decoratePreventDefault(e){return r=>{if("__ngUnwrap__"===r)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(r)):e(r))&&r.preventDefault()}}}function TD(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class ZF extends lx{constructor(e,r,n,i,l,h,f,w){super(e,l,h,w),this.sharedStylesHost=r,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const E=ED(i.id,i.styles);for(const P of E){const O=document.createElement("style");f&&O.setAttribute("nonce",f),O.textContent=P,this.shadowRoot.appendChild(O)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,r){return super.appendChild(this.nodeOrShadowRoot(e),r)}insertBefore(e,r,n){return super.insertBefore(this.nodeOrShadowRoot(e),r,n)}removeChild(e,r){return super.removeChild(this.nodeOrShadowRoot(e),r)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class cx extends lx{constructor(e,r,n,i,l,h,f,w){super(e,l,h,f),this.sharedStylesHost=r,this.removeStylesOnCompDestory=i,this.rendererUsageCount=0,this.styles=w?ED(w,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class SD extends cx{constructor(e,r,n,i,l,h,f,w){const E=i+"-"+n.id;super(e,r,n,l,h,f,w,E),this.contentAttr=function HF(t){return"_ngcontent-%COMP%".replace(ax,t)}(E),this.hostAttr=function GF(t){return"_nghost-%COMP%".replace(ax,t)}(E)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,r){const n=super.createElement(e,r);return super.setAttribute(n,this.contentAttr,""),n}}let WF=(()=>{const e=class extends wD{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,l){return n.addEventListener(i,l,!1),()=>this.removeEventListener(n,i,l)}removeEventListener(n,i,l){return n.removeEventListener(i,l)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(hs))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();const MD=["alt","control","meta","shift"],XF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},KF={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let YF=(()=>{const e=class extends wD{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,l){const h=e.parseEventName(i),f=e.eventCallback(h.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Rc().onAndCancel(n,h.domEventName,f))}static parseEventName(n){const i=n.toLowerCase().split("."),l=i.shift();if(0===i.length||"keydown"!==l&&"keyup"!==l)return null;const h=e._normalizeKey(i.pop());let f="",w=i.indexOf("code");if(w>-1&&(i.splice(w,1),f="code."),MD.forEach(P=>{const O=i.indexOf(P);O>-1&&(i.splice(O,1),f+=P+".")}),f+=h,0!=i.length||0===h.length)return null;const E={};return E.domEventName=l,E.fullKey=f,E}static matchEventFullKeyCode(n,i){let l=XF[n.key]||n.key,h="";return i.indexOf("code.")>-1&&(l=n.code,h="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),MD.forEach(f=>{f!==l&&(0,KF[f])(n)&&(h+=f+".")}),h+=l,h===i)}static eventCallback(n,i,l){return h=>{e.matchEventFullKeyCode(h,n)&&l.runGuarded(()=>i(h))}}static _normalizeKey(n){return"esc"===n?"escape":n}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(hs))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();const tL=bC(Sk,"browser",[{provide:Bu,useValue:"browser"},{provide:L0,useValue:function JF(){rx.makeCurrent()},multi:!0},{provide:hs,useFactory:function eL(){return function Ap(t){Lu=t}(document),document},deps:[]}]),nL=new ut(""),kD=[{provide:cg,useClass:class zF{addToWindow(e){fn.getAngularTestability=(n,i=!0)=>{const l=e.findTestabilityInTree(n,i);if(null==l)throw new Ne(5103,!1);return l},fn.getAllAngularTestabilities=()=>e.getAllTestabilities(),fn.getAllAngularRootElements=()=>e.getAllRootElements(),fn.frameworkStabilizers||(fn.frameworkStabilizers=[]),fn.frameworkStabilizers.push(n=>{const i=fn.getAllAngularTestabilities();let l=i.length,h=!1;const f=function(w){h=h||w,l--,0==l&&n(h)};i.forEach(function(w){w.whenStable(f)})})}findTestabilityInTree(e,r,n){return null==r?null:e.getTestability(r)??(n?Rc().isShadowRoot(r)?this.findTestabilityInTree(e,r.host,!0):this.findTestabilityInTree(e,r.parentElement,!0):null)}},deps:[]},{provide:gC,useClass:Ev,deps:[xr,Iv,cg]},{provide:Ev,useClass:Ev,deps:[xr,Iv,cg]}],RD=[{provide:r_,useValue:"root"},{provide:Vu,useFactory:function QF(){return new Vu},deps:[]},{provide:ix,useClass:WF,multi:!0,deps:[hs,xr,Bu]},{provide:ix,useClass:YF,multi:!0,deps:[hs]},ID,CD,bD,{provide:H0,useExisting:ID},{provide:gD,useClass:BF,deps:[]},[]];let rL=(()=>{const e=class{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:Rm,useValue:n.appId}]}}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(nL,12))},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({providers:[...RD,...kD],imports:[nF,Mk]}),t})(),FD=(()=>{const e=class{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(hs))},e.\u0275prov=ft({token:e,factory:function(i){let l=null;return l=i?new i:function oL(){return new FD(lt(hs))}(),l},providedIn:"root"}),t})();typeof window<"u"&&window;const{isArray:uL}=Array,{getPrototypeOf:dL,prototype:hL,keys:pL}=Object;function zD(t){if(1===t.length){const e=t[0];if(uL(e))return{args:e,keys:null};if(function fL(t){return t&&"object"==typeof t&&dL(t)===hL}(e)){const r=pL(e);return{args:r.map(n=>e[n]),keys:r}}}return{args:t,keys:null}}const{isArray:mL}=Array;function BD(t){return $t(e=>function gL(t,e){return mL(e)?t(...e):t(e)}(t,e))}function VD(t,e){return t.reduce((r,n,i)=>(r[n]=e[i],r),{})}let UD=(()=>{const e=class{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(Vl),Me(us))},e.\u0275dir=Tt({type:e}),t})(),qu=(()=>{const e=class extends UD{};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275dir=Tt({type:e,features:[Bn]}),t})();const tl=new ut("NgValueAccessor"),_L={provide:tl,useExisting:En(()=>dx),multi:!0};let dx=(()=>{const e=class extends qu{writeValue(n){this.setProperty("checked",n)}};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275dir=Tt({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,l){1&i&&Ye("change",function(f){return l.onChange(f.target.checked)})("blur",function(){return l.onTouched()})},features:[pr([_L]),Bn]}),t})();const vL={provide:tl,useExisting:En(()=>nl),multi:!0},bL=new ut("CompositionEventMode");let nl=(()=>{const e=class extends UD{constructor(n,i,l){super(n,i),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function xL(){const t=Rc()?Rc().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(Vl),Me(us),Me(bL,8))},e.\u0275dir=Tt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,l){1&i&&Ye("input",function(f){return l._handleInput(f.target.value)})("blur",function(){return l.onTouched()})("compositionstart",function(){return l._compositionStart()})("compositionend",function(f){return l._compositionEnd(f.target.value)})},features:[pr([vL]),Bn]}),t})();const to=new ut("NgValidators"),Oc=new ut("NgAsyncValidators");function GD(t){return function Lc(t){return null==t||("string"==typeof t||Array.isArray(t))&&0===t.length}(t.value)?{required:!0}:null}function Mg(t){return null}function YD(t){return null!=t}function JD(t){return Xp(t)?gr(t):t}function QD(t){let e={};return t.forEach(r=>{e=null!=r?{...e,...r}:e}),0===Object.keys(e).length?null:e}function eE(t,e){return e.map(r=>r(t))}function tE(t){return t.map(e=>function CL(t){return!t.validate}(e)?e:r=>e.validate(r))}function hx(t){return null!=t?function nE(t){if(!t)return null;const e=t.filter(YD);return 0==e.length?null:function(r){return QD(eE(r,e))}}(tE(t)):null}function px(t){return null!=t?function rE(t){if(!t)return null;const e=t.filter(YD);return 0==e.length?null:function(r){return function yL(...t){const e=vn(t),{args:r,keys:n}=zD(t),i=new hn(l=>{const{length:h}=r;if(!h)return void l.complete();const f=new Array(h);let w=h,E=h;for(let P=0;P<h;P++){let O=!1;Q(r[P]).subscribe($n(l,Z=>{O||(O=!0,E--),f[P]=Z},()=>w--,void 0,()=>{(!w||!O)&&(E||l.next(n?VD(n,f):f),l.complete())}))}});return e?i.pipe(BD(e)):i}(eE(r,e).map(JD)).pipe($t(QD))}}(tE(t)):null}function iE(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function fx(t){return t?Array.isArray(t)?t:[t]:[]}function Ag(t,e){return Array.isArray(t)?t.includes(e):t===e}function aE(t,e){const r=fx(e);return fx(t).forEach(i=>{Ag(r,i)||r.push(i)}),r}function lE(t,e){return fx(e).filter(r=>!Ag(t,r))}class cE{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=hx(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=px(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,r){return!!this.control&&this.control.hasError(e,r)}getError(e,r){return this.control?this.control.getError(e,r):null}}class bo extends cE{get formDirective(){return null}get path(){return null}}class Nc extends cE{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class uE{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Wl=(()=>{const e=class extends uE{constructor(n){super(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(Nc,2))},e.\u0275dir=Tt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,l){2&i&&Jm("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)},features:[Bn]}),t})(),Zu=(()=>{const e=class extends uE{constructor(n){super(n)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(bo,10))},e.\u0275dir=Tt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,l){2&i&&Jm("ng-untouched",l.isUntouched)("ng-touched",l.isTouched)("ng-pristine",l.isPristine)("ng-dirty",l.isDirty)("ng-valid",l.isValid)("ng-invalid",l.isInvalid)("ng-pending",l.isPending)("ng-submitted",l.isSubmitted)},features:[Bn]}),t})();const hf="VALID",kg="INVALID",ah="PENDING",pf="DISABLED";function yx(t){return(Rg(t)?t.validators:t)||null}function _x(t,e){return(Rg(e)?e.asyncValidators:t)||null}function Rg(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class fE{constructor(e,r){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(r)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===hf}get invalid(){return this.status===kg}get pending(){return this.status==ah}get disabled(){return this.status===pf}get enabled(){return this.status!==pf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(aE(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(aE(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(lE(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(lE(e,this._rawAsyncValidators))}hasValidator(e){return Ag(this._rawValidators,e)}hasAsyncValidator(e){return Ag(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(r=>{r.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=ah,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const r=this._parentMarkedDirty(e.onlySelf);this.status=pf,this.errors=null,this._forEachChild(n=>{n.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:r}),this._onDisabledChange.forEach(n=>n(!0))}enable(e={}){const r=this._parentMarkedDirty(e.onlySelf);this.status=hf,this._forEachChild(n=>{n.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:r}),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===hf||this.status===ah)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(r=>r._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?pf:hf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=ah,this._hasOwnPendingAsyncValidator=!0;const r=JD(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,r={}){this.errors=e,this._updateControlsErrors(!1!==r.emitEvent)}get(e){let r=e;return null==r||(Array.isArray(r)||(r=r.split(".")),0===r.length)?null:r.reduce((n,i)=>n&&n._find(i),this)}getError(e,r){const n=r?this.get(r):this;return n&&n.errors?n.errors[e]:null}hasError(e,r){return!!this.getError(e,r)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Pr,this.statusChanges=new Pr}_calculateStatus(){return this._allControlsDisabled()?pf:this.errors?kg:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ah)?ah:this._anyControlsHaveStatus(kg)?kg:hf}_anyControlsHaveStatus(e){return this._anyControls(r=>r.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Rg(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function TL(t){return Array.isArray(t)?hx(t):t||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function SL(t){return Array.isArray(t)?px(t):t||null}(this._rawAsyncValidators)}}class vx extends fE{constructor(e,r,n){super(yx(r),_x(n,r)),this.controls=e,this._initObservables(),this._setUpdateStrategy(r),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,r){return this.controls[e]?this.controls[e]:(this.controls[e]=r,r.setParent(this),r._registerOnCollectionChange(this._onCollectionChange),r)}addControl(e,r,n={}){this.registerControl(e,r),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}setControl(e,r,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],r&&this.registerControl(e,r),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,r={}){(function pE(t,e,r){t._forEachChild((n,i)=>{if(void 0===r[i])throw new Ne(1002,"")})})(this,0,e),Object.keys(e).forEach(n=>{(function hE(t,e,r){const n=t.controls;if(!(e?Object.keys(n):n).length)throw new Ne(1e3,"");if(!n[r])throw new Ne(1001,"")})(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r)}patchValue(e,r={}){null!=e&&(Object.keys(e).forEach(n=>{const i=this.controls[n];i&&i.patchValue(e[n],{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r))}reset(e={},r={}){this._forEachChild((n,i)=>{n.reset(e[i],{onlySelf:!0,emitEvent:r.emitEvent})}),this._updatePristine(r),this._updateTouched(r),this.updateValueAndValidity(r)}getRawValue(){return this._reduceChildren({},(e,r,n)=>(e[n]=r.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(r,n)=>!!n._syncPendingControls()||r);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(r=>{const n=this.controls[r];n&&e(n,r)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[r,n]of Object.entries(this.controls))if(this.contains(r)&&e(n))return!0;return!1}_reduceValue(){return this._reduceChildren({},(r,n,i)=>((n.enabled||this.disabled)&&(r[i]=n.value),r))}_reduceChildren(e,r){let n=e;return this._forEachChild((i,l)=>{n=r(n,i,l)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}const Wu=new ut("CallSetDisabledState",{providedIn:"root",factory:()=>ff}),ff="always";function mf(t,e,r=ff){xx(t,e),e.valueAccessor.writeValue(t.value),(t.disabled||"always"===r)&&e.valueAccessor.setDisabledState?.(t.disabled),function PL(t,e){e.valueAccessor.registerOnChange(r=>{t._pendingValue=r,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&mE(t,e)})}(t,e),function RL(t,e){const r=(n,i)=>{e.valueAccessor.writeValue(n),i&&e.viewToModelUpdate(n)};t.registerOnChange(r),e._registerOnDestroy(()=>{t._unregisterOnChange(r)})}(t,e),function kL(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&mE(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function AL(t,e){if(e.valueAccessor.setDisabledState){const r=n=>{e.valueAccessor.setDisabledState(n)};t.registerOnDisabledChange(r),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(r)})}}(t,e)}function Og(t,e){t.forEach(r=>{r.registerOnValidatorChange&&r.registerOnValidatorChange(e)})}function xx(t,e){const r=function oE(t){return t._rawValidators}(t);null!==e.validator?t.setValidators(iE(r,e.validator)):"function"==typeof r&&t.setValidators([r]);const n=function sE(t){return t._rawAsyncValidators}(t);null!==e.asyncValidator?t.setAsyncValidators(iE(n,e.asyncValidator)):"function"==typeof n&&t.setAsyncValidators([n]);const i=()=>t.updateValueAndValidity();Og(e._rawValidators,i),Og(e._rawAsyncValidators,i)}function mE(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}const zL={provide:bo,useExisting:En(()=>Xl)},gf=(()=>Promise.resolve())();let Xl=(()=>{const e=class extends bo{constructor(n,i,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Pr,this.form=new vx({},hx(n),px(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){gf.then(()=>{const i=this._findContainer(n.path);n.control=i.registerControl(n.name,n.control),mf(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){gf.then(()=>{const i=this._findContainer(n.path);i&&i.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){gf.then(()=>{const i=this._findContainer(n.path),l=new vx({});(function gE(t,e){xx(t,e)})(l,n),i.registerControl(n.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){gf.then(()=>{const i=this._findContainer(n.path);i&&i.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,i){gf.then(()=>{this.form.get(n.path).setValue(i)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,function yE(t,e){t._syncPendingControls(),e.forEach(r=>{const n=r.control;"submit"===n.updateOn&&n._pendingChange&&(r.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(to,10),Me(Oc,10),Me(Wu,8))},e.\u0275dir=Tt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,l){1&i&&Ye("submit",function(f){return l.onSubmit(f)})("reset",function(){return l.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[pr([zL]),Bn]}),t})();function _E(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}function vE(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const xE=class extends fE{constructor(e=null,r,n){super(yx(r),_x(n,r)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(r),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Rg(r)&&(r.nonNullable||r.initialValueIsDefault)&&(this.defaultValue=vE(e)?e.value:e)}setValue(e,r={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==r.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==r.emitViewToModelChange)),this.updateValueAndValidity(r)}patchValue(e,r={}){this.setValue(e,r)}reset(e=this.defaultValue,r={}){this._applyFormState(e),this.markAsPristine(r),this.markAsUntouched(r),this.setValue(this.value,r),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){_E(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){_E(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){vE(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}},UL={provide:Nc,useExisting:En(()=>rl)},CE=(()=>Promise.resolve())();let rl=(()=>{const e=class extends Nc{constructor(n,i,l,h,f,w){super(),this._changeDetectorRef=f,this.callSetDisabledState=w,this.control=new xE,this._registered=!1,this.name="",this.update=new Pr,this._parent=n,this._setValidators(i),this._setAsyncValidators(l),this.valueAccessor=function Cx(t,e){if(!e)return null;let r,n,i;return Array.isArray(e),e.forEach(l=>{l.constructor===nl?r=l:function OL(t){return Object.getPrototypeOf(t.constructor)===qu}(l)?n=l:i=l}),i||n||r||null}(0,h)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const i=n.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),function wx(t,e){if(!t.hasOwnProperty("model"))return!1;const r=t.model;return!!r.isFirstChange()||!Object.is(e,r.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){mf(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){CE.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){const i=n.isDisabled.currentValue,l=0!==i&&sh(i);CE.then(()=>{l&&!this.control.disabled?this.control.disable():!l&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?function Fg(t,e){return[...e.path,t]}(n,this._parent):[n]}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(bo,9),Me(to,10),Me(Oc,10),Me(tl,10),Me(dg,8),Me(Wu,8))},e.\u0275dir=Tt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[pr([UL]),Bn,fo]}),t})(),Xu=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Tt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})();const $L={provide:tl,useExisting:En(()=>Dx),multi:!0};let Dx=(()=>{const e=class extends qu{writeValue(n){this.setProperty("value",n??"")}registerOnChange(n){this.onChange=i=>{n(""==i?null:parseFloat(i))}}};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275dir=Tt({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,l){1&i&&Ye("input",function(f){return l.onChange(f.target.value)})("blur",function(){return l.onTouched()})},features:[pr([$L]),Bn]}),t})();const jL={provide:tl,useExisting:En(()=>Ex),multi:!0};let DE=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({}),t})(),HL=(()=>{const e=class{constructor(){this._accessors=[]}add(n,i){this._accessors.push([n,i])}remove(n){for(let i=this._accessors.length-1;i>=0;--i)if(this._accessors[i][1]===n)return void this._accessors.splice(i,1)}select(n){this._accessors.forEach(i=>{this._isSameGroup(i,n)&&i[1]!==n&&i[1].fireUncheck(n.value)})}_isSameGroup(n,i){return!!n[0].control&&n[0]._parent===i._control._parent&&n[1].name===i.name}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:DE}),t})(),Ex=(()=>{const e=class extends qu{constructor(n,i,l,h){super(n,i),this._registry=l,this._injector=h,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=rt(Wu,{optional:!0})??ff}ngOnInit(){this._control=this._injector.get(Nc),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(n){this._state=n===this.value,this.setProperty("checked",this._state)}registerOnChange(n){this._fn=n,this.onChange=()=>{n(this.value),this._registry.select(this)}}setDisabledState(n){(this.setDisabledStateFired||n||"whenDisabledForLegacyCode"===this.callSetDisabledState)&&this.setProperty("disabled",n),this.setDisabledStateFired=!0}fireUncheck(n){this.writeValue(n)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(Vl),Me(us),Me(HL),Me(Za))},e.\u0275dir=Tt({type:e,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(i,l){1&i&&Ye("change",function(){return l.onChange()})("blur",function(){return l.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[pr([jL]),Bn]}),t})();const Ix=new ut("NgModelWithFormControlWarning"),YL={provide:tl,useExisting:En(()=>lh),multi:!0};function ME(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}let lh=(()=>{const e=class extends qu{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;const l=ME(this._getOptionId(n),n);this.setProperty("value",l)}registerOnChange(n){this.onChange=i=>{this.value=this._getOptionValue(i),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),n))return i;return null}_getOptionValue(n){const i=function JL(t){return t.split(":")[0]}(n);return this._optionMap.has(i)?this._optionMap.get(i):n}};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275dir=Tt({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,l){1&i&&Ye("change",function(f){return l.onChange(f.target.value)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[pr([YL]),Bn]}),t})(),zg=(()=>{const e=class{constructor(n,i,l){this._element=n,this._renderer=i,this._select=l,this._select&&(this.id=this._select._registerOption())}set ngValue(n){null!=this._select&&(this._select._optionMap.set(this.id,n),this._setElementValue(ME(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(us),Me(Vl),Me(lh,9))},e.\u0275dir=Tt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();const QL={provide:tl,useExisting:En(()=>Ax),multi:!0};function AE(t,e){return null==t?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}let Ax=(()=>{const e=class extends qu{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){let i;if(this.value=n,Array.isArray(n)){const l=n.map(h=>this._getOptionId(h));i=(h,f)=>{h._setSelected(l.indexOf(f.toString())>-1)}}else i=(l,h)=>{l._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(n){this.onChange=i=>{const l=[],h=i.selectedOptions;if(void 0!==h){const f=h;for(let w=0;w<f.length;w++){const P=this._getOptionValue(f[w].value);l.push(P)}}else{const f=i.options;for(let w=0;w<f.length;w++){const E=f[w];if(E.selected){const P=this._getOptionValue(E.value);l.push(P)}}}this.value=l,n(l)}}_registerOption(n){const i=(this._idCounter++).toString();return this._optionMap.set(i,n),i}_getOptionId(n){for(const i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,n))return i;return null}_getOptionValue(n){const i=function eO(t){return t.split(":")[0]}(n);return this._optionMap.has(i)?this._optionMap.get(i)._value:n}};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275dir=Tt({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,l){1&i&&Ye("change",function(f){return l.onChange(f.target)})("blur",function(){return l.onTouched()})},inputs:{compareWith:"compareWith"},features:[pr([QL]),Bn]}),t})(),Bg=(()=>{const e=class{constructor(n,i,l){this._element=n,this._renderer=i,this._select=l,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){null!=this._select&&(this._value=n,this._setElementValue(AE(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(AE(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(us),Me(Vl),Me(Ax,9))},e.\u0275dir=Tt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})(),Ku=(()=>{const e=class{constructor(){this._validator=Mg}ngOnChanges(n){if(this.inputName in n){const i=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Mg,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return null!=n}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Tt({type:e,features:[fo]}),t})();const rO={provide:to,useExisting:En(()=>Yu),multi:!0};let Yu=(()=>{const e=class extends Ku{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=sh,this.createValidator=n=>GD}enabled(n){return n}};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275dir=Tt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,l){2&i&&Ka("required",l._enabled?"":null)},inputs:{required:"required"},features:[pr([rO]),Bn]}),t})(),VE=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({imports:[DE]}),t})(),uO=(()=>{const e=class{static withConfig(n){return{ngModule:e,providers:[{provide:Wu,useValue:n.callSetDisabledState??ff}]}}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({imports:[VE]}),t})(),dO=(()=>{const e=class{static withConfig(n){return{ngModule:e,providers:[{provide:Ix,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:Wu,useValue:n.callSetDisabledState??ff}]}}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({imports:[VE]}),t})();function ch(t,e){return An(e)?ze(t,e,1):ze(t,1)}function il(t,e){return pn((r,n)=>{let i=0;r.subscribe($n(n,l=>t.call(e,l,i++)&&n.next(l)))})}function yf(t){return pn((e,r)=>{try{e.subscribe(r)}finally{r.add(t)}})}class Vg{}class Px{}class ol{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(r=>{const n=r.indexOf(":");if(n>0){const i=r.slice(0,n),l=i.toLowerCase(),h=r.slice(n+1).trim();this.maybeSetNormalizedName(i,l),this.headers.has(l)?this.headers.get(l).push(h):this.headers.set(l,[h])}})}:()=>{this.headers=new Map,Object.entries(e).forEach(([r,n])=>{let i;if(i="string"==typeof n?[n]:"number"==typeof n?[n.toString()]:n.map(l=>l.toString()),i.length>0){const l=r.toLowerCase();this.headers.set(l,i),this.maybeSetNormalizedName(r,l)}})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const r=this.headers.get(e.toLowerCase());return r&&r.length>0?r[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,r){return this.clone({name:e,value:r,op:"a"})}set(e,r){return this.clone({name:e,value:r,op:"s"})}delete(e,r){return this.clone({name:e,value:r,op:"d"})}maybeSetNormalizedName(e,r){this.normalizedNames.has(r)||this.normalizedNames.set(r,e)}init(){this.lazyInit&&(this.lazyInit instanceof ol?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(r=>{this.headers.set(r,e.headers.get(r)),this.normalizedNames.set(r,e.normalizedNames.get(r))})}clone(e){const r=new ol;return r.lazyInit=this.lazyInit&&this.lazyInit instanceof ol?this.lazyInit:this,r.lazyUpdate=(this.lazyUpdate||[]).concat([e]),r}applyUpdate(e){const r=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,r);const i=("a"===e.op?this.headers.get(r):void 0)||[];i.push(...n),this.headers.set(r,i);break;case"d":const l=e.value;if(l){let h=this.headers.get(r);if(!h)return;h=h.filter(f=>-1===l.indexOf(f)),0===h.length?(this.headers.delete(r),this.normalizedNames.delete(r)):this.headers.set(r,h)}else this.headers.delete(r),this.normalizedNames.delete(r)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(r=>e(this.normalizedNames.get(r),this.headers.get(r)))}}class hO{encodeKey(e){return UE(e)}encodeValue(e){return UE(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const fO=/%(\d[a-f0-9])/gi,mO={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function UE(t){return encodeURIComponent(t).replace(fO,(e,r)=>mO[r]??e)}function Ug(t){return`${t}`}class zc{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new hO,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function pO(t,e){const r=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(i=>{const l=i.indexOf("="),[h,f]=-1==l?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,l)),e.decodeValue(i.slice(l+1))],w=r.get(h)||[];w.push(f),r.set(h,w)}),r}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(r=>{const n=e.fromObject[r],i=Array.isArray(n)?n.map(Ug):[Ug(n)];this.map.set(r,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const r=this.map.get(e);return r?r[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,r){return this.clone({param:e,value:r,op:"a"})}appendAll(e){const r=[];return Object.keys(e).forEach(n=>{const i=e[n];Array.isArray(i)?i.forEach(l=>{r.push({param:n,value:l,op:"a"})}):r.push({param:n,value:i,op:"a"})}),this.clone(r)}set(e,r){return this.clone({param:e,value:r,op:"s"})}delete(e,r){return this.clone({param:e,value:r,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const r=this.encoder.encodeKey(e);return this.map.get(e).map(n=>r+"="+this.encoder.encodeValue(n)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const r=new zc({encoder:this.encoder});return r.cloneFrom=this.cloneFrom||this,r.updates=(this.updates||[]).concat(e),r}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const r=("a"===e.op?this.map.get(e.param):void 0)||[];r.push(Ug(e.value)),this.map.set(e.param,r);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let n=this.map.get(e.param)||[];const i=n.indexOf(Ug(e.value));-1!==i&&n.splice(i,1),n.length>0?this.map.set(e.param,n):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class gO{constructor(){this.map=new Map}set(e,r){return this.map.set(e,r),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function $E(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function jE(t){return typeof Blob<"u"&&t instanceof Blob}function HE(t){return typeof FormData<"u"&&t instanceof FormData}class _f{constructor(e,r,n,i){let l;if(this.url=r,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function yO(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==n?n:null,l=i):l=n,l&&(this.reportProgress=!!l.reportProgress,this.withCredentials=!!l.withCredentials,l.responseType&&(this.responseType=l.responseType),l.headers&&(this.headers=l.headers),l.context&&(this.context=l.context),l.params&&(this.params=l.params)),this.headers||(this.headers=new ol),this.context||(this.context=new gO),this.params){const h=this.params.toString();if(0===h.length)this.urlWithParams=r;else{const f=r.indexOf("?");this.urlWithParams=r+(-1===f?"?":f<r.length-1?"&":"")+h}}else this.params=new zc,this.urlWithParams=r}serializeBody(){return null===this.body?null:$E(this.body)||jE(this.body)||HE(this.body)||function _O(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof zc?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||HE(this.body)?null:jE(this.body)?this.body.type||null:$E(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof zc?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const r=e.method||this.method,n=e.url||this.url,i=e.responseType||this.responseType,l=void 0!==e.body?e.body:this.body,h=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,f=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let w=e.headers||this.headers,E=e.params||this.params;const P=e.context??this.context;return void 0!==e.setHeaders&&(w=Object.keys(e.setHeaders).reduce((O,Z)=>O.set(Z,e.setHeaders[Z]),w)),e.setParams&&(E=Object.keys(e.setParams).reduce((O,Z)=>O.set(Z,e.setParams[Z]),E)),new _f(r,n,l,{params:E,headers:w,context:P,reportProgress:f,responseType:i,withCredentials:h})}}var oi=(()=>((oi=oi||{})[oi.Sent=0]="Sent",oi[oi.UploadProgress=1]="UploadProgress",oi[oi.ResponseHeader=2]="ResponseHeader",oi[oi.DownloadProgress=3]="DownloadProgress",oi[oi.Response=4]="Response",oi[oi.User=5]="User",oi))();class kx{constructor(e,r=200,n="OK"){this.headers=e.headers||new ol,this.status=void 0!==e.status?e.status:r,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Rx extends kx{constructor(e={}){super(e),this.type=oi.ResponseHeader}clone(e={}){return new Rx({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class uh extends kx{constructor(e={}){super(e),this.type=oi.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new uh({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class GE extends kx{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function Fx(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let qE=(()=>{const e=class{constructor(n){this.handler=n}request(n,i,l={}){let h;if(n instanceof _f)h=n;else{let E,P;E=l.headers instanceof ol?l.headers:new ol(l.headers),l.params&&(P=l.params instanceof zc?l.params:new zc({fromObject:l.params})),h=new _f(n,i,void 0!==l.body?l.body:null,{headers:E,context:l.context,params:P,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const f=wt(h).pipe(ch(E=>this.handler.handle(E)));if(n instanceof _f||"events"===l.observe)return f;const w=f.pipe(il(E=>E instanceof uh));switch(l.observe||"body"){case"body":switch(h.responseType){case"arraybuffer":return w.pipe($t(E=>{if(null!==E.body&&!(E.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return E.body}));case"blob":return w.pipe($t(E=>{if(null!==E.body&&!(E.body instanceof Blob))throw new Error("Response is not a Blob.");return E.body}));case"text":return w.pipe($t(E=>{if(null!==E.body&&"string"!=typeof E.body)throw new Error("Response is not a string.");return E.body}));default:return w.pipe($t(E=>E.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new zc).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,l={}){return this.request("PATCH",n,Fx(l,i))}post(n,i,l={}){return this.request("POST",n,Fx(l,i))}put(n,i,l={}){return this.request("PUT",n,Fx(l,i))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(Vg))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();function ZE(t,e){return e(t)}function vO(t,e){return(r,n)=>e.intercept(r,{handle:i=>t(i,n)})}const WE=new ut(""),vf=new ut(""),XE=new ut("");function bO(){let t=null;return(e,r)=>{null===t&&(t=(rt(WE,{optional:!0})??[]).reduceRight(vO,ZE));const n=rt(lg),i=n.add();return t(e,r).pipe(yf(()=>n.remove(i)))}}let KE=(()=>{const e=class extends Vg{constructor(n,i){super(),this.backend=n,this.injector=i,this.chain=null,this.pendingTasks=rt(lg)}handle(n){if(null===this.chain){const l=Array.from(new Set([...this.injector.get(vf),...this.injector.get(XE,[])]));this.chain=l.reduceRight((h,f)=>function xO(t,e,r){return(n,i)=>r.runInContext(()=>e(n,l=>t(l,i)))}(h,f,this.injector),ZE)}const i=this.pendingTasks.add();return this.chain(n,l=>this.backend.handle(l)).pipe(yf(()=>this.pendingTasks.remove(i)))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(Px),lt(qa))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();const EO=/^\)\]\}',?\n/;let JE=(()=>{const e=class{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Ne(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?gr(i.\u0275loadImpl()):wt(null)).pipe(ji(()=>new hn(h=>{const f=i.build();if(f.open(n.method,n.urlWithParams),n.withCredentials&&(f.withCredentials=!0),n.headers.forEach((Ie,ke)=>f.setRequestHeader(Ie,ke.join(","))),n.headers.has("Accept")||f.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const Ie=n.detectContentTypeHeader();null!==Ie&&f.setRequestHeader("Content-Type",Ie)}if(n.responseType){const Ie=n.responseType.toLowerCase();f.responseType="json"!==Ie?Ie:"text"}const w=n.serializeBody();let E=null;const P=()=>{if(null!==E)return E;const Ie=f.statusText||"OK",ke=new ol(f.getAllResponseHeaders()),Ee=function IO(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(f)||n.url;return E=new Rx({headers:ke,status:f.status,statusText:Ie,url:Ee}),E},O=()=>{let{headers:Ie,status:ke,statusText:Ee,url:mt}=P(),yt=null;204!==ke&&(yt=typeof f.response>"u"?f.responseText:f.response),0===ke&&(ke=yt?200:0);let Kt=ke>=200&&ke<300;if("json"===n.responseType&&"string"==typeof yt){const fs=yt;yt=yt.replace(EO,"");try{yt=""!==yt?JSON.parse(yt):null}catch(ay){yt=fs,Kt&&(Kt=!1,yt={error:ay,text:yt})}}Kt?(h.next(new uh({body:yt,headers:Ie,status:ke,statusText:Ee,url:mt||void 0})),h.complete()):h.error(new GE({error:yt,headers:Ie,status:ke,statusText:Ee,url:mt||void 0}))},Z=Ie=>{const{url:ke}=P(),Ee=new GE({error:Ie,status:f.status||0,statusText:f.statusText||"Unknown Error",url:ke||void 0});h.error(Ee)};let J=!1;const he=Ie=>{J||(h.next(P()),J=!0);let ke={type:oi.DownloadProgress,loaded:Ie.loaded};Ie.lengthComputable&&(ke.total=Ie.total),"text"===n.responseType&&f.responseText&&(ke.partialText=f.responseText),h.next(ke)},xe=Ie=>{let ke={type:oi.UploadProgress,loaded:Ie.loaded};Ie.lengthComputable&&(ke.total=Ie.total),h.next(ke)};return f.addEventListener("load",O),f.addEventListener("error",Z),f.addEventListener("timeout",Z),f.addEventListener("abort",Z),n.reportProgress&&(f.addEventListener("progress",he),null!==w&&f.upload&&f.upload.addEventListener("progress",xe)),f.send(w),h.next({type:oi.Sent}),()=>{f.removeEventListener("error",Z),f.removeEventListener("abort",Z),f.removeEventListener("load",O),f.removeEventListener("timeout",Z),n.reportProgress&&(f.removeEventListener("progress",he),null!==w&&f.upload&&f.upload.removeEventListener("progress",xe)),f.readyState!==f.DONE&&f.abort()}})))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(gD))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();const Lx=new ut("XSRF_ENABLED"),QE=new ut("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),eI=new ut("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class tI{}let MO=(()=>{const e=class{constructor(n,i,l){this.doc=n,this.platform=i,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=rD(n,this.cookieName),this.lastCookieString=n),this.lastToken}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(hs),lt(Bu),lt(QE))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();function AO(t,e){const r=t.url.toLowerCase();if(!rt(Lx)||"GET"===t.method||"HEAD"===t.method||r.startsWith("http://")||r.startsWith("https://"))return e(t);const n=rt(tI).getToken(),i=rt(eI);return null!=n&&!t.headers.has(i)&&(t=t.clone({headers:t.headers.set(i,n)})),e(t)}var Hr=(()=>((Hr=Hr||{})[Hr.Interceptors=0]="Interceptors",Hr[Hr.LegacyInterceptors=1]="LegacyInterceptors",Hr[Hr.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",Hr[Hr.NoXsrfProtection=3]="NoXsrfProtection",Hr[Hr.JsonpSupport=4]="JsonpSupport",Hr[Hr.RequestsMadeViaParent=5]="RequestsMadeViaParent",Hr))();function dh(t,e){return{\u0275kind:t,\u0275providers:e}}function PO(...t){const e=[qE,JE,KE,{provide:Vg,useExisting:KE},{provide:Px,useExisting:JE},{provide:vf,useValue:AO,multi:!0},{provide:Lx,useValue:!0},{provide:tI,useClass:MO}];for(const r of t)e.push(...r.\u0275providers);return function Qy(t){return{\u0275providers:t}}(e)}const nI=new ut("LEGACY_INTERCEPTOR_FN");let RO=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({providers:[PO(dh(Hr.LegacyInterceptors,[{provide:nI,useFactory:bO},{provide:vf,useExisting:nI,multi:!0}]))]}),t})();function Ox(...t){const e=Xn(t),r=vn(t),{args:n,keys:i}=zD(t);if(0===n.length)return gr([],e);const l=new hn(function VO(t,e,r=Gr){return n=>{rI(e,()=>{const{length:i}=t,l=new Array(i);let h=i,f=i;for(let w=0;w<i;w++)rI(e,()=>{const E=gr(t[w],e);let P=!1;E.subscribe($n(n,O=>{l[w]=O,P||(P=!0,f--),f||n.next(r(l.slice()))},()=>{--h||n.complete()}))},n)},n)}}(n,e,i?h=>VD(i,h):Gr));return r?l.pipe(BD(r)):l}function rI(t,e,r){t?Ke(r,t,e):e()}const jg=$c(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Nx(...t){return function UO(){return dt(1)}()(gr(t,Xn(t)))}function iI(t){return new hn(e=>{Q(t()).subscribe(e)})}function hh(t,e){const r=An(t)?t:()=>t,n=i=>i.error(r());return new hn(e?i=>e.schedule(n,0,i):n)}function zx(){return pn((t,e)=>{let r=null;t._refCount++;const n=$n(e,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(r=null);const i=t._connection,l=r;r=null,i&&(!l||i===l)&&i.unsubscribe(),e.unsubscribe()});t.subscribe(n),n.closed||(r=t.connect())})}class oI extends hn{constructor(e,r){super(),this.source=e,this.subjectFactory=r,this._subject=null,this._refCount=0,this._connection=null,Ko(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Wn;const r=this.getSubject();e.add(this.source.subscribe($n(r,void 0,()=>{this._teardown(),r.complete()},n=>{this._teardown(),r.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Wn.EMPTY)}return e}refCount(){return zx()(this)}}function ph(t){return t<=0?()=>ht:pn((e,r)=>{let n=0;e.subscribe($n(r,i=>{++n<=t&&(r.next(i),t<=n&&r.complete())}))})}function Hg(t){return pn((e,r)=>{let n=!1;e.subscribe($n(r,i=>{n=!0,r.next(i)},()=>{n||r.next(t),r.complete()}))})}function sI(t=jO){return pn((e,r)=>{let n=!1;e.subscribe($n(r,i=>{n=!0,r.next(i)},()=>n?r.complete():r.error(t())))})}function jO(){return new jg}function Ju(t,e){const r=arguments.length>=2;return n=>n.pipe(t?il((i,l)=>t(i,l,n)):Gr,ph(1),r?Hg(e):sI(()=>new jg))}function no(t,e,r){const n=An(t)||e||r?{next:t,error:e,complete:r}:t;return n?pn((i,l)=>{var h;null===(h=n.subscribe)||void 0===h||h.call(n);let f=!0;i.subscribe($n(l,w=>{var E;null===(E=n.next)||void 0===E||E.call(n,w),l.next(w)},()=>{var w;f=!1,null===(w=n.complete)||void 0===w||w.call(n),l.complete()},w=>{var E;f=!1,null===(E=n.error)||void 0===E||E.call(n,w),l.error(w)},()=>{var w,E;f&&(null===(w=n.unsubscribe)||void 0===w||w.call(n)),null===(E=n.finalize)||void 0===E||E.call(n)}))}):Gr}function Bc(t){return pn((e,r)=>{let l,n=null,i=!1;n=e.subscribe($n(r,void 0,void 0,h=>{l=Q(t(h,Bc(t)(e))),n?(n.unsubscribe(),n=null,l.subscribe(r)):i=!0})),i&&(n.unsubscribe(),n=null,l.subscribe(r))})}function Bx(t){return t<=0?()=>ht:pn((e,r)=>{let n=[];e.subscribe($n(r,i=>{n.push(i),t<n.length&&n.shift()},()=>{for(const i of n)r.next(i);r.complete()},void 0,()=>{n=null}))})}const qt="primary",xf=Symbol("RouteTitle");class WO{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const r=this.params[e];return Array.isArray(r)?r[0]:r}return null}getAll(e){if(this.has(e)){const r=this.params[e];return Array.isArray(r)?r:[r]}return[]}get keys(){return Object.keys(this.params)}}function fh(t){return new WO(t)}function XO(t,e,r){const n=r.path.split("/");if(n.length>t.length||"full"===r.pathMatch&&(e.hasChildren()||n.length<t.length))return null;const i={};for(let l=0;l<n.length;l++){const h=n[l],f=t[l];if(h.startsWith(":"))i[h.substring(1)]=f;else if(h!==f.path)return null}return{consumed:t.slice(0,n.length),posParams:i}}function sl(t,e){const r=t?Object.keys(t):void 0,n=e?Object.keys(e):void 0;if(!r||!n||r.length!=n.length)return!1;let i;for(let l=0;l<r.length;l++)if(i=r[l],!aI(t[i],e[i]))return!1;return!0}function aI(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const r=[...t].sort(),n=[...e].sort();return r.every((i,l)=>n[l]===i)}return t===e}function lI(t){return t.length>0?t[t.length-1]:null}function Vc(t){return function BO(t){return!!t&&(t instanceof hn||An(t.lift)&&An(t.subscribe))}(t)?t:Xp(t)?gr(Promise.resolve(t)):wt(t)}const YO={exact:function dI(t,e,r){if(!Qu(t.segments,e.segments)||!Gg(t.segments,e.segments,r)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const n in e.children)if(!t.children[n]||!dI(t.children[n],e.children[n],r))return!1;return!0},subset:hI},cI={exact:function JO(t,e){return sl(t,e)},subset:function QO(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(r=>aI(t[r],e[r]))},ignored:()=>!0};function uI(t,e,r){return YO[r.paths](t.root,e.root,r.matrixParams)&&cI[r.queryParams](t.queryParams,e.queryParams)&&!("exact"===r.fragment&&t.fragment!==e.fragment)}function hI(t,e,r){return pI(t,e,e.segments,r)}function pI(t,e,r,n){if(t.segments.length>r.length){const i=t.segments.slice(0,r.length);return!(!Qu(i,r)||e.hasChildren()||!Gg(i,r,n))}if(t.segments.length===r.length){if(!Qu(t.segments,r)||!Gg(t.segments,r,n))return!1;for(const i in e.children)if(!t.children[i]||!hI(t.children[i],e.children[i],n))return!1;return!0}{const i=r.slice(0,t.segments.length),l=r.slice(t.segments.length);return!!(Qu(t.segments,i)&&Gg(t.segments,i,n)&&t.children[qt])&&pI(t.children[qt],e,l,n)}}function Gg(t,e,r){return e.every((n,i)=>cI[r](t[i].parameters,n.parameters))}class mh{constructor(e=new Vn([],{}),r={},n=null){this.root=e,this.queryParams=r,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=fh(this.queryParams)),this._queryParamMap}toString(){return nN.serialize(this)}}class Vn{constructor(e,r){this.segments=e,this.children=r,this.parent=null,Object.values(r).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return qg(this)}}class bf{constructor(e,r){this.path=e,this.parameters=r}get parameterMap(){return this._parameterMap||(this._parameterMap=fh(this.parameters)),this._parameterMap}toString(){return gI(this)}}function Qu(t,e){return t.length===e.length&&t.every((r,n)=>r.path===e[n].path)}let wf=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return new Vx},providedIn:"root"}),t})();class Vx{parse(e){const r=new pN(e);return new mh(r.parseRootSegment(),r.parseQueryParams(),r.parseFragment())}serialize(e){const r=`/${Cf(e.root,!0)}`,n=function oN(t){const e=Object.keys(t).map(r=>{const n=t[r];return Array.isArray(n)?n.map(i=>`${Zg(r)}=${Zg(i)}`).join("&"):`${Zg(r)}=${Zg(n)}`}).filter(r=>!!r);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${r}${n}${"string"==typeof e.fragment?`#${function rN(t){return encodeURI(t)}(e.fragment)}`:""}`}}const nN=new Vx;function qg(t){return t.segments.map(e=>gI(e)).join("/")}function Cf(t,e){if(!t.hasChildren())return qg(t);if(e){const r=t.children[qt]?Cf(t.children[qt],!1):"",n=[];return Object.entries(t.children).forEach(([i,l])=>{i!==qt&&n.push(`${i}:${Cf(l,!1)}`)}),n.length>0?`${r}(${n.join("//")})`:r}{const r=function tN(t,e){let r=[];return Object.entries(t.children).forEach(([n,i])=>{n===qt&&(r=r.concat(e(i,n)))}),Object.entries(t.children).forEach(([n,i])=>{n!==qt&&(r=r.concat(e(i,n)))}),r}(t,(n,i)=>i===qt?[Cf(t.children[qt],!1)]:[`${i}:${Cf(n,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[qt]?`${qg(t)}/${r[0]}`:`${qg(t)}/(${r.join("//")})`}}function fI(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Zg(t){return fI(t).replace(/%3B/gi,";")}function Ux(t){return fI(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Wg(t){return decodeURIComponent(t)}function mI(t){return Wg(t.replace(/\+/g,"%20"))}function gI(t){return`${Ux(t.path)}${function iN(t){return Object.keys(t).map(e=>`;${Ux(e)}=${Ux(t[e])}`).join("")}(t.parameters)}`}const sN=/^[^\/()?;#]+/;function $x(t){const e=t.match(sN);return e?e[0]:""}const aN=/^[^\/()?;=#]+/,cN=/^[^=?&#]+/,dN=/^[^&#]+/;class pN{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Vn([],{}):new Vn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let r={};this.peekStartsWith("/(")&&(this.capture("/"),r=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(r).length>0)&&(n[qt]=new Vn(e,r)),n}parseSegment(){const e=$x(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Ne(4009,!1);return this.capture(e),new bf(Wg(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const r=function lN(t){const e=t.match(aN);return e?e[0]:""}(this.remaining);if(!r)return;this.capture(r);let n="";if(this.consumeOptional("=")){const i=$x(this.remaining);i&&(n=i,this.capture(n))}e[Wg(r)]=Wg(n)}parseQueryParam(e){const r=function uN(t){const e=t.match(cN);return e?e[0]:""}(this.remaining);if(!r)return;this.capture(r);let n="";if(this.consumeOptional("=")){const h=function hN(t){const e=t.match(dN);return e?e[0]:""}(this.remaining);h&&(n=h,this.capture(n))}const i=mI(r),l=mI(n);if(e.hasOwnProperty(i)){let h=e[i];Array.isArray(h)||(h=[h],e[i]=h),h.push(l)}else e[i]=l}parseParens(e){const r={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=$x(this.remaining),i=this.remaining[n.length];if("/"!==i&&")"!==i&&";"!==i)throw new Ne(4010,!1);let l;n.indexOf(":")>-1?(l=n.slice(0,n.indexOf(":")),this.capture(l),this.capture(":")):e&&(l=qt);const h=this.parseChildren();r[l]=1===Object.keys(h).length?h[qt]:new Vn([],h),this.consumeOptional("//")}return r}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Ne(4011,!1)}}function yI(t){return t.segments.length>0?new Vn([],{[qt]:t}):t}function _I(t){const e={};for(const n of Object.keys(t.children)){const l=_I(t.children[n]);if(n===qt&&0===l.segments.length&&l.hasChildren())for(const[h,f]of Object.entries(l.children))e[h]=f;else(l.segments.length>0||l.hasChildren())&&(e[n]=l)}return function fN(t){if(1===t.numberOfChildren&&t.children[qt]){const e=t.children[qt];return new Vn(t.segments.concat(e.segments),e.children)}return t}(new Vn(t.segments,e))}function ed(t){return t instanceof mh}function vI(t){let e;const i=yI(function r(l){const h={};for(const w of l.children){const E=r(w);h[w.outlet]=E}const f=new Vn(l.url,h);return l===t&&(e=f),f}(t.root));return e??i}function xI(t,e,r,n){let i=t;for(;i.parent;)i=i.parent;if(0===e.length)return jx(i,i,i,r,n);const l=function gN(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new wI(!0,0,t);let e=0,r=!1;const n=t.reduce((i,l,h)=>{if("object"==typeof l&&null!=l){if(l.outlets){const f={};return Object.entries(l.outlets).forEach(([w,E])=>{f[w]="string"==typeof E?E.split("/"):E}),[...i,{outlets:f}]}if(l.segmentPath)return[...i,l.segmentPath]}return"string"!=typeof l?[...i,l]:0===h?(l.split("/").forEach((f,w)=>{0==w&&"."===f||(0==w&&""===f?r=!0:".."===f?e++:""!=f&&i.push(f))}),i):[...i,l]},[]);return new wI(r,e,n)}(e);if(l.toRoot())return jx(i,i,new Vn([],{}),r,n);const h=function yN(t,e,r){if(t.isAbsolute)return new Kg(e,!0,0);if(!r)return new Kg(e,!1,NaN);if(null===r.parent)return new Kg(r,!0,0);const n=Xg(t.commands[0])?0:1;return function _N(t,e,r){let n=t,i=e,l=r;for(;l>i;){if(l-=i,n=n.parent,!n)throw new Ne(4005,!1);i=n.segments.length}return new Kg(n,!1,i-l)}(r,r.segments.length-1+n,t.numberOfDoubleDots)}(l,i,t),f=h.processChildren?Ef(h.segmentGroup,h.index,l.commands):CI(h.segmentGroup,h.index,l.commands);return jx(i,h.segmentGroup,f,r,n)}function Xg(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Df(t){return"object"==typeof t&&null!=t&&t.outlets}function jx(t,e,r,n,i){let h,l={};n&&Object.entries(n).forEach(([w,E])=>{l[w]=Array.isArray(E)?E.map(P=>`${P}`):`${E}`}),h=t===e?r:bI(t,e,r);const f=yI(_I(h));return new mh(f,l,i)}function bI(t,e,r){const n={};return Object.entries(t.children).forEach(([i,l])=>{n[i]=l===e?r:bI(l,e,r)}),new Vn(t.segments,n)}class wI{constructor(e,r,n){if(this.isAbsolute=e,this.numberOfDoubleDots=r,this.commands=n,e&&n.length>0&&Xg(n[0]))throw new Ne(4003,!1);const i=n.find(Df);if(i&&i!==lI(n))throw new Ne(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Kg{constructor(e,r,n){this.segmentGroup=e,this.processChildren=r,this.index=n}}function CI(t,e,r){if(t||(t=new Vn([],{})),0===t.segments.length&&t.hasChildren())return Ef(t,e,r);const n=function xN(t,e,r){let n=0,i=e;const l={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(n>=r.length)return l;const h=t.segments[i],f=r[n];if(Df(f))break;const w=`${f}`,E=n<r.length-1?r[n+1]:null;if(i>0&&void 0===w)break;if(w&&E&&"object"==typeof E&&void 0===E.outlets){if(!EI(w,E,h))return l;n+=2}else{if(!EI(w,{},h))return l;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(t,e,r),i=r.slice(n.commandIndex);if(n.match&&n.pathIndex<t.segments.length){const l=new Vn(t.segments.slice(0,n.pathIndex),{});return l.children[qt]=new Vn(t.segments.slice(n.pathIndex),t.children),Ef(l,0,i)}return n.match&&0===i.length?new Vn(t.segments,{}):n.match&&!t.hasChildren()?Hx(t,e,r):n.match?Ef(t,0,i):Hx(t,e,r)}function Ef(t,e,r){if(0===r.length)return new Vn(t.segments,{});{const n=function vN(t){return Df(t[0])?t[0].outlets:{[qt]:t}}(r),i={};if(!n[qt]&&t.children[qt]&&1===t.numberOfChildren&&0===t.children[qt].segments.length){const l=Ef(t.children[qt],e,r);return new Vn(t.segments,l.children)}return Object.entries(n).forEach(([l,h])=>{"string"==typeof h&&(h=[h]),null!==h&&(i[l]=CI(t.children[l],e,h))}),Object.entries(t.children).forEach(([l,h])=>{void 0===n[l]&&(i[l]=h)}),new Vn(t.segments,i)}}function Hx(t,e,r){const n=t.segments.slice(0,e);let i=0;for(;i<r.length;){const l=r[i];if(Df(l)){const w=bN(l.outlets);return new Vn(n,w)}if(0===i&&Xg(r[0])){n.push(new bf(t.segments[e].path,DI(r[0]))),i++;continue}const h=Df(l)?l.outlets[qt]:`${l}`,f=i<r.length-1?r[i+1]:null;h&&f&&Xg(f)?(n.push(new bf(h,DI(f))),i+=2):(n.push(new bf(h,{})),i++)}return new Vn(n,{})}function bN(t){const e={};return Object.entries(t).forEach(([r,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(e[r]=Hx(new Vn([],{}),0,n))}),e}function DI(t){const e={};return Object.entries(t).forEach(([r,n])=>e[r]=`${n}`),e}function EI(t,e,r){return t==r.path&&sl(e,r.parameters)}const If="imperative";class al{constructor(e,r){this.id=e,this.url=r}}class Gx extends al{constructor(e,r,n="imperative",i=null){super(e,r),this.type=0,this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Uc extends al{constructor(e,r,n){super(e,r),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Yg extends al{constructor(e,r,n,i){super(e,r),this.reason=n,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Tf extends al{constructor(e,r,n,i){super(e,r),this.reason=n,this.code=i,this.type=16}}class qx extends al{constructor(e,r,n,i){super(e,r),this.error=n,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class wN extends al{constructor(e,r,n,i){super(e,r),this.urlAfterRedirects=n,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class CN extends al{constructor(e,r,n,i){super(e,r),this.urlAfterRedirects=n,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class DN extends al{constructor(e,r,n,i,l){super(e,r),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=l,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class EN extends al{constructor(e,r,n,i){super(e,r),this.urlAfterRedirects=n,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class IN extends al{constructor(e,r,n,i){super(e,r),this.urlAfterRedirects=n,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class TN{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class SN{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class MN{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class AN{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class PN{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class kN{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class II{constructor(e,r,n){this.routerEvent=e,this.position=r,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class RN{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Sf,this.attachRef=null}}let Sf=(()=>{const e=class{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){const l=this.getOrCreateContext(n);l.outlet=i,this.contexts.set(n,l)}onChildOutletDestroyed(n){const i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new RN,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class TI{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const r=this.pathFromRoot(e);return r.length>1?r[r.length-2]:null}children(e){const r=Zx(e,this._root);return r?r.children.map(n=>n.value):[]}firstChild(e){const r=Zx(e,this._root);return r&&r.children.length>0?r.children[0].value:null}siblings(e){const r=Wx(e,this._root);return r.length<2?[]:r[r.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return Wx(e,this._root).map(r=>r.value)}}function Zx(t,e){if(t===e.value)return e;for(const r of e.children){const n=Zx(t,r);if(n)return n}return null}function Wx(t,e){if(t===e.value)return[e];for(const r of e.children){const n=Wx(t,r);if(n.length)return n.unshift(e),n}return[]}class Kl{constructor(e,r){this.value=e,this.children=r}toString(){return`TreeNode(${this.value})`}}function gh(t){const e={};return t&&t.children.forEach(r=>e[r.value.outlet]=r),e}class SI extends TI{constructor(e,r){super(e),this.snapshot=r,Xx(this,e)}toString(){return this.snapshot.toString()}}function MI(t,e){const r=function FN(t,e){const h=new Jg([],{},{},"",{},qt,e,null,{});return new PI("",new Kl(h,[]))}(0,e),n=new fr([new bf("",{})]),i=new fr({}),l=new fr({}),h=new fr({}),f=new fr(""),w=new td(n,i,h,f,l,qt,e,r.root);return w.snapshot=r.root,new SI(new Kl(w,[]),r)}class td{constructor(e,r,n,i,l,h,f,w){this.urlSubject=e,this.paramsSubject=r,this.queryParamsSubject=n,this.fragmentSubject=i,this.dataSubject=l,this.outlet=h,this.component=f,this._futureSnapshot=w,this.title=this.dataSubject?.pipe($t(E=>E[xf]))??wt(void 0),this.url=e,this.params=r,this.queryParams=n,this.fragment=i,this.data=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe($t(e=>fh(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe($t(e=>fh(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function AI(t,e="emptyOnly"){const r=t.pathFromRoot;let n=0;if("always"!==e)for(n=r.length-1;n>=1;){const i=r[n],l=r[n-1];if(i.routeConfig&&""===i.routeConfig.path)n--;else{if(l.component)break;n--}}return function LN(t){return t.reduce((e,r)=>({params:{...e.params,...r.params},data:{...e.data,...r.data},resolve:{...r.data,...e.resolve,...r.routeConfig?.data,...r._resolvedData}}),{params:{},data:{},resolve:{}})}(r.slice(n))}class Jg{get title(){return this.data?.[xf]}constructor(e,r,n,i,l,h,f,w,E){this.url=e,this.params=r,this.queryParams=n,this.fragment=i,this.data=l,this.outlet=h,this.component=f,this.routeConfig=w,this._resolve=E}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=fh(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=fh(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class PI extends TI{constructor(e,r){super(r),this.url=e,Xx(this,r)}toString(){return kI(this._root)}}function Xx(t,e){e.value._routerState=t,e.children.forEach(r=>Xx(t,r))}function kI(t){const e=t.children.length>0?` { ${t.children.map(kI).join(", ")} } `:"";return`${t.value}${e}`}function Kx(t){if(t.snapshot){const e=t.snapshot,r=t._futureSnapshot;t.snapshot=r,sl(e.queryParams,r.queryParams)||t.queryParamsSubject.next(r.queryParams),e.fragment!==r.fragment&&t.fragmentSubject.next(r.fragment),sl(e.params,r.params)||t.paramsSubject.next(r.params),function KO(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!sl(t[r],e[r]))return!1;return!0}(e.url,r.url)||t.urlSubject.next(r.url),sl(e.data,r.data)||t.dataSubject.next(r.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function Yx(t,e){const r=sl(t.params,e.params)&&function eN(t,e){return Qu(t,e)&&t.every((r,n)=>sl(r.parameters,e[n].parameters))}(t.url,e.url);return r&&!(!t.parent!=!e.parent)&&(!t.parent||Yx(t.parent,e.parent))}let Jx=(()=>{const e=class{constructor(){this.activated=null,this._activatedRoute=null,this.name=qt,this.activateEvents=new Pr,this.deactivateEvents=new Pr,this.attachEvents=new Pr,this.detachEvents=new Pr,this.parentContexts=rt(Sf),this.location=rt(ha),this.changeDetector=rt(dg),this.environmentInjector=rt(qa),this.inputBinder=rt(Qg,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:i,previousValue:l}=n.name;if(i)return;this.isTrackedInParentContexts(l)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(l)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ne(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ne(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ne(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Ne(4013,!1);this._activatedRoute=n;const l=this.location,f=n.snapshot.component,w=this.parentContexts.getOrCreateContext(this.name).children,E=new ON(n,w,l.injector);this.activated=l.createComponent(f,{index:l.length,injector:E,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Tt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[fo]}),t})();class ON{constructor(e,r,n){this.route=e,this.childContexts=r,this.parent=n}get(e,r){return e===td?this.route:e===Sf?this.childContexts:this.parent.get(e,r)}}const Qg=new ut("");let RI=(()=>{const e=class{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:i}=n,l=Ox([i.queryParams,i.params,i.data]).pipe(ji(([h,f,w],E)=>(w={...h,...f,...w},0===E?wt(w):Promise.resolve(w)))).subscribe(h=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==i||null===i.component)return void this.unsubscribeFromRouteData(n);const f=function Bk(t){const e=on(t);if(!e)return null;const r=new Hp(e);return{get selector(){return r.selector},get type(){return r.componentType},get inputs(){return r.inputs},get outputs(){return r.outputs},get ngContentSelectors(){return r.ngContentSelectors},get isStandalone(){return e.standalone}}}(i.component);if(f)for(const{templateName:w}of f.inputs)n.activatedComponentRef.setInput(w,h[w]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,l)}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();function Mf(t,e,r){if(r&&t.shouldReuseRoute(e.value,r.value.snapshot)){const n=r.value;n._futureSnapshot=e.value;const i=function zN(t,e,r){return e.children.map(n=>{for(const i of r.children)if(t.shouldReuseRoute(n.value,i.value.snapshot))return Mf(t,n,i);return Mf(t,n)})}(t,e,r);return new Kl(n,i)}{if(t.shouldAttach(e.value)){const l=t.retrieve(e.value);if(null!==l){const h=l.route;return h.value._futureSnapshot=e.value,h.children=e.children.map(f=>Mf(t,f)),h}}const n=function BN(t){return new td(new fr(t.url),new fr(t.params),new fr(t.queryParams),new fr(t.fragment),new fr(t.data),t.outlet,t.component,t)}(e.value),i=e.children.map(l=>Mf(t,l));return new Kl(n,i)}}const Qx="ngNavigationCancelingError";function FI(t,e){const{redirectTo:r,navigationBehaviorOptions:n}=ed(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=LI(!1,0,e);return i.url=r,i.navigationBehaviorOptions=n,i}function LI(t,e,r){const n=new Error("NavigationCancelingError: "+(t||""));return n[Qx]=!0,n.cancellationCode=e,r&&(n.url=r),n}function OI(t){return NI(t)&&ed(t.url)}function NI(t){return t&&t[Qx]}let zI=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=sr({type:e,selectors:[["ng-component"]],standalone:!0,features:[f1],decls:1,vars:0,template:function(i,l){1&i&&Vs(0,"router-outlet")},dependencies:[Jx],encapsulation:2}),t})();function e0(t){const e=t.children&&t.children.map(e0),r=e?{...t,children:e}:{...t};return!r.component&&!r.loadComponent&&(e||r.loadChildren)&&r.outlet&&r.outlet!==qt&&(r.component=zI),r}function ga(t){return t.outlet||qt}function Af(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let e=t.parent;e;e=e.parent){const r=e.routeConfig;if(r?._loadedInjector)return r._loadedInjector;if(r?._injector)return r._injector}return null}class qN{constructor(e,r,n,i,l){this.routeReuseStrategy=e,this.futureState=r,this.currState=n,this.forwardEvent=i,this.inputBindingEnabled=l}activate(e){const r=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(r,n,e),Kx(this.futureState.root),this.activateChildRoutes(r,n,e)}deactivateChildRoutes(e,r,n){const i=gh(r);e.children.forEach(l=>{const h=l.value.outlet;this.deactivateRoutes(l,i[h],n),delete i[h]}),Object.values(i).forEach(l=>{this.deactivateRouteAndItsChildren(l,n)})}deactivateRoutes(e,r,n){const i=e.value,l=r?r.value:null;if(i===l)if(i.component){const h=n.getContext(i.outlet);h&&this.deactivateChildRoutes(e,r,h.children)}else this.deactivateChildRoutes(e,r,n);else l&&this.deactivateRouteAndItsChildren(r,n)}deactivateRouteAndItsChildren(e,r){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,r):this.deactivateRouteAndOutlet(e,r)}detachAndStoreRouteSubtree(e,r){const n=r.getContext(e.value.outlet),i=n&&e.value.component?n.children:r,l=gh(e);for(const h of Object.keys(l))this.deactivateRouteAndItsChildren(l[h],i);if(n&&n.outlet){const h=n.outlet.detach(),f=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:h,route:e,contexts:f})}}deactivateRouteAndOutlet(e,r){const n=r.getContext(e.value.outlet),i=n&&e.value.component?n.children:r,l=gh(e);for(const h of Object.keys(l))this.deactivateRouteAndItsChildren(l[h],i);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,r,n){const i=gh(r);e.children.forEach(l=>{this.activateRoutes(l,i[l.value.outlet],n),this.forwardEvent(new kN(l.value.snapshot))}),e.children.length&&this.forwardEvent(new AN(e.value.snapshot))}activateRoutes(e,r,n){const i=e.value,l=r?r.value:null;if(Kx(i),i===l)if(i.component){const h=n.getOrCreateContext(i.outlet);this.activateChildRoutes(e,r,h.children)}else this.activateChildRoutes(e,r,n);else if(i.component){const h=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const f=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),h.children.onOutletReAttached(f.contexts),h.attachRef=f.componentRef,h.route=f.route.value,h.outlet&&h.outlet.attach(f.componentRef,f.route.value),Kx(f.route.value),this.activateChildRoutes(e,null,h.children)}else{const f=Af(i.snapshot);h.attachRef=null,h.route=i,h.injector=f,h.outlet&&h.outlet.activateWith(i,h.injector),this.activateChildRoutes(e,null,h.children)}}else this.activateChildRoutes(e,null,n)}}class BI{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class ey{constructor(e,r){this.component=e,this.route=r}}function ZN(t,e,r){const n=t._root;return Pf(n,e?e._root:null,r,[n.value])}function yh(t,e){const r=Symbol(),n=e.get(t,r);return n===r?"function"!=typeof t||function Sh(t){return null!==sc(t)}(t)?e.get(t):t:n}function Pf(t,e,r,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const l=gh(e);return t.children.forEach(h=>{(function XN(t,e,r,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const l=t.value,h=e?e.value:null,f=r?r.getContext(t.value.outlet):null;if(h&&l.routeConfig===h.routeConfig){const w=function KN(t,e,r){if("function"==typeof r)return r(t,e);switch(r){case"pathParamsChange":return!Qu(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Qu(t.url,e.url)||!sl(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Yx(t,e)||!sl(t.queryParams,e.queryParams);default:return!Yx(t,e)}}(h,l,l.routeConfig.runGuardsAndResolvers);w?i.canActivateChecks.push(new BI(n)):(l.data=h.data,l._resolvedData=h._resolvedData),Pf(t,e,l.component?f?f.children:null:r,n,i),w&&f&&f.outlet&&f.outlet.isActivated&&i.canDeactivateChecks.push(new ey(f.outlet.component,h))}else h&&kf(e,f,i),i.canActivateChecks.push(new BI(n)),Pf(t,null,l.component?f?f.children:null:r,n,i)})(h,l[h.value.outlet],r,n.concat([h.value]),i),delete l[h.value.outlet]}),Object.entries(l).forEach(([h,f])=>kf(f,r.getContext(h),i)),i}function kf(t,e,r){const n=gh(t),i=t.value;Object.entries(n).forEach(([l,h])=>{kf(h,i.component?e?e.children.getContext(l):null:e,r)}),r.canDeactivateChecks.push(new ey(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}function Rf(t){return"function"==typeof t}function VI(t){return t instanceof jg||"EmptyError"===t?.name}const ty=Symbol("INITIAL_VALUE");function _h(){return ji(t=>Ox(t.map(e=>e.pipe(ph(1),function $O(...t){const e=Xn(t);return pn((r,n)=>{(e?Nx(t,r,e):Nx(t,r)).subscribe(n)})}(ty)))).pipe($t(e=>{for(const r of e)if(!0!==r){if(r===ty)return ty;if(!1===r||r instanceof mh)return r}return!0}),il(e=>e!==ty),ph(1)))}function UI(t){return function Wo(...t){return $i(t)}(no(e=>{if(ed(e))throw FI(0,e)}),$t(e=>!0===e))}class ny{constructor(e){this.segmentGroup=e||null}}class $I{constructor(e){this.urlTree=e}}function vh(t){return hh(new ny(t))}function jI(t){return hh(new $I(t))}class gz{constructor(e,r){this.urlSerializer=e,this.urlTree=r}noMatchError(e){return new Ne(4002,!1)}lineralizeSegments(e,r){let n=[],i=r.root;for(;;){if(n=n.concat(i.segments),0===i.numberOfChildren)return wt(n);if(i.numberOfChildren>1||!i.children[qt])return hh(new Ne(4e3,!1));i=i.children[qt]}}applyRedirectCommands(e,r,n){return this.applyRedirectCreateUrlTree(r,this.urlSerializer.parse(r),e,n)}applyRedirectCreateUrlTree(e,r,n,i){const l=this.createSegmentGroup(e,r.root,n,i);return new mh(l,this.createQueryParams(r.queryParams,this.urlTree.queryParams),r.fragment)}createQueryParams(e,r){const n={};return Object.entries(e).forEach(([i,l])=>{if("string"==typeof l&&l.startsWith(":")){const f=l.substring(1);n[i]=r[f]}else n[i]=l}),n}createSegmentGroup(e,r,n,i){const l=this.createSegments(e,r.segments,n,i);let h={};return Object.entries(r.children).forEach(([f,w])=>{h[f]=this.createSegmentGroup(e,w,n,i)}),new Vn(l,h)}createSegments(e,r,n,i){return r.map(l=>l.path.startsWith(":")?this.findPosParam(e,l,i):this.findOrReturn(l,n))}findPosParam(e,r,n){const i=n[r.path.substring(1)];if(!i)throw new Ne(4001,!1);return i}findOrReturn(e,r){let n=0;for(const i of r){if(i.path===e.path)return r.splice(n),i;n++}return e}}const t0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function yz(t,e,r,n,i){const l=n0(t,e,r);return l.matched?(n=function VN(t,e){return t.providers&&!t._injector&&(t._injector=rv(t.providers,e,`Route: ${t.path}`)),t._injector??e}(e,n),function pz(t,e,r,n){const i=e.canMatch;return i&&0!==i.length?wt(i.map(h=>{const f=yh(h,t);return Vc(function nz(t){return t&&Rf(t.canMatch)}(f)?f.canMatch(e,r):t.runInContext(()=>f(e,r)))})).pipe(_h(),UI()):wt(!0)}(n,e,r).pipe($t(h=>!0===h?l:{...t0}))):wt(l)}function n0(t,e,r){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||r.length>0)?{...t0}:{matched:!0,consumedSegments:[],remainingSegments:r,parameters:{},positionalParamSegments:{}};const i=(e.matcher||XO)(r,t,e);if(!i)return{...t0};const l={};Object.entries(i.posParams??{}).forEach(([f,w])=>{l[f]=w.path});const h=i.consumed.length>0?{...l,...i.consumed[i.consumed.length-1].parameters}:l;return{matched:!0,consumedSegments:i.consumed,remainingSegments:r.slice(i.consumed.length),parameters:h,positionalParamSegments:i.posParams??{}}}function HI(t,e,r,n){return r.length>0&&function xz(t,e,r){return r.some(n=>ry(t,e,n)&&ga(n)!==qt)}(t,r,n)?{segmentGroup:new Vn(e,vz(n,new Vn(r,t.children))),slicedSegments:[]}:0===r.length&&function bz(t,e,r){return r.some(n=>ry(t,e,n))}(t,r,n)?{segmentGroup:new Vn(t.segments,_z(t,0,r,n,t.children)),slicedSegments:r}:{segmentGroup:new Vn(t.segments,t.children),slicedSegments:r}}function _z(t,e,r,n,i){const l={};for(const h of n)if(ry(t,r,h)&&!i[ga(h)]){const f=new Vn([],{});l[ga(h)]=f}return{...i,...l}}function vz(t,e){const r={};r[qt]=e;for(const n of t)if(""===n.path&&ga(n)!==qt){const i=new Vn([],{});r[ga(n)]=i}return r}function ry(t,e,r){return(!(t.hasChildren()||e.length>0)||"full"!==r.pathMatch)&&""===r.path}class Ez{constructor(e,r,n,i,l,h,f){this.injector=e,this.configLoader=r,this.rootComponentType=n,this.config=i,this.urlTree=l,this.paramsInheritanceStrategy=h,this.urlSerializer=f,this.allowRedirects=!0,this.applyRedirects=new gz(this.urlSerializer,this.urlTree)}noMatchError(e){return new Ne(4002,!1)}recognize(){const e=HI(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,qt).pipe(Bc(r=>{if(r instanceof $I)return this.allowRedirects=!1,this.urlTree=r.urlTree,this.match(r.urlTree);throw r instanceof ny?this.noMatchError(r):r}),$t(r=>{const n=new Jg([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},qt,this.rootComponentType,null,{}),i=new Kl(n,r),l=new PI("",i),h=function mN(t,e,r=null,n=null){return xI(vI(t),e,r,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return h.queryParams=this.urlTree.queryParams,l.url=this.urlSerializer.serialize(h),this.inheritParamsAndData(l._root),{state:l,tree:h}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e.root,qt).pipe(Bc(n=>{throw n instanceof ny?this.noMatchError(n):n}))}inheritParamsAndData(e){const r=e.value,n=AI(r,this.paramsInheritanceStrategy);r.params=Object.freeze(n.params),r.data=Object.freeze(n.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,r,n,i){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,r,n):this.processSegment(e,r,n,n.segments,i,!0)}processChildren(e,r,n){const i=[];for(const l of Object.keys(n.children))"primary"===l?i.unshift(l):i.push(l);return gr(i).pipe(ch(l=>{const h=n.children[l],f=function HN(t,e){const r=t.filter(n=>ga(n)===e);return r.push(...t.filter(n=>ga(n)!==e)),r}(r,l);return this.processSegmentGroup(e,f,h,l)}),function GO(t,e){return pn(function HO(t,e,r,n,i){return(l,h)=>{let f=r,w=e,E=0;l.subscribe($n(h,P=>{const O=E++;w=f?t(w,P,O):(f=!0,P),n&&h.next(w)},i&&(()=>{f&&h.next(w),h.complete()})))}}(t,e,arguments.length>=2,!0))}((l,h)=>(l.push(...h),l)),Hg(null),function qO(t,e){const r=arguments.length>=2;return n=>n.pipe(t?il((i,l)=>t(i,l,n)):Gr,Bx(1),r?Hg(e):sI(()=>new jg))}(),ze(l=>{if(null===l)return vh(n);const h=GI(l);return function Iz(t){t.sort((e,r)=>e.value.outlet===qt?-1:r.value.outlet===qt?1:e.value.outlet.localeCompare(r.value.outlet))}(h),wt(h)}))}processSegment(e,r,n,i,l,h){return gr(r).pipe(ch(f=>this.processSegmentAgainstRoute(f._injector??e,r,f,n,i,l,h).pipe(Bc(w=>{if(w instanceof ny)return wt(null);throw w}))),Ju(f=>!!f),Bc(f=>{if(VI(f))return function Cz(t,e,r){return 0===e.length&&!t.children[r]}(n,i,l)?wt([]):vh(n);throw f}))}processSegmentAgainstRoute(e,r,n,i,l,h,f){return function wz(t,e,r,n){return!!(ga(t)===n||n!==qt&&ry(e,r,t))&&("**"===t.path||n0(e,t,r).matched)}(n,i,l,h)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(e,i,n,l,h,f):f&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,i,r,n,l,h):vh(i):vh(i)}expandSegmentAgainstRouteUsingRedirect(e,r,n,i,l,h){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,i,h):this.expandRegularSegmentAgainstRouteUsingRedirect(e,r,n,i,l,h)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,n,i){const l=this.applyRedirects.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?jI(l):this.applyRedirects.lineralizeSegments(n,l).pipe(ze(h=>{const f=new Vn(h,{});return this.processSegment(e,r,f,h,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,r,n,i,l,h){const{matched:f,consumedSegments:w,remainingSegments:E,positionalParamSegments:P}=n0(r,i,l);if(!f)return vh(r);const O=this.applyRedirects.applyRedirectCommands(w,i.redirectTo,P);return i.redirectTo.startsWith("/")?jI(O):this.applyRedirects.lineralizeSegments(i,O).pipe(ze(Z=>this.processSegment(e,n,r,Z.concat(E),h,!1)))}matchSegmentAgainstRoute(e,r,n,i,l,h){let f;if("**"===n.path){const w=i.length>0?lI(i).parameters:{};f=wt({snapshot:new Jg(i,w,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,qI(n),ga(n),n.component??n._loadedComponent??null,n,ZI(n)),consumedSegments:[],remainingSegments:[]}),r.children={}}else f=yz(r,n,i,e).pipe($t(({matched:w,consumedSegments:E,remainingSegments:P,parameters:O})=>w?{snapshot:new Jg(E,O,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,qI(n),ga(n),n.component??n._loadedComponent??null,n,ZI(n)),consumedSegments:E,remainingSegments:P}:null));return f.pipe(ji(w=>null===w?vh(r):this.getChildConfig(e=n._injector??e,n,i).pipe(ji(({routes:E})=>{const P=n._loadedInjector??e,{snapshot:O,consumedSegments:Z,remainingSegments:J}=w,{segmentGroup:he,slicedSegments:xe}=HI(r,Z,J,E);if(0===xe.length&&he.hasChildren())return this.processChildren(P,E,he).pipe($t(ke=>null===ke?null:[new Kl(O,ke)]));if(0===E.length&&0===xe.length)return wt([new Kl(O,[])]);const Ie=ga(n)===l;return this.processSegment(P,E,he,xe,Ie?qt:l,!0).pipe($t(ke=>[new Kl(O,ke)]))}))))}getChildConfig(e,r,n){return r.children?wt({routes:r.children,injector:e}):r.loadChildren?void 0!==r._loadedRoutes?wt({routes:r._loadedRoutes,injector:r._loadedInjector}):function hz(t,e,r,n){const i=e.canLoad;return void 0===i||0===i.length?wt(!0):wt(i.map(h=>{const f=yh(h,t);return Vc(function JN(t){return t&&Rf(t.canLoad)}(f)?f.canLoad(e,r):t.runInContext(()=>f(e,r)))})).pipe(_h(),UI())}(e,r,n).pipe(ze(i=>i?this.configLoader.loadChildren(e,r).pipe(no(l=>{r._loadedRoutes=l.routes,r._loadedInjector=l.injector})):function mz(t){return hh(LI(!1,3))}())):wt({routes:[],injector:e})}}function Tz(t){const e=t.value.routeConfig;return e&&""===e.path}function GI(t){const e=[],r=new Set;for(const n of t){if(!Tz(n)){e.push(n);continue}const i=e.find(l=>n.value.routeConfig===l.value.routeConfig);void 0!==i?(i.children.push(...n.children),r.add(i)):e.push(n)}for(const n of r){const i=GI(n.children);e.push(new Kl(n.value,i))}return e.filter(n=>!r.has(n))}function qI(t){return t.data||{}}function ZI(t){return t.resolve||{}}function WI(t){return"string"==typeof t.title||null===t.title}function r0(t){return ji(e=>{const r=t(e);return r?gr(r).pipe($t(()=>e)):wt(e)})}const xh=new ut("ROUTES");let o0=(()=>{const e=class{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=rt(lC)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return wt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=Vc(n.loadComponent()).pipe($t(XI),no(h=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=h}),yf(()=>{this.componentLoaders.delete(n)})),l=new oI(i,()=>new Cr).pipe(zx());return this.componentLoaders.set(n,l),l}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return wt({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const h=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe($t(w=>{this.onLoadEndListener&&this.onLoadEndListener(i);let E,P;return Array.isArray(w)?P=w:(E=w.create(n).injector,P=E.get(xh,[],_t.Self|_t.Optional).flat()),{routes:P.map(e0),injector:E}}),yf(()=>{this.childrenLoaders.delete(i)})),f=new oI(h,()=>new Cr).pipe(zx());return this.childrenLoaders.set(i,f),f}loadModuleFactoryOrRoutes(n){return Vc(n()).pipe($t(XI),ze(i=>i instanceof h1||Array.isArray(i)?wt(i):gr(this.compiler.compileModuleAsync(i))))}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function XI(t){return function Fz(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let iy=(()=>{const e=class{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Cr,this.configLoader=rt(o0),this.environmentInjector=rt(qa),this.urlSerializer=rt(wf),this.rootContexts=rt(Sf),this.inputBindingEnabled=null!==rt(Qg,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>wt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=l=>this.events.next(new SN(l)),this.configLoader.onLoadStartListener=l=>this.events.next(new TN(l))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:i})}setupNavigations(n){return this.transitions=new fr({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:If,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(il(i=>0!==i.id),$t(i=>({...i,extractedUrl:n.urlHandlingStrategy.extract(i.rawUrl)})),ji(i=>{let l=!1,h=!1;return wt(i).pipe(no(f=>{this.currentNavigation={id:f.id,initialUrl:f.rawUrl,extractedUrl:f.extractedUrl,trigger:f.source,extras:f.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ji(f=>{const w=n.browserUrlTree.toString(),E=!n.navigated||f.extractedUrl.toString()!==w||w!==n.currentUrlTree.toString();if(!E&&"reload"!==(f.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const O="";return this.events.next(new Tf(f.id,n.serializeUrl(i.rawUrl),O,0)),n.rawUrlTree=f.rawUrl,f.resolve(null),ht}if(n.urlHandlingStrategy.shouldProcessUrl(f.rawUrl))return KI(f.source)&&(n.browserUrlTree=f.extractedUrl),wt(f).pipe(ji(O=>{const Z=this.transitions?.getValue();return this.events.next(new Gx(O.id,this.urlSerializer.serialize(O.extractedUrl),O.source,O.restoredState)),Z!==this.transitions?.getValue()?ht:Promise.resolve(O)}),function Sz(t,e,r,n,i,l){return ze(h=>function Dz(t,e,r,n,i,l,h="emptyOnly"){return new Ez(t,e,r,n,i,h,l).recognize()}(t,e,r,n,h.extractedUrl,i,l).pipe($t(({state:f,tree:w})=>({...h,targetSnapshot:f,urlAfterRedirects:w}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),no(O=>{if(i.targetSnapshot=O.targetSnapshot,i.urlAfterRedirects=O.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:O.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!O.extras.skipLocationChange){const J=n.urlHandlingStrategy.merge(O.urlAfterRedirects,O.rawUrl);n.setBrowserUrl(J,O)}n.browserUrlTree=O.urlAfterRedirects}const Z=new wN(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next(Z)}));if(E&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:O,extractedUrl:Z,source:J,restoredState:he,extras:xe}=f,Ie=new Gx(O,this.urlSerializer.serialize(Z),J,he);this.events.next(Ie);const ke=MI(0,this.rootComponentType).snapshot;return wt(i={...f,targetSnapshot:ke,urlAfterRedirects:Z,extras:{...xe,skipLocationChange:!1,replaceUrl:!1}})}{const O="";return this.events.next(new Tf(f.id,n.serializeUrl(i.extractedUrl),O,1)),n.rawUrlTree=f.rawUrl,f.resolve(null),ht}}),no(f=>{const w=new CN(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(w)}),$t(f=>i={...f,guards:ZN(f.targetSnapshot,f.currentSnapshot,this.rootContexts)}),function iz(t,e){return ze(r=>{const{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:l,canDeactivateChecks:h}}=r;return 0===h.length&&0===l.length?wt({...r,guardsResult:!0}):function oz(t,e,r,n){return gr(t).pipe(ze(i=>function dz(t,e,r,n,i){const l=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return l&&0!==l.length?wt(l.map(f=>{const w=Af(e)??i,E=yh(f,w);return Vc(function tz(t){return t&&Rf(t.canDeactivate)}(E)?E.canDeactivate(t,e,r,n):w.runInContext(()=>E(t,e,r,n))).pipe(Ju())})).pipe(_h()):wt(!0)}(i.component,i.route,r,e,n)),Ju(i=>!0!==i,!0))}(h,n,i,t).pipe(ze(f=>f&&function YN(t){return"boolean"==typeof t}(f)?function sz(t,e,r,n){return gr(e).pipe(ch(i=>Nx(function lz(t,e){return null!==t&&e&&e(new MN(t)),wt(!0)}(i.route.parent,n),function az(t,e){return null!==t&&e&&e(new PN(t)),wt(!0)}(i.route,n),function uz(t,e,r){const n=e[e.length-1],l=e.slice(0,e.length-1).reverse().map(h=>function WN(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(h)).filter(h=>null!==h).map(h=>iI(()=>wt(h.guards.map(w=>{const E=Af(h.node)??r,P=yh(w,E);return Vc(function ez(t){return t&&Rf(t.canActivateChild)}(P)?P.canActivateChild(n,t):E.runInContext(()=>P(n,t))).pipe(Ju())})).pipe(_h())));return wt(l).pipe(_h())}(t,i.path,r),function cz(t,e,r){const n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||0===n.length)return wt(!0);const i=n.map(l=>iI(()=>{const h=Af(e)??r,f=yh(l,h);return Vc(function QN(t){return t&&Rf(t.canActivate)}(f)?f.canActivate(e,t):h.runInContext(()=>f(e,t))).pipe(Ju())}));return wt(i).pipe(_h())}(t,i.route,r))),Ju(i=>!0!==i,!0))}(n,l,t,e):wt(f)),$t(f=>({...r,guardsResult:f})))})}(this.environmentInjector,f=>this.events.next(f)),no(f=>{if(i.guardsResult=f.guardsResult,ed(f.guardsResult))throw FI(0,f.guardsResult);const w=new DN(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot,!!f.guardsResult);this.events.next(w)}),il(f=>!!f.guardsResult||(n.restoreHistory(f),this.cancelNavigationTransition(f,"",3),!1)),r0(f=>{if(f.guards.canActivateChecks.length)return wt(f).pipe(no(w=>{const E=new EN(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(E)}),ji(w=>{let E=!1;return wt(w).pipe(function Mz(t,e){return ze(r=>{const{targetSnapshot:n,guards:{canActivateChecks:i}}=r;if(!i.length)return wt(r);let l=0;return gr(i).pipe(ch(h=>function Az(t,e,r,n){const i=t.routeConfig,l=t._resolve;return void 0!==i?.title&&!WI(i)&&(l[xf]=i.title),function Pz(t,e,r,n){const i=function kz(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===i.length)return wt({});const l={};return gr(i).pipe(ze(h=>function Rz(t,e,r,n){const i=Af(e)??n,l=yh(t,i);return Vc(l.resolve?l.resolve(e,r):i.runInContext(()=>l(e,r)))}(t[h],e,r,n).pipe(Ju(),no(f=>{l[h]=f}))),Bx(1),function ZO(t){return $t(()=>t)}(l),Bc(h=>VI(h)?ht:hh(h)))}(l,t,e,n).pipe($t(h=>(t._resolvedData=h,t.data=AI(t,r).resolve,i&&WI(i)&&(t.data[xf]=i.title),null)))}(h.route,n,t,e)),no(()=>l++),Bx(1),ze(h=>l===i.length?wt(r):ht))})}(n.paramsInheritanceStrategy,this.environmentInjector),no({next:()=>E=!0,complete:()=>{E||(n.restoreHistory(w),this.cancelNavigationTransition(w,"",2))}}))}),no(w=>{const E=new IN(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(E)}))}),r0(f=>{const w=E=>{const P=[];E.routeConfig?.loadComponent&&!E.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(E.routeConfig).pipe(no(O=>{E.component=O}),$t(()=>{})));for(const O of E.children)P.push(...w(O));return P};return Ox(w(f.targetSnapshot.root)).pipe(Hg(),ph(1))}),r0(()=>this.afterPreactivation()),$t(f=>{const w=function NN(t,e,r){const n=Mf(t,e._root,r?r._root:void 0);return new SI(n,e)}(n.routeReuseStrategy,f.targetSnapshot,f.currentRouterState);return i={...f,targetRouterState:w}}),no(f=>{n.currentUrlTree=f.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(f.urlAfterRedirects,f.rawUrl),n.routerState=f.targetRouterState,"deferred"===n.urlUpdateStrategy&&(f.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,f),n.browserUrlTree=f.urlAfterRedirects)}),((t,e,r,n)=>$t(i=>(new qN(e,i.targetRouterState,i.currentRouterState,r,n).activate(t),i)))(this.rootContexts,n.routeReuseStrategy,f=>this.events.next(f),this.inputBindingEnabled),ph(1),no({next:f=>{l=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new Uc(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(f.targetRouterState.snapshot),f.resolve(!0)},complete:()=>{l=!0}}),yf(()=>{l||h||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),Bc(f=>{if(h=!0,NI(f)){OI(f)||(n.navigated=!0,n.restoreHistory(i,!0));const w=new Yg(i.id,this.urlSerializer.serialize(i.extractedUrl),f.message,f.cancellationCode);if(this.events.next(w),OI(f)){const E=n.urlHandlingStrategy.merge(f.url,n.rawUrlTree),P={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||KI(i.source)};n.scheduleNavigation(E,If,null,P,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{n.restoreHistory(i,!0);const w=new qx(i.id,this.urlSerializer.serialize(i.extractedUrl),f,i.targetSnapshot??void 0);this.events.next(w);try{i.resolve(n.errorHandler(f))}catch(E){i.reject(E)}}return ht}))}))}cancelNavigationTransition(n,i,l){const h=new Yg(n.id,this.urlSerializer.serialize(n.extractedUrl),i,l);this.events.next(h),n.resolve(!1)}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function KI(t){return t!==If}let YI=(()=>{const e=class{buildTitle(n){let i,l=n.root;for(;void 0!==l;)i=this.getResolvedTitleForRoute(l)??i,l=l.children.find(h=>h.outlet===qt);return i}getResolvedTitleForRoute(n){return n.data[xf]}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return rt(Lz)},providedIn:"root"}),t})(),Lz=(()=>{const e=class extends YI{constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(FD))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Oz=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return rt(zz)},providedIn:"root"}),t})();class Nz{shouldDetach(e){return!1}store(e,r){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,r){return e.routeConfig===r.routeConfig}}let zz=(()=>{const e=class extends Nz{};let t=e;return e.\u0275fac=function(){let n;return function(l){return(n||(n=yr(e)))(l||e)}}(),e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const oy=new ut("",{providedIn:"root",factory:()=>({})});let Bz=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:function(){return rt(Vz)},providedIn:"root"}),t})(),Vz=(()=>{const e=class{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();var ps=(()=>((ps=ps||{})[ps.COMPLETE=0]="COMPLETE",ps[ps.FAILED=1]="FAILED",ps[ps.REDIRECTING=2]="REDIRECTING",ps))();function JI(t,e){t.events.pipe(il(r=>r instanceof Uc||r instanceof Yg||r instanceof qx||r instanceof Tf),$t(r=>r instanceof Uc||r instanceof Tf?ps.COMPLETE:r instanceof Yg&&(0===r.code||1===r.code)?ps.REDIRECTING:ps.FAILED),il(r=>r!==ps.REDIRECTING),ph(1)).subscribe(()=>{e()})}function Uz(t){throw t}function $z(t,e,r){return e.parse("/")}const jz={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Hz={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let wr=(()=>{const e=class{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=rt(aC),this.isNgZoneEnabled=!1,this.options=rt(oy,{optional:!0})||{},this.pendingTasks=rt(lg),this.errorHandler=this.options.errorHandler||Uz,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||$z,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=rt(Bz),this.routeReuseStrategy=rt(Oz),this.titleStrategy=rt(YI),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=rt(xh,{optional:!0})?.flat()??[],this.navigationTransitions=rt(iy),this.urlSerializer=rt(wf),this.location=rt(Vv),this.componentInputBindingEnabled=!!rt(Qg,{optional:!0}),this.isNgZoneEnabled=rt(xr)instanceof xr&&xr.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new mh,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=MI(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),If,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const i="popstate"===n.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,i,n.state)},0)}))}navigateToSyncWithBrowser(n,i,l){const h={replaceUrl:!0},f=l?.navigationId?l:null;if(l){const E={...l};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(h.state=E)}const w=this.parseUrl(n);this.scheduleNavigation(w,i,f,h)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(e0),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,i={}){const{relativeTo:l,queryParams:h,fragment:f,queryParamsHandling:w,preserveFragment:E}=i,P=E?this.currentUrlTree.fragment:f;let Z,O=null;switch(w){case"merge":O={...this.currentUrlTree.queryParams,...h};break;case"preserve":O=this.currentUrlTree.queryParams;break;default:O=h||null}null!==O&&(O=this.removeEmptyProps(O));try{Z=vI(l?l.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),Z=this.currentUrlTree.root}return xI(Z,n,O,P??null)}navigateByUrl(n,i={skipLocationChange:!1}){const l=ed(n)?n:this.parseUrl(n),h=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(h,If,null,i)}navigate(n,i={skipLocationChange:!1}){return function Gz(t){for(let e=0;e<t.length;e++)if(null==t[e])throw new Ne(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let i;try{i=this.urlSerializer.parse(n)}catch(l){i=this.malformedUriErrorHandler(l,this.urlSerializer,n)}return i}isActive(n,i){let l;if(l=!0===i?{...jz}:!1===i?{...Hz}:i,ed(n))return uI(this.currentUrlTree,n,l);const h=this.parseUrl(n);return uI(this.currentUrlTree,h,l)}removeEmptyProps(n){return Object.keys(n).reduce((i,l)=>{const h=n[l];return null!=h&&(i[l]=h),i},{})}scheduleNavigation(n,i,l,h,f){if(this.disposed)return Promise.resolve(!1);let w,E,P;f?(w=f.resolve,E=f.reject,P=f.promise):P=new Promise((Z,J)=>{w=Z,E=J});const O=this.pendingTasks.add();return JI(this,()=>{Promise.resolve().then(()=>this.pendingTasks.remove(O))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:h,resolve:w,reject:E,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch(Z=>Promise.reject(Z))}setBrowserUrl(n,i){const l=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(l)||i.extras.replaceUrl){const f={...i.extras.state,...this.generateNgRouterState(i.id,this.browserPageId)};this.location.replaceState(l,"",f)}else{const h={...i.extras.state,...this.generateNgRouterState(i.id,(this.browserPageId??0)+1)};this.location.go(l,"",h)}}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const h=this.currentPageId-(this.browserPageId??this.currentPageId);0!==h?this.location.historyGo(h):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===h&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),bh=(()=>{const e=class{constructor(n,i,l,h,f,w){this.router=n,this.route=i,this.tabIndexAttribute=l,this.renderer=h,this.el=f,this.locationStrategy=w,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Cr;const E=f.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===E||"area"===E,this.isAnchorElement?this.subscription=n.events.subscribe(P=>{P instanceof Uc&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(n){this._preserveFragment=sh(n)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(n){this._skipLocationChange=sh(n)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(n){this._replaceUrl=sh(n)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,i,l,h,f){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||i||l||h||f||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:function I0(t,e,r){return function ET(t,e){return"src"===e&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===e&&("base"===t||"link"===t)?E0:Jy}(e,r)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,i){const l=this.renderer,h=this.el.nativeElement;null!==i?l.setAttribute(h,n,i):l.removeAttribute(h,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(wr),Me(td),function Eu(t){return function My(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const r=t.attrs;if(r){const n=r.length;let i=0;for(;i<n;){const l=r[i];if(ru(l))break;if(0===l)i+=2;else if("number"==typeof l)for(i++;i<n&&"string"==typeof r[i];)i++;else{if(l===e)return r[i+1];i+=2}}}return null}(Xr(),t)}("tabindex"),Me(Vl),Me(us),Me(Gu))},e.\u0275dir=Tt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,l){1&i&&Ye("click",function(f){return l.onClick(f.button,f.ctrlKey,f.shiftKey,f.altKey,f.metaKey)}),2&i&&Ka("target",l.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[fo]}),t})();class QI{}let Wz=(()=>{const e=class{constructor(n,i,l,h,f){this.router=n,this.injector=l,this.preloadingStrategy=h,this.loader=f}setUpPreloading(){this.subscription=this.router.events.pipe(il(n=>n instanceof Uc),ch(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,i){const l=[];for(const h of i){h.providers&&!h._injector&&(h._injector=rv(h.providers,n,`Route: ${h.path}`));const f=h._injector??n,w=h._loadedInjector??f;(h.loadChildren&&!h._loadedRoutes&&void 0===h.canLoad||h.loadComponent&&!h._loadedComponent)&&l.push(this.preloadConfig(f,h)),(h.children||h._loadedRoutes)&&l.push(this.processRoutes(w,h.children??h._loadedRoutes))}return gr(l).pipe(dt())}preloadConfig(n,i){return this.preloadingStrategy.preload(i,()=>{let l;l=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(n,i):wt(null);const h=l.pipe(ze(f=>null===f?wt(void 0):(i._loadedRoutes=f.routes,i._loadedInjector=f.injector,this.processRoutes(f.injector??n,f.routes))));return i.loadComponent&&!i._loadedComponent?gr([h,this.loader.loadComponent(i)]).pipe(dt()):h})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(wr),lt(lC),lt(qa),lt(QI),lt(o0))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const s0=new ut("");let eT=(()=>{const e=class{constructor(n,i,l,h,f={}){this.urlSerializer=n,this.transitions=i,this.viewportScroller=l,this.zone=h,this.options=f,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},f.scrollPositionRestoration=f.scrollPositionRestoration||"disabled",f.anchorScrolling=f.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof Gx?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Uc?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof Tf&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof II&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new II(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};let t=e;return e.\u0275fac=function(i){!function lb(){throw new Error("invalid")}()},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})();function Yl(t,e){return{\u0275kind:t,\u0275providers:e}}function nT(){const t=rt(Za);return e=>{const r=t.get(oh);if(e!==r.components[0])return;const n=t.get(wr),i=t.get(rT);1===t.get(a0)&&n.initialNavigation(),t.get(iT,null,_t.Optional)?.setUpPreloading(),t.get(s0,null,_t.Optional)?.init(),n.resetRootComponentType(r.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const rT=new ut("",{factory:()=>new Cr}),a0=new ut("",{providedIn:"root",factory:()=>1}),iT=new ut("");function Jz(t){return Yl(0,[{provide:iT,useExisting:Wz},{provide:QI,useExisting:t}])}const oT=new ut("ROUTER_FORROOT_GUARD"),eB=[Vv,{provide:wf,useClass:Vx},wr,Sf,{provide:td,useFactory:function tT(t){return t.routerState.root},deps:[wr]},o0,[]];function tB(){return new vC("Router",wr)}let nB=(()=>{const e=class{constructor(n){}static forRoot(n,i){return{ngModule:e,providers:[eB,[],{provide:xh,multi:!0,useValue:n},{provide:oT,useFactory:sB,deps:[[wr,new cs,new Mu]]},{provide:oy,useValue:i||{}},i?.useHash?{provide:Gu,useClass:Hk}:{provide:Gu,useClass:ZC},{provide:s0,useFactory:()=>{const t=rt(sF),e=rt(xr),r=rt(oy),n=rt(iy),i=rt(wf);return r.scrollOffset&&t.setOffset(r.scrollOffset),new eT(i,n,t,e,r)}},i?.preloadingStrategy?Jz(i.preloadingStrategy).\u0275providers:[],{provide:vC,multi:!0,useFactory:tB},i?.initialNavigation?aB(i):[],i?.bindToComponentInputs?Yl(8,[RI,{provide:Qg,useExisting:RI}]).\u0275providers:[],[{provide:sT,useFactory:nT},{provide:Mv,multi:!0,useExisting:sT}]]}}static forChild(n){return{ngModule:e,providers:[{provide:xh,multi:!0,useValue:n}]}}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(oT,8))},e.\u0275mod=Zi({type:e}),e.\u0275inj=qi({}),t})();function sB(t){return"guarded"}function aB(t){return["disabled"===t.initialNavigation?Yl(3,[{provide:xv,multi:!0,useFactory:()=>{const e=rt(wr);return()=>{e.setUpLocationChangeListener()}}},{provide:a0,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Yl(2,[{provide:a0,useValue:0},{provide:xv,multi:!0,deps:[Za],useFactory:e=>{const r=e.get($k,Promise.resolve());return()=>r.then(()=>new Promise(n=>{const i=e.get(wr),l=e.get(rT);JI(i,()=>{n(!0)}),e.get(iy).afterPreactivation=()=>(n(!0),l.closed?wt(void 0):l),i.initialNavigation()}))}}]).\u0275providers:[]]}const sT=new ut("");let jo=(()=>{const e=class{constructor(n){this.http=n,this.baseUrl=window&&window.location&&"localhost"===window.location.hostname?"http://localhost:8080/api":"http://back:8080/api"}list(n){return this.http.get(`${this.baseUrl}/${n}`)}get(n,i){return this.http.get(`${this.baseUrl}/${n}/${i}`)}create(n,i){return this.http.post(`${this.baseUrl}/${n}`,i)}update(n,i,l){return this.http.put(`${this.baseUrl}/${n}/${i}`,l)}delete(n,i){return this.http.delete(`${this.baseUrl}/${n}/${i}`)}uploadFile(n,i,l){const h=new FormData;return h.append("file",n,n.name),i&&h.append("nomMedia",i),l&&h.append("description",l),this.http.post(`${this.baseUrl}/medias/upload`,h)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(qE))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),aT=(()=>{const e=class{constructor(){this.key="eb-theme";const n=localStorage.getItem(this.key);"dark"===n?(document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light"),document.body.classList.add("dark-theme")):"light"===n?(document.documentElement.classList.add("light"),document.documentElement.classList.remove("dark"),document.body.classList.remove("dark-theme")):(document.documentElement.classList.add("light"),document.body.classList.remove("dark-theme"))}toggle(){const n=document.documentElement.classList.toggle("dark");n?document.documentElement.classList.remove("light"):document.documentElement.classList.add("light"),document.body.classList.toggle("dark-theme",n),localStorage.setItem(this.key,n?"dark":"light")}setDark(n){document.documentElement.classList.toggle("dark",n),document.documentElement.classList.toggle("light",!n),document.body.classList.toggle("dark-theme",n),localStorage.setItem(this.key,n?"dark":"light")}isDark(){return document.documentElement.classList.contains("dark")||document.body.classList.contains("dark-theme")}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),Jl=(()=>{const e=class{get token(){return localStorage.getItem("token")}isLogged(){return!!this.token}getPseudoFromToken(){const n=this.token;if(!n)return null;const i=n.split(".");if(i.length<2)return null;try{return JSON.parse(atob(i[1].replace(/-/g,"+").replace(/_/g,"/"))).sub||null}catch{return null}}};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function cB(t,e){1&t&&(le(0,"nav",7)(1,"a",8),Ae(2,"Tableau de bord"),ce(),le(3,"a",9),Ae(4,"Mes lieux"),ce(),le(5,"a",10),Ae(6,"Mes bornes"),ce(),le(7,"a",11),Ae(8,"Carte des bornes"),ce(),le(9,"a",12),Ae(10,"Mes r\xe9servations"),ce()())}function uB(t,e){1&t&&(le(0,"nav",7)(1,"a",13),Ae(2,"S'inscrire"),ce(),le(3,"a",14),Ae(4,"Connexion"),ce()())}function dB(t,e){if(1&t){const r=ca();le(0,"div",15)(1,"div",16),Ae(2),ce(),le(3,"button",17),Ye("click",function(){return lr(r),cr(Mn().logout())}),Ae(4,"D\xe9connexion"),ce()()}if(2&t){const r=Mn();Re(2),hr(r.auth.getPseudoFromToken()||"Utilisateur")}}function hB(t,e){1&t&&(le(0,"div",15)(1,"a",18),Ae(2,"S'inscrire"),ce(),le(3,"a",19),Ae(4,"Se connecter"),ce()())}let pB=(()=>{const e=class{constructor(n,i,l){this.theme=n,this.auth=i,this.router=l}toggleSidebar(){document.body.classList.toggle("sidebar-open")}logout(){localStorage.removeItem("token"),this.router.navigateByUrl("/connexion")}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(aT),Me(Jl),Me(wr))},e.\u0275cmp=sr({type:e,selectors:[["eb-header"]],decls:11,vars:4,consts:[[1,"h-16","bg-[#071021]/60","backdrop-blur-sm","flex","items-center","px-6","text-white"],[1,"flex-1","flex","items-center","gap-6"],["routerLink","/",1,"text-2xl","font-semibold","text-white"],["class","hidden md:flex items-center gap-4",4,"ngIf"],[1,"flex","items-center","gap-4"],[1,"p-2","rounded-md","hover:bg-white/5",3,"click"],["class","flex items-center gap-3",4,"ngIf"],[1,"hidden","md:flex","items-center","gap-4"],["routerLink","/",1,"px-3","py-2","rounded","hover:bg-white/5"],["routerLink","/lieux",1,"px-3","py-2","rounded","hover:bg-white/5"],["routerLink","/bornes",1,"px-3","py-2","rounded","hover:bg-white/5"],["routerLink","/carte",1,"px-3","py-2","rounded","hover:bg-white/5"],["routerLink","/reservations",1,"px-3","py-2","rounded","hover:bg-white/5"],["routerLink","/inscription",1,"px-3","py-2","rounded","hover:bg-white/5"],["routerLink","/connexion",1,"px-3","py-2","rounded","hover:bg-white/5"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-cyan-300"],[1,"px-3","py-1","bg-red-600/30","hover:bg-red-600/40","rounded",3,"click"],["routerLink","/inscription",1,"px-3","py-1","bg-cyan-600","text-black","rounded","font-semibold"],["routerLink","/connexion",1,"px-3","py-1","bg-white/5","rounded"]],template:function(i,l){1&i&&(le(0,"header",0)(1,"div",1)(2,"a",2),Ae(3,"EVCharge"),ce(),Sn(4,cB,11,0,"nav",3),Sn(5,uB,5,0,"nav",3),ce(),le(6,"div",4)(7,"button",5),Ye("click",function(){return l.theme.toggle()}),Ae(8,"Th\xe8me"),ce(),Sn(9,dB,5,1,"div",6),Sn(10,hB,5,0,"div",6),ce()()),2&i&&(Re(4),Ze("ngIf",l.auth.isLogged()),Re(1),Ze("ngIf",!l.auth.isLogged()),Re(4),Ze("ngIf",l.auth.isLogged()),Re(1),Ze("ngIf",!l.auth.isLogged()))},dependencies:[Zl,bh],styles:["[_nghost-%COMP%]{display:block}"]}),t})(),fB=(()=>{const e=class{constructor(n,i,l){this.api=n,this.router=i,this.theme=l,this.router.events.pipe(il(h=>h instanceof Uc)).subscribe(h=>{const f=h.urlAfterRedirects||h.url||"",w=document.body;w.classList.remove("home-bg","login-bg","dashboard-bg","map-bg","management-bg","reservations-bg"),f.startsWith("/connexion")||f.startsWith("/inscription")?w.classList.add("login-bg"):"/"===f||f.startsWith("/tableau-de-bord")?w.classList.add("dashboard-bg"):f.startsWith("/carte")?w.classList.add("map-bg"):f.startsWith("/gestion")||f.startsWith("/bornes")||f.startsWith("/lieux")?w.classList.add("management-bg"):f.startsWith("/reservations")?w.classList.add("reservations-bg"):w.classList.add("home-bg")})}isLogged(){return!!localStorage.getItem("token")}demoLogin(){this.api.create("auth/login",{pseudo:"alice",motDePasse:"secret"}).subscribe(i=>{i&&i.token&&(localStorage.setItem("token",i.token),this.router.navigateByUrl("/"))})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(wr),Me(aT))},e.\u0275cmp=sr({type:e,selectors:[["app-root"]],decls:5,vars:0,consts:[[1,"app-shell","min-h-screen","flex"],[1,"flex-1","flex","flex-col"],[1,"main-wrap","p-6"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"div",1),Vs(2,"eb-header"),le(3,"main",2),Vs(4,"router-outlet"),ce()()())},dependencies:[Jx,pB],encapsulation:2}),t})(),mB=(()=>{const e=class{constructor(n,i){this.api=n,this.router=i,this.model={}}ngOnInit(){}register(){this.api.create("auth/register",{adresseMail:this.model.adresseMail,motDePasse:this.model.motDePasse,nomUtilisateur:this.model.nomUtilisateur||this.model.nom||"",prenom:this.model.prenom||"",pseudo:this.model.pseudo||"",dateNaissance:this.model.dateNaissance||null,vehicule:this.model.vehicule||null}).subscribe({next:i=>{console.log("inscription success",i),this.router.navigateByUrl("/connexion")},error:i=>console.error("inscription error",i)})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(wr))},e.\u0275cmp=sr({type:e,selectors:[["inscription"]],decls:17,vars:7,consts:[[1,"flex","h-screen"],[1,"w-1/2","h-full","bg-cover","bg-center",2,"background-image","url('https://images.unsplash.com/photo-1507679799987-c73779587ccf?auto=format&fit=crop&w=1600&q=80')"],[1,"w-full","h-full","bg-black","bg-opacity-40"],[1,"w-1/2","flex","items-center","justify-center","bg-gradient-to-br","from-gray-900","to-black"],[1,"w-96","p-8","rounded-2xl","bg-white/10","backdrop-blur-md","shadow-xl"],[1,"text-3xl","font-bold","text-white","mb-6"],[1,"space-y-4",3,"ngSubmit"],["type","text","placeholder","Nom","name","nom","required","",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","text","placeholder","Pr\xe9nom","name","prenom",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","text","placeholder","Pseudo","name","pseudo",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","email","placeholder","Email","name","adresseMail","required","",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","password","placeholder","Mot de passe","name","motDePasse","required","",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","date","placeholder","Date de naissance","name","dateNaissance",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","text","placeholder","V\xe9hicule","name","vehicule",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","submit",1,"w-full","py-3","rounded-lg","bg-cyan-500","hover:bg-cyan-400","text-black","font-bold","transition"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"div",1),Vs(2,"div",2),ce(),le(3,"div",3)(4,"div",4)(5,"h2",5),Ae(6,"Inscription"),ce(),le(7,"form",6),Ye("ngSubmit",function(){return l.register()}),le(8,"input",7),Ye("ngModelChange",function(f){return l.model.nomUtilisateur=f}),ce(),le(9,"input",8),Ye("ngModelChange",function(f){return l.model.prenom=f}),ce(),le(10,"input",9),Ye("ngModelChange",function(f){return l.model.pseudo=f}),ce(),le(11,"input",10),Ye("ngModelChange",function(f){return l.model.adresseMail=f}),ce(),le(12,"input",11),Ye("ngModelChange",function(f){return l.model.motDePasse=f}),ce(),le(13,"input",12),Ye("ngModelChange",function(f){return l.model.dateNaissance=f}),ce(),le(14,"input",13),Ye("ngModelChange",function(f){return l.model.vehicule=f}),ce(),le(15,"button",14),Ae(16,"S'inscrire"),ce()()()()()),2&i&&(Re(8),Ze("ngModel",l.model.nomUtilisateur),Re(1),Ze("ngModel",l.model.prenom),Re(1),Ze("ngModel",l.model.pseudo),Re(1),Ze("ngModel",l.model.adresseMail),Re(1),Ze("ngModel",l.model.motDePasse),Re(1),Ze("ngModel",l.model.dateNaissance),Re(1),Ze("ngModel",l.model.vehicule))},dependencies:[Xu,nl,Wl,Zu,Yu,rl,Xl],styles:["[_nghost-%COMP%]{display:block}"]}),t})();function gB(t,e){if(1&t&&(le(0,"div",11),Ae(1),ce()),2&t){const r=Mn();Re(1),hr(r.error)}}let yB=(()=>{const e=class{constructor(n,i){this.api=n,this.router=i,this.model={},this.error=null}login(){this.api.create("auth/login",{pseudo:this.model.pseudo||this.model.adresseMail||"",motDePasse:this.model.motDePasse}).subscribe(l=>{l&&l.token?(localStorage.setItem("token",l.token),this.error=null,this.router.navigateByUrl("/")):this.error="R\xe9ponse inattendue du serveur"},l=>{this.error="Identifiants invalides",console.error("login error",l)})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(wr))},e.\u0275cmp=sr({type:e,selectors:[["connexion"]],decls:13,vars:3,consts:[[1,"flex","h-screen"],[1,"w-1/2","h-full","bg-cover","bg-center",2,"background-image","url('https://images.unsplash.com/photo-1508057198894-247b23fe5ade?auto=format&fit=crop&w=1600&q=80')"],[1,"w-full","h-full","bg-black","bg-opacity-40"],[1,"w-1/2","flex","items-center","justify-center","bg-gradient-to-br","from-gray-900","to-black"],[1,"w-96","p-8","rounded-2xl","bg-white/10","backdrop-blur-md","shadow-xl"],[1,"text-3xl","font-bold","text-white","mb-6"],[1,"space-y-4",3,"ngSubmit"],["type","email","placeholder","Email","name","pseudo","required","",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["type","password","placeholder","Mot de passe","name","motDePasse","required","",1,"w-full","p-3","rounded-lg","bg-gray-800","text-white","focus:ring-2","focus:ring-cyan-400",3,"ngModel","ngModelChange"],["class","text-red-400 text-sm",4,"ngIf"],["type","submit",1,"w-full","py-3","rounded-lg","bg-cyan-500","hover:bg-cyan-400","text-black","font-bold","transition"],[1,"text-red-400","text-sm"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"div",1),Vs(2,"div",2),ce(),le(3,"div",3)(4,"div",4)(5,"h2",5),Ae(6,"Connexion"),ce(),le(7,"form",6),Ye("ngSubmit",function(){return l.login()}),le(8,"input",7),Ye("ngModelChange",function(f){return l.model.pseudo=f}),ce(),le(9,"input",8),Ye("ngModelChange",function(f){return l.model.motDePasse=f}),ce(),Sn(10,gB,2,1,"div",9),le(11,"button",10),Ae(12," Se connecter "),ce()()()()()),2&i&&(Re(8),Ze("ngModel",l.model.pseudo),Re(1),Ze("ngModel",l.model.motDePasse),Re(1),Ze("ngIf",l.error))},dependencies:[Zl,Xu,nl,Wl,Zu,Yu,rl,Xl],styles:["[_nghost-%COMP%]{display:block}"]}),t})(),_B=(()=>{const e=class{constructor(n){this.router=n}ngOnInit(){localStorage.removeItem("token"),this.router.navigateByUrl("/")}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(wr))},e.\u0275cmp=sr({type:e,selectors:[["deconnexion"]],decls:2,vars:0,template:function(i,l){1&i&&(le(0,"p"),Ae(1,"deconnexion works!"),ce())},styles:["[_nghost-%COMP%]{display:block}"]}),t})();function vB(t,e){if(1&t&&(le(0,"li",22)(1,"div")(2,"div",23),Ae(3),ce(),le(4,"div",24),Ae(5),ce()(),le(6,"div",25),Ae(7),ce()()),2&t){const r=e.$implicit;Re(3),hr(r.nomBorne||r.nom),Re(2),hr((null==r.lieu?null:r.lieu.instructions)||"\u2014"),Re(2),hr(r.etat||(r.occupee?"Occup\xe9e":"Libre"))}}function xB(t,e){1&t&&(le(0,"li",26),Ae(1,"Aucune borne trouv\xe9e pour votre compte."),ce())}function bB(t,e){if(1&t&&(le(0,"li",27)(1,"div")(2,"div",23),Ae(3),ce(),le(4,"div",24),Ae(5),og(6,"date"),og(7,"date"),ce()(),le(8,"div",25),Ae(9),ce()()),2&t){const r=e.$implicit;Re(3),hr((null==r.borne?null:r.borne.nomBorne)||(null==r.borne?null:r.borne.nom)||"Borne #"+((null==r.borne?null:r.borne.id)||r.idBorne)),Re(2),eg("",ov(6,4,r.dateDebut,"short")," \u2192 ",ov(7,7,r.dateFin,"short"),""),Re(4),hr(r.etat||"\u2014")}}function wB(t,e){1&t&&(le(0,"li",26),Ae(1,"Aucune r\xe9servation trouv\xe9e. "),ce())}const CB=function(){return[]};let DB=(()=>{const e=class{constructor(n,i){this.api=n,this.auth=i,this.bornes=[],this.reservations=[],this.pseudo=null,this.bornesByUser=[],this.activeReservationsCount=0,this.userCount=0,this.loading=!0}ngOnInit(){this.pseudo=this.auth.getPseudoFromToken(),this.api.list("bornes/mine").subscribe(n=>{this.bornes=n||[],this.bornesByUser=this.bornes},()=>{this.bornes=[],this.bornesByUser=[]}),this.api.list("reservations/mine").subscribe(n=>{this.reservations=n||[],this.activeReservationsCount=(this.reservations||[]).filter(i=>{const l=(i.etat||"").toLowerCase();return"active"===l||"en_cours"===l||!i.etat}).length}),this.api.list("utilisateurs").subscribe(n=>{this.userCount=(n||[]).length,this.loading=!1})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(Jl))},e.\u0275cmp=sr({type:e,selectors:[["tableau-de-bord"]],decls:53,vars:13,consts:[[1,"min-h-screen","bg-[#0B0F18]"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"bg-white/10","backdrop-blur-md","p-6","rounded-xl","shadow-md","hover:shadow-xl","transition"],[1,"text-xl","text-white"],[1,"text-cyan-400","text-3xl","font-bold"],[1,"text-sm","text-white/70"],[1,"mb-6"],[1,"text-white","text-2xl","mb-3"],[1,"flex","flex-wrap","gap-3"],["routerLink","/lieux",1,"px-4","py-2","bg-cyan-600","text-black","rounded","shadow"],["routerLink","/bornes",1,"px-4","py-2","bg-cyan-600","text-black","rounded","shadow"],["routerLink","/reservations",1,"px-4","py-2","bg-cyan-600","text-black","rounded","shadow"],[1,"text-white","text-xl","mb-2"],[1,"text-white/70","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"bg-white/5","p-4","rounded"],[1,"text-sm","text-white/80"],[1,"mt-3","space-y-2","max-h-60","overflow-auto"],["class","flex justify-between items-center p-2 bg-white/3 rounded",4,"ngFor","ngForOf"],["class","text-white/60",4,"ngIf"],["class","p-2 bg-white/3 rounded flex justify-between items-center",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","p-2","bg-white/3","rounded"],[1,"text-white","text-sm"],[1,"text-white/60","text-xs"],[1,"text-cyan-300","text-sm"],[1,"text-white/60"],[1,"p-2","bg-white/3","rounded","flex","justify-between","items-center"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"main",1)(2,"section",2)(3,"div",3)(4,"h3",4),Ae(5,"Bornes cr\xe9\xe9es"),ce(),le(6,"p",5),Ae(7),ce(),le(8,"p",6),Ae(9,"Bornes associ\xe9es \xe0 votre compte"),ce()(),le(10,"div",3)(11,"h3",4),Ae(12,"R\xe9servations actives"),ce(),le(13,"p",5),Ae(14),ce(),le(15,"p",6),Ae(16,"R\xe9servations en cours sur la plateforme"),ce()(),le(17,"div",3)(18,"h3",4),Ae(19,"Utilisateurs"),ce(),le(20,"p",5),Ae(21),ce(),le(22,"p",6),Ae(23,"Total utilisateurs enregistr\xe9s"),ce()()(),le(24,"section",7)(25,"h2",8),Ae(26,"Raccourcis"),ce(),le(27,"div",9)(28,"a",10),Ae(29,"Mes Lieux"),ce(),le(30,"a",11),Ae(31,"Mes Bornes"),ce(),le(32,"a",12),Ae(33,"Mes R\xe9servations"),ce()()(),le(34,"section")(35,"h2",13),Ae(36),ce(),le(37,"p",14),Ae(38,"R\xe9sum\xe9 rapide de votre activit\xe9."),ce(),le(39,"div",15)(40,"div",16)(41,"h3",17),Ae(42,"Bornes associ\xe9es"),ce(),le(43,"ul",18),Sn(44,vB,8,3,"li",19),Sn(45,xB,2,0,"li",20),ce()(),le(46,"div",16)(47,"h3",17),Ae(48,"R\xe9servations r\xe9centes"),ce(),le(49,"ul",18),Sn(50,bB,10,10,"li",21),og(51,"slice"),Sn(52,wB,2,0,"li",20),ce()()()()()()),2&i&&(Re(7),hr(l.bornesByUser.length),Re(7),hr(l.activeReservationsCount),Re(7),hr(l.userCount),Re(15),Qa("Bienvenue",l.pseudo?", "+l.pseudo:"",""),Re(8),Ze("ngForOf",l.bornesByUser),Re(1),Ze("ngIf",0===l.bornesByUser.length),Re(5),Ze("ngForOf",S1(51,8,l.reservations,0,6)),Re(2),Ze("ngIf",0===(l.reservations||function b1(t,e,r){const n=Ri()+t,i=Le();return i[n]===Ut?Xa(i,n,r?e.call(r):e()):function Gp(t,e){return t[e]}(i,n)}(12,CB)).length))},dependencies:[el,Zl,bh,hD,uD],styles:["[_nghost-%COMP%]{display:block}"]}),t})();function EB(t,e){if(1&t){const r=ca();le(0,"button",14),Ye("click",function(){lr(r);const i=Mn().$implicit;return cr(Mn().edit(i))}),Ae(1,"Edit"),ce()}}function IB(t,e){if(1&t){const r=ca();le(0,"button",15),Ye("click",function(){lr(r);const i=Mn().$implicit;return cr(Mn().remove(i))}),Ae(1,"Supprimer"),ce()}}function TB(t,e){if(1&t&&(le(0,"li",8)(1,"div")(2,"div",9),Ae(3),ce(),le(4,"div",10),Ae(5),ce()(),le(6,"div",11),Sn(7,EB,2,0,"button",12),Sn(8,IB,2,0,"button",13),ce()()),2&t){const r=e.$implicit,n=Mn();Re(3),hr(r.nom),Re(2),hr(r.instructions),Re(2),Ze("ngIf",r.utilisateur&&(r.utilisateur.id===n.currentUserId||r.utilisateur===n.currentUserId)),Re(1),Ze("ngIf",r.utilisateur&&(r.utilisateur.id===n.currentUserId||r.utilisateur===n.currentUserId))}}let SB=(()=>{const e=class{constructor(n,i){this.api=n,this.auth=i,this.lieux=[],this.model={},this.currentUserId=null}ngOnInit(){this.load(),this.resolveCurrentUser()}load(){this.api.list("lieux/mine").subscribe(n=>this.lieux=n||[])}resolveCurrentUser(){const n=this.auth.getPseudoFromToken();n&&this.api.list("utilisateurs").subscribe(i=>{const l=(i||[]).find(h=>h.pseudo===n||h.adresseMail===n);l&&(this.currentUserId=l.id)})}save(){const n={...this.model};!this.model.id&&this.currentUserId&&(n.utilisateur={id:this.currentUserId}),this.model.id?this.api.update("lieux",this.model.id,n).subscribe(()=>this.load()):this.api.create("lieux",n).subscribe(()=>this.load()),this.model={}}edit(n){this.model={...n}}remove(n){this.api.delete("lieux",n.id).subscribe(()=>this.load())}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(Jl))},e.\u0275cmp=sr({type:e,selectors:[["gestion-lieux"]],decls:11,vars:3,consts:[[1,"max-w-3xl","mx-auto","p-4","bg-surface","rounded","shadow"],[1,"text-xl","mb-4","text-foreground"],[1,"space-y-2","mb-4",3,"ngSubmit"],["name","nom","placeholder","Nom du lieu","required","",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","instructions","placeholder","Instructions",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],[1,"flex","justify-end"],["type","submit",1,"bg-blue-600","text-inverse","px-4","py-2","rounded"],["class","p-2 border-b flex justify-between items-center",4,"ngFor","ngForOf"],[1,"p-2","border-b","flex","justify-between","items-center"],[1,"font-semibold"],[1,"text-sm","text-gray-600"],[1,"space-x-2"],["class","px-2 py-1 border rounded",3,"click",4,"ngIf"],["class","px-2 py-1 btn-danger",3,"click",4,"ngIf"],[1,"px-2","py-1","border","rounded",3,"click"],[1,"px-2","py-1","btn-danger",3,"click"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"h2",1),Ae(2,"Mes lieux"),ce(),le(3,"form",2),Ye("ngSubmit",function(){return l.save()}),le(4,"input",3),Ye("ngModelChange",function(f){return l.model.nom=f}),ce(),le(5,"textarea",4),Ye("ngModelChange",function(f){return l.model.instructions=f}),ce(),le(6,"div",5)(7,"button",6),Ae(8,"Enregistrer"),ce()()(),le(9,"ul"),Sn(10,TB,9,4,"li",7),ce()()),2&i&&(Re(4),Ze("ngModel",l.model.nom),Re(1),Ze("ngModel",l.model.instructions),Re(5),Ze("ngForOf",l.lieux))},dependencies:[el,Zl,Xu,nl,Wl,Zu,Yu,rl,Xl],styles:["[_nghost-%COMP%]{display:block}"]}),t})();function MB(t,e){if(1&t){const r=ca();le(0,"li",17)(1,"div")(2,"div",18),Ae(3),ce(),le(4,"div",19),Ae(5),ce()(),le(6,"div",20)(7,"button",15),Ye("click",function(){const l=lr(r).$implicit;return cr(Mn().edit(l))}),Ae(8,"Edit"),ce(),le(9,"button",21),Ye("click",function(){const l=lr(r).$implicit;return cr(Mn().remove(l))}),Ae(10,"Supprimer"),ce()()()}if(2&t){const r=e.$implicit;Re(3),hr(r.nomAdresse),Re(2),W_("",r.numeroRue,", ",r.codePostal," ",r.ville," - ",r.pays," ")}}let AB=(()=>{const e=class{constructor(n){this.api=n,this.adresses=[],this.model={},this.page=1,this.pageSize=10}ngOnInit(){this.load()}load(){this.api.list("adresses").subscribe(n=>this.adresses=n||[])}save(){this.model.id?this.api.update("adresses",this.model.id,this.model).subscribe(()=>{this.load(),this.model={}}):this.api.create("adresses",this.model).subscribe(()=>{this.load(),this.model={}})}edit(n){this.model={...n}}remove(n){confirm("Supprimer cette adresse ?")&&this.api.delete("adresses",n.id).subscribe(()=>this.load())}get paged(){const n=(this.page-1)*this.pageSize;return this.adresses.slice(n,n+this.pageSize)}prev(){this.page>1&&this.page--}next(){this.page*this.pageSize<this.adresses.length&&this.page++}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo))},e.\u0275cmp=sr({type:e,selectors:[["gestion-adresses"]],decls:22,vars:9,consts:[[1,"max-w-3xl","mx-auto","p-4","bg-surface","rounded","shadow"],[1,"text-xl","mb-4","text-foreground"],[1,"space-y-2","mb-4",3,"ngSubmit"],["name","nomAdresse","placeholder","Nom adresse","required","",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","numeroRue","placeholder","Num\xe9ro et rue",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","codePostal","placeholder","Code postal",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","ville","placeholder","Ville",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","region","placeholder","R\xe9gion",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","pays","placeholder","Pays",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","complement","placeholder","Compl\xe9ment",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["name","etage","placeholder","\xc9tage",1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],[1,"flex","justify-end"],["type","submit",1,"bg-green-600","text-inverse","px-4","py-2","rounded"],[1,"mb-2"],[1,"px-2","py-1","border","rounded","mr-2",3,"click"],[1,"px-2","py-1","border","rounded",3,"click"],["class","p-2 border-b flex justify-between items-center",4,"ngFor","ngForOf"],[1,"p-2","border-b","flex","justify-between","items-center"],[1,"font-semibold"],[1,"text-sm","text-gray-600"],[1,"space-x-2"],[1,"px-2","py-1","bg-red-600","text-inverse","rounded",3,"click"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"h2",1),Ae(2,"Adresses"),ce(),le(3,"form",2),Ye("ngSubmit",function(){return l.save()}),le(4,"input",3),Ye("ngModelChange",function(f){return l.model.nomAdresse=f}),ce(),le(5,"input",4),Ye("ngModelChange",function(f){return l.model.numeroRue=f}),ce(),le(6,"input",5),Ye("ngModelChange",function(f){return l.model.codePostal=f}),ce(),le(7,"input",6),Ye("ngModelChange",function(f){return l.model.ville=f}),ce(),le(8,"input",7),Ye("ngModelChange",function(f){return l.model.region=f}),ce(),le(9,"input",8),Ye("ngModelChange",function(f){return l.model.pays=f}),ce(),le(10,"input",9),Ye("ngModelChange",function(f){return l.model.complement=f}),ce(),le(11,"input",10),Ye("ngModelChange",function(f){return l.model.etage=f}),ce(),le(12,"div",11)(13,"button",12),Ae(14,"Enregistrer"),ce()()(),le(15,"div",13)(16,"button",14),Ye("click",function(){return l.prev()}),Ae(17,"Pr\xe9c"),ce(),le(18,"button",15),Ye("click",function(){return l.next()}),Ae(19,"Suiv"),ce()(),le(20,"ul"),Sn(21,MB,11,5,"li",16),ce()()),2&i&&(Re(4),Ze("ngModel",l.model.nomAdresse),Re(1),Ze("ngModel",l.model.numeroRue),Re(1),Ze("ngModel",l.model.codePostal),Re(1),Ze("ngModel",l.model.ville),Re(1),Ze("ngModel",l.model.region),Re(1),Ze("ngModel",l.model.pays),Re(1),Ze("ngModel",l.model.complement),Re(1),Ze("ngModel",l.model.etage),Re(10),Ze("ngForOf",l.paged))},dependencies:[el,Xu,nl,Wl,Zu,Yu,rl,Xl],styles:["[_nghost-%COMP%]{display:block}"]}),t})();function lT(t,e,r,n,i,l,h){try{var f=t[l](h),w=f.value}catch(E){return void r(E)}f.done?e(w):Promise.resolve(w).then(n,i)}function cT(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var l=t.apply(e,r);function h(w){lT(l,n,i,h,f,"next",w)}function f(w){lT(l,n,i,h,f,"throw",w)}h(void 0)})}}function PB(t,e){if(1&t){const r=ca();le(0,"button",14),Ye("click",function(){lr(r);const i=Mn().$implicit;return cr(Mn().edit(i))}),Ae(1,"Edit"),ce()}}function kB(t,e){if(1&t){const r=ca();le(0,"button",15),Ye("click",function(){lr(r);const i=Mn().$implicit;return cr(Mn().remove(i))}),Ae(1,"Supprimer"),ce()}}function RB(t,e){if(1&t&&(le(0,"tr",10)(1,"td",11),Ae(2),ce(),le(3,"td",11),Ae(4),ce(),le(5,"td",11),Ae(6),ce(),le(7,"td",11),Ae(8),ce(),le(9,"td",11),Ae(10),ce(),le(11,"td",7),Sn(12,PB,2,0,"button",12),Sn(13,kB,2,0,"button",13),ce()()),2&t){const r=e.$implicit;Re(2),hr(r.nomBorne||r.nom),Re(2),hr(r.coordGPS),Re(2),Qa("",r.tarif," \u20ac/min"),Re(2),Qa("",r.puissance," kW"),Re(2),hr((null==r.lieu?null:r.lieu.nom)||(null==r.lieu?null:r.lieu.instructions)||"\u2014"),Re(2),Ze("ngIf",r._isOwner),Re(1),Ze("ngIf",r._isOwner)}}function FB(t,e){1&t&&(le(0,"p",16),Ae(1,"Aucune borne trouv\xe9e."),ce())}let LB=(()=>{const e=class{constructor(n,i){this.api=n,this.auth=i,this.bornes=[],this.model={},this.lieux=[],this.medias=[],this.creatingLieu=!1,this.newLieu={instructions:"",utilisateur:null,adresse:{}},this.selectedFiles=[],this.filePreviews=[],this.currentUserId=null}ngOnInit(){this.resolveCurrentUser(),this.load(),this.loadLieux(),this.loadMedias()}loadLieux(){this.api.list("lieux/mine").subscribe(n=>this.lieux=n||[])}loadMedias(){this.api.list("medias").subscribe(n=>this.medias=n||[])}load(){this.api.list("bornes/mine").subscribe(n=>{try{const i=localStorage.getItem("token");console.debug("DEBUG: token length:",i?i.length:0)}catch{}console.debug("DEBUG: /api/bornes/mine response:",n),this.bornes=(n||[]).map(i=>({...i,_isOwner:this.isOwnedByCurrentUser(i)}));try{console.debug("DEBUG: bornes mapped _isOwner:",this.bornes.map(i=>({id:i.id,_isOwner:i._isOwner,pseudo:i.lieu?.utilisateur?.pseudo,userId:i.lieu?.utilisateur?.id})))}catch{}},n=>{console.error("DEBUG: /api/bornes/mine error",n)})}resolveCurrentUser(){const n=this.auth.getPseudoFromToken();n&&this.api.list("utilisateurs").subscribe(i=>{const l=(i||[]).find(h=>h.pseudo===n||h.adresseMail===n);l&&(this.currentUserId=l.id),this.bornes=this.bornes.map(h=>({...h,_isOwner:this.isOwnedByCurrentUser(h)}))})}isOwnedByCurrentUser(n){try{const i=this.auth.getPseudoFromToken();return i&&n&&n.lieu&&n.lieu.utilisateur&&n.lieu.utilisateur.pseudo?n.lieu.utilisateur.pseudo===i:!!(this.currentUserId&&n&&n.lieu&&n.lieu.utilisateur&&n.lieu.utilisateur.id)&&n.lieu.utilisateur.id===this.currentUserId}catch{return!1}}save(){var n=this;const l={borne:{nomBorne:this.model.nomBorne,coordGPS:this.model.coordGPS,tarif:Number(this.model.tarif)||0,puissance:Number(this.model.puissance)||0,instruction:this.model.instruction,surPied:!!this.model.surPied,etat:this.model.etat,occupee:!!this.model.occupee}};!this.creatingLieu&&this.model.lieuId?l.lieu={id:this.model.lieuId}:this.creatingLieu&&(l.lieu={instructions:this.newLieu.instructions,utilisateur:{id:this.newLieu.utilisateur?.id||this.newLieu.utilisateur}},this.newLieu.adresse&&(this.newLieu.adresse.nomAdresse||this.newLieu.adresse.numeroEtRue)&&(l.lieu.adresse={...this.newLieu.adresse})),function(){var f=cT(function*(){try{const w=[];for(let E=0;E<n.selectedFiles.length;E++){const P=n.selectedFiles[E],O=yield n.api.uploadFile(P).toPromise();O&&O.id&&w.push({id:O.id})}w.length&&(l.medias=w),n.model.id?n.api.update("bornes",n.model.id,l.borne).subscribe(()=>n.load(),()=>alert("Erreur update")):n.api.create("bornes",l).subscribe(E=>{n.load()},()=>alert("Erreur cr\xe9ation borne"))}catch(w){console.error(w),alert("Erreur upload m\xe9dia")}});return function(){return f.apply(this,arguments)}}()(),this.resetForm()}edit(n){this.model={...n}}resetForm(){this.model={},this.creatingLieu=!1,this.newLieu={instructions:"",utilisateur:null,adresse:{}},this.filePreviews=[]}onFilesSelected(n){const i=n.target.files;for(let l=0;l<i.length;l++){const h=i.item(l),f=URL.createObjectURL(h);this.selectedFiles.push(h),this.filePreviews.push({name:h.name,size:h.size,url:f,type:h.type})}}removePreview(n){const i=this.filePreviews.splice(n,1)[0];try{URL.revokeObjectURL(i.url)}catch{}}remove(n){confirm("Supprimer cette borne ?")&&this.api.list("reservations/mine").subscribe(i=>{(i||[]).find(h=>Number(h.idBorne)===Number(n.id)&&h.etat&&"CANCELLED"!==h.etat)?alert("Impossible: cette borne a des r\xe9servations actives."):this.api.delete("bornes",n.id).subscribe(()=>this.load(),()=>alert("Erreur suppression"))},()=>{confirm("Impossible de v\xe9rifier les r\xe9servations. Supprimer quand m\xeame ?")&&this.api.delete("bornes",n.id).subscribe(()=>this.load())})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(Jl))},e.\u0275cmp=sr({type:e,selectors:[["gestion-bornes"]],decls:25,vars:2,consts:[[1,"max-w-4xl","mx-auto","p-4","card","bg-surface"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-xl","mb-0","text-foreground"],["routerLink","/bornes/new","aria-label","Ajouter",1,"fab-neon","p-3","rounded-full","text-sm"],[1,"table-wrap","overflow-auto","bg-surface-weak","rounded-lg","p-2"],[1,"min-w-full"],[1,"text-left","text-sm","muted"],[1,"px-4","py-3"],["class","border-t border-surface-weak hover:bg-surface-weak transition",4,"ngFor","ngForOf"],["class","mt-4 text-gray-600",4,"ngIf"],[1,"border-t","border-surface-weak","hover:bg-surface-weak","transition"],[1,"px-4","py-3","text-black"],["class","px-2 py-1 rounded bg-surface-weak text-foreground mr-2",3,"click",4,"ngIf"],["class","px-2 py-1 rounded bg-red-600 text-inverse",3,"click",4,"ngIf"],[1,"px-2","py-1","rounded","bg-surface-weak","text-foreground","mr-2",3,"click"],[1,"px-2","py-1","rounded","bg-red-600","text-inverse",3,"click"],[1,"mt-4","text-gray-600"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"div",1)(2,"h2",2),Ae(3,"Gestion des bornes"),ce(),le(4,"button",3),Ae(5,"\uff0b"),ce()(),le(6,"div",4)(7,"table",5)(8,"thead")(9,"tr",6)(10,"th",7),Ae(11,"Nom"),ce(),le(12,"th",7),Ae(13,"CoordGPS"),ce(),le(14,"th",7),Ae(15,"Tarif"),ce(),le(16,"th",7),Ae(17,"Puissance"),ce(),le(18,"th",7),Ae(19,"Lieu"),ce(),le(20,"th",7),Ae(21,"Actions"),ce()()(),le(22,"tbody"),Sn(23,RB,14,7,"tr",8),ce()()(),Sn(24,FB,2,0,"p",9),ce()),2&i&&(Re(23),Ze("ngForOf",l.bornes),Re(1),Ze("ngIf",!l.bornes||0===l.bornes.length))},dependencies:[el,Zl,bh],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%], [_nghost-%COMP%]   *[_ngcontent-%COMP%]{color:#fff!important}.table-wrap[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-wrap[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#fff!important}"]}),t})();function OB(t,e){if(1&t&&(le(0,"option",27),Ae(1),ce()),2&t){const r=e.$implicit;Ze("value",r.id),Re(1),hr(r.instructions||"Lieu #"+r.id)}}function NB(t,e){if(1&t){const r=ca();le(0,"div")(1,"select",24),Ye("ngModelChange",function(i){return lr(r),cr(Mn().model.lieuId=i)}),le(2,"option",25),Ae(3,"-- choisir --"),ce(),Sn(4,OB,2,2,"option",26),ce()()}if(2&t){const r=Mn();Re(1),Ze("ngModel",r.model.lieuId),Re(3),Ze("ngForOf",r.lieux)}}function zB(t,e){if(1&t){const r=ca();le(0,"div",28)(1,"input",29),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.instructions=i)}),ce(),le(2,"input",29),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.instructions=i)}),ce(),le(3,"h5",30),Ae(4,"Adresse (optionnel)"),ce(),le(5,"input",31),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.nomAdresse=i)}),ce(),le(6,"input",32),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.numeroEtRue=i)}),ce(),le(7,"div",33)(8,"input",34),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.codePostal=i)}),ce(),le(9,"input",35),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.ville=i)}),ce(),le(10,"input",36),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.region=i)}),ce()(),le(11,"div",37)(12,"input",38),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.pays=i)}),ce(),le(13,"input",39),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.complement=i)}),ce()(),le(14,"input",40),Ye("ngModelChange",function(i){return lr(r),cr(Mn().newLieu.adresse.etage=i)}),ce()()}if(2&t){const r=Mn();Re(1),Ze("ngModel",r.newLieu.instructions),Re(1),Ze("ngModel",r.newLieu.instructions),Re(3),Ze("ngModel",r.newLieu.adresse.nomAdresse),Re(1),Ze("ngModel",r.newLieu.adresse.numeroEtRue),Re(2),Ze("ngModel",r.newLieu.adresse.codePostal),Re(1),Ze("ngModel",r.newLieu.adresse.ville),Re(1),Ze("ngModel",r.newLieu.adresse.region),Re(2),Ze("ngModel",r.newLieu.adresse.pays),Re(1),Ze("ngModel",r.newLieu.adresse.complement),Re(1),Ze("ngModel",r.newLieu.adresse.etage)}}function BB(t,e){if(1&t&&(le(0,"div"),Vs(1,"img",45),ce()),2&t){const r=Mn().$implicit;Re(1),Ze("src",r.url,Jy)}}function VB(t,e){if(1&t){const r=ca();le(0,"div",41)(1,"div",13),Ae(2),ce(),le(3,"div",42),Ae(4),ce(),Sn(5,BB,2,1,"div",16),le(6,"div",43)(7,"button",44),Ye("click",function(){const l=lr(r).index;return cr(Mn().removePreview(l))}),Ae(8,"Supprimer"),ce()()()}if(2&t){const r=e.$implicit;Re(2),hr(r.name),Re(2),Qa("",r.size," bytes"),Re(1),Ze("ngIf",r.type.startsWith("image"))}}let UB=(()=>{const e=class{constructor(n,i,l){this.api=n,this.router=i,this.auth=l,this.model={},this.lieux=[],this.creatingLieu=!1,this.newLieu={instructions:"",utilisateur:null,adresse:{}},this.selectedFiles=[],this.filePreviews=[]}ngOnInit(){this.loadLieux()}loadLieux(){this.api.list("lieux").subscribe(n=>this.lieux=n||[])}onFilesSelected(n){const i=n.target.files;for(let l=0;l<i.length;l++){const h=i.item(l),f=URL.createObjectURL(h);this.selectedFiles.push(h),this.filePreviews.push({name:h.name,size:h.size,url:f,type:h.type})}}removePreview(n){const i=this.filePreviews.splice(n,1)[0];this.selectedFiles.splice(n,1);try{URL.revokeObjectURL(i.url)}catch{}}cancel(){this.router.navigate(["/bornes"])}save(){var n=this;return cT(function*(){const l={borne:{nomBorne:n.model.nomBorne,coordGPS:n.model.coordGPS,tarif:Number(n.model.tarif)||0,puissance:Number(n.model.puissance)||0,instruction:n.model.instruction,surPied:!!n.model.surPied,etat:n.model.etat,occupee:!!n.model.occupee}};if(!n.creatingLieu&&n.model.lieuId)l.lieu={id:n.model.lieuId};else if(n.creatingLieu){const h=n.auth.getPseudoFromToken();l.lieu={instructions:n.newLieu.instructions},h&&(l.lieu.utilisateur={pseudo:h}),n.newLieu.adresse&&(n.newLieu.adresse.nomAdresse||n.newLieu.adresse.numeroEtRue)&&(l.lieu.adresse={...n.newLieu.adresse})}try{const h=[];for(let f=0;f<n.selectedFiles.length;f++){const w=n.selectedFiles[f],E=yield n.api.uploadFile(w).toPromise();E&&E.id&&h.push({id:E.id})}h.length&&(l.medias=h),n.api.create("bornes",l).subscribe(()=>{n.router.navigate(["/bornes"])},()=>alert("Erreur cr\xe9ation borne"))}catch(h){console.error(h),alert("Erreur upload m\xe9dia")}})()}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(wr),Me(Jl))},e.\u0275cmp=sr({type:e,selectors:[["nouvelle-borne"]],decls:53,vars:15,consts:[[1,"max-w-3xl","mx-auto","p-4","card","bg-surface"],[1,"text-xl","mb-4"],[1,"space-y-4",3,"ngSubmit"],[1,"block","mb-1"],["name","nomBorne",1,"p-2","border","rounded","w-full","text-black",3,"ngModel","ngModelChange"],["name","coordGPS",1,"p-2","border","rounded","w-full","text-black",3,"ngModel","ngModelChange"],[1,"grid","grid-cols-2","gap-2"],["name","tarif","type","number","placeholder","Tarif",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],["name","puissance","type","number","placeholder","Puissance",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],["name","instruction",1,"p-2","border","rounded","w-full","text-black",3,"ngModel","ngModelChange"],["type","checkbox","name","surPied",3,"ngModel","ngModelChange"],["type","checkbox","name","occupee",3,"ngModel","ngModelChange"],["name","etat",1,"p-2","border","rounded","w-full","text-black",3,"ngModel","ngModelChange"],[1,"font-semibold"],[1,"flex","items-center","space-x-2"],["type","radio","name","lieuMode",3,"ngModel","value","ngModelChange"],[4,"ngIf"],["class","p-2 border rounded bg-surface-weak",4,"ngIf"],["type","file","multiple","",1,"text-black",3,"change"],[1,"grid","grid-cols-3","gap-2","mt-2"],["class","p-2 border rounded",4,"ngFor","ngForOf"],[1,"flex","space-x-2","mt-4"],["type","submit",1,"px-4","py-2","btn-cyan"],["type","button",1,"px-4","py-2","btn-danger",3,"click"],["name","lieuId",1,"p-2","border","rounded","w-full","text-black",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"p-2","border","rounded","bg-surface-weak"],["name","newLieuInstructions","placeholder","Instructions",1,"p-2","border","rounded","w-full","text-black",3,"ngModel","ngModelChange"],[1,"font-semibold","mt-2"],["name","adrNom","placeholder","Nom adresse",1,"p-2","border","rounded","w-full","mt-1","text-black",3,"ngModel","ngModelChange"],["name","adrNumeroRue","placeholder","Num\xe9ro et rue",1,"p-2","border","rounded","w-full","mt-1","text-black",3,"ngModel","ngModelChange"],[1,"grid","grid-cols-3","gap-2","mt-1"],["name","adrCp","placeholder","Code postal",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],["name","adrVille","placeholder","Ville",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],["name","adrRegion","placeholder","R\xe9gion",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],[1,"grid","grid-cols-2","gap-2","mt-1"],["name","adrPays","placeholder","Pays",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],["name","adrCompl","placeholder","Compl\xe9ment",1,"p-2","border","rounded","text-black",3,"ngModel","ngModelChange"],["name","adrEtage","placeholder","\xc9tage",1,"p-2","border","rounded","w-full","mt-1","text-black",3,"ngModel","ngModelChange"],[1,"p-2","border","rounded"],[1,"text-sm","text-gray-600"],[1,"mt-2"],[1,"px-2","py-1","btn-danger",3,"click"],[1,"w-full","h-24","object-cover","mt-2",3,"src"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"h2",1),Ae(2,"Nouvelle Borne"),ce(),le(3,"form",2),Ye("ngSubmit",function(){return l.save()}),le(4,"div")(5,"label",3),Ae(6,"Nom de la borne"),ce(),le(7,"input",4),Ye("ngModelChange",function(f){return l.model.nomBorne=f}),ce()(),le(8,"div")(9,"label",3),Ae(10,"Coordonn\xe9es GPS"),ce(),le(11,"input",5),Ye("ngModelChange",function(f){return l.model.coordGPS=f}),ce()(),le(12,"div",6)(13,"input",7),Ye("ngModelChange",function(f){return l.model.tarif=f}),ce(),le(14,"input",8),Ye("ngModelChange",function(f){return l.model.puissance=f}),ce()(),le(15,"div")(16,"label",3),Ae(17,"Instructions"),ce(),le(18,"textarea",9),Ye("ngModelChange",function(f){return l.model.instruction=f}),ce()(),le(19,"div",6)(20,"label")(21,"input",10),Ye("ngModelChange",function(f){return l.model.surPied=f}),ce(),Ae(22," Sur pied"),ce(),le(23,"label")(24,"input",11),Ye("ngModelChange",function(f){return l.model.occupee=f}),ce(),Ae(25," Occup\xe9e"),ce()(),le(26,"div")(27,"label",3),Ae(28,"Etat"),ce(),le(29,"input",12),Ye("ngModelChange",function(f){return l.model.etat=f}),ce()(),Vs(30,"hr"),le(31,"h3",13),Ae(32,"Lieu"),ce(),le(33,"div",14)(34,"label")(35,"input",15),Ye("ngModelChange",function(f){return l.creatingLieu=f}),ce(),Ae(36," Choisir existant"),ce(),le(37,"label")(38,"input",15),Ye("ngModelChange",function(f){return l.creatingLieu=f}),ce(),Ae(39," Cr\xe9er nouveau"),ce()(),Sn(40,NB,5,2,"div",16),Sn(41,zB,15,10,"div",17),Vs(42,"hr"),le(43,"h3",13),Ae(44,"M\xe9dias"),ce(),le(45,"input",18),Ye("change",function(f){return l.onFilesSelected(f)}),ce(),le(46,"div",19),Sn(47,VB,9,3,"div",20),ce(),le(48,"div",21)(49,"button",22),Ae(50,"Enregistrer"),ce(),le(51,"button",23),Ye("click",function(){return l.cancel()}),Ae(52,"Annuler"),ce()()()()),2&i&&(Re(7),Ze("ngModel",l.model.nomBorne),Re(4),Ze("ngModel",l.model.coordGPS),Re(2),Ze("ngModel",l.model.tarif),Re(1),Ze("ngModel",l.model.puissance),Re(4),Ze("ngModel",l.model.instruction),Re(3),Ze("ngModel",l.model.surPied),Re(3),Ze("ngModel",l.model.occupee),Re(5),Ze("ngModel",l.model.etat),Re(6),Ze("ngModel",l.creatingLieu)("value",!1),Re(3),Ze("ngModel",l.creatingLieu)("value",!0),Re(2),Ze("ngIf",!l.creatingLieu),Re(1),Ze("ngIf",l.creatingLieu),Re(6),Ze("ngForOf",l.filePreviews))},dependencies:[el,Zl,Xu,zg,Bg,nl,Dx,dx,lh,Ex,Wl,Zu,rl,Xl],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 1px 3px #0000000f}.btn-cyan[_ngcontent-%COMP%]{background:linear-gradient(90deg,#06b6d4,#0ea5b3);color:#fff;border-radius:6px}.btn-danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border-radius:6px}"]}),t})();var sy=ec(943);let $B=(()=>{const e=class{constructor(n,i){this.api=n,this.router=i}ngAfterViewInit(){try{this.map=new sy.Map({container:"map",style:{version:8,sources:{"raster-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xa9 OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"raster-tiles"}]},center:[2.3522,48.8566],zoom:13}),this.map.addControl(new sy.NavigationControl)}catch(n){return void console.error("Map init error",n)}this.api.list("bornes").subscribe(n=>{n.forEach(i=>{const h=String(i.coordGPS||i.coord||"").split(",").map(f=>f.trim());if(2===h.length){const f=parseFloat(h[0]),w=parseFloat(h[1]);if(!isNaN(f)&&!isNaN(w)){const E=document.createElement("div");E.className="marker-neon";const P=document.createElement("div");P.className="popup-glass p-3 rounded-lg text-sm",P.style.background="rgba(255,255,255,0.06)",P.style.backdropFilter="blur(8px)",P.style.color="#000",P.innerHTML=`<div class="font-semibold">${i.nomBorne||i.nom}</div>\n                            <div class="text-xs">Tarif: ${i.tarif} \u20ac/min</div>\n                            <div class="text-xs">Puissance: ${i.puissance||"-"} kW</div>\n                            <div class="mt-2"><button id="reserve-${i.id}" class="px-3 py-1 rounded bg-cyan-600 text-black">R\xe9server</button></div>`;const O=new sy.Popup({closeButton:!0,closeOnClick:!0}).setDOMContent(P);new sy.Marker(E).setLngLat([w,f]).setPopup(O).addTo(this.map),setTimeout(()=>{const J=P.querySelector(`#reserve-${i.id}`);J&&J.addEventListener("click",he=>{he.stopPropagation(),this.router.navigate(["/reservation"],{queryParams:{borne:i.id}})})},50)}}})})}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(wr))},e.\u0275cmp=sr({type:e,selectors:[["carte"]],decls:4,vars:0,consts:[[1,"min-h-screen","bg-deep","text-white","p-6"],[1,"max-w-7xl","mx-auto"],[1,"bg-white/10","rounded-xl","overflow-hidden","h-[70vh]"],["id","map",1,"w-full","h-full"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"div",1)(2,"div",2),Vs(3,"div",3),ce()()())},styles:["#map[_ngcontent-%COMP%]{width:100%;height:70vh;min-height:400px}[_nghost-%COMP%]{display:block}.marker-neon[_ngcontent-%COMP%]{width:22px;height:22px;box-sizing:border-box;border-radius:50%;background:#00D1FF;border:2px solid rgba(0,210,255,.2);box-shadow:0 0 8px 2px #00d2ffd9;backface-visibility:hidden;transform-origin:center;will-change:transform}.marker-neon[_ngcontent-%COMP%], .marker-neon[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{cursor:pointer;pointer-events:auto}.popup-glass[_ngcontent-%COMP%]{color:#000!important}"]}),t})();function jB(t,e){if(1&t&&(le(0,"option",11),Ae(1),ce()),2&t){const r=e.$implicit;Ze("value",r.id),Re(1),hr(r.nomBorne||r.nom)}}function HB(t,e){if(1&t&&(le(0,"div",12),Ae(1),ce()),2&t){const r=Mn();Re(1),Qa("Prix estim\xe9: ",r.estimatedPrice," \u20ac")}}function GB(t,e){1&t&&(le(0,"div",13),Ae(1,"Date de fin doit \xeatre apr\xe8s la date de d\xe9but"),ce())}let qB=(()=>{const e=class{constructor(n,i,l){this.api=n,this.route=i,this.router=l,this.model={},this.bornes=[],this.selectedBorne=null,this.estimatedPrice=0}ngOnInit(){this.api.list("bornes").subscribe(n=>{this.bornes=n||[];const i=Number(this.route.snapshot.queryParamMap.get("borne"));i&&this.selectBorneById(i)})}selectBorneById(n){this.selectedBorne=this.bornes.find(i=>i.id===n)||null,this.model.borneId=n,this.calculatePrice()}calculatePrice(){if(!this.selectedBorne||!this.model.debut||!this.model.fin)return void(this.estimatedPrice=0);const n=new Date(this.model.debut),i=new Date(this.model.fin);if(i.getTime()<=n.getTime())return void(this.estimatedPrice=0);const l=Math.max(0,(i.getTime()-n.getTime())/6e4),h=Number(this.selectedBorne.tarif)||0;this.estimatedPrice=+(l*h).toFixed(2)}reserve(){const n=new Date(this.model.debut||0);if(new Date(this.model.fin||0).getTime()<=n.getTime())return void alert("La date de fin doit \xeatre apr\xe8s la date de d\xe9but");const l={idBorne:Number(this.model.borneId),idUtilisateur:this.model.utilisateurId||null,dateDebut:this.model.debut,dateFin:this.model.fin,prixMinuteHisto:Number(this.selectedBorne?.tarif)||0,etat:"CONFIRMED"};this.api.create("reservations",l).subscribe(()=>{alert("R\xe9serv\xe9"),this.router.navigate(["/reservations"])},h=>alert("Erreur"))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(td),Me(wr))},e.\u0275cmp=sr({type:e,selectors:[["reservation"]],decls:20,vars:7,consts:[[1,"max-w-md","mx-auto","p-4","bg-surface"],[1,"text-xl","mb-4","text-foreground"],[1,"space-y-3",3,"ngSubmit"],["name","borneId",1,"w-full","p-2","border","rounded",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","datetime-local","name","debut",1,"w-full","p-2","border","rounded",3,"ngModel","ngModelChange","change"],["type","datetime-local","name","fin",1,"w-full","p-2","border","rounded",3,"ngModel","ngModelChange","change"],["class","text-lg font-semibold",4,"ngIf"],["class","text-red-600",4,"ngIf"],["type","submit",1,"bg-blue-600","text-inverse","px-4","py-2","rounded",3,"disabled"],[3,"value"],[1,"text-lg","font-semibold"],[1,"text-red-600"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"h2",1),Ae(2,"Cr\xe9er une r\xe9servation"),ce(),le(3,"form",2),Ye("ngSubmit",function(){return l.reserve()}),le(4,"label"),Ae(5,"Choisir une borne"),ce(),le(6,"select",3),Ye("ngModelChange",function(f){return l.model.borneId=f})("change",function(){return l.selectBorneById(l.model.borneId)}),le(7,"option",4),Ae(8,"-- choisir --"),ce(),Sn(9,jB,2,2,"option",5),ce(),le(10,"label"),Ae(11,"Date d\xe9but"),ce(),le(12,"input",6),Ye("ngModelChange",function(f){return l.model.debut=f})("change",function(){return l.calculatePrice()}),ce(),le(13,"label"),Ae(14,"Date fin"),ce(),le(15,"input",7),Ye("ngModelChange",function(f){return l.model.fin=f})("change",function(){return l.calculatePrice()}),ce(),Sn(16,HB,2,1,"div",8),Sn(17,GB,2,0,"div",9),le(18,"button",10),Ae(19,"R\xe9server"),ce()()()),2&i&&(Re(6),Ze("ngModel",l.model.borneId),Re(3),Ze("ngForOf",l.bornes),Re(3),Ze("ngModel",l.model.debut),Re(3),Ze("ngModel",l.model.fin),Re(1),Ze("ngIf",l.estimatedPrice>0),Re(1),Ze("ngIf",0===l.estimatedPrice&&l.model.debut&&l.model.fin),Re(1),Ze("disabled",!l.model.borneId||!l.model.debut||!l.model.fin||0===l.estimatedPrice))},dependencies:[el,Zl,Xu,zg,Bg,nl,lh,Wl,Zu,rl,Xl],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%], [_nghost-%COMP%]   *[_ngcontent-%COMP%]{color:#000!important}.bg-blue-600.text-inverse[_ngcontent-%COMP%]{color:#000!important}"]}),t})();function ZB(t,e){1&t&&(le(0,"span",11),Ae(1,"Libre"),ce())}function WB(t,e){1&t&&(le(0,"span",12),Ae(1,"Occup\xe9e"),ce())}function XB(t,e){if(1&t&&(le(0,"div",5)(1,"div",6)(2,"div")(3,"h4",7),Ae(4),ce(),le(5,"p",8),Ae(6),ce()(),Sn(7,ZB,2,0,"span",9),Sn(8,WB,2,0,"span",10),ce()()),2&t){const r=e.$implicit;Re(4),Qa("R\xe9servation #",r.id,""),Re(2),eg("",r.borneName," - ",r.dateDisplay,""),Re(1),Ze("ngIf","libre"===r.statut),Re(1),Ze("ngIf","occupee"===r.statut)}}let KB=(()=>{const e=class{constructor(n,i){this.api=n,this.auth=i,this.reservations=[],this.currentUserId=null}ngOnInit(){this.resolveCurrentUser()}resolveCurrentUser(){const n=this.auth.getPseudoFromToken();if(!n)return this.currentUserId=null,void(this.reservations=[]);this.api.list("utilisateurs").subscribe(i=>{const l=(i||[]).find(h=>h.pseudo===n||h.adresseMail===n);l&&(this.currentUserId=l.id),this.load()},()=>{this.currentUserId=null,this.load()})}load(){this.api.list("reservations/mine").subscribe(n=>{const i=["ACTIVE","active","CONFIRMED","confirmed"];let l=(n||[]).filter(f=>!f.etat||i.includes(String(f.etat)));const h=this.auth.getPseudoFromToken();l=l.filter(f=>!!(this.currentUserId&&(f.utilisateur&&(f.utilisateur.id===this.currentUserId||f.utilisateur===this.currentUserId)||f.client&&(f.client.id===this.currentUserId||f.client===this.currentUserId)||f.idUtilisateur&&f.idUtilisateur===this.currentUserId)||h&&(f.utilisateur&&(f.utilisateur.pseudo===h||f.utilisateur.adresseMail===h)||f.client&&(f.client.pseudo===h||f.client.adresseMail===h)))),this.reservations=l.map(f=>{const w=f.borne?.nomBorne||f.borne?.nom||f.nomBorne||(f.idBorne?"Borne #"+f.idBorne:"Borne");let E="-";try{if(f.dateDebut||f.dateFin){const O=f.dateDebut?new Date(f.dateDebut):null,Z=f.dateFin?new Date(f.dateFin):null;O&&Z?E=O.toLocaleString()+" \u2192 "+Z.toLocaleString():O?E=O.toLocaleString():Z&&(E=Z.toLocaleString())}else f.heureDebut&&(E=f.heureDebut)}catch{E=f.dateDebut||f.heureDebut||"-"}const P=f.client?.nom||f.utilisateur?.nom||f.utilisateur?.pseudo||f.client||"Inconnu";return{...f,borneName:w,dateDisplay:E,clientName:P}})})}cancel(n){this.api.delete("reservations",n.id).subscribe(()=>this.load())}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo),Me(Jl))},e.\u0275cmp=sr({type:e,selectors:[["reservations-courantes"]],decls:6,vars:1,consts:[[1,"min-h-screen","bg-deep","text-white","p-6"],[1,"max-w-6xl","mx-auto"],[1,"text-2xl","font-semibold","mb-4"],[1,"flex","gap-4","overflow-x-auto"],["class","min-w-[320px] bg-white/10 backdrop-blur-md p-4 rounded-xl shadow-md",4,"ngFor","ngForOf"],[1,"min-w-[320px]","bg-white/10","backdrop-blur-md","p-4","rounded-xl","shadow-md"],[1,"flex","justify-between","items-start"],[1,"text-white","font-semibold"],[1,"text-gray-300","text-sm"],["class","text-sm bg-green-500 text-black px-2 py-1 rounded-full",4,"ngIf"],["class","text-sm bg-red-500 text-black px-2 py-1 rounded-full",4,"ngIf"],[1,"text-sm","bg-green-500","text-black","px-2","py-1","rounded-full"],[1,"text-sm","bg-red-500","text-black","px-2","py-1","rounded-full"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"div",1)(2,"h2",2),Ae(3,"R\xe9servations en cours"),ce(),le(4,"div",3),Sn(5,XB,9,5,"div",4),ce()()()),2&i&&(Re(5),Ze("ngForOf",l.reservations))},dependencies:[el,Zl],styles:["[_nghost-%COMP%]{display:block}"]}),t})();const YB=function(t,e){return{"bg-cyan-400":t,"bg-gray-500":e}};function JB(t,e){if(1&t&&(le(0,"div",8),Vs(1,"div",9),le(2,"div",10)(3,"div",11),Ae(4),ce(),le(5,"div",12),Ae(6),ce()()()),2&t){const r=e.$implicit;Re(1),Ze("ngClass",function w1(t,e,r,n,i){return D1(Le(),Ri(),t,e,r,n,i)}(5,YB,"Termin\xe9e"===r.etat,"Annul\xe9e"===r.etat)),Re(3),hr(r.borneName||(r.idBorne?"Borne #"+r.idBorne:"Borne")),Re(2),Z_("",r.dateDebut," \u2192 ",r.dateFin," \u2014 \xc9tat: ",r.etat,"")}}let QB=(()=>{const e=class{constructor(n){this.api=n,this.reservations=[],this.q="",this.filterBorne="",this.filterEtat="",this.fromDate="",this.toDate=""}ngOnInit(){this.api.list("reservations/mine").subscribe(n=>this.reservations=n||[])}get filtered(){return this.reservations.filter(n=>{if(this.q&&!(n.borneName||"").toLowerCase().includes(this.q.toLowerCase())&&!(n.utilisateurName||"").toLowerCase().includes(this.q.toLowerCase())||this.filterBorne&&String(n.idBorne)!==String(this.filterBorne)||this.filterEtat&&n.etat!==this.filterEtat)return!1;if(this.fromDate){const i=new Date(this.fromDate);if(new Date(n.dateDebut)<i)return!1}if(this.toDate){const i=new Date(this.toDate);if(new Date(n.dateFin)>i)return!1}return!0})}clearFilters(){this.q="",this.filterBorne="",this.filterEtat="",this.fromDate="",this.toDate=""}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo))},e.\u0275cmp=sr({type:e,selectors:[["reservations-historique"]],decls:11,vars:4,consts:[[1,"max-w-4xl","mx-auto","p-6"],[1,"text-xl","mb-4","font-bold"],[1,"flex","gap-2","mb-4"],["placeholder","Recherche",1,"p-2","border","rounded","flex-1","bg-transparent","text-white",3,"ngModel","ngModelChange"],["type","date",1,"p-2","border","rounded","bg-transparent","text-white",3,"ngModel","ngModelChange"],[1,"px-3","py-2","border","rounded",3,"click"],[1,"space-y-6"],["class","flex items-start gap-4",4,"ngFor","ngForOf"],[1,"flex","items-start","gap-4"],[1,"w-3","h-3","rounded-full","mt-2",3,"ngClass"],[1,"bg-white/5","p-4","rounded-lg","flex-1"],[1,"text-white","font-semibold"],[1,"text-gray-300","text-sm"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"h2",1),Ae(2,"Historique des r\xe9servations"),ce(),le(3,"div",2)(4,"input",3),Ye("ngModelChange",function(f){return l.q=f}),ce(),le(5,"input",4),Ye("ngModelChange",function(f){return l.fromDate=f}),ce(),le(6,"input",4),Ye("ngModelChange",function(f){return l.toDate=f}),ce(),le(7,"button",5),Ye("click",function(){return l.clearFilters()}),Ae(8,"Nettoyer"),ce()(),le(9,"div",6),Sn(10,JB,7,8,"div",7),ce()()),2&i&&(Re(4),Ze("ngModel",l.q),Re(1),Ze("ngModel",l.fromDate),Re(1),Ze("ngModel",l.toDate),Re(4),Ze("ngForOf",l.filtered))},dependencies:[oD,el,nl,Wl,rl],styles:["[_nghost-%COMP%]{display:block}"]}),t})();function eV(t,e){if(1&t&&(le(0,"option",9),Ae(1),ce()),2&t){const r=e.$implicit;Ze("value",r.id),Re(1),hr(r.nomBorne||r.nom)}}function tV(t,e){if(1&t){const r=ca();le(0,"li",10)(1,"div")(2,"div",11),Ae(3),ce(),le(4,"div",12),Ae(5),ce()(),le(6,"div")(7,"button",13),Ye("click",function(){const l=lr(r).$implicit;return cr(Mn().del(l))}),Ae(8,"Supprimer"),ce()()()}if(2&t){const r=e.$implicit;Re(3),hr(r.filename||r.nom),Re(2),Qa("Borne: ",(null==r.borne?null:r.borne.nomBorne)||(null==r.borne?null:r.borne.nom)||"-","")}}let nV=(()=>{const e=class{constructor(n){this.api=n,this.medias=[],this.selectedBorne=null,this.mediasBornes=[]}ngOnInit(){this.load(),this.loadBornes()}load(){this.api.list("medias").subscribe(n=>this.medias=n||[])}loadBornes(){this.api.list("bornes/mine").subscribe(n=>this.mediasBornes=n||[])}onFile(n){if(this.file=n.target.files[0],!this.file)return;const i={filename:this.file.name};this.selectedBorne&&(i.borne={id:this.selectedBorne}),this.api.create("medias",i).subscribe(()=>this.load(),()=>alert("Erreur upload"))}del(n){this.api.delete("medias",n.id).subscribe(()=>this.load())}};let t=e;return e.\u0275fac=function(i){return new(i||e)(Me(jo))},e.\u0275cmp=sr({type:e,selectors:[["gestion-medias"]],decls:14,vars:3,consts:[[1,"max-w-3xl","mx-auto","p-4","bg-surface","rounded","shadow"],[1,"text-xl","mb-4","text-foreground"],[1,"mb-3"],[1,"block","mb-1"],[1,"p-2","border","rounded","w-full",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","file",3,"change"],["class","p-2 border-b flex justify-between items-center",4,"ngFor","ngForOf"],[3,"value"],[1,"p-2","border-b","flex","justify-between","items-center"],[1,"font-semibold"],[1,"text-sm","text-gray-600"],[1,"px-2","py-1","bg-red-600","text-inverse","rounded",3,"click"]],template:function(i,l){1&i&&(le(0,"div",0)(1,"h2",1),Ae(2,"M\xe9dias"),ce(),le(3,"div",2)(4,"label",3),Ae(5,"Associer \xe0 une borne"),ce(),le(6,"select",4),Ye("ngModelChange",function(f){return l.selectedBorne=f}),le(7,"option",5),Ae(8,"-- choisir --"),ce(),Sn(9,eV,2,2,"option",6),ce()(),le(10,"div",2)(11,"input",7),Ye("change",function(f){return l.onFile(f)}),ce()(),le(12,"ul"),Sn(13,tV,9,2,"li",8),ce()()),2&i&&(Re(6),Ze("ngModel",l.selectedBorne),Re(3),Ze("ngForOf",l.mediasBornes),Re(4),Ze("ngForOf",l.medias))},dependencies:[el,zg,Bg,lh,Wl,rl],styles:["[_nghost-%COMP%]{display:block}"]}),t})(),rV=(()=>{const e=class{constructor(n){this.router=n}intercept(n,i){const l=localStorage.getItem("token"),h=l?n.clone({setHeaders:{Authorization:`Bearer ${l}`}}):n;return i.handle(h).pipe(no(f=>{}),Bc(f=>((401===f.status||403===f.status)&&(localStorage.removeItem("token"),setTimeout(()=>this.router.navigateByUrl("/connexion"))),hh(()=>f))))}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(wr))},e.\u0275prov=ft({token:e,factory:e.\u0275fac}),t})(),js=(()=>{const e=class{constructor(n,i){this.auth=n,this.router=i}canActivate(){return!!this.auth.isLogged()||(this.router.navigateByUrl("/connexion"),!1)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(Jl),lt(wr))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),l0=(()=>{const e=class{constructor(n,i){this.auth=n,this.router=i}canActivate(){return!this.auth.isLogged()||(this.router.navigateByUrl("/"),!1)}};let t=e;return e.\u0275fac=function(i){return new(i||e)(lt(Jl),lt(wr))},e.\u0275prov=ft({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const iV=[{path:"",component:DB,canActivate:[js]},{path:"inscription",component:mB,canActivate:[l0]},{path:"connexion",component:yB,canActivate:[l0]},{path:"deconnexion",component:_B,canActivate:[js]},{path:"lieux",component:SB,canActivate:[js]},{path:"adresses",component:AB,canActivate:[js]},{path:"bornes",component:LB,canActivate:[js]},{path:"bornes/new",component:UB,canActivate:[js]},{path:"carte",component:$B,canActivate:[js]},{path:"reservation",component:qB,canActivate:[js]},{path:"reservations",component:KB,canActivate:[js]},{path:"historique",component:QB,canActivate:[js]},{path:"medias",component:nV,canActivate:[js]}];let oV=(()=>{const e=class{};let t=e;return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Zi({type:e,bootstrap:[fB]}),e.\u0275inj=qi({providers:[jo,Jl,js,l0,{provide:WE,useClass:rV,multi:!0}],imports:[rL,uO,dO,RO,nB.forRoot(iV)]}),t})();tL().bootstrapModule(oV).catch(t=>console.error(t))},943:function(wh){wh.exports=function(){"use strict";var Ql,ec,An;function $c(_,Wn){if(Ql)if(ec){var Ho="var sharedChunk = {}; ("+Ql+")(sharedChunk); ("+ec+")(sharedChunk);",wo={};Ql(wo),An=Wn(wo),typeof window<"u"&&(An.workerUrl=window.URL.createObjectURL(new Blob([Ho],{type:"text/javascript"})))}else ec=Wn;else Ql=Wn}return $c(0,function(_){var Wn=Ho;function Ho(a,o,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=c,this.p2y=d}function wo(a,o,c,d){const g=new Wn(a,o,c,d);return function(v){return g.solve(v)}}Ho.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,d=0;d<8;d++){var g=this.sampleCurveX(c)-a;if(Math.abs(g)<o)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=g/v}var b=0,D=1;for(c=a,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-a)<o));d++)a>g?b=c:D=c,c=.5*(D-b)+b;return c},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};const nn=wo(.25,.1,.25,1);function be(a,o,c){return Math.min(c,Math.max(o,a))}function Go(a,o,c){const d=c-o,g=((a-o)%d+d)%d+o;return g===o?c:g}function Bi(a,...o){for(const c of o)for(const d in c)a[d]=c[d];return a}let Un=1;function tc(a,o){a.forEach(c=>{o[c]&&(o[c]=o[c].bind(o))})}function ll(a,o,c){const d={};for(const g in a)d[g]=o.call(c||this,a[g],g,a);return d}function qo(a,o,c){const d={};for(const g in a)o.call(c||this,a[g],g,a)&&(d[g]=a[g]);return d}function si(a){return Array.isArray(a)?a.map(si):"object"==typeof a&&a?ll(a,si):a}const ro={};function jn(a){ro[a]||(typeof console<"u"&&console.warn(a),ro[a]=!0)}function Co(a,o,c){return(c.y-a.y)*(o.x-a.x)>(o.y-a.y)*(c.x-a.x)}function Do(a){let o=0;for(let c,d,g=0,v=a.length,b=v-1;g<v;b=g++)c=a[g],d=a[b],o+=(d.x-c.x)*(c.y+d.y);return o}function Vi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ya(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,v)=>{const b=g||v;return o[d]=!b||b.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o}let Zo,io,Ui=null;function _a(a){if(null==Ui){const o=a.navigator?a.navigator.userAgent:null;Ui=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Ui}function Eo(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const ms={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const o=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(a,o=0){const c=window.document.createElement("canvas"),d=c.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,d.drawImage(a,0,0,a.width,a.height),d.getImageData(-o,-o,a.width+2*o,a.height+2*o)},resolveURL:a=>(Zo||(Zo=document.createElement("a")),Zo.href=a,Zo.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==io&&(io=matchMedia("(prefers-reduced-motion: reduce)")),io.matches)}};var xt=Gr;function Gr(a,o){this.x=a,this.y=o}Gr.prototype={clone:function(){return new Gr(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,c=a.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),c=Math.sin(a),d=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=d,this},_rotateAround:function(a,o){var c=Math.cos(a),d=Math.sin(a),g=o.y+d*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-d*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Gr.convert=function(a){return a instanceof Gr?a:Array.isArray(a)?new Gr(a[0],a[1]):a};const Wo={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},$i="mapbox-tiles";let hn,va=500,xa=50;function ba(){typeof caches>"u"||hn||(hn=caches.open($i))}let Cr=1/0;const Xo={supported:!1,testSupport:function(a){!pn&&Ko&&($n?cl(a):fr=a)}};let fr,Ko,pn=!1,$n=!1;function cl(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Ko),a.isContextLost())return;Xo.supported=!0}catch{}a.deleteTexture(o),pn=!0}typeof document<"u"&&(Ko=document.createElement("img"),Ko.onload=function(){fr&&cl(fr),fr=null,$n=!0},Ko.onerror=function(){pn=!0,fr=null},Ko.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const $t={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze($t);class ai extends Error{constructor(o,c,d,g){super(`AJAXError: ${c} (${o}): ${d}`),this.status=o,this.statusText=c,this.url=d,this.body=g}}const ul=Vi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function Io(a,o){const c=new AbortController,d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ul(),signal:c.signal});let g=!1,v=!1;return"json"===a.type&&d.headers.set("Accept","application/json"),((b,D,I)=>{if(v)return;const M=Date.now();fetch(d).then(R=>{return R.ok?(L=R,null,M,void("arrayBuffer"===a.type?L.arrayBuffer():"json"===a.type?L.json():L.text()).then($=>{v||(g=!0,o(null,$,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch($=>{v||o(new Error($.message))})):R.blob().then(L=>o(new ai(R.status,R.statusText,a.url,L)));var L}).catch(R=>{20!==R.code&&o(new Error(R.message))})})(),{cancel:()=>{v=!0,g||c.abort()}}}const wa=function(a,o){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o);if(!Vi()){const d=a.url.substring(0,a.url.indexOf("://"));return(Wo.REGISTERED_PROTOCOLS[d]||Io)(a,o)}}if(!(/^file:/.test(c=a.url)||/^file:/.test(ul())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Io(a,o);if(Vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var c;return function(d,g){const v=new XMLHttpRequest;v.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(v.responseType="arraybuffer");for(const b in d.headers)v.setRequestHeader(b,d.headers[b]);return"json"===d.type&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials="include"===d.credentials,v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||0===v.status)&&null!==v.response){let b=v.response;if("json"===d.type)try{b=JSON.parse(v.response)}catch(D){return g(D)}g(null,b,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const b=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});g(new ai(v.status,v.statusText,d.url,b))}},v.send(d.body),{cancel:()=>v.abort()}}(a,o)},Ca=function(a,o){return wa(Bi(a,{type:"arrayBuffer"}),o)};function dl(a){const o=window.document.createElement("a");return o.href=a,o.protocol===window.document.location.protocol&&o.host===window.document.location.host}const Yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let To,ys;To=[],ys=0;const _s=function(a,o){if(Xo.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ys>=Wo.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return To.push(v),v}ys++;let c=!1;const d=()=>{if(!c)for(c=!0,ys--;To.length&&ys<Wo.MAX_PARALLEL_IMAGE_REQUESTS;){const v=To.shift(),{requestParameters:b,callback:D,cancelled:I}=v;I||(v.cancel=_s(b,D).cancel)}},g=Ca(a,(v,b,D,I)=>{var M,R;d(),v?o(v):b&&(M=b,R=(M,R)=>{null!=M?o(M):null!=R&&o(null,R,{cacheControl:D,expires:I})},"function"==typeof createImageBitmap?function(L,B){const V=new Blob([new Uint8Array(L)],{type:"image/png"});createImageBitmap(V).then($=>{B(null,$)}).catch($=>{B(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(M,R):function(L,B){const V=new Image;V.onload=()=>{B(null,V),URL.revokeObjectURL(V.src),V.onload=null,window.requestAnimationFrame(()=>{V.src=Yt})},V.onerror=()=>B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Blob([new Uint8Array(L)],{type:"image/png"});V.src=L.byteLength?URL.createObjectURL($):Yt}(M,R))});return{cancel:()=>{g.cancel(),d()}}};function hl(a,o,c){c[a]&&-1!==c[a].indexOf(o)||(c[a]=c[a]||[],c[a].push(o))}function So(a,o,c){if(c&&c[a]){const d=c[a].indexOf(o);-1!==d&&c[a].splice(d,1)}}class Yo{constructor(o,c={}){Bi(this,c),this.type=o}}class vs extends Yo{constructor(o,c={}){super("error",Bi({error:o},c))}}class Jo{on(o,c){return this._listeners=this._listeners||{},hl(o,c,this._listeners),this}off(o,c){return So(o,c,this._listeners),So(o,c,this._oneTimeListeners),this}once(o,c){return this._oneTimeListeners=this._oneTimeListeners||{},hl(o,c,this._oneTimeListeners),this}fire(o,c){"string"==typeof o&&(o=new Yo(o,c||{}));const d=o.type;if(this.listens(d)){o.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const D of g)D.call(this,o);const v=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const D of v)So(d,D,this._oneTimeListeners),D.call(this,o);const b=this._eventedParent;b&&(Bi(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(o))}else o instanceof vs&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class He{constructor(o,c,d,g){this.message=(o?`${o}: `:"")+d,g&&(this.identifier=g),null!=c&&c.__line__&&(this.line=c.__line__)}}function Hs(a){const o=a.value;return o?[new He(a.key,o,"constants have been deprecated as of v8")]:[]}function oo(a,...o){for(const c of o)for(const d in c)a[d]=c[d];return a}function Jt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function mr(a){if(Array.isArray(a))return a.map(mr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const c in a)o[c]=mr(a[c]);return o}return Jt(a)}class _i extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class Ai{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(o){return new Ai(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Qo={kind:"null"},je={kind:"number"},Ft={kind:"string"},Et={kind:"boolean"},kr={kind:"color"},xs={kind:"object"},It={kind:"value"},es={kind:"collator"},Dr={kind:"formatted"},Da={kind:"padding"},or={kind:"resolvedImage"};function li(a,o){return{kind:"array",itemType:a,N:o}}function _n(a){if("array"===a.kind){const o=_n(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const pl=[Qo,je,Ft,Et,kr,Dr,xs,li(It),Da,or];function so(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!so(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const c of pl)if(!so(c,o))return null}return`Expected ${_n(a)} but found ${_n(o)} instead.`}function bs(a,o){return o.some(c=>c.kind===a.kind)}function ws(a,o){return o.some(c=>"null"===c?null===a:"array"===c?Array.isArray(a):"object"===c?a&&!Array.isArray(a)&&"object"==typeof a:c===typeof a)}var Gs,Cs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function G(a){return(a=Math.round(a))<0?0:a>255?255:a}function k(a){return G("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function N(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function j(a,o,c){return c<0?c+=1:c>1&&(c-=1),6*c<1?a+(o-a)*c*6:2*c<1?o:3*c<2?a+(o-a)*(2/3-c)*6:a}try{Gs={}.parseCSSColor=function(a){var o,c=a.replace(/ /g,"").toLowerCase();if(c in Cs)return Cs[c].slice();if("#"===c[0])return 4===c.length?(o=parseInt(c.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===c.length&&(o=parseInt(c.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var d=c.indexOf("("),g=c.indexOf(")");if(-1!==d&&g+1===c.length){var v=c.substr(0,d),b=c.substr(d+1,g-(d+1)).split(","),D=1;switch(v){case"rgba":if(4!==b.length)return null;D=N(b.pop());case"rgb":return 3!==b.length?null:[k(b[0]),k(b[1]),k(b[2]),D];case"hsla":if(4!==b.length)return null;D=N(b.pop());case"hsl":if(3!==b.length)return null;var I=(parseFloat(b[0])%360+360)%360/360,M=N(b[1]),R=N(b[2]),L=R<=.5?R*(M+1):R+M-R*M,B=2*R-L;return[G(255*j(B,L,I+1/3)),G(255*j(B,L,I)),G(255*j(B,L,I-1/3)),D];default:return null}}return null}}catch{}class H{constructor(o,c,d,g=1){this.r=o,this.g=c,this.b=d,this.a=g}static parse(o){if(!o)return;if(o instanceof H)return o;if("string"!=typeof o)return;const c=Gs(o);return c?new H(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[o,c,d,g]=this.toArray();return`rgba(${Math.round(o)},${Math.round(c)},${Math.round(d)},${g})`}toArray(){const{r:o,g:c,b:d,a:g}=this;return 0===g?[0,0,0,0]:[255*o/g,255*c/g,255*d/g,g]}}H.black=new H(0,0,0,1),H.white=new H(1,1,1,1),H.transparent=new H(0,0,0,0),H.red=new H(1,0,0,1);class Q{constructor(o,c,d){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ie{constructor(o,c,d,g,v){this.text=o,this.image=c,this.scale=d,this.fontStack=g,this.textColor=v}}class ne{constructor(o){this.sections=o}static fromString(o){return new ne([new ie(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof ne?o:ne.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}}class te{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof te)return o;if("number"==typeof o)return new te([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if("number"!=typeof c)return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new te(o)}}toString(){return JSON.stringify(this.values)}}class oe{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new oe({name:o,available:!1}):null}}function _e(a,o,c,d){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof c&&c>=0&&c<=255?void 0===d||"number"==typeof d&&d>=0&&d<=1?null:`Invalid rgba value [${[a,o,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof d?[a,o,c,d]:[a,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pe(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof H||a instanceof Q||a instanceof ne||a instanceof te||a instanceof oe)return!0;if(Array.isArray(a)){for(const o of a)if(!Pe(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Pe(a[o]))return!1;return!0}return!1}function ye(a){if(null===a)return Qo;if("string"==typeof a)return Ft;if("boolean"==typeof a)return Et;if("number"==typeof a)return je;if(a instanceof H)return kr;if(a instanceof Q)return es;if(a instanceof ne)return Dr;if(a instanceof te)return Da;if(a instanceof oe)return or;if(Array.isArray(a)){const o=a.length;let c;for(const d of a){const g=ye(d);if(c){if(c===g)continue;c=It;break}c=g}return li(c||It,o)}return xs}function Ke(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof H||a instanceof ne||a instanceof te||a instanceof oe?a.toString():JSON.stringify(a)}class st{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(2!==o.length)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Pe(o[1]))return c.error("invalid value");const d=o[1];let g=ye(d);const v=c.expectedType;return"array"!==g.kind||0!==g.N||!v||"array"!==v.kind||"number"==typeof v.N&&0!==v.N||(g=v),new st(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ze{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const dt={string:Ft,number:je,boolean:Et,object:xs};class ht{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let d,g=1;const v=o[0];if("array"===v){let D,I;if(o.length>2){const M=o[1];if("string"!=typeof M||!(M in dt)||"object"===M)return c.error('The item type argument of "array" must be one of string, number, boolean',1);D=dt[M],g++}else D=It;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=o[2],g++}d=li(D,I)}else{if(!dt[v])throw new Error(`Types doesn't contain name = ${v}`);d=dt[v]}const b=[];for(;g<o.length;g++){const D=c.parse(o[g],g,It);if(!D)return null;b.push(D)}return new ht(d,b)}evaluate(o){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(o);if(!so(this.type,ye(d)))return d;if(c===this.args.length-1)throw new ze(`Expected value to be of type ${_n(this.type)}, but found ${_n(ye(d))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Qt={"to-boolean":Et,"to-color":kr,"to-number":je,"to-string":Ft};class bt{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const d=o[0];if(!Qt[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if(("to-boolean"===d||"to-string"===d)&&2!==o.length)return c.error("Expected one argument.");const g=Qt[d],v=[];for(let b=1;b<o.length;b++){const D=c.parse(o[b],b,It);if(!D)return null;v.push(D)}return new bt(g,v)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let c,d;for(const g of this.args){if(c=g.evaluate(o),d=null,c instanceof H)return c;if("string"==typeof c){const v=o.parseColor(c);if(v)return v}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:_e(c[0],c[1],c[2],c[3]),!d))return new H(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new ze(d||`Could not parse color from value '${"string"==typeof c?c:JSON.stringify(c)}'`)}if("padding"===this.type.kind){let c;for(const d of this.args){c=d.evaluate(o);const g=te.parse(c);if(g)return g}throw new ze(`Could not parse padding from value '${"string"==typeof c?c:JSON.stringify(c)}'`)}if("number"===this.type.kind){let c=null;for(const d of this.args){if(c=d.evaluate(o),null===c)return 0;const g=Number(c);if(!isNaN(g))return g}throw new ze(`Could not convert ${JSON.stringify(c)} to number.`)}return"formatted"===this.type.kind?ne.fromString(Ke(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?oe.fromString(Ke(this.args[0].evaluate(o))):Ke(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Lt=["Unknown","Point","LineString","Polygon"];class Ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Lt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=H.parse(o)),c}}class vn{constructor(o,c,d,g){this.name=o,this.type=c,this._evaluate=d,this.args=g}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const d=o[0],g=vn.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,D=b.filter(([M])=>!Array.isArray(M)||M.length===o.length-1);let I=null;for(const[M,R]of D){I=new Ds(c.registry,c.path,null,c.scope);const L=[];let B=!1;for(let V=1;V<o.length;V++){const $=o[V],ee=Array.isArray(M)?M[V-1]:M.type,K=I.parse($,1+L.length,ee);if(!K){B=!0;break}L.push(K)}if(!B)if(Array.isArray(M)&&M.length!==L.length)I.error(`Expected ${M.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const $=Array.isArray(M)?M[V]:M.type,ee=L[V];I.concat(V+1).checkSubtype($,ee.type)}if(0===I.errors.length)return new vn(d,v,R,L)}}if(1===D.length)c.errors.push(...I.errors);else{const M=(D.length?D:b).map(([L])=>{return B=L,Array.isArray(B)?`(${B.map(_n).join(", ")})`:`(${_n(B.type)}...)`;var B}).join(" | "),R=[];for(let L=1;L<o.length;L++){const B=c.parse(o[L],1+R.length);if(!B)return null;R.push(_n(B.type))}c.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(o,c){vn.definitions=c;for(const d in c)o[d]=vn}}class Xn{constructor(o,c,d){this.type=es,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(2!==o.length)return c.error("Expected one argument.");const d=o[1];if("object"!=typeof d||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(void 0!==d["case-sensitive"]&&d["case-sensitive"],1,Et);if(!g)return null;const v=c.parse(void 0!==d["diacritic-sensitive"]&&d["diacritic-sensitive"],1,Et);if(!v)return null;let b=null;return d.locale&&(b=c.parse(d.locale,1,Ft),!b)?null:new Xn(g,v,b)}evaluate(o){return new Q(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const Ln=8192;function Rr(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function qs(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function fl(a,o){const c=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(c*g*Ln),Math.round(d*g*Ln)]}function Dn(a,o,c){const d=a[0]-o[0],g=a[1]-o[1],v=a[0]-c[0],b=a[1]-c[1];return d*b-v*g==0&&d*v<=0&&g*b<=0}function jc(a,o){let c=!1;for(let b=0,D=o.length;b<D;b++){const I=o[b];for(let M=0,R=I.length;M<R-1;M++){if(Dn(a,I[M],I[M+1]))return!1;(g=I[M])[1]>(d=a)[1]!=(v=I[M+1])[1]>d[1]&&d[0]<(v[0]-g[0])*(d[1]-g[1])/(v[1]-g[1])+g[0]&&(c=!c)}}var d,g,v;return c}function Hc(a,o){for(let c=0;c<o.length;c++)if(jc(a,o[c]))return!0;return!1}function Gc(a,o,c,d){const g=d[0]-c[0],v=d[1]-c[1],b=(a[0]-c[0])*v-g*(a[1]-c[1]),D=(o[0]-c[0])*v-g*(o[1]-c[1]);return b>0&&D<0||b<0&&D>0}function nd(a,o,c){for(const M of c)for(let R=0;R<M.length-1;++R)if((D=[(b=M[R+1])[0]-(v=M[R])[0],b[1]-v[1]])[0]*(I=[(g=o)[0]-(d=a)[0],g[1]-d[1]])[1]-D[1]*I[0]!=0&&Gc(d,g,v,b)&&Gc(v,b,d,g))return!0;var d,g,v,b,D,I;return!1}function qc(a,o){for(let c=0;c<a.length;++c)if(!jc(a[c],o))return!1;for(let c=0;c<a.length-1;++c)if(nd(a[c],a[c+1],o))return!1;return!0}function gr(a,o){for(let c=0;c<o.length;c++)if(qc(a,o[c]))return!0;return!1}function nc(a,o,c){const d=[];for(let g=0;g<a.length;g++){const v=[];for(let b=0;b<a[g].length;b++){const D=fl(a[g][b],c);Rr(o,D),v.push(D)}d.push(v)}return d}function wt(a,o,c){const d=[];for(let g=0;g<a.length;g++){const v=nc(a[g],o,c);d.push(v)}return d}function Zc(a,o,c,d){if(a[0]<c[0]||a[0]>c[2]){const g=.5*d;let v=a[0]-c[0]>g?-d:c[0]-a[0]>g?d:0;0===v&&(v=a[0]-c[2]>g?-d:c[2]-a[0]>g?d:0),a[0]+=v}Rr(o,a)}function rc(a,o,c,d){const g=Math.pow(2,d.z)*Ln,v=[d.x*Ln,d.y*Ln],b=[];for(const D of a)for(const I of D){const M=[I.x+v[0],I.y+v[1]];Zc(M,o,c,g),b.push(M)}return b}function ji(a,o,c,d){const g=Math.pow(2,d.z)*Ln,v=[d.x*Ln,d.y*Ln],b=[];for(const I of a){const M=[];for(const R of I){const L=[R.x+v[0],R.y+v[1]];Rr(o,L),M.push(L)}b.push(M)}if(o[2]-o[0]<=g/2){(D=o)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const I of b)for(const M of I)Zc(M,o,c,g)}var D;return b}class Zs{constructor(o,c){this.type=Et,this.geojson=o,this.geometries=c}static parse(o,c){if(2!==o.length)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Pe(o[1])){const d=o[1];if("FeatureCollection"===d.type)for(let g=0;g<d.features.length;++g){const v=d.features[g].geometry.type;if("Polygon"===v||"MultiPolygon"===v)return new Zs(d,d.features[g].geometry)}else if("Feature"===d.type){const g=d.geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Zs(d,d.geometry)}else if("Polygon"===d.type||"MultiPolygon"===d.type)return new Zs(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(c,d){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if("Polygon"===d.type){const D=nc(d.coordinates,v,b),I=rc(c.geometry(),g,v,b);if(!qs(g,v))return!1;for(const M of I)if(!jc(M,D))return!1}if("MultiPolygon"===d.type){const D=wt(d.coordinates,v,b),I=rc(c.geometry(),g,v,b);if(!qs(g,v))return!1;for(const M of I)if(!Hc(M,D))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(c,d){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if("Polygon"===d.type){const D=nc(d.coordinates,v,b),I=ji(c.geometry(),g,v,b);if(!qs(g,v))return!1;for(const M of I)if(!qc(M,D))return!1}if("MultiPolygon"===d.type){const D=wt(d.coordinates,v,b),I=ji(c.geometry(),g,v,b);if(!qs(g,v))return!1;for(const M of I)if(!gr(M,D))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function ml(a){if(a instanceof vn&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Zs)return!1;let o=!0;return a.eachChild(c=>{o&&!ml(c)&&(o=!1)}),o}function rn(a){if(a instanceof vn&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(c=>{o&&!rn(c)&&(o=!1)}),o}function Ea(a,o){if(a instanceof vn&&o.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(d=>{c&&!Ea(d,o)&&(c=!1)}),c}class Kn{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(2!==o.length||"string"!=typeof o[1])return c.error("'var' expression requires exactly one string literal argument.");const d=o[1];return c.scope.has(d)?new Kn(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class Ds{constructor(o,c=[],d,g=new Ai,v=[]){this.registry=o,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=v,this.expectedType=d}parse(o,c,d,g,v={}){return c?this.concat(c,d,g)._parse(o,v):this._parse(o,v)}_parse(o,c){function d(g,v,b){return"assert"===b?new ht(v,[g]):"coerce"===b?new bt(v,[g]):g}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=o[0];if("string"!=typeof g)return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let b=v.parse(o,this);if(!b)return null;if(this.expectedType){const D=this.expectedType,I=b.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==I.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==I.kind&&"string"!==I.kind)if("padding"!==D.kind||"value"!==I.kind&&"number"!==I.kind&&"array"!==I.kind){if(this.checkSubtype(D,I))return null}else b=d(b,D,c.typeAnnotation||"coerce");else b=d(b,D,c.typeAnnotation||"coerce");else b=d(b,D,c.typeAnnotation||"assert")}if(!(b instanceof st)&&"resolvedImage"!==b.type.kind&&Wc(b)){const D=new Ht;try{b=new st(b.type,b.evaluate(D))}catch(I){return this.error(I.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,d){const g="number"==typeof o?this.path.concat(o):this.path,v=d?this.scope.concat(d):this.scope;return new Ds(this.registry,g,c||null,v,this.errors)}error(o,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new _i(d,o))}checkSubtype(o,c){const d=so(o,c);return d&&this.error(d),d}}function Wc(a){if(a instanceof Kn)return Wc(a.boundExpression);if(a instanceof vn&&"error"===a.name||a instanceof Xn||a instanceof Zs)return!1;const o=a instanceof bt||a instanceof ht;let c=!0;return a.eachChild(d=>{c=o?c&&Wc(d):c&&d instanceof st}),!!c&&ml(a)&&Ea(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function En(a,o){const c=a.length-1;let d,g,v=0,b=c,D=0;for(;v<=b;)if(D=Math.floor((v+b)/2),d=a[D],g=a[D+1],d<=o){if(D===c||o<g)return D;v=D+1}else{if(!(d>o))throw new ze("Input is not a number.");b=D-1}return 0}class Ct{constructor(o,c,d){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,v]of d)this.labels.push(g),this.outputs.push(v)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(o[1],1,je);if(!d)return null;const g=[];let v=null;c.expectedType&&"value"!==c.expectedType.kind&&(v=c.expectedType);for(let b=1;b<o.length;b+=2){const D=1===b?-1/0:o[b],I=o[b+1],M=b,R=b+1;if("number"!=typeof D)return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=D)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const L=c.parse(I,R,v);if(!L)return null;v=v||L.type,g.push([D,L])}return new Ct(v,d,g)}evaluate(o){const c=this.labels,d=this.outputs;if(1===c.length)return d[0].evaluate(o);const g=this.input.evaluate(o);if(g<=c[0])return d[0].evaluate(o);const v=c.length;return g>=c[v-1]?d[v-1].evaluate(o):d[En(c,g)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Pn(a,o,c){return a*(1-c)+o*c}var Ws=Object.freeze({__proto__:null,number:Pn,color:function(a,o,c){return new H(Pn(a.r,o.r,c),Pn(a.g,o.g,c),Pn(a.b,o.b,c),Pn(a.a,o.a,c))},array:function(a,o,c){return a.map((d,g)=>Pn(d,o[g],c))},padding:function(a,o,c){const d=a.values,g=o.values;return new te([Pn(d[0],g[0],c),Pn(d[1],g[1],c),Pn(d[2],g[2],c),Pn(d[3],g[3],c)])}});const Ne=4/29,Xs=6/29,At=3*Xs*Xs,xn=Math.PI/180,Eh=180/Math.PI;function rd(a){return a>.008856451679035631?Math.pow(a,1/3):a/At+Ne}function Kc(a){return a>Xs?a*a*a:At*(a-Ne)}function Ia(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ci(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ln(a){const o=ci(a.r),c=ci(a.g),d=ci(a.b),g=rd((.4124564*o+.3575761*c+.1804375*d)/.95047),v=rd((.2126729*o+.7151522*c+.072175*d)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-rd((.0193339*o+.119192*c+.9503041*d)/1.08883)),alpha:a.a}}function id(a){let o=(a.l+16)/116,c=isNaN(a.a)?o:o+a.a/500,d=isNaN(a.b)?o:o-a.b/200;return o=1*Kc(o),c=.95047*Kc(c),d=1.08883*Kc(d),new H(Ia(3.2404542*c-1.5371385*o-.4985314*d),Ia(-.969266*c+1.8760108*o+.041556*d),Ia(.0556434*c-.2040259*o+1.0572252*d),a.alpha)}function Ff(a,o,c){const d=o-a;return a+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const Hi={forward:ln,reverse:id,interpolate:function(a,o,c){return{l:Pn(a.l,o.l,c),a:Pn(a.a,o.a,c),b:Pn(a.b,o.b,c),alpha:Pn(a.alpha,o.alpha,c)}}},ic={forward:function(a){const{l:o,a:c,b:d}=ln(a),g=Math.atan2(d,c)*Eh;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:o,alpha:a.a}},reverse:function(a){const o=a.h*xn,c=a.c;return id({l:a.l,a:Math.cos(o)*c,b:Math.sin(o)*c,alpha:a.alpha})},interpolate:function(a,o,c){return{h:Ff(a.h,o.h,c),c:Pn(a.c,o.c,c),l:Pn(a.l,o.l,c),alpha:Pn(a.alpha,o.alpha,c)}}};var Ih=Object.freeze({__proto__:null,lab:Hi,hcl:ic});class Gi{constructor(o,c,d,g,v){this.type=o,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[b,D]of v)this.labels.push(b),this.outputs.push(D)}static interpolationFactor(o,c,d,g){let v=0;if("exponential"===o.name)v=od(c,o.base,d,g);else if("linear"===o.name)v=od(c,1,d,g);else if("cubic-bezier"===o.name){const b=o.controlPoints;v=new Wn(b[0],b[1],b[2],b[3]).solve(od(c,1,d,g))}return v}static parse(o,c){let[d,g,v,...b]=o;if(!Array.isArray(g)||0===g.length)return c.error("Expected an interpolation type expression.",1);if("linear"===g[0])g={name:"linear"};else if("exponential"===g[0]){const M=g[1];if("number"!=typeof M)return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if("cubic-bezier"!==g[0])return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(4!==M.length||M.some(R=>"number"!=typeof R||R<0||R>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(v=c.parse(v,2,je),!v)return null;const D=[];let I=null;"interpolate-hcl"===d||"interpolate-lab"===d?I=kr:c.expectedType&&"value"!==c.expectedType.kind&&(I=c.expectedType);for(let M=0;M<b.length;M+=2){const R=b[M],L=b[M+1],B=M+3,V=M+4;if("number"!=typeof R)return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(D.length&&D[D.length-1][0]>=R)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const $=c.parse(L,V,I);if(!$)return null;I=I||$.type,D.push([R,$])}return"number"===I.kind||"color"===I.kind||"padding"===I.kind||"array"===I.kind&&"number"===I.itemType.kind&&"number"==typeof I.N?new Gi(I,d,g,v,D):c.error(`Type ${_n(I)} is not interpolatable.`)}evaluate(o){const c=this.labels,d=this.outputs;if(1===c.length)return d[0].evaluate(o);const g=this.input.evaluate(o);if(g<=c[0])return d[0].evaluate(o);const v=c.length;if(g>=c[v-1])return d[v-1].evaluate(o);const b=En(c,g),D=Gi.interpolationFactor(this.interpolation,g,c[b],c[b+1]),I=d[b].evaluate(o),M=d[b+1].evaluate(o);return"interpolate"===this.operator?Ws[this.type.kind.toLowerCase()](I,M,D):"interpolate-hcl"===this.operator?ic.reverse(ic.interpolate(ic.forward(I),ic.forward(M),D)):Hi.reverse(Hi.interpolate(Hi.forward(I),Hi.forward(M),D))}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function od(a,o,c,d){const g=d-c,v=a-c;return 0===g?0:1===o?v/g:(Math.pow(o,v)-1)/(Math.pow(o,g)-1)}class oc{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&"value"!==g.kind&&(d=g);const v=[];for(const D of o.slice(1)){const I=c.parse(D,1+v.length,d,void 0,{typeAnnotation:"omit"});if(!I)return null;d=d||I.type,v.push(I)}if(!d)throw new Error("No output type");const b=g&&v.some(D=>so(g,D.type));return new oc(b?It:d,v)}evaluate(o){let c,d=null,g=0;for(const v of this.args)if(g++,d=v.evaluate(o),d&&d instanceof oe&&!d.available&&(c||(c=d.name),d=null,g===this.args.length&&(d=c)),null!==d)break;return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class Yc{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let v=1;v<o.length-1;v+=2){const b=o[v];if("string"!=typeof b)return c.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",v);const D=c.parse(o[v+1],v+1);if(!D)return null;d.push([b,D])}const g=c.parse(o[o.length-1],o.length-1,c.expectedType,d);return g?new Yc(d,g):null}outputDefined(){return this.result.outputDefined()}}class Jc{constructor(o,c,d){this.type=o,this.index=c,this.input=d}static parse(o,c){if(3!==o.length)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,je),g=c.parse(o[2],2,li(c.expectedType||It));return d&&g?new Jc(g.type.itemType,d,g):null}evaluate(o){const c=this.index.evaluate(o),d=this.input.evaluate(o);if(c<0)throw new ze(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new ze(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new ze(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class sd{constructor(o,c){this.type=Et,this.needle=o,this.haystack=c}static parse(o,c){if(3!==o.length)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,It),g=c.parse(o[2],2,It);return d&&g?bs(d.type,[Et,Ft,je,Qo,It])?new sd(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${_n(d.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!d)return!1;if(!ws(c,["boolean","string","number","null"]))throw new ze(`Expected first argument to be of type boolean, string, number or null, but found ${_n(ye(c))} instead.`);if(!ws(d,["string","array"]))throw new ze(`Expected second argument to be of type array or string, but found ${_n(ye(d))} instead.`);return d.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class ui{constructor(o,c,d){this.type=je,this.needle=o,this.haystack=c,this.fromIndex=d}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,It),g=c.parse(o[2],2,It);if(!d||!g)return null;if(!bs(d.type,[Et,Ft,je,Qo,It]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${_n(d.type)} instead`);if(4===o.length){const v=c.parse(o[3],3,je);return v?new ui(d,g,v):null}return new ui(d,g)}evaluate(o){const c=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!ws(c,["boolean","string","number","null"]))throw new ze(`Expected first argument to be of type boolean, string, number or null, but found ${_n(ye(c))} instead.`);if(!ws(d,["string","array"]))throw new ze(`Expected second argument to be of type array or string, but found ${_n(ye(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(o);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class cn{constructor(o,c,d,g,v,b){this.inputType=o,this.type=c,this.input=d,this.cases=g,this.outputs=v,this.otherwise=b}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&"value"!==c.expectedType.kind&&(g=c.expectedType);const v={},b=[];for(let M=2;M<o.length-1;M+=2){let R=o[M];const L=o[M+1];Array.isArray(R)||(R=[R]);const B=c.concat(M);if(0===R.length)return B.error("Expected at least one branch label.");for(const $ of R){if("number"!=typeof $&&"string"!=typeof $)return B.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return B.error("Numeric branch labels must be integer values.");if(d){if(B.checkSubtype(d,ye($)))return null}else d=ye($);if(void 0!==v[String($)])return B.error("Branch labels must be unique.");v[String($)]=b.length}const V=c.parse(L,M,g);if(!V)return null;g=g||V.type,b.push(V)}const D=c.parse(o[1],1,It);if(!D)return null;const I=c.parse(o[o.length-1],o.length-1,g);return I?"value"!==D.type.kind&&c.concat(1).checkSubtype(d,D.type)?null:new cn(d,g,D,v,b,I):null}evaluate(o){const c=this.input.evaluate(o);return(ye(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class ad{constructor(o,c,d){this.type=o,this.branches=c,this.otherwise=d}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&"value"!==c.expectedType.kind&&(d=c.expectedType);const g=[];for(let b=1;b<o.length-1;b+=2){const D=c.parse(o[b],b,Et);if(!D)return null;const I=c.parse(o[b+1],b+1,d);if(!I)return null;g.push([D,I]),d=d||I.type}const v=c.parse(o[o.length-1],o.length-1,d);if(!v)return null;if(!d)throw new Error("Can't infer output type");return new ad(d,g,v)}evaluate(o){for(const[c,d]of this.branches)if(c.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,d]of this.branches)o(c),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Qc{constructor(o,c,d,g){this.type=o,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,It),g=c.parse(o[2],2,je);if(!d||!g)return null;if(!bs(d.type,[li(It),Ft,It]))return c.error(`Expected first argument to be of type array or string, but found ${_n(d.type)} instead`);if(4===o.length){const v=c.parse(o[3],3,je);return v?new Qc(d.type,d,g,v):null}return new Qc(d.type,d,g)}evaluate(o){const c=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!ws(c,["string","array"]))throw new ze(`Expected first argument to be of type array or string, but found ${_n(ye(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(o);return c.slice(d,g)}return c.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Th(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function ft(a,o,c,d){return 0===d.compare(o,c)}function gl(a,o,c){const d="=="!==a&&"!="!==a;return class uT{constructor(v,b,D){this.type=Et,this.lhs=v,this.rhs=b,this.collator=D,this.hasUntypedArgument="value"===v.type.kind||"value"===b.type.kind}static parse(v,b){if(3!==v.length&&4!==v.length)return b.error("Expected two or three arguments.");const D=v[0];let I=b.parse(v[1],1,It);if(!I)return null;if(!Th(D,I.type))return b.concat(1).error(`"${D}" comparisons are not supported for type '${_n(I.type)}'.`);let M=b.parse(v[2],2,It);if(!M)return null;if(!Th(D,M.type))return b.concat(2).error(`"${D}" comparisons are not supported for type '${_n(M.type)}'.`);if(I.type.kind!==M.type.kind&&"value"!==I.type.kind&&"value"!==M.type.kind)return b.error(`Cannot compare types '${_n(I.type)}' and '${_n(M.type)}'.`);d&&("value"===I.type.kind&&"value"!==M.type.kind?I=new ht(M.type,[I]):"value"!==I.type.kind&&"value"===M.type.kind&&(M=new ht(I.type,[M])));let R=null;if(4===v.length){if("string"!==I.type.kind&&"string"!==M.type.kind&&"value"!==I.type.kind&&"value"!==M.type.kind)return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(v[3],3,es),!R)return null}return new uT(I,M,R)}evaluate(v){const b=this.lhs.evaluate(v),D=this.rhs.evaluate(v);if(d&&this.hasUntypedArgument){const I=ye(b),M=ye(D);if(I.kind!==M.kind||"string"!==I.kind&&"number"!==I.kind)throw new ze(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${I.kind}, ${M.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const I=ye(b),M=ye(D);if("string"!==I.kind||"string"!==M.kind)return o(v,b,D)}return this.collator?c(v,b,D,this.collator.evaluate(v)):o(v,b,D)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const qi=gl("==",function(a,o,c){return o===c},ft),sc=gl("!=",function(a,o,c){return o!==c},function(a,o,c,d){return!ft(0,o,c,d)}),Sh=gl("<",function(a,o,c){return o<c},function(a,o,c,d){return d.compare(o,c)<0}),ld=gl(">",function(a,o,c){return o>c},function(a,o,c,d){return d.compare(o,c)>0}),Mh=gl("<=",function(a,o,c){return o<=c},function(a,o,c,d){return d.compare(o,c)<=0}),cd=gl(">=",function(a,o,c){return o>=c},function(a,o,c,d){return d.compare(o,c)>=0});class Ta{constructor(o,c,d,g,v){this.type=Ft,this.number=o,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(o,c){if(3!==o.length)return c.error("Expected two arguments.");const d=c.parse(o[1],1,je);if(!d)return null;const g=o[2];if("object"!=typeof g||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=c.parse(g.locale,1,Ft),!v))return null;let b=null;if(g.currency&&(b=c.parse(g.currency,1,Ft),!b))return null;let D=null;if(g["min-fraction-digits"]&&(D=c.parse(g["min-fraction-digits"],1,je),!D))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,je),!I)?null:new Ta(d,v,b,D,I)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Sa{constructor(o){this.type=Dr,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&"object"==typeof d)return c.error("First argument must be an image or text section.");const g=[];let v=!1;for(let b=1;b<=o.length-1;++b){const D=o[b];if(v&&"object"==typeof D&&!Array.isArray(D)){v=!1;let I=null;if(D["font-scale"]&&(I=c.parse(D["font-scale"],1,je),!I))return null;let M=null;if(D["text-font"]&&(M=c.parse(D["text-font"],1,li(Ft)),!M))return null;let R=null;if(D["text-color"]&&(R=c.parse(D["text-color"],1,kr),!R))return null;const L=g[g.length-1];L.scale=I,L.font=M,L.textColor=R}else{const I=c.parse(o[b],1,It);if(!I)return null;const M=I.type.kind;if("string"!==M&&"value"!==M&&"null"!==M&&"resolvedImage"!==M)return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new Sa(g)}evaluate(o){return new ne(this.sections.map(c=>{const d=c.content.evaluate(o);return ye(d)===or?new ie("",d,null,null,null):new ie(Ke(d),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}}class ac{constructor(o){this.type=or,this.input=o}static parse(o,c){if(2!==o.length)return c.error("Expected two arguments.");const d=c.parse(o[1],1,Ft);return d?new ac(d):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),d=oe.fromString(c);return d&&o.availableImages&&(d.available=o.availableImages.indexOf(c)>-1),d}eachChild(o){o(this.input)}outputDefined(){return!1}}class eu{constructor(o){this.type=je,this.input=o}static parse(o,c){if(2!==o.length)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=c.parse(o[1],1);return d?"array"!==d.type.kind&&"string"!==d.type.kind&&"value"!==d.type.kind?c.error(`Expected argument of type string or array, but found ${_n(d.type)} instead.`):new eu(d):null}evaluate(o){const c=this.input.evaluate(o);if("string"==typeof c||Array.isArray(c))return c.length;throw new ze(`Expected value to be of type string or array, but found ${_n(ye(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const _t={"==":qi,"!=":sc,">":ld,"<":Sh,">=":cd,"<=":Mh,array:ht,at:Jc,boolean:ht,case:ad,coalesce:oc,collator:Xn,format:Sa,image:ac,in:sd,"index-of":ui,interpolate:Gi,"interpolate-hcl":Gi,"interpolate-lab":Gi,length:eu,let:Yc,literal:st,match:cn,number:ht,"number-format":Ta,object:ht,slice:Qc,step:Ct,string:ht,"to-boolean":bt,"to-color":bt,"to-number":bt,"to-string":bt,var:Kn,within:Zs};function lc(a,[o,c,d,g]){o=o.evaluate(a),c=c.evaluate(a),d=d.evaluate(a);const v=g?g.evaluate(a):1,b=_e(o,c,d,v);if(b)throw new ze(b);return new H(o/255*v,c/255*v,d/255*v,v)}function tu(a,o){return a in o}function Fr(a,o){const c=o[a];return void 0===c?null:c}function Es(a){return{type:a}}function Ah(a){return{result:"success",value:a}}function fn(a){return{result:"error",value:a}}function On(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function Ph(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Gt(a){return!!a.expression&&a.expression.interpolated}function Zt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function In(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Tn(a){return a}function yl(a,o){const c="color"===o.type,d=a.stops&&"object"==typeof a.stops[0][0],g=d||!(d||void 0!==a.property),v=a.type||(Gt(o)?"exponential":"interval");if(c||"padding"===o.type){const M=c?H.parse:te.parse;(a=oo({},a)).stops&&(a.stops=a.stops.map(R=>[R[0],M(R[1])])),a.default=M(a.default?a.default:o.default)}if(a.colorSpace&&"rgb"!==a.colorSpace&&!Ih[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,D,I;if("exponential"===v)b=Ks;else if("interval"===v)b=ud;else if("categorical"===v){b=kh,D=Object.create(null);for(const M of a.stops)D[M[0]]=M[1];I=typeof a.stops[0][0]}else{if("identity"!==v)throw new Error(`Unknown function type "${v}"`);b=Rh}if(d){const M={},R=[];for(let V=0;V<a.stops.length;V++){const $=a.stops[V],ee=$[0].zoom;void 0===M[ee]&&(M[ee]={zoom:ee,type:a.type,property:a.property,default:a.default,stops:[]},R.push(ee)),M[ee].stops.push([$[0].value,$[1]])}const L=[];for(const V of R)L.push([M[V].zoom,yl(M[V],o)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Gi.interpolationFactor.bind(void 0,B),zoomStops:L.map(V=>V[0]),evaluate:({zoom:V},$)=>Ks({stops:L,base:a.base},o,V).evaluate(V,$)}}if(g){const M="exponential"===v?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Gi.interpolationFactor.bind(void 0,M),zoomStops:a.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(a,o,R,D,I)}}return{kind:"source",evaluate(M,R){const L=R&&R.properties?R.properties[a.property]:void 0;return void 0===L?Ma(a.default,o.default):b(a,o,L,D,I)}}}function Ma(a,o,c){return void 0!==a?a:void 0!==o?o:void 0!==c?c:void 0}function kh(a,o,c,d,g){return Ma(typeof c===g?d[c]:void 0,a.default,o.default)}function ud(a,o,c){if("number"!==Zt(c))return Ma(a.default,o.default);const d=a.stops.length;if(1===d||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[d-1][0])return a.stops[d-1][1];const g=En(a.stops.map(v=>v[0]),c);return a.stops[g][1]}function Ks(a,o,c){const d=void 0!==a.base?a.base:1;if("number"!==Zt(c))return Ma(a.default,o.default);const g=a.stops.length;if(1===g||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[g-1][0])return a.stops[g-1][1];const v=En(a.stops.map(R=>R[0]),c),b=function(R,L,B,V){const $=V-B,ee=R-B;return 0===$?0:1===L?ee/$:(Math.pow(L,ee)-1)/(Math.pow(L,$)-1)}(c,d,a.stops[v][0],a.stops[v+1][0]),D=a.stops[v][1],I=a.stops[v+1][1];let M=Ws[o.type]||Tn;if(a.colorSpace&&"rgb"!==a.colorSpace){const R=Ih[a.colorSpace];M=(L,B)=>R.reverse(R.interpolate(R.forward(L),R.forward(B),b))}return"function"==typeof D.evaluate?{evaluate(...R){const L=D.evaluate.apply(void 0,R),B=I.evaluate.apply(void 0,R);if(void 0!==L&&void 0!==B)return M(L,B,b)}}:M(D,I,b)}function Rh(a,o,c){switch(o.type){case"color":c=H.parse(c);break;case"formatted":c=ne.fromString(c.toString());break;case"resolvedImage":c=oe.fromString(c.toString());break;case"padding":c=te.parse(c);break;default:Zt(c)===o.type||"enum"===o.type&&o.values[c]||(c=void 0)}return Ma(c,a.default,o.default)}vn.register(_t,{error:[{kind:"error"},[Ft],(a,[o])=>{throw new ze(o.evaluate(a))}],typeof:[Ft,[It],(a,[o])=>_n(ye(o.evaluate(a)))],"to-rgba":[li(je,4),[kr],(a,[o])=>o.evaluate(a).toArray()],rgb:[kr,[je,je,je],lc],rgba:[kr,[je,je,je,je],lc],has:{type:Et,overloads:[[[Ft],(a,[o])=>tu(o.evaluate(a),a.properties())],[[Ft,xs],(a,[o,c])=>tu(o.evaluate(a),c.evaluate(a))]]},get:{type:It,overloads:[[[Ft],(a,[o])=>Fr(o.evaluate(a),a.properties())],[[Ft,xs],(a,[o,c])=>Fr(o.evaluate(a),c.evaluate(a))]]},"feature-state":[It,[Ft],(a,[o])=>Fr(o.evaluate(a),a.featureState||{})],properties:[xs,[],a=>a.properties()],"geometry-type":[Ft,[],a=>a.geometryType()],id:[It,[],a=>a.id()],zoom:[je,[],a=>a.globals.zoom],"heatmap-density":[je,[],a=>a.globals.heatmapDensity||0],"line-progress":[je,[],a=>a.globals.lineProgress||0],accumulated:[It,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[je,Es(je),(a,o)=>{let c=0;for(const d of o)c+=d.evaluate(a);return c}],"*":[je,Es(je),(a,o)=>{let c=1;for(const d of o)c*=d.evaluate(a);return c}],"-":{type:je,overloads:[[[je,je],(a,[o,c])=>o.evaluate(a)-c.evaluate(a)],[[je],(a,[o])=>-o.evaluate(a)]]},"/":[je,[je,je],(a,[o,c])=>o.evaluate(a)/c.evaluate(a)],"%":[je,[je,je],(a,[o,c])=>o.evaluate(a)%c.evaluate(a)],ln2:[je,[],()=>Math.LN2],pi:[je,[],()=>Math.PI],e:[je,[],()=>Math.E],"^":[je,[je,je],(a,[o,c])=>Math.pow(o.evaluate(a),c.evaluate(a))],sqrt:[je,[je],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[je,[je],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[je,[je],(a,[o])=>Math.log(o.evaluate(a))],log2:[je,[je],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[je,[je],(a,[o])=>Math.sin(o.evaluate(a))],cos:[je,[je],(a,[o])=>Math.cos(o.evaluate(a))],tan:[je,[je],(a,[o])=>Math.tan(o.evaluate(a))],asin:[je,[je],(a,[o])=>Math.asin(o.evaluate(a))],acos:[je,[je],(a,[o])=>Math.acos(o.evaluate(a))],atan:[je,[je],(a,[o])=>Math.atan(o.evaluate(a))],min:[je,Es(je),(a,o)=>Math.min(...o.map(c=>c.evaluate(a)))],max:[je,Es(je),(a,o)=>Math.max(...o.map(c=>c.evaluate(a)))],abs:[je,[je],(a,[o])=>Math.abs(o.evaluate(a))],round:[je,[je],(a,[o])=>{const c=o.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[je,[je],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[je,[je],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Et,[Ft,It],(a,[o,c])=>a.properties()[o.value]===c.value],"filter-id-==":[Et,[It],(a,[o])=>a.id()===o.value],"filter-type-==":[Et,[Ft],(a,[o])=>a.geometryType()===o.value],"filter-<":[Et,[Ft,It],(a,[o,c])=>{const d=a.properties()[o.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Et,[It],(a,[o])=>{const c=a.id(),d=o.value;return typeof c==typeof d&&c<d}],"filter->":[Et,[Ft,It],(a,[o,c])=>{const d=a.properties()[o.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[Et,[It],(a,[o])=>{const c=a.id(),d=o.value;return typeof c==typeof d&&c>d}],"filter-<=":[Et,[Ft,It],(a,[o,c])=>{const d=a.properties()[o.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Et,[It],(a,[o])=>{const c=a.id(),d=o.value;return typeof c==typeof d&&c<=d}],"filter->=":[Et,[Ft,It],(a,[o,c])=>{const d=a.properties()[o.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Et,[It],(a,[o])=>{const c=a.id(),d=o.value;return typeof c==typeof d&&c>=d}],"filter-has":[Et,[It],(a,[o])=>o.value in a.properties()],"filter-has-id":[Et,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Et,[li(Ft)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Et,[li(It)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Et,[Ft,li(It)],(a,[o,c])=>c.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Et,[Ft,li(It)],(a,[o,c])=>function(d,g,v,b){for(;v<=b;){const D=v+b>>1;if(g[D]===d)return!0;g[D]>d?b=D-1:v=D+1}return!1}(a.properties()[o.value],c.value,0,c.value.length-1)],all:{type:Et,overloads:[[[Et,Et],(a,[o,c])=>o.evaluate(a)&&c.evaluate(a)],[Es(Et),(a,o)=>{for(const c of o)if(!c.evaluate(a))return!1;return!0}]]},any:{type:Et,overloads:[[[Et,Et],(a,[o,c])=>o.evaluate(a)||c.evaluate(a)],[Es(Et),(a,o)=>{for(const c of o)if(c.evaluate(a))return!0;return!1}]]},"!":[Et,[Et],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Et,[Ft],(a,[o])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(o.evaluate(a))}],upcase:[Ft,[Ft],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Ft,[Ft],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Ft,Es(It),(a,o)=>o.map(c=>Ke(c.evaluate(a))).join("")],"resolved-locale":[Ft,[es],(a,[o])=>o.evaluate(a).resolvedLocale()]});class ao{constructor(o,c){var d;this.expression=o,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=c?"color"===(d=c).type&&In(d.default)?new H(0,0,0,0):"color"===d.type?H.parse(d.default)||null:"padding"===d.type?te.parse(d.default)||null:void 0===d.default?null:d.default:null,this._enumValues=c&&"enum"===c.type?c.values:null}evaluateWithoutErrorHandling(o,c,d,g,v,b){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(o,c,d,g,v,b){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new ze(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function _l(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in _t}function lt(a,o){const c=new Ds(_t,[],o?function(g){const v={color:kr,string:Ft,number:je,enum:Ft,boolean:Et,formatted:Dr,padding:Da,resolvedImage:or};return"array"===g.type?li(v[g.value]||It,g.length):v[g.type]}(o):void 0),d=c.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return d?Ah(new ao(d,o)):fn(c.errors)}class Aa{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent="constant"!==o&&!rn(c.expression)}evaluateWithoutErrorHandling(o,c,d,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(o,c,d,g,v,b)}evaluate(o,c,d,g,v,b){return this._styleExpression.evaluate(o,c,d,g,v,b)}}class rt{constructor(o,c,d,g){this.kind=o,this.zoomStops=d,this._styleExpression=c,this.isStateDependent="camera"!==o&&!rn(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(o,c,d,g,v,b){return this._styleExpression.evaluateWithoutErrorHandling(o,c,d,g,v,b)}evaluate(o,c,d,g,v,b){return this._styleExpression.evaluate(o,c,d,g,v,b)}interpolationFactor(o,c,d){return this.interpolationType?Gi.interpolationFactor(this.interpolationType,o,c,d):0}}function vl(a,o){const c=lt(a,o);if("error"===c.result)return c;const d=c.value.expression,g=ml(d);if(!g&&!On(o))return fn([new _i("","data expressions not supported")]);const v=Ea(d,["zoom"]);if(!v&&!Ph(o))return fn([new _i("","zoom expressions not supported")]);const b=Is(d);return b||v?b instanceof _i?fn([b]):b instanceof Gi&&!Gt(o)?fn([new _i("",'"interpolate" expressions cannot be used with this property')]):Ah(b?new rt(g?"camera":"composite",c.value,b.labels,b instanceof Gi?b.interpolation:void 0):new Aa(g?"constant":"source",c.value)):fn([new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Pa{constructor(o,c){this._parameters=o,this._specification=c,oo(this,yl(this._parameters,this._specification))}static deserialize(o){return new Pa(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Is(a){let o=null;if(a instanceof Yc)o=Is(a.result);else if(a instanceof oc){for(const c of a.args)if(o=Is(c),o)break}else(a instanceof Ct||a instanceof Gi)&&a.input instanceof vn&&"zoom"===a.input.name&&(o=a);return o instanceof _i||a.eachChild(c=>{const d=Is(c);d instanceof _i?o=d:!o&&d?o=new _i("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&d&&o!==d&&(o=new _i("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function lo(a){const o=a.key,c=a.value,d=a.valueSpec||{},g=a.objectElementValidators||{},v=a.style,b=a.styleSpec;let D=[];const I=Zt(c);if("object"!==I)return[new He(o,c,`object expected, ${I} found`)];for(const M in c){const R=M.split(".")[0],L=d[R]||d["*"];let B;if(g[R])B=g[R];else if(d[R])B=xi;else if(g["*"])B=g["*"];else{if(!d["*"]){D.push(new He(o,c[M],`unknown property "${M}"`));continue}B=xi}D=D.concat(B({key:(o&&`${o}.`)+M,value:c[M],valueSpec:L,style:v,styleSpec:b,object:c,objectKey:M},c))}for(const M in d)g[M]||d[M].required&&void 0===d[M].default&&void 0===c[M]&&D.push(new He(o,c,`missing required property "${M}"`));return D}function dd(a){const o=a.value,c=a.valueSpec,d=a.style,g=a.styleSpec,v=a.key,b=a.arrayElementValidator||xi;if("array"!==Zt(o))return[new He(v,o,`array expected, ${Zt(o)} found`)];if(c.length&&o.length!==c.length)return[new He(v,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new He(v,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let D={type:c.value,values:c.values};g.$version<7&&(D.function=c.function),"object"===Zt(c.value)&&(D=c.value);let I=[];for(let M=0;M<o.length;M++)I=I.concat(b({array:o,arrayIndex:M,value:o[M],valueSpec:D,style:d,styleSpec:g,key:`${v}[${M}]`}));return I}function nu(a){const o=a.key,c=a.value,d=a.valueSpec;let g=Zt(c);return"number"===g&&c!=c&&(g="NaN"),"number"!==g?[new He(o,c,`number expected, ${g} found`)]:"minimum"in d&&c<d.minimum?[new He(o,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new He(o,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function Mo(a){const o=a.valueSpec,c=Jt(a.value.type);let d,g,v,b={};const D="categorical"!==c&&void 0===a.value.property,I=!D,M="array"===Zt(a.value.stops)&&"array"===Zt(a.value.stops[0])&&"object"===Zt(a.value.stops[0][0]),R=lo({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(V){if("identity"===c)return[new He(V.key,V.value,'identity function may not have a "stops" property')];let $=[];const ee=V.value;return $=$.concat(dd({key:V.key,value:ee,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),"array"===Zt(ee)&&0===ee.length&&$.push(new He(V.key,ee,"array must have at least one stop")),$},default:function(V){return xi({key:V.key,value:V.value,valueSpec:o,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===c&&D&&R.push(new He(a.key,a.value,'missing required property "property"')),"identity"===c||a.value.stops||R.push(new He(a.key,a.value,'missing required property "stops"')),"exponential"===c&&a.valueSpec.expression&&!Gt(a.valueSpec)&&R.push(new He(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(I&&!On(a.valueSpec)?R.push(new He(a.key,a.value,"property functions not supported")):D&&!Ph(a.valueSpec)&&R.push(new He(a.key,a.value,"zoom functions not supported"))),"categorical"!==c&&!M||void 0!==a.value.property||R.push(new He(a.key,a.value,'"property" property is required')),R;function L(V){let $=[];const ee=V.value,K=V.key;if("array"!==Zt(ee))return[new He(K,ee,`array expected, ${Zt(ee)} found`)];if(2!==ee.length)return[new He(K,ee,`array length 2 expected, length ${ee.length} found`)];if(M){if("object"!==Zt(ee[0]))return[new He(K,ee,`object expected, ${Zt(ee[0])} found`)];if(void 0===ee[0].zoom)return[new He(K,ee,"object stop key must have zoom")];if(void 0===ee[0].value)return[new He(K,ee,"object stop key must have value")];if(v&&v>Jt(ee[0].zoom))return[new He(K,ee[0].zoom,"stop zoom values must appear in ascending order")];Jt(ee[0].zoom)!==v&&(v=Jt(ee[0].zoom),g=void 0,b={}),$=$.concat(lo({key:`${K}[0]`,value:ee[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:nu,value:B}}))}else $=$.concat(B({key:`${K}[0]`,value:ee[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},ee));return _l(mr(ee[1]))?$.concat([new He(`${K}[1]`,ee[1],"expressions are not allowed in function stops.")]):$.concat(xi({key:`${K}[1]`,value:ee[1],valueSpec:o,style:V.style,styleSpec:V.styleSpec}))}function B(V,$){const ee=Zt(V.value),K=Jt(V.value),ue=null!==V.value?V.value:$;if(d){if(ee!==d)return[new He(V.key,ue,`${ee} stop domain type must match previous stop domain type ${d}`)]}else d=ee;if("number"!==ee&&"string"!==ee&&"boolean"!==ee)return[new He(V.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==ee&&"categorical"!==c){let ge=`number expected, ${ee} found`;return On(o)&&void 0===c&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(V.key,ue,ge)]}return"categorical"!==c||"number"!==ee||isFinite(K)&&Math.floor(K)===K?"categorical"!==c&&"number"===ee&&void 0!==g&&K<g?[new He(V.key,ue,"stop domain values must appear in ascending order")]:(g=K,"categorical"===c&&K in b?[new He(V.key,ue,"stop domain values must be unique")]:(b[K]=!0,[])):[new He(V.key,ue,`integer expected, found ${K}`)]}}function qr(a){const o=("property"===a.expressionContext?vl:lt)(mr(a.value),a.valueSpec);if("error"===o.result)return o.value.map(d=>new He(`${a.key}${d.key}`,a.value,d.message));const c=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!c.outputDefined())return[new He(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!rn(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!rn(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Ea(c,["zoom","feature-state"]))return[new He(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!ml(c))return[new He(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Lr(a){const o=a.key,c=a.value,d=a.valueSpec,g=[];return Array.isArray(d.values)?-1===d.values.indexOf(Jt(c))&&g.push(new He(o,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):-1===Object.keys(d.values).indexOf(Jt(c))&&g.push(new He(o,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function vi(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!vi(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}const un={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ys(a){if(null==a)return{filter:()=>!0,needGeometry:!1};vi(a)||(a=ka(a));const o=lt(a,un);if("error"===o.result)throw new Error(o.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,g)=>o.value.evaluate(c,d,{},g),needGeometry:uc(a)}}function cc(a,o){return a<o?-1:a>o?1:0}function uc(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(uc(a[o]))return!0;return!1}function ka(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?co(a[1],a[2],"=="):"!="===o?Js(co(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?co(a[1],a[2],o):"any"===o?(c=a.slice(1),["any"].concat(c.map(ka))):"all"===o?["all"].concat(a.slice(1).map(ka)):"none"===o?["all"].concat(a.slice(1).map(ka).map(Js)):"in"===o?Ts(a[1],a.slice(2)):"!in"===o?Js(Ts(a[1],a.slice(2))):"has"===o?Ra(a[1]):"!has"===o?Js(Ra(a[1])):"within"!==o||a;var c}function co(a,o,c){switch(a){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,a,o]}}function Ts(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",a,["literal",o.sort(cc)]]:["filter-in-small",a,["literal",o]]}}function Ra(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Js(a){return["!",a]}function Qs(a){return vi(mr(a.value))?qr(oo({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ru(a)}function ru(a){const o=a.value,c=a.key;if("array"!==Zt(o))return[new He(c,o,`array expected, ${Zt(o)} found`)];const d=a.styleSpec;let g,v=[];if(o.length<1)return[new He(c,o,"filter array must have at least 1 element")];switch(v=v.concat(Lr({key:`${c}[0]`,value:o[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),Jt(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===Jt(o[1])&&v.push(new He(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&v.push(new He(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(g=Zt(o[1]),"string"!==g&&v.push(new He(`${c}[1]`,o[1],`string expected, ${g} found`)));for(let b=2;b<o.length;b++)g=Zt(o[b]),"$type"===Jt(o[1])?v=v.concat(Lr({key:`${c}[${b}]`,value:o[b],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==g&&"number"!==g&&"boolean"!==g&&v.push(new He(`${c}[${b}]`,o[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<o.length;b++)v=v.concat(ru({key:`${c}[${b}]`,value:o[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Zt(o[1]),2!==o.length?v.push(new He(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==g&&v.push(new He(`${c}[1]`,o[1],`string expected, ${g} found`));break;case"within":g=Zt(o[1]),2!==o.length?v.push(new He(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==g&&v.push(new He(`${c}[1]`,o[1],`object expected, ${g} found`))}return v}function Fa(a,o){const c=a.key,d=a.style,g=a.styleSpec,v=a.value,b=a.objectKey,D=g[`${o}_${a.layerType}`];if(!D)return[];const I=b.match(/^(.*)-transition$/);if("paint"===o&&I&&D[I[1]]&&D[I[1]].transition)return xi({key:c,value:v,valueSpec:g.transition,style:d,styleSpec:g});const M=a.valueSpec||D[b];if(!M)return[new He(c,v,`unknown property "${b}"`)];let R;if("string"===Zt(v)&&On(M)&&!M.tokens&&(R=/^{([^}]+)}$/.exec(v)))return[new He(c,v,`"${b}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const L=[];return"symbol"===a.layerType&&("text-field"===b&&d&&!d.glyphs&&L.push(new He(c,v,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&In(mr(v))&&"identity"===Jt(v.type)&&L.push(new He(c,v,'"text-font" does not support identity functions'))),L.concat(xi({key:a.key,value:v,valueSpec:M,style:d,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:b}))}function La(a){return Fa(a,"paint")}function iu(a){return Fa(a,"layout")}function ou(a){let o=[];const c=a.value,d=a.key,g=a.style,v=a.styleSpec;c.type||c.ref||o.push(new He(d,c,'either "type" or "ref" is required'));let b=Jt(c.type);const D=Jt(c.ref);if(c.id){const I=Jt(c.id);for(let M=0;M<a.arrayIndex;M++){const R=g.layers[M];Jt(R.id)===I&&o.push(new He(d,c.id,`duplicate layer id "${c.id}", previously used at line ${R.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&o.push(new He(d,c[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Jt(M.id)===D&&(I=M)}),I?I.ref?o.push(new He(d,c.ref,"ref cannot reference another ref layer")):b=Jt(I.type):o.push(new He(d,c.ref,`ref layer "${D}" not found`))}else if("background"!==b)if(c.source){const I=g.sources&&g.sources[c.source],M=I&&Jt(I.type);I?"vector"===M&&"raster"===b?o.push(new He(d,c.source,`layer "${c.id}" requires a raster source`)):"raster"===M&&"raster"!==b?o.push(new He(d,c.source,`layer "${c.id}" requires a vector source`)):"vector"!==M||c["source-layer"]?"raster-dem"===M&&"hillshade"!==b?o.push(new He(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!c.paint||!c.paint["line-gradient"]||"geojson"===M&&I.lineMetrics||o.push(new He(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new He(d,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new He(d,c.source,`source "${c.source}" not found`))}else o.push(new He(d,c,'missing required property "source"'));return o=o.concat(lo({key:d,value:c,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xi({key:`${d}.type`,value:c.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"}),filter:Qs,layout:I=>lo({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":M=>iu(oo({layerType:b},M))}}),paint:I=>lo({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":M=>La(oo({layerType:b},M))}})}})),o}function Oa(a){const o=a.value,c=a.key,d=Zt(o);return"string"!==d?[new He(c,o,`string expected, ${d} found`)]:[]}const su={promoteId:function({key:a,value:o}){if("string"===Zt(o))return Oa({key:a,value:o});{const c=[];for(const d in o)c.push(...Oa({key:`${a}.${d}`,value:o[d]}));return c}}};function xl(a){const o=a.value,c=a.key,d=a.styleSpec,g=a.style;if(!o.type)return[new He(c,o,'"type" is required')];const v=Jt(o.type);let b;switch(v){case"vector":case"raster":case"raster-dem":return b=lo({key:c,value:o,valueSpec:d[`source_${v.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:su}),b;case"geojson":if(b=lo({key:c,value:o,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:su}),o.cluster)for(const D in o.clusterProperties){const[I,M]=o.clusterProperties[D],R="string"==typeof I?[I,["accumulated"],["get",D]]:I;b.push(...qr({key:`${c}.${D}.map`,value:M,expressionContext:"cluster-map"})),b.push(...qr({key:`${c}.${D}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return b;case"video":return lo({key:c,value:o,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return lo({key:c,value:o,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new He(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lr({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function bl(a){const o=a.value,c=a.styleSpec,d=c.light,g=a.style;let v=[];const b=Zt(o);if(void 0===o)return v;if("object"!==b)return v=v.concat([new He("light",o,`object expected, ${b} found`)]),v;for(const D in o){const I=D.match(/^(.*)-transition$/);v=v.concat(I&&d[I[1]]&&d[I[1]].transition?xi({key:D,value:o[D],valueSpec:c.transition,style:g,styleSpec:c}):d[D]?xi({key:D,value:o[D],valueSpec:d[D],style:g,styleSpec:c}):[new He(D,o[D],`unknown property "${D}"`)])}return v}function Hn(a){const o=a.value,c=a.styleSpec,d=c.terrain,g=a.style;let v=[];const b=Zt(o);if(void 0===o)return v;if("object"!==b)return v=v.concat([new He("terrain",o,`object expected, ${b} found`)]),v;for(const D in o)v=v.concat(d[D]?xi({key:D,value:o[D],valueSpec:d[D],style:g,styleSpec:c}):[new He(D,o[D],`unknown property "${D}"`)]);return v}const wl={"*":()=>[],array:dd,boolean:function(a){const o=a.value,c=a.key,d=Zt(o);return"boolean"!==d?[new He(c,o,`boolean expected, ${d} found`)]:[]},number:nu,color:function(a){const o=a.key,c=a.value,d=Zt(c);return"string"!==d?[new He(o,c,`color expected, ${d} found`)]:null===Gs(c)?[new He(o,c,`color expected, "${c}" found`)]:[]},constants:Hs,enum:Lr,filter:Qs,function:Mo,layer:ou,object:lo,source:xl,light:bl,terrain:Hn,string:Oa,formatted:function(a){return 0===Oa(a).length?[]:qr(a)},resolvedImage:function(a){return 0===Oa(a).length?[]:qr(a)},padding:function(a){const o=a.key,c=a.value;if("array"===Zt(c)){if(c.length<1||c.length>4)return[new He(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let g=[];for(let v=0;v<c.length;v++)g=g.concat(xi({key:`${o}[${v}]`,value:c[v],valueSpec:d}));return g}return nu({key:o,value:c,valueSpec:{}})}};function xi(a){const o=a.value,c=a.valueSpec,d=a.styleSpec;return c.expression&&In(Jt(o))?Mo(a):c.expression&&_l(mr(o))?qr(a):c.type&&wl[c.type]?wl[c.type](a):lo(oo({},a,{valueSpec:c.type?d[c.type]:c}))}function Fh(a){const o=a.value,c=a.key,d=Oa(a);return d.length||(-1===o.indexOf("{fontstack}")&&d.push(new He(c,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&d.push(new He(c,o,'"glyphs" url must include a "{range}" token'))),d}function Ss(a,o=we){let c=[];return c=c.concat(xi({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:Fh,"*":()=>[]}})),a.constants&&(c=c.concat(Hs({key:"constants",value:a.constants,style:a,styleSpec:o}))),hd(c)}function hd(a){return[].concat(a).sort((o,c)=>o.line-c.line)}function ts(a){return function(...o){return hd(a.apply(this,o))}}Ss.source=ts(xl),Ss.light=ts(bl),Ss.terrain=ts(Hn),Ss.layer=ts(ou),Ss.filter=ts(Qs),Ss.paintProperty=ts(La),Ss.layoutProperty=ts(iu);const Na=Ss,au=Na.light,Lh=Na.paintProperty,Oh=Na.layoutProperty;function sr(a,o){let c=!1;if(o&&o.length)for(const d of o)a.fire(new vs(new Error(d.message))),c=!0;return c}class Cl{constructor(o,c,d){const g=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const b=new Int32Array(this.arrayBuffer);o=b[0],this.d=(c=b[1])+2*(d=b[2]);for(let I=0;I<this.d*this.d;I++){const M=b[3+I],R=b[3+I+1];g.push(M===R?null:b.subarray(M,R))}const D=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],D),this.bboxes=b.subarray(D),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=d,this.scale=c/o,this.uid=0;const v=d/c*o;this.min=-v,this.max=o+v}insert(o,c,d,g,v){this._forEachCell(c,d,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,d,g,v,b){this.cells[v].push(b)}query(o,c,d,g,v){const b=this.min,D=this.max;if(o<=b&&c<=b&&D<=d&&D<=g&&!v)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(o,c,d,g,this._queryCell,I,{},v),I}}_queryCell(o,c,d,g,v,b,D,I){const M=this.cells[v];if(null!==M){const R=this.keys,L=this.bboxes;for(let B=0;B<M.length;B++){const V=M[B];if(void 0===D[V]){const $=4*V;(I?I(L[$+0],L[$+1],L[$+2],L[$+3]):o<=L[$+2]&&c<=L[$+3]&&d>=L[$+0]&&g>=L[$+1])?(D[V]=!0,b.push(R[V])):D[V]=!1}}}}_forEachCell(o,c,d,g,v,b,D,I){const M=this._convertToCellCoord(o),R=this._convertToCellCoord(c),L=this._convertToCellCoord(d),B=this._convertToCellCoord(g);for(let V=M;V<=L;V++)for(let $=R;$<=B;$++){const ee=this.d*$+V;if((!I||I(this._convertFromCellCoord(V),this._convertFromCellCoord($),this._convertFromCellCoord(V+1),this._convertFromCellCoord($+1)))&&v.call(this,o,c,d,g,ee,b,D,I))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let d=0;for(let b=0;b<this.cells.length;b++)d+=this.cells[b].length;const g=new Int32Array(c+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=c;for(let b=0;b<o.length;b++){const D=o[b];g[3+b]=v,g.set(D,v),v+=D.length}return g[3+o.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+o.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(o,c){const d=o.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(o){return new Cl(o.buffer)}}const ns={};function et(a,o,c={}){if(ns[a])throw new Error(`${a} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:a,writeable:!1}),ns[a]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}et("Object",Object),et("TransferableGridIndex",Cl),et("Color",H),et("Error",Error),et("AJAXError",ai),et("ResolvedImage",oe),et("StylePropertyFunction",Pa),et("StyleExpression",ao,{omit:["_evaluator"]}),et("ZoomDependentExpression",rt),et("ZoomConstantExpression",Aa),et("CompoundExpression",vn,{omit:["_evaluate"]});for(const a in _t)_t[a]._classRegistryKey||et(`Expression_${a}`,_t[a]);function Zi(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function ea(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(Zi(a)||Eo(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const c=a;return o&&o.push(c.buffer),c}if(a instanceof ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const c=[];for(const d of a)c.push(ea(d,o));return c}if("object"==typeof a){const c=a.constructor,d=c._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!ns[d])throw new Error(`${d} is not registered.`);const g=c.serialize?c.serialize(a,o):{};if(c.serialize){if(o&&g===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in a){if(!a.hasOwnProperty(v)||ns[d].omit.indexOf(v)>=0)continue;const b=a[v];g[v]=ns[d].shallow.indexOf(v)>=0?b:ea(b,o)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==d&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof a)}function rs(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||Zi(a)||Eo(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(rs);if("object"==typeof a){const o=a.$name||"Object";if(!ns[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=ns[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(a);const d=Object.create(c.prototype);for(const g of Object.keys(a)){if("$name"===g)continue;const v=a[g];d[g]=ns[o].shallow.indexOf(g)>=0?v:rs(v)}return d}throw new Error("can't deserialize object of type "+typeof a)}class Tt{constructor(){this.first=!0}update(o,c){const d=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=d,!0))}}const Be={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function on(a){for(const o of a)if(Ms(o.charCodeAt(0)))return!0;return!1}function Zr(a){for(const o of a)if(!Wr(o.charCodeAt(0)))return!1;return!0}function Wr(a){return!(Be.Arabic(a)||Be["Arabic Supplement"](a)||Be["Arabic Extended-A"](a)||Be["Arabic Presentation Forms-A"](a)||Be["Arabic Presentation Forms-B"](a))}function Ms(a){return!(746!==a&&747!==a&&(a<4352||!(Be["Bopomofo Extended"](a)||Be.Bopomofo(a)||Be["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Be["CJK Compatibility Ideographs"](a)||Be["CJK Compatibility"](a)||Be["CJK Radicals Supplement"](a)||Be["CJK Strokes"](a)||!(!Be["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Be["CJK Unified Ideographs Extension A"](a)||Be["CJK Unified Ideographs"](a)||Be["Enclosed CJK Letters and Months"](a)||Be["Hangul Compatibility Jamo"](a)||Be["Hangul Jamo Extended-A"](a)||Be["Hangul Jamo Extended-B"](a)||Be["Hangul Jamo"](a)||Be["Hangul Syllables"](a)||Be.Hiragana(a)||Be["Ideographic Description Characters"](a)||Be.Kanbun(a)||Be["Kangxi Radicals"](a)||Be["Katakana Phonetic Extensions"](a)||Be.Katakana(a)&&12540!==a||!(!Be["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Be["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Be["Unified Canadian Aboriginal Syllabics"](a)||Be["Unified Canadian Aboriginal Syllabics Extended"](a)||Be["Vertical Forms"](a)||Be["Yijing Hexagram Symbols"](a)||Be["Yi Syllables"](a)||Be["Yi Radicals"](a))))}function bi(a){return!(Ms(a)||(o=a,Be["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Be["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Be["Letterlike Symbols"](o)||Be["Number Forms"](o)||Be["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Be["Control Pictures"](o)&&9251!==o||Be["Optical Character Recognition"](o)||Be["Enclosed Alphanumerics"](o)||Be["Geometric Shapes"](o)||Be["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Be["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Be["CJK Symbols and Punctuation"](o)||Be.Katakana(o)||Be["Private Use Area"](o)||Be["CJK Compatibility Forms"](o)||Be["Small Form Variants"](o)||Be["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function lu(a){return a>=1424&&a<=2303||Be["Arabic Presentation Forms-A"](a)||Be["Arabic Presentation Forms-B"](a)}function pd(a,o){return!(!o&&lu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Be.Khmer(a))}function Dl(a){for(const o of a)if(lu(o.charCodeAt(0)))return!0;return!1}const cu="deferred",uu="loading",tr="loaded";let tt=null,vt="unavailable",bn=null;const Wi=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(vt="error"),tt&&tt(a)};function Xi(){Er.fire(new Yo("pluginStateChange",{pluginStatus:vt,pluginURL:bn}))}const Er=new Jo,Ao=function(){return vt},Gn=function(){if(vt!==cu||!bn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vt=uu,Xi(),bn&&Ca({url:bn},a=>{a?Wi(a):(vt=tr,Xi())})},Or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vt===tr||null!=Or.applyArabicShaping,isLoading:()=>vt===uu,setState(a){if(!Vi())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");vt=a.pluginStatus,bn=a.pluginURL},isParsed(){if(!Vi())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=Or.applyArabicShaping&&null!=Or.processBidirectionalText&&null!=Or.processStyledBidirectionalText},getPluginURL(){if(!Vi())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return bn}};class mn{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Tt,this.transition={})}isSupportedScript(o){return function(c,d){for(const g of c)if(!pd(g.charCodeAt(0),d))return!1;return!0}(o,Or.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),d=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class St{constructor(o,c){this.property=o,this.value=c,this.expression=function(d,g){if(In(d))return new Pa(d,g);if(_l(d)){const v=vl(d,g);if("error"===v.result)throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=d;return"color"===g.type&&"string"==typeof d?v=H.parse(d):"padding"!==g.type||"number"!=typeof d&&!Array.isArray(d)||(v=te.parse(d)),{kind:"constant",evaluate:()=>v}}}(void 0===c?o.specification.default:c,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,c,d){return this.property.possiblyEvaluate(this,o,c,d)}}class As{constructor(o){this.property=o,this.value=new St(o,void 0)}transitioned(o,c){return new ta(this.property,this.value,c,Bi({},o.transition,this.transition),o.now)}untransitioned(){return new ta(this.property,this.value,null,{},0)}}class du{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return si(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new As(this._values[o].property)),this._values[o].value=new St(this._values[o].property,null===c?void 0:si(c))}getTransition(o){return si(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new As(this._values[o].property)),this._values[o].transition=si(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const d=this.getValue(c);void 0!==d&&(o[c]=d);const g=this.getTransition(c);void 0!==g&&(o[`${c}-transition`]=g)}return o}transitioned(o,c){const d=new nr(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(o,c._values[g]);return d}untransitioned(){const o=new nr(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class ta{constructor(o,c,d,g,v){this.property=o,this.value=c,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,o.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(o,c,d){const g=o.now||0,v=this.value.possiblyEvaluate(o,c,d),b=this.prior;if(b){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return b.possiblyEvaluate(o,c,d);{const D=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,c,d),v,function(I){if(I<=0)return 0;if(I>=1)return 1;const M=I*I,R=M*I;return 4*(I<.5?R:3*(I-M)+R-.75)}(D))}}return v}}class nr{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,d){const g=new wi(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(o,c,d);return g}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class El{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return si(this._values[o].value)}setValue(o,c){this._values[o]=new St(this._values[o].property,null===c?void 0:si(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const d=this.getValue(c);void 0!==d&&(o[c]=d)}return o}possiblyEvaluate(o,c,d){const g=new wi(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(o,c,d);return g}}class di{constructor(o,c,d){this.property=o,this.value=c,this.parameters=d}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,c,d,g){return this.property.evaluate(this.value,this.parameters,o,c,d,g)}}class wi{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class it{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,d){const g=Ws[this.specification.type];return g?g(o,c,d):o}}class gt{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,d,g){return new di(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(c,null,{},d,g)}:o.expression,c)}interpolate(o,c,d){if("constant"!==o.value.kind||"constant"!==c.value.kind)return o;if(void 0===o.value.value||void 0===c.value.value)return new di(this,{kind:"constant",value:void 0},o.parameters);const g=Ws[this.specification.type];return g?new di(this,{kind:"constant",value:g(o.value.value,c.value.value,d)},o.parameters):o}evaluate(o,c,d,g,v,b){return"constant"===o.kind?o.value:o.evaluate(c,d,g,v,b)}}class Pi extends gt{possiblyEvaluate(o,c,d,g){if(void 0===o.value)return new di(this,{kind:"constant",value:void 0},c);if("constant"===o.expression.kind){const v=o.expression.evaluate(c,null,{},d,g),b="resolvedImage"===o.property.specification.type&&"string"!=typeof v?v.name:v,D=this._calculate(b,b,b,c);return new di(this,{kind:"constant",value:D},c)}if("camera"===o.expression.kind){const v=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new di(this,{kind:"constant",value:v},c)}return new di(this,o.expression,c)}evaluate(o,c,d,g,v,b){if("source"===o.kind){const D=o.evaluate(c,d,g,v,b);return this._calculate(D,D,D,c)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},d,g),o.evaluate({zoom:Math.floor(c.zoom)},d,g),o.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):o.value}_calculate(o,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:d,to:c}}interpolate(o){return o}}class uo{constructor(o){this.specification=o}possiblyEvaluate(o,c,d,g){if(void 0!==o.value){if("constant"===o.expression.kind){const v=o.expression.evaluate(c,null,{},d,g);return this._calculate(v,v,v,c)}return this._calculate(o.expression.evaluate(new mn(Math.floor(c.zoom-1),c)),o.expression.evaluate(new mn(Math.floor(c.zoom),c)),o.expression.evaluate(new mn(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:d,to:c}}interpolate(o){return o}}class ho{constructor(o){this.specification=o}possiblyEvaluate(o,c,d,g){return!!o.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class ar{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const d=o[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new St(d,void 0),v=this.defaultTransitionablePropertyValues[c]=new As(d);this.defaultTransitioningPropertyValues[c]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}et("DataDrivenProperty",gt),et("DataConstantProperty",it),et("CrossFadedDataDrivenProperty",Pi),et("CrossFadedProperty",uo),et("ColorRampProperty",ho);const Ot="-transition";class is extends Jo{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new El(c.layout)),c.paint)){this._transitionablePaint=new du(c.paint);for(const d in o.paint)this.setPaintProperty(d,o.paint[d],{validate:!1});for(const d in o.layout)this.setLayoutProperty(d,o.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wi(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,d={}){null!=c&&this._validate(Oh,`layers.${this.id}.layout.${o}`,o,c,d)||("visibility"!==o?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith(Ot)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,d={}){if(null!=c&&this._validate(Lh,`layers.${this.id}.paint.${o}`,o,c,d))return!1;if(o.endsWith(Ot))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[o],v="cross-faded-data-driven"===g.property.specification["property-type"],b=g.value.isDataDriven(),D=g.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const I=this._transitionablePaint._values[o].value;return I.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(o,D,I)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),qo(o,(c,d)=>!(void 0===c||"layout"===d&&!Object.keys(c).length||"paint"===d&&!Object.keys(c).length))}_validate(o,c,d,g,v={}){return(!v||!1!==v.validate)&&sr(this,o.call(Na,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof di&&On(c.property.specification)&&("source"===c.value.kind||"composite"===c.value.kind)&&c.value.isStateDependent)return!0}return!1}}const dc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class os{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qn(a,o=1){let c=0,d=0;return{members:a.map(g=>{const v=dc[g.type].BYTES_PER_ELEMENT,b=c=Ps(c,Math.max(o,v)),D=g.components||1;return d=Math.max(d,v),c+=v*D,{name:g.name,type:g.type,components:D,offset:b}}),size:Ps(c,Math.max(d,o)),alignment:o}}function Ps(a,o){return Math.ceil(a/o)*o}class po extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const d=this.length;return this.resize(d+1),this.emplace(d,o,c)}emplace(o,c,d){const g=2*o;return this.int16[g+0]=c,this.int16[g+1]=d,o}}po.prototype.bytesPerElement=4,et("StructArrayLayout2i4",po);class m extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,d,g)}emplace(o,c,d,g,v){const b=4*o;return this.int16[b+0]=c,this.int16[b+1]=d,this.int16[b+2]=g,this.int16[b+3]=v,o}}m.prototype.bytesPerElement=8,et("StructArrayLayout4i8",m);class s extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,d,g,v,b)}emplace(o,c,d,g,v,b,D){const I=6*o;return this.int16[I+0]=c,this.int16[I+1]=d,this.int16[I+2]=g,this.int16[I+3]=v,this.int16[I+4]=b,this.int16[I+5]=D,o}}s.prototype.bytesPerElement=12,et("StructArrayLayout2i4i12",s);class u extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,d,g,v,b)}emplace(o,c,d,g,v,b,D){const I=4*o,M=8*o;return this.int16[I+0]=c,this.int16[I+1]=d,this.uint8[M+4]=g,this.uint8[M+5]=v,this.uint8[M+6]=b,this.uint8[M+7]=D,o}}u.prototype.bytesPerElement=8,et("StructArrayLayout2i4ub8",u);class p extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const d=this.length;return this.resize(d+1),this.emplace(d,o,c)}emplace(o,c,d){const g=2*o;return this.float32[g+0]=c,this.float32[g+1]=d,o}}p.prototype.bytesPerElement=8,et("StructArrayLayout2f8",p);class y extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b,D,I,M,R){const L=this.length;return this.resize(L+1),this.emplace(L,o,c,d,g,v,b,D,I,M,R)}emplace(o,c,d,g,v,b,D,I,M,R,L){const B=10*o;return this.uint16[B+0]=c,this.uint16[B+1]=d,this.uint16[B+2]=g,this.uint16[B+3]=v,this.uint16[B+4]=b,this.uint16[B+5]=D,this.uint16[B+6]=I,this.uint16[B+7]=M,this.uint16[B+8]=R,this.uint16[B+9]=L,o}}y.prototype.bytesPerElement=20,et("StructArrayLayout10ui20",y);class x extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b,D,I,M,R,L,B){const V=this.length;return this.resize(V+1),this.emplace(V,o,c,d,g,v,b,D,I,M,R,L,B)}emplace(o,c,d,g,v,b,D,I,M,R,L,B,V){const $=12*o;return this.int16[$+0]=c,this.int16[$+1]=d,this.int16[$+2]=g,this.int16[$+3]=v,this.uint16[$+4]=b,this.uint16[$+5]=D,this.uint16[$+6]=I,this.uint16[$+7]=M,this.int16[$+8]=R,this.int16[$+9]=L,this.int16[$+10]=B,this.int16[$+11]=V,o}}x.prototype.bytesPerElement=24,et("StructArrayLayout4i4ui4i24",x);class C extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,d)}emplace(o,c,d,g){const v=3*o;return this.float32[v+0]=c,this.float32[v+1]=d,this.float32[v+2]=g,o}}C.prototype.bytesPerElement=12,et("StructArrayLayout3f12",C);class T extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}T.prototype.bytesPerElement=4,et("StructArrayLayout1ul4",T);class S extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b,D,I,M){const R=this.length;return this.resize(R+1),this.emplace(R,o,c,d,g,v,b,D,I,M)}emplace(o,c,d,g,v,b,D,I,M,R){const L=10*o,B=5*o;return this.int16[L+0]=c,this.int16[L+1]=d,this.int16[L+2]=g,this.int16[L+3]=v,this.int16[L+4]=b,this.int16[L+5]=D,this.uint32[B+3]=I,this.uint16[L+8]=M,this.uint16[L+9]=R,o}}S.prototype.bytesPerElement=20,et("StructArrayLayout6i1ul2ui20",S);class A extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b){const D=this.length;return this.resize(D+1),this.emplace(D,o,c,d,g,v,b)}emplace(o,c,d,g,v,b,D){const I=6*o;return this.int16[I+0]=c,this.int16[I+1]=d,this.int16[I+2]=g,this.int16[I+3]=v,this.int16[I+4]=b,this.int16[I+5]=D,o}}A.prototype.bytesPerElement=12,et("StructArrayLayout2i2i2i12",A);class F extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,d,g,v)}emplace(o,c,d,g,v,b){const D=4*o,I=8*o;return this.float32[D+0]=c,this.float32[D+1]=d,this.float32[D+2]=g,this.int16[I+6]=v,this.int16[I+7]=b,o}}F.prototype.bytesPerElement=16,et("StructArrayLayout2f1f2i16",F);class z extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,d,g)}emplace(o,c,d,g,v){const b=12*o,D=3*o;return this.uint8[b+0]=c,this.uint8[b+1]=d,this.float32[D+1]=g,this.float32[D+2]=v,o}}z.prototype.bytesPerElement=12,et("StructArrayLayout2ub2f12",z);class U extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,d)}emplace(o,c,d,g){const v=3*o;return this.uint16[v+0]=c,this.uint16[v+1]=d,this.uint16[v+2]=g,o}}U.prototype.bytesPerElement=6,et("StructArrayLayout3ui6",U);class X extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee,K,ue){const ge=this.length;return this.resize(ge+1),this.emplace(ge,o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee,K,ue)}emplace(o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee,K,ue,ge){const ae=24*o,fe=12*o,Se=48*o;return this.int16[ae+0]=c,this.int16[ae+1]=d,this.uint16[ae+2]=g,this.uint16[ae+3]=v,this.uint32[fe+2]=b,this.uint32[fe+3]=D,this.uint32[fe+4]=I,this.uint16[ae+10]=M,this.uint16[ae+11]=R,this.uint16[ae+12]=L,this.float32[fe+7]=B,this.float32[fe+8]=V,this.uint8[Se+36]=$,this.uint8[Se+37]=ee,this.uint8[Se+38]=K,this.uint32[fe+10]=ue,this.int16[ae+22]=ge,o}}X.prototype.bytesPerElement=48,et("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",X);class q extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee,K,ue,ge,ae,fe,Se,Te,Je,ot,qe,$e,Ve,We){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee,K,ue,ge,ae,fe,Se,Te,Je,ot,qe,$e,Ve,We)}emplace(o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee,K,ue,ge,ae,fe,Se,Te,Je,ot,qe,$e,Ve,We,Ge){const Oe=34*o,pt=17*o;return this.int16[Oe+0]=c,this.int16[Oe+1]=d,this.int16[Oe+2]=g,this.int16[Oe+3]=v,this.int16[Oe+4]=b,this.int16[Oe+5]=D,this.int16[Oe+6]=I,this.int16[Oe+7]=M,this.uint16[Oe+8]=R,this.uint16[Oe+9]=L,this.uint16[Oe+10]=B,this.uint16[Oe+11]=V,this.uint16[Oe+12]=$,this.uint16[Oe+13]=ee,this.uint16[Oe+14]=K,this.uint16[Oe+15]=ue,this.uint16[Oe+16]=ge,this.uint16[Oe+17]=ae,this.uint16[Oe+18]=fe,this.uint16[Oe+19]=Se,this.uint16[Oe+20]=Te,this.uint16[Oe+21]=Je,this.uint16[Oe+22]=ot,this.uint32[pt+12]=qe,this.float32[pt+13]=$e,this.float32[pt+14]=Ve,this.float32[pt+15]=We,this.float32[pt+16]=Ge,o}}q.prototype.bytesPerElement=68,et("StructArrayLayout8i15ui1ul4f68",q);class W extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}W.prototype.bytesPerElement=4,et("StructArrayLayout1f4",W);class re extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,d)}emplace(o,c,d,g){const v=3*o;return this.int16[v+0]=c,this.int16[v+1]=d,this.int16[v+2]=g,o}}re.prototype.bytesPerElement=6,et("StructArrayLayout3i6",re);class se extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,d)}emplace(o,c,d,g){const v=4*o;return this.uint32[2*o+0]=c,this.uint16[v+2]=d,this.uint16[v+3]=g,o}}se.prototype.bytesPerElement=8,et("StructArrayLayout1ul2ui8",se);class de extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const d=this.length;return this.resize(d+1),this.emplace(d,o,c)}emplace(o,c,d){const g=2*o;return this.uint16[g+0]=c,this.uint16[g+1]=d,o}}de.prototype.bytesPerElement=4,et("StructArrayLayout2ui4",de);class Y extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}Y.prototype.bytesPerElement=2,et("StructArrayLayout1ui2",Y);class me extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,o,c,d,g)}emplace(o,c,d,g,v){const b=4*o;return this.float32[b+0]=c,this.float32[b+1]=d,this.float32[b+2]=g,this.float32[b+3]=v,o}}me.prototype.bytesPerElement=16,et("StructArrayLayout4f16",me);class pe extends os{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new xt(this.anchorPointX,this.anchorPointY)}}pe.prototype.size=20;class Ce extends S{get(o){return new pe(this,o)}}et("CollisionBoxArray",Ce);class De extends os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}De.prototype.size=48;class Fe extends X{get(o){return new De(this,o)}}et("PlacedSymbolArray",Fe);class ve extends os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ve.prototype.size=68;class Xe extends q{get(o){return new ve(this,o)}}et("SymbolInstanceArray",Xe);class Ue extends W{getoffsetX(o){return this.float32[1*o+0]}}et("GlyphOffsetArray",Ue);class Qe extends re{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}et("SymbolLineVertexArray",Qe);class Pt extends os{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Pt.prototype.size=8;class Bt extends se{get(o){return new Pt(this,o)}}et("FeatureIndexArray",Bt);class ct extends po{}class dn extends po{}class wn extends po{}class jt extends s{}class Wt extends u{}class Cn extends p{}class Ir extends y{}class Po extends x{}class ko extends C{}class Ro extends T{}class Nr extends A{}class hi extends z{}class yn extends U{}class Fo extends de{}const hu=qn([{name:"a_pos",components:2,type:"Int16"}],4),{members:rr}=hu;class Nt{constructor(o=[]){this.segments=o}prepareSegment(o,c,d,g){let v=this.segments[this.segments.length-1];return o>Nt.MAX_VERTEX_ARRAY_LENGTH&&jn(`Max vertices per segment is ${Nt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!v||v.vertexLength+o>Nt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},void 0!==g&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,d,g){return new Nt([{vertexOffset:o,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function en(a,o){return 256*(a=be(Math.floor(a),0,255))+be(Math.floor(o),0,255)}Nt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,et("SegmentVector",Nt);const Tr=qn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var zr={exports:{}},na=function(a,o){var c,d,g,v,b,D,I,M;for(d=a.length-(c=3&a.length),g=o,b=3432918353,D=461845907,M=0;M<d;)I=255&a.charCodeAt(M)|(255&a.charCodeAt(++M))<<8|(255&a.charCodeAt(++M))<<16|(255&a.charCodeAt(++M))<<24,++M,g=27492+(65535&(v=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*D+(((I>>>16)*D&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&a.charCodeAt(M+2))<<16;case 2:I^=(255&a.charCodeAt(M+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&a.charCodeAt(M)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*D+(((I>>>16)*D&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0},za=function(a,o){for(var c,d=a.length,g=o^d,v=0;d>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++v;switch(d){case 3:g^=(255&a.charCodeAt(v+2))<<16;case 2:g^=(255&a.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};zr.exports=na,zr.exports.murmur3=na,zr.exports.murmur2=za;class Ba{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,d,g){this.ids.push(Nh(o)),this.positions.push(c,d,g)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Nh(o);let d=0,g=this.ids.length-1;for(;d<g;){const b=d+g>>1;this.ids[b]>=c?g=b:d=b+1}const v=[];for(;this.ids[d]===c;)v.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return v}static serialize(o,c){const d=new Float64Array(o.ids),g=new Uint32Array(o.positions);return fd(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(o){const c=new Ba;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function Nh(a){const o=+a;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:zr.exports(String(a))}function fd(a,o,c,d){for(;c<d;){const g=a[c+d>>1];let v=c-1,b=d+1;for(;;){do{v++}while(a[v]<g);do{b--}while(a[b]>g);if(v>=b)break;ss(a,v,b),ss(o,3*v,3*b),ss(o,3*v+1,3*b+1),ss(o,3*v+2,3*b+2)}b-c<d-b?(fd(a,o,c,b),c=b+1):(fd(a,o,b+1,d),d=b)}}function ss(a,o,c){const d=a[o];a[o]=a[c],a[c]=d}et("FeaturePositionMap",Ba);class ks{constructor(o,c){this.gl=o.gl,this.location=c}}class ra extends ks{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class hc extends ks{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class fo extends ks{constructor(o,c){super(o,c),this.current=H.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Lf=new Float32Array(16);function zh(a){return[en(255*a.r,255*a.g),en(255*a.b,255*a.a)]}class pu{constructor(o,c,d){this.value=o,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(o,c,d){o.set(d.constantOr(this.value))}getBinding(o,c,d){return"color"===this.type?new fo(o,c):new ra(o,c)}}class Il{constructor(o,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,d,g){const v="u_pattern_to"===g?this.patternTo:"u_pattern_from"===g?this.patternFrom:"u_pixel_ratio_to"===g?this.pixelRatioTo:"u_pixel_ratio_from"===g?this.pixelRatioFrom:null;v&&o.set(v)}getBinding(o,c,d){return"u_pattern"===d.substr(0,9)?new hc(o,c):new ra(o,c)}}class Rs{constructor(o,c,d,g){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===d?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(o,c,d,g,v){const b=this.paintVertexArray.length,D=this.expression.evaluate(new mn(0),c,{},g,[],v);this.paintVertexArray.resize(o),this._setPaintValue(b,o,D)}updatePaintArray(o,c,d,g){const v=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(o,c,v)}_setPaintValue(o,c,d){if("color"===this.type){const g=zh(d);for(let v=o;v<c;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=o;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class as{constructor(o,c,d,g,v,b){this.expression=o,this.uniformNames=c.map(D=>`u_${D}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=c.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===d?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,c,d,g,v){const b=this.expression.evaluate(new mn(this.zoom),c,{},g,[],v),D=this.expression.evaluate(new mn(this.zoom+1),c,{},g,[],v),I=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(I,o,b,D)}updatePaintArray(o,c,d,g){const v=this.expression.evaluate({zoom:this.zoom},d,g),b=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(o,c,v,b)}_setPaintValue(o,c,d,g){if("color"===this.type){const v=zh(d),b=zh(g);for(let D=o;D<c;D++)this.paintVertexArray.emplace(D,v[0],v[1],b[0],b[1])}else{for(let v=o;v<c;v++)this.paintVertexArray.emplace(v,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=be(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);o.set(g)}getBinding(o,c,d){return new ra(o,c)}}class Fs{constructor(o,c,d,g,v,b){this.expression=o,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(o,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(g,o,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(o,c,d,g,v){this._setPaintValues(o,c,d.patterns&&d.patterns[this.layerId],v)}_setPaintValues(o,c,d,g){if(!g||!d)return;const{min:v,mid:b,max:D}=d,I=g[v],M=g[b],R=g[D];if(I&&M&&R)for(let L=o;L<c;L++)this.zoomInPaintVertexArray.emplace(L,M.tl[0],M.tl[1],M.br[0],M.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],M.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,M.tl[0],M.tl[1],M.br[0],M.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],M.pixelRatio,R.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Tr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Tr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Of{constructor(o,c,d){this.binders={},this._buffers=[];const g=[];for(const v in o.paint._values){if(!d(v))continue;const b=o.paint.get(v);if(!(b instanceof di&&On(b.property.specification)))continue;const D=Nf(v,o.type),I=b.value,M=b.property.specification.type,R=b.property.useIntegerZoom,L=b.property.specification["property-type"],B="cross-faded"===L||"cross-faded-data-driven"===L;if("constant"===I.kind)this.binders[v]=B?new Il(I.value,D):new pu(I.value,D,M),g.push(`/u_${v}`);else if("source"===I.kind||B){const V=Bh(v,M,"source");this.binders[v]=B?new Fs(I,M,R,c,V,o.id):new Rs(I,D,M,V),g.push(`/a_${v}`)}else{const V=Bh(v,M,"composite");this.binders[v]=new as(I,D,M,R,c,V),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof Rs||c instanceof as?c.maxValue:0}populatePaintArrays(o,c,d,g,v){for(const b in this.binders){const D=this.binders[b];(D instanceof Rs||D instanceof as||D instanceof Fs)&&D.populatePaintArray(o,c,d,g,v)}}setConstantPatternPositions(o,c){for(const d in this.binders){const g=this.binders[d];g instanceof Il&&g.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,d,g,v){let b=!1;for(const D in o){const I=c.getPositions(D);for(const M of I){const R=d.feature(M.index);for(const L in this.binders){const B=this.binders[L];if((B instanceof Rs||B instanceof as||B instanceof Fs)&&!0===B.expression.isStateDependent){const V=g.paint.get(L);B.expression=V.value,B.updatePaintArray(M.start,M.end,R,o[D],v),b=!0}}}}return b}defines(){const o=[];for(const c in this.binders){const d=this.binders[c];(d instanceof pu||d instanceof Il)&&o.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Rs||d instanceof as)for(let g=0;g<d.paintVertexAttributes.length;g++)o.push(d.paintVertexAttributes[g].name);else if(d instanceof Fs)for(let g=0;g<Tr.members.length;g++)o.push(Tr.members[g].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof pu||d instanceof Il||d instanceof as)for(const g of d.uniformNames)o.push(g)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const d=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof pu||v instanceof Il||v instanceof as)for(const b of v.uniformNames)if(c[b]){const D=v.getBinding(o,c[b],b);d.push({name:b,property:g,binding:D})}}return d}setUniforms(o,c,d,g){for(const{name:v,property:b,binding:D}of c)this.binders[b].setUniform(D,g,d.get(b),v)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(o&&d instanceof Fs){const g=2===o.fromScale?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof Rs||d instanceof as)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(o){for(const c in this.binders){const d=this.binders[c];(d instanceof Rs||d instanceof as||d instanceof Fs)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof Rs||c instanceof as||c instanceof Fs)&&c.destroy()}}}class Di{constructor(o,c,d=(()=>!0)){this.programConfigurations={};for(const g of o)this.programConfigurations[g.id]=new Of(g,c,d);this.needsUpload=!1,this._featureMap=new Ba,this._bufferOffset=0}populatePaintArrays(o,c,d,g,v,b){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,c,g,v,b);void 0!==c.id&&this._featureMap.add(c.id,d,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,d,g){for(const v of d)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(o,this._featureMap,c,v,g)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Nf(a,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}function Bh(a,o,c){const g={"line-pattern":{source:Ir,composite:Ir},"fill-pattern":{source:Ir,composite:Ir},"fill-extrusion-pattern":{source:Ir,composite:Ir}}[a];return g&&g[c]||{color:{source:p,composite:me},number:{source:W,composite:p}}[o][c]}et("ConstantBinder",pu),et("CrossFadedConstantBinder",Il),et("SourceExpressionBinder",Rs),et("CrossFadedCompositeBinder",Fs),et("CompositeExpressionBinder",as),et("ProgramConfiguration",Of,{omit:["_buffers"]}),et("ProgramConfigurationSet",Di);var zt=8192;const Vh=Math.pow(2,14)-1,fu=-Vh-1;function Sr(a){const o=zt/a.extent,c=a.loadGeometry();for(let d=0;d<c.length;d++){const g=c[d];for(let v=0;v<g.length;v++){const b=g[v],D=Math.round(b.x*o),I=Math.round(b.y*o);b.x=be(D,fu,Vh),b.y=be(I,fu,Vh),(D<b.x||D>b.x+1||I<b.y||I>b.y+1)&&jn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function Tl(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Sr(a):[]}}function mu(a,o,c,d,g){a.emplaceBack(2*o+(d+1)/2,2*c+(g+1)/2)}class Va{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new dn,this.indexArray=new yn,this.segments=new Nt,this.programConfigurations=new Di(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){const g=this.layers[0],v=[];let b=null,D=!1;"circle"===g.type&&(b=g.layout.get("circle-sort-key"),D=!b.isConstant());for(const{feature:I,id:M,index:R,sourceLayerIndex:L}of o){const B=this.layers[0]._featureFilter.needGeometry,V=Tl(I,B);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),V,d))continue;const $=D?b.evaluate(V,{},d):void 0,ee={id:M,properties:I.properties,type:I.type,sourceLayerIndex:L,index:R,geometry:B?V.geometry:Sr(I),patterns:{},sortKey:$};v.push(ee)}D&&v.sort((I,M)=>I.sortKey-M.sortKey);for(const I of v){const{geometry:M,index:R,sourceLayerIndex:L}=I,B=o[R].feature;this.addFeature(I,M,R,d),c.featureIndex.insert(B,M,R,L,this.index)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,rr),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,d,g){for(const v of c)for(const b of v){const D=b.x,I=b.y;if(D<0||D>=zt||I<0||I>=zt)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),R=M.vertexLength;mu(this.layoutVertexArray,D,I,-1,-1),mu(this.layoutVertexArray,D,I,1,-1),mu(this.layoutVertexArray,D,I,1,1),mu(this.layoutVertexArray,D,I,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},g)}}function ki(a,o){for(let c=0;c<a.length;c++)if(Sl(o,a[c]))return!0;for(let c=0;c<o.length;c++)if(Sl(a,o[c]))return!0;return!!Ls(a,o)}function ly(a,o,c){return!!Sl(a,o)||!!Uh(o,a,c)}function gu(a,o){if(1===a.length)return jh(o,a[0]);for(let c=0;c<o.length;c++){const d=o[c];for(let g=0;g<d.length;g++)if(Sl(a,d[g]))return!0}for(let c=0;c<a.length;c++)if(jh(o,a[c]))return!0;for(let c=0;c<o.length;c++)if(Ls(a,o[c]))return!0;return!1}function cy(a,o,c){if(a.length>1){if(Ls(a,o))return!0;for(let d=0;d<o.length;d++)if(Uh(o[d],a,c))return!0}for(let d=0;d<a.length;d++)if(Uh(a[d],o,c))return!0;return!1}function Ls(a,o){if(0===a.length||0===o.length)return!1;for(let c=0;c<a.length-1;c++){const d=a[c],g=a[c+1];for(let v=0;v<o.length-1;v++)if(zf(d,g,o[v],o[v+1]))return!0}return!1}function zf(a,o,c,d){return Co(a,c,d)!==Co(o,c,d)&&Co(a,o,c)!==Co(a,o,d)}function Uh(a,o,c){const d=c*c;if(1===o.length)return a.distSqr(o[0])<d;for(let g=1;g<o.length;g++)if($h(a,o[g-1],o[g])<d)return!0;return!1}function $h(a,o,c){const d=o.distSqr(c);if(0===d)return a.distSqr(o);const g=((a.x-o.x)*(c.x-o.x)+(a.y-o.y)*(c.y-o.y))/d;return a.distSqr(g<0?o:g>1?c:c.sub(o)._mult(g)._add(o))}function jh(a,o){let c,d,g,v=!1;for(let b=0;b<a.length;b++){c=a[b];for(let D=0,I=c.length-1;D<c.length;I=D++)d=c[D],g=c[I],d.y>o.y!=g.y>o.y&&o.x<(g.x-d.x)*(o.y-d.y)/(g.y-d.y)+d.x&&(v=!v)}return v}function Sl(a,o){let c=!1;for(let d=0,g=a.length-1;d<a.length;g=d++){const v=a[d],b=a[g];v.y>o.y!=b.y>o.y&&o.x<(b.x-v.x)*(o.y-v.y)/(b.y-v.y)+v.x&&(c=!c)}return c}function uy(a,o,c){const d=c[0],g=c[2];if(a.x<d.x&&o.x<d.x||a.x>g.x&&o.x>g.x||a.y<d.y&&o.y<d.y||a.y>g.y&&o.y>g.y)return!1;const v=Co(a,o,c[0]);return v!==Co(a,o,c[1])||v!==Co(a,o,c[2])||v!==Co(a,o,c[3])}function Dt(a,o,c){const d=o.paint.get(a).value;return"constant"===d.kind?d.value:c.programConfigurations.get(o.id).getMaxValue(a)}function yu(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Hh(a,o,c,d,g){if(!o[0]&&!o[1])return a;const v=xt.convert(o)._mult(g);"viewport"===c&&v._rotate(-d);const b=[];for(let D=0;D<a.length;D++)b.push(a[D].sub(v));return b}et("CircleBucket",Va,{omit:["layers"]});const dy=new ar({"circle-sort-key":new gt(we.layout_circle["circle-sort-key"])});var hy={paint:new ar({"circle-radius":new gt(we.paint_circle["circle-radius"]),"circle-color":new gt(we.paint_circle["circle-color"]),"circle-blur":new gt(we.paint_circle["circle-blur"]),"circle-opacity":new gt(we.paint_circle["circle-opacity"]),"circle-translate":new it(we.paint_circle["circle-translate"]),"circle-translate-anchor":new it(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gt(we.paint_circle["circle-stroke-opacity"])}),layout:dy},Ei=1e-6,pi=typeof Float32Array<"u"?Float32Array:Array;function Ml(){var a=new pi(9);return pi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Gh(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Bf(a,o,c){var d=o[0],g=o[1],v=o[2],b=o[3],D=o[4],I=o[5],M=o[6],R=o[7],L=o[8],B=o[9],V=o[10],$=o[11],ee=o[12],K=o[13],ue=o[14],ge=o[15],ae=c[0],fe=c[1],Se=c[2],Te=c[3];return a[0]=ae*d+fe*D+Se*L+Te*ee,a[1]=ae*g+fe*I+Se*B+Te*K,a[2]=ae*v+fe*M+Se*V+Te*ue,a[3]=ae*b+fe*R+Se*$+Te*ge,a[4]=(ae=c[4])*d+(fe=c[5])*D+(Se=c[6])*L+(Te=c[7])*ee,a[5]=ae*g+fe*I+Se*B+Te*K,a[6]=ae*v+fe*M+Se*V+Te*ue,a[7]=ae*b+fe*R+Se*$+Te*ge,a[8]=(ae=c[8])*d+(fe=c[9])*D+(Se=c[10])*L+(Te=c[11])*ee,a[9]=ae*g+fe*I+Se*B+Te*K,a[10]=ae*v+fe*M+Se*V+Te*ue,a[11]=ae*b+fe*R+Se*$+Te*ge,a[12]=(ae=c[12])*d+(fe=c[13])*D+(Se=c[14])*L+(Te=c[15])*ee,a[13]=ae*g+fe*I+Se*B+Te*K,a[14]=ae*v+fe*M+Se*V+Te*ue,a[15]=ae*b+fe*R+Se*$+Te*ge,a}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var _u,a,py=Bf;function Vf(){var a=new pi(3);return pi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Le(a,o,c){var d=new pi(3);return d[0]=a,d[1]=o,d[2]=c,d}function tn(a,o,c){var d=o[0],g=o[1],v=o[2],b=o[3];return a[0]=c[0]*d+c[4]*g+c[8]*v+c[12]*b,a[1]=c[1]*d+c[5]*g+c[9]*v+c[13]*b,a[2]=c[2]*d+c[6]*g+c[10]*v+c[14]*b,a[3]=c[3]*d+c[7]*g+c[11]*v+c[15]*b,a}function lr(){var a=new pi(4);return pi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function cr(a,o){const c=tn([],[a.x,a.y,0,1],o);return new xt(c[0]/c[3],c[1]/c[3])}Vf(),_u=new pi(4),pi!=Float32Array&&(_u[0]=0,_u[1]=0,_u[2]=0,_u[3]=0),Vf(),Le(1,0,0),Le(0,1,0),lr(),lr(),Ml(),a=new pi(2),pi!=Float32Array&&(a[0]=0,a[1]=0);class Xr extends Va{}et("HeatmapBucket",Xr,{omit:["layers"]});var Uf={paint:new ar({"heatmap-radius":new gt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ho(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(we.paint_heatmap["heatmap-opacity"])})};function Al(a,{width:o,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==o*c*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${o*c*d}`)}else g=new Uint8Array(o*c*d);return a.width=o,a.height=c,a.data=g,a}function ls(a,{width:o,height:c},d){if(o===a.width&&c===a.height)return;const g=Al({},{width:o,height:c},d);vu(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,o),height:Math.min(a.height,c)},d),a.width=o,a.height=c,a.data=g.data}function vu(a,o,c,d,g,v){if(0===g.width||0===g.height)return o;if(g.width>a.width||g.height>a.height||c.x>a.width-g.width||c.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||d.x>o.width-g.width||d.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,D=o.data;if(b===D)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const M=((c.y+I)*a.width+c.x)*v,R=((d.y+I)*o.width+d.x)*v;for(let L=0;L<g.width*v;L++)D[R+L]=b[M+L]}return o}class Pl{constructor(o,c){Al(this,o,1,c)}resize(o){ls(this,o,1)}clone(){return new Pl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,d,g,v){vu(o,c,d,g,v,1)}}class mo{constructor(o,c){Al(this,o,4,c)}resize(o){ls(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,d,g,v){vu(o,c,d,g,v,4)}}function fy(a){const o={},c=a.resolution||256,d=a.clips?a.clips.length:1,g=a.image||new mo({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const v=(b,D,I)=>{o[a.evaluationKey]=I;const M=a.expression.evaluate(o);g.data[b+D+0]=Math.floor(255*M.r/M.a),g.data[b+D+1]=Math.floor(255*M.g/M.a),g.data[b+D+2]=Math.floor(255*M.b/M.a),g.data[b+D+3]=Math.floor(255*M.a)};if(a.clips)for(let b=0,D=0;b<d;++b,D+=4*c)for(let I=0,M=0;I<c;I++,M+=4){const R=I/(c-1),{start:L,end:B}=a.clips[b];v(D,M,L*(1-R)+B*R)}else for(let b=0,D=0;b<c;b++,D+=4)v(0,D,b/(c-1));return g}et("AlphaImage",Pl),et("RGBAImage",mo);var $f={paint:new ar({"hillshade-illumination-direction":new it(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(we.paint_hillshade["hillshade-accent-color"])})};const Ri=qn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ia}=Ri;var xu={exports:{}};function oa(a,o,c){c=c||2;var d,g,v,b,D,I,M,R=o&&o.length,L=R?o[0]*c:a.length,B=Os(a,0,L,c,!0),V=[];if(!B||B.next===B.prev)return V;if(R&&(B=function(ee,K,ue,ge){var ae,fe,Se,Te=[];for(ae=0,fe=K.length;ae<fe;ae++)(Se=Os(ee,K[ae]*ge,ae<fe-1?K[ae+1]*ge:ee.length,ge,!1))===Se.next&&(Se.steiner=!0),Te.push(Xh(Se));for(Te.sort(jf),ae=0;ae<Te.length;ae++)ue=Wh(Te[ae],ue);return ue}(a,o,B,c)),a.length>80*c){d=v=a[0],g=b=a[1];for(var $=c;$<L;$+=c)(D=a[$])<d&&(d=D),(I=a[$+1])<g&&(g=I),D>v&&(v=D),I>b&&(b=I);M=0!==(M=Math.max(v-d,b-g))?32767/M:0}return pc(B,V,c,d,g,M,0),V}function Os(a,o,c,d,g){var v,b;if(g===Yh(a,o,c,d)>0)for(v=o;v<c;v+=d)b=Jn(v,a[v],a[v+1],b);else for(v=c-d;v>=o;v-=d)b=Jn(v,a[v],a[v+1],b);return b&&bu(b,b.next)&&(wu(b),b=b.next),b}function kl(a,o){if(!a)return a;o||(o=a);var c,d=a;do{if(c=!1,d.steiner||!bu(d,d.next)&&0!==Yn(d.prev,d,d.next))d=d.next;else{if(wu(d),(d=o=d.prev)===d.next)break;c=!0}}while(c||d!==o);return o}function pc(a,o,c,d,g,v,b){if(a){!b&&v&&function(R,L,B,V){var $=R;do{0===$.z&&($.z=md($.x,$.y,L,B,V)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==R);$.prevZ.nextZ=null,$.prevZ=null,function(ee){var K,ue,ge,ae,fe,Se,Te,Je,ot=1;do{for(ue=ee,ee=null,fe=null,Se=0;ue;){for(Se++,ge=ue,Te=0,K=0;K<ot&&(Te++,ge=ge.nextZ);K++);for(Je=ot;Te>0||Je>0&&ge;)0!==Te&&(0===Je||!ge||ue.z<=ge.z)?(ae=ue,ue=ue.nextZ,Te--):(ae=ge,ge=ge.nextZ,Je--),fe?fe.nextZ=ae:ee=ae,ae.prevZ=fe,fe=ae;ue=ge}fe.nextZ=null,ot*=2}while(Se>1)}($)}(a,d,g,v);for(var D,I,M=a;a.prev!==a.next;)if(D=a.prev,I=a.next,v?gy(a,d,g,v):my(a))o.push(D.i/c|0),o.push(a.i/c|0),o.push(I.i/c|0),wu(a),a=I.next,M=I.next;else if((a=I)===M){b?1===b?pc(a=qh(kl(a),o,c),o,c,d,g,v,2):2===b&&Zh(a,o,c,d,g,v):pc(kl(a),o,c,d,g,v,1);break}}}function my(a){var o=a.prev,c=a,d=a.next;if(Yn(o,c,d)>=0)return!1;for(var g=o.x,v=c.x,b=d.x,D=o.y,I=c.y,M=d.y,R=g<v?g<b?g:b:v<b?v:b,L=D<I?D<M?D:M:I<M?I:M,B=g>v?g>b?g:b:v>b?v:b,V=D>I?D>M?D:M:I>M?I:M,$=d.next;$!==o;){if($.x>=R&&$.x<=B&&$.y>=L&&$.y<=V&&Rl(g,D,v,I,b,M,$.x,$.y)&&Yn($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function gy(a,o,c,d){var g=a.prev,v=a,b=a.next;if(Yn(g,v,b)>=0)return!1;for(var D=g.x,I=v.x,M=b.x,R=g.y,L=v.y,B=b.y,V=D<I?D<M?D:M:I<M?I:M,$=R<L?R<B?R:B:L<B?L:B,ee=D>I?D>M?D:M:I>M?I:M,K=R>L?R>B?R:B:L>B?L:B,ue=md(V,$,o,c,d),ge=md(ee,K,o,c,d),ae=a.prevZ,fe=a.nextZ;ae&&ae.z>=ue&&fe&&fe.z<=ge;){if(ae.x>=V&&ae.x<=ee&&ae.y>=$&&ae.y<=K&&ae!==g&&ae!==b&&Rl(D,R,I,L,M,B,ae.x,ae.y)&&Yn(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,fe.x>=V&&fe.x<=ee&&fe.y>=$&&fe.y<=K&&fe!==g&&fe!==b&&Rl(D,R,I,L,M,B,fe.x,fe.y)&&Yn(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ae&&ae.z>=ue;){if(ae.x>=V&&ae.x<=ee&&ae.y>=$&&ae.y<=K&&ae!==g&&ae!==b&&Rl(D,R,I,L,M,B,ae.x,ae.y)&&Yn(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;fe&&fe.z<=ge;){if(fe.x>=V&&fe.x<=ee&&fe.y>=$&&fe.y<=K&&fe!==g&&fe!==b&&Rl(D,R,I,L,M,B,fe.x,fe.y)&&Yn(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function qh(a,o,c){var d=a;do{var g=d.prev,v=d.next.next;!bu(g,v)&&gd(g,d,d.next,v)&&Br(g,v)&&Br(v,g)&&(o.push(g.i/c|0),o.push(d.i/c|0),o.push(v.i/c|0),wu(d),wu(d.next),d=a=v),d=d.next}while(d!==a);return kl(d)}function Zh(a,o,c,d,g,v){var b=a;do{for(var D=b.next.next;D!==b.prev;){if(b.i!==D.i&&Hf(b,D)){var I=Ua(b,D);return b=kl(b,b.next),I=kl(I,I.next),pc(b,o,c,d,g,v,0),void pc(I,o,c,d,g,v,0)}D=D.next}b=b.next}while(b!==a)}function jf(a,o){return a.x-o.x}function Wh(a,o){var c=function(g,v){var b,D=v,I=g.x,M=g.y,R=-1/0;do{if(M<=D.y&&M>=D.next.y&&D.next.y!==D.y){var L=D.x+(M-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(L<=I&&L>R&&(R=L,b=D.x<D.next.x?D:D.next,L===I))return b}D=D.next}while(D!==v);if(!b)return null;var B,V=b,$=b.x,ee=b.y,K=1/0;D=b;do{I>=D.x&&D.x>=$&&I!==D.x&&Rl(M<ee?I:R,M,$,ee,M<ee?R:I,M,D.x,D.y)&&(B=Math.abs(M-D.y)/(I-D.x),Br(D,g)&&(B<K||B===K&&(D.x>b.x||D.x===b.x&&yy(b,D)))&&(b=D,K=B)),D=D.next}while(D!==V);return b}(a,o);if(!c)return o;var d=Ua(c,a);return kl(d,d.next),kl(c,c.next)}function yy(a,o){return Yn(a.prev,a,o.prev)<0&&Yn(o.next,a,a.next)<0}function md(a,o,c,d,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-c)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Xh(a){var o=a,c=a;do{(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next}while(o!==a);return c}function Rl(a,o,c,d,g,v,b,D){return(g-b)*(o-D)>=(a-b)*(v-D)&&(a-b)*(d-D)>=(c-b)*(o-D)&&(c-b)*(v-D)>=(g-b)*(d-D)}function Hf(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&gd(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(a,o)&&(Br(a,o)&&Br(o,a)&&function(c,d){var g=c,v=!1,b=(c.x+d.x)/2,D=(c.y+d.y)/2;do{g.y>D!=g.next.y>D&&g.next.y!==g.y&&b<(g.next.x-g.x)*(D-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next}while(g!==c);return v}(a,o)&&(Yn(a.prev,a,o.prev)||Yn(a,o.prev,o))||bu(a,o)&&Yn(a.prev,a,a.next)>0&&Yn(o.prev,o,o.next)>0)}function Yn(a,o,c){return(o.y-a.y)*(c.x-o.x)-(o.x-a.x)*(c.y-o.y)}function bu(a,o){return a.x===o.x&&a.y===o.y}function gd(a,o,c,d){var g=_d(Yn(a,o,c)),v=_d(Yn(a,o,d)),b=_d(Yn(c,d,a)),D=_d(Yn(c,d,o));return g!==v&&b!==D||!(0!==g||!yd(a,c,o))||!(0!==v||!yd(a,d,o))||!(0!==b||!yd(c,a,d))||!(0!==D||!yd(c,o,d))}function yd(a,o,c){return o.x<=Math.max(a.x,c.x)&&o.x>=Math.min(a.x,c.x)&&o.y<=Math.max(a.y,c.y)&&o.y>=Math.min(a.y,c.y)}function _d(a){return a>0?1:a<0?-1:0}function Br(a,o){return Yn(a.prev,a,a.next)<0?Yn(a,o,a.next)>=0&&Yn(a,a.prev,o)>=0:Yn(a,o,a.prev)<0||Yn(a,a.next,o)<0}function Ua(a,o){var c=new Kh(a.i,a.x,a.y),d=new Kh(o.i,o.x,o.y),g=a.next,v=o.prev;return a.next=o,o.prev=a,c.next=g,g.prev=c,d.next=c,c.prev=d,v.next=d,d.prev=v,d}function Jn(a,o,c,d){var g=new Kh(a,o,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function wu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Kh(a,o,c){this.i=a,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yh(a,o,c,d){for(var g=0,v=o,b=c-d;v<c;v+=d)g+=(a[b]-a[v])*(a[v+1]+a[b+1]),b=v;return g}function _y(a,o,c,d,g){Jh(a,o,c||0,d||a.length-1,g||vd)}function Jh(a,o,c,d,g){for(;d>c;){if(d-c>600){var v=d-c+1,b=o-c+1,D=Math.log(v),I=.5*Math.exp(2*D/3),M=.5*Math.sqrt(D*I*(v-I)/v)*(b-v/2<0?-1:1);Jh(a,o,Math.max(c,Math.floor(o-b*I/v+M)),Math.min(d,Math.floor(o+(v-b)*I/v+M)),g)}var R=a[o],L=c,B=d;for(fc(a,c,o),g(a[d],R)>0&&fc(a,c,d);L<B;){for(fc(a,L,B),L++,B--;g(a[L],R)<0;)L++;for(;g(a[B],R)>0;)B--}0===g(a[c],R)?fc(a,c,B):fc(a,++B,d),B<=o&&(c=B+1),o<=B&&(d=B-1)}}function fc(a,o,c){var d=a[o];a[o]=a[c],a[c]=d}function vd(a,o){return a<o?-1:a>o?1:0}function Ns(a,o){const c=a.length;if(c<=1)return[a];const d=[];let g,v;for(let b=0;b<c;b++){const D=Do(a[b]);0!==D&&(a[b].area=Math.abs(D),void 0===v&&(v=D<0),v===D<0?(g&&d.push(g),g=[a[b]]):g.push(a[b]))}if(g&&d.push(g),o>1)for(let b=0;b<d.length;b++)d[b].length<=o||(_y(d[b],o,1,d[b].length-1,vy),d[b]=d[b].slice(0,o));return d}function vy(a,o){return o.area-a.area}function mc(a,o,c){const d=c.patternDependencies;let g=!1;for(const v of o){const b=v.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const D=b.constantOr(null);D&&(g=!0,d[D.to]=!0,d[D.from]=!0)}return g}function gc(a,o,c,d,g){const v=g.patternDependencies;for(const b of o){const D=b.paint.get(`${a}-pattern`).value;if("constant"!==D.kind){let I=D.evaluate({zoom:d-1},c,{},g.availableImages),M=D.evaluate({zoom:d},c,{},g.availableImages),R=D.evaluate({zoom:d+1},c,{},g.availableImages);I=I&&I.name?I.name:I,M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,v[I]=!0,v[M]=!0,v[R]=!0,c.patterns[b.id]={min:I,mid:M,max:R}}}return c}xu.exports=oa,xu.exports.default=oa,oa.deviation=function(a,o,c,d){var g=o&&o.length,v=Math.abs(Yh(a,0,g?o[0]*c:a.length,c));if(g)for(var b=0,D=o.length;b<D;b++)v-=Math.abs(Yh(a,o[b]*c,b<D-1?o[b+1]*c:a.length,c));var I=0;for(b=0;b<d.length;b+=3){var M=d[b]*c,R=d[b+1]*c,L=d[b+2]*c;I+=Math.abs((a[M]-a[L])*(a[R+1]-a[M+1])-(a[M]-a[R])*(a[L+1]-a[M+1]))}return 0===v&&0===I?0:Math.abs((I-v)/v)},oa.flatten=function(a){for(var o=a[0][0].length,c={vertices:[],holes:[],dimensions:o},d=0,g=0;g<a.length;g++){for(var v=0;v<a[g].length;v++)for(var b=0;b<o;b++)c.vertices.push(a[g][v][b]);g>0&&c.holes.push(d+=a[g-1].length)}return c};class yc{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wn,this.indexArray=new yn,this.indexArray2=new Fo,this.programConfigurations=new Di(o.layers,o.zoom),this.segments=new Nt,this.segments2=new Nt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){this.hasPattern=mc("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),b=[];for(const{feature:D,id:I,index:M,sourceLayerIndex:R}of o){const L=this.layers[0]._featureFilter.needGeometry,B=Tl(D,L);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),B,d))continue;const V=v?g.evaluate(B,{},d,c.availableImages):void 0,$={id:I,properties:D.properties,type:D.type,sourceLayerIndex:R,index:M,geometry:L?B.geometry:Sr(D),patterns:{},sortKey:V};b.push($)}v&&b.sort((D,I)=>D.sortKey-I.sortKey);for(const D of b){const{geometry:I,index:M,sourceLayerIndex:R}=D;if(this.hasPattern){const L=gc("fill",this.layers,D,this.zoom,c);this.patternFeatures.push(L)}else this.addFeature(D,I,M,d,{});c.featureIndex.insert(o[M].feature,I,M,R,this.index)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}addFeatures(o,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ia),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,d,g,v){for(const b of Ns(c,500)){let D=0;for(const V of b)D+=V.length;const I=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),M=I.vertexLength,R=[],L=[];for(const V of b){if(0===V.length)continue;V!==b[0]&&L.push(R.length/2);const $=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),ee=$.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(ee+V.length-1,ee),R.push(V[0].x),R.push(V[0].y);for(let K=1;K<V.length;K++)this.layoutVertexArray.emplaceBack(V[K].x,V[K].y),this.indexArray2.emplaceBack(ee+K-1,ee+K),R.push(V[K].x),R.push(V[K].y);$.vertexLength+=V.length,$.primitiveLength+=V.length}const B=xu.exports(R,L);for(let V=0;V<B.length;V+=3)this.indexArray.emplaceBack(M+B[V],M+B[V+1],M+B[V+2]);I.vertexLength+=D,I.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,v,g)}}et("FillBucket",yc,{omit:["layers","patternFeatures"]});const Qh=new ar({"fill-sort-key":new gt(we.layout_fill["fill-sort-key"])});var Gf={paint:new ar({"fill-antialias":new it(we.paint_fill["fill-antialias"]),"fill-opacity":new gt(we.paint_fill["fill-opacity"]),"fill-color":new gt(we.paint_fill["fill-color"]),"fill-outline-color":new gt(we.paint_fill["fill-outline-color"]),"fill-translate":new it(we.paint_fill["fill-translate"]),"fill-translate-anchor":new it(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pi(we.paint_fill["fill-pattern"])}),layout:Qh};const qf=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xy=qn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_c}=qf;var Lo={},by=xt,wy=$a;function $a(a,o,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=g,a.readFields(c0,this,o)}function c0(a,o,c){1==a?o.id=c.readVarint():2==a?function(d,g){for(var v=d.readVarint()+d.pos;d.pos<v;){var b=g._keys[d.readVarint()],D=g._values[d.readVarint()];g.properties[b]=D}}(c,o):3==a?o.type=c.readVarint():4==a&&(o._geometry=c.pos)}function Cy(a){for(var o,c,d=0,g=0,v=a.length,b=v-1;g<v;b=g++)d+=((c=a[b]).x-(o=a[g]).x)*(o.y+c.y);return d}$a.types=["Unknown","Point","LineString","Polygon"],$a.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,c=a.readVarint()+a.pos,d=1,g=0,v=0,b=0,D=[];a.pos<c;){if(g<=0){var I=a.readVarint();d=7&I,g=I>>3}if(g--,1===d||2===d)v+=a.readSVarint(),b+=a.readSVarint(),1===d&&(o&&D.push(o),o=[]),o.push(new by(v,b));else{if(7!==d)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&D.push(o),D},$a.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,c=1,d=0,g=0,v=0,b=1/0,D=-1/0,I=1/0,M=-1/0;a.pos<o;){if(d<=0){var R=a.readVarint();c=7&R,d=R>>3}if(d--,1===c||2===c)(g+=a.readSVarint())<b&&(b=g),g>D&&(D=g),(v+=a.readSVarint())<I&&(I=v),v>M&&(M=v);else if(7!==c)throw new Error("unknown command "+c)}return[b,I,D,M]},$a.prototype.toGeoJSON=function(a,o,c){var d,g,v=this.extent*Math.pow(2,c),b=this.extent*a,D=this.extent*o,I=this.loadGeometry(),M=$a.types[this.type];function R(V){for(var $=0;$<V.length;$++){var ee=V[$];V[$]=[360*(ee.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+D)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(d=0;d<I.length;d++)L[d]=I[d][0];R(I=L);break;case 2:for(d=0;d<I.length;d++)R(I[d]);break;case 3:for(I=function(V){var $=V.length;if($<=1)return[V];for(var ee,K,ue=[],ge=0;ge<$;ge++){var ae=Cy(V[ge]);0!==ae&&(void 0===K&&(K=ae<0),K===ae<0?(ee&&ue.push(ee),ee=[V[ge]]):ee.push(V[ge]))}return ee&&ue.push(ee),ue}(I),d=0;d<I.length;d++)for(g=0;g<I[d].length;g++)R(I[d][g])}1===I.length?I=I[0]:M="Multi"+M;var B={type:"Feature",geometry:{type:M,coordinates:I},properties:this.properties};return"id"in this&&(B.id=this.id),B};var Dy=wy,Ey=Iy;function Iy(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Zf,this,o),this.length=this._features.length}function Zf(a,o,c){15===a?o.version=c.readVarint():1===a?o.name=c.readString():5===a?o.extent=c.readVarint():2===a?o._features.push(c.pos):3===a?o._keys.push(c.readString()):4===a&&o._values.push(function(d){for(var g=null,v=d.readVarint()+d.pos;d.pos<v;){var b=d.readVarint()>>3;g=1===b?d.readString():2===b?d.readFloat():3===b?d.readDouble():4===b?d.readVarint64():5===b?d.readVarint():6===b?d.readSVarint():7===b?d.readBoolean():null}return g}(c))}Iy.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new Dy(this._pbf,o,this.extent,this._keys,this._values)};var xd=Ey;function Ty(a,o,c){if(3===a){var d=new xd(c,c.readVarint()+c.pos);d.length&&(o[d.name]=d)}}Lo.VectorTile=function(a,o){this.layers=a.readFields(Ty,{},o)},Lo.VectorTileFeature=wy,Lo.VectorTileLayer=Ey;const bd=Lo.VectorTileFeature.types,Cu=Math.pow(2,13);function ja(a,o,c,d,g,v,b,D){a.emplaceBack(o,c,2*Math.floor(d*Cu)+b,g*Cu*2,v*Cu*2,Math.round(D))}class Wf{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new jt,this.centroidVertexArray=new ct,this.indexArray=new yn,this.programConfigurations=new Di(o.layers,o.zoom),this.segments=new Nt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){this.features=[],this.hasPattern=mc("fill-extrusion",this.layers,c);for(const{feature:g,id:v,index:b,sourceLayerIndex:D}of o){const I=this.layers[0]._featureFilter.needGeometry,M=Tl(g,I);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),M,d))continue;const R={id:v,sourceLayerIndex:D,index:b,geometry:I?M.geometry:Sr(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(gc("fill-extrusion",this.layers,R,this.zoom,c)):this.addFeature(R,R.geometry,b,d,{}),c.featureIndex.insert(g,R.geometry,b,D,this.index,!0)}}addFeatures(o,c,d){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,c,d)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_c),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,xy.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,d,g,v){const b={x:0,y:0,vertexCount:0};for(const D of Ns(c,500)){let I=0;for(const $ of D)I+=$.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of D){if(0===$.length||Kf($))continue;let ee=0;for(let K=0;K<$.length;K++){const ue=$[K];if(K>=1){const ge=$[K-1];if(!Xf(ue,ge)){M.vertexLength+4>Nt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ae=ue.sub(ge)._perp()._unit(),fe=ge.dist(ue);ee+fe>32768&&(ee=0),ja(this.layoutVertexArray,ue.x,ue.y,ae.x,ae.y,0,0,ee),ja(this.layoutVertexArray,ue.x,ue.y,ae.x,ae.y,0,1,ee),b.x+=2*ue.x,b.y+=2*ue.y,b.vertexCount+=2,ee+=fe,ja(this.layoutVertexArray,ge.x,ge.y,ae.x,ae.y,0,0,ee),ja(this.layoutVertexArray,ge.x,ge.y,ae.x,ae.y,0,1,ee),b.x+=2*ge.x,b.y+=2*ge.y,b.vertexCount+=2;const Se=M.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+I>Nt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),"Polygon"!==bd[o.type])continue;const R=[],L=[],B=M.vertexLength;for(const $ of D)if(0!==$.length){$!==D[0]&&L.push(R.length/2);for(let ee=0;ee<$.length;ee++){const K=$[ee];ja(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),b.x+=K.x,b.y+=K.y,b.vertexCount+=1,R.push(K.x),R.push(K.y)}}const V=xu.exports(R,L);for(let $=0;$<V.length;$+=3)this.indexArray.emplaceBack(B+V[$],B+V[$+2],B+V[$+1]);M.primitiveLength+=V.length/3,M.vertexLength+=I}for(let D=0;D<b.vertexCount;D++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,v,g)}}function Xf(a,o){return a.x===o.x&&(a.x<0||a.x>zt)||a.y===o.y&&(a.y<0||a.y>zt)}function Kf(a){return a.every(o=>o.x<0)||a.every(o=>o.x>zt)||a.every(o=>o.y<0)||a.every(o=>o.y>zt)}et("FillExtrusionBucket",Wf,{omit:["layers","features"]});var Sy={paint:new ar({"fill-extrusion-opacity":new it(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pi(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ki(a,o){return a.x*o.x+a.y*o.y}function Yf(a,o){if(1===a.length){let c=0;const d=o[c++];let g;for(;!g||d.equals(g);)if(g=o[c++],!g)return 1/0;for(;c<o.length;c++){const v=o[c],b=a[0],D=g.sub(d),I=v.sub(d),M=b.sub(d),R=Ki(D,D),L=Ki(D,I),B=Ki(I,I),V=Ki(M,D),$=Ki(M,I),ee=R*B-L*L,K=(B*V-L*$)/ee,ue=(R*$-L*V)/ee,ge=d.z*(1-K-ue)+g.z*K+v.z*ue;if(isFinite(ge))return ge}return 1/0}{let c=1/0;for(const d of o)c=Math.min(c,d.z);return c}}const wd=qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ep}=wd,Jf=qn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tp}=Jf,np=Lo.VectorTileFeature.types,My=Math.cos(Math.PI/180*37.5),rp=Math.pow(2,14)/.5;class Cd{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Wt,this.layoutVertexArray2=new Cn,this.indexArray=new yn,this.programConfigurations=new Di(o.layers,o.zoom),this.segments=new Nt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){this.hasPattern=mc("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),b=[];for(const{feature:D,id:I,index:M,sourceLayerIndex:R}of o){const L=this.layers[0]._featureFilter.needGeometry,B=Tl(D,L);if(!this.layers[0]._featureFilter.filter(new mn(this.zoom),B,d))continue;const V=v?g.evaluate(B,{},d):void 0,$={id:I,properties:D.properties,type:D.type,sourceLayerIndex:R,index:M,geometry:L?B.geometry:Sr(D),patterns:{},sortKey:V};b.push($)}v&&b.sort((D,I)=>D.sortKey-I.sortKey);for(const D of b){const{geometry:I,index:M,sourceLayerIndex:R}=D;if(this.hasPattern){const L=gc("line",this.layers,D,this.zoom,c);this.patternFeatures.push(L)}else this.addFeature(D,I,M,d,{});c.featureIndex.insert(o[M].feature,I,M,R,this.index)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}addFeatures(o,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,tp)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,ep),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,d,g,v){const b=this.layers[0].layout,D=b.get("line-join").evaluate(o,{}),I=b.get("line-cap"),M=b.get("line-miter-limit"),R=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const L of c)this.addLine(L,o,D,I,M,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,v,g)}addLine(o,c,d,g,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<o.length-1;ue++)this.totalDistance+=o[ue].dist(o[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===np[c.type];let I=o.length;for(;I>=2&&o[I-1].equals(o[I-2]);)I--;let M=0;for(;M<I-1&&o[M].equals(o[M+1]);)M++;if(I<(D?3:2))return;"bevel"===d&&(v=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let B,V,$,ee,K;this.e1=this.e2=-1,D&&(B=o[I-2],K=o[M].sub(B)._unit()._perp());for(let ue=M;ue<I;ue++){if($=ue===I-1?D?o[M+1]:void 0:o[ue+1],$&&o[ue].equals($))continue;K&&(ee=K),B&&(V=B),B=o[ue],K=$?$.sub(B)._unit()._perp():ee,ee=ee||K;let ge=ee.add(K);0===ge.x&&0===ge.y||ge._unit();const ae=ee.x*K.x+ee.y*K.y,fe=ge.x*K.x+ge.y*K.y,Se=0!==fe?1/fe:1/0,Te=2*Math.sqrt(2-2*fe),Je=fe<My&&V&&$,ot=ee.x*K.y-ee.y*K.x>0;if(Je&&ue>M){const Ve=B.dist(V);if(Ve>2*R){const We=B.sub(B.sub(V)._mult(R/Ve)._round());this.updateDistance(V,We),this.addCurrentVertex(We,ee,0,0,L),V=We}}const qe=V&&$;let $e=qe?d:D?"butt":g;if(qe&&"round"===$e&&(Se<b?$e="miter":Se<=2&&($e="fakeround")),"miter"===$e&&Se>v&&($e="bevel"),"bevel"===$e&&(Se>2&&($e="flipbevel"),Se<v&&($e="miter")),V&&this.updateDistance(V,B),"miter"===$e)ge._mult(Se),this.addCurrentVertex(B,ge,0,0,L);else if("flipbevel"===$e){if(Se>100)ge=K.mult(-1);else{const Ve=Se*ee.add(K).mag()/ee.sub(K).mag();ge._perp()._mult(Ve*(ot?-1:1))}this.addCurrentVertex(B,ge,0,0,L),this.addCurrentVertex(B,ge.mult(-1),0,0,L)}else if("bevel"===$e||"fakeround"===$e){const Ve=-Math.sqrt(Se*Se-1),We=ot?Ve:0,Ge=ot?0:Ve;if(V&&this.addCurrentVertex(B,ee,We,Ge,L),"fakeround"===$e){const Oe=Math.round(180*Te/Math.PI/20);for(let pt=1;pt<Oe;pt++){let nt=pt/Oe;if(.5!==nt){const kn=nt-.5;nt+=nt*kn*(nt-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*kn*kn+(.848013+ae*(.215638*ae-1.06021)))}const Rt=K.sub(ee)._mult(nt)._add(ee)._unit()._mult(ot?-1:1);this.addHalfVertex(B,Rt.x,Rt.y,!1,ot,0,L)}}$&&this.addCurrentVertex(B,K,-We,-Ge,L)}else if("butt"===$e)this.addCurrentVertex(B,ge,0,0,L);else if("square"===$e){const Ve=V?1:-1;this.addCurrentVertex(B,ge,Ve,Ve,L)}else"round"===$e&&(V&&(this.addCurrentVertex(B,ee,0,0,L),this.addCurrentVertex(B,ee,1,1,L,!0)),$&&(this.addCurrentVertex(B,K,-1,-1,L,!0),this.addCurrentVertex(B,K,0,0,L)));if(Je&&ue<I-1){const Ve=B.dist($);if(Ve>2*R){const We=B.add($.sub(B)._mult(R/Ve)._round());this.updateDistance(B,We),this.addCurrentVertex(We,K,0,0,L),B=We}}}}addCurrentVertex(o,c,d,g,v,b=!1){const D=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(o,c.x+c.y*d,c.y-c.x*d,b,!1,d,v),this.addHalfVertex(o,D,I,b,!0,-g,v),this.distance>rp/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(o,c,d,g,v,b))}addHalfVertex({x:o,y:c},d,g,v,b,D,I){const M=.5*(this.lineClips?this.scaledDistance*(rp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(v?1:0),(c<<1)+(b?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(0===D?0:D<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),I.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}et("LineBucket",Cd,{omit:["layers","patternFeatures"]});const Qf=new ar({"line-cap":new it(we.layout_line["line-cap"]),"line-join":new gt(we.layout_line["line-join"]),"line-miter-limit":new it(we.layout_line["line-miter-limit"]),"line-round-limit":new it(we.layout_line["line-round-limit"]),"line-sort-key":new gt(we.layout_line["line-sort-key"])});var ip={paint:new ar({"line-opacity":new gt(we.paint_line["line-opacity"]),"line-color":new gt(we.paint_line["line-color"]),"line-translate":new it(we.paint_line["line-translate"]),"line-translate-anchor":new it(we.paint_line["line-translate-anchor"]),"line-width":new gt(we.paint_line["line-width"]),"line-gap-width":new gt(we.paint_line["line-gap-width"]),"line-offset":new gt(we.paint_line["line-offset"]),"line-blur":new gt(we.paint_line["line-blur"]),"line-dasharray":new uo(we.paint_line["line-dasharray"]),"line-pattern":new Pi(we.paint_line["line-pattern"]),"line-gradient":new ho(we.paint_line["line-gradient"])}),layout:Qf};const em=new class extends gt{possiblyEvaluate(a,o){return o=new mn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,c,d){return o=Bi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,c,d)}}(ip.paint.properties["line-width"].specification);function Du(a,o){return o>0?o+2*a:a}em.useIntegerZoom=!0;const Fl=qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ay=qn([{name:"a_projected_pos",components:3,type:"Float32"}],4);qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tm=qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const op=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vc=qn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Py(a,o,c){return a.sections.forEach(d=>{d.text=function(g,v,b){const D=v.layout.get("text-transform").evaluate(b,{});return"uppercase"===D?g=g.toLocaleUpperCase():"lowercase"===D&&(g=g.toLocaleLowerCase()),Or.applyArabicShaping&&(g=Or.applyArabicShaping(g)),g}(d.text,o,c)}),a}qn([{name:"triangle",components:3,type:"Uint16"}]),qn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),qn([{type:"Float32",name:"offsetX"}]),qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const yr={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var _r=24,sp=sn,ap=function(a,o,c,d,g){var v,b,D=8*g-d-1,I=(1<<D)-1,M=I>>1,R=-7,L=c?g-1:0,B=c?-1:1,V=a[o+L];for(L+=B,v=V&(1<<-R)-1,V>>=-R,R+=D;R>0;v=256*v+a[o+L],L+=B,R-=8);for(b=v&(1<<-R)-1,v>>=-R,R+=d;R>0;b=256*b+a[o+L],L+=B,R-=8);if(0===v)v=1-M;else{if(v===I)return b?NaN:1/0*(V?-1:1);b+=Math.pow(2,d),v-=M}return(V?-1:1)*b*Math.pow(2,v-d)},Eu=function(a,o,c,d,g,v){var b,D,I,M=8*v-g-1,R=(1<<M)-1,L=R>>1,B=23===g?Math.pow(2,-24)-Math.pow(2,-77):0,V=d?0:v-1,$=d?1:-1,ee=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(D=isNaN(o)?1:0,b=R):(b=Math.floor(Math.log(o)/Math.LN2),o*(I=Math.pow(2,-b))<1&&(b--,I*=2),(o+=b+L>=1?B/I:B*Math.pow(2,1-L))*I>=2&&(b++,I/=2),b+L>=R?(D=0,b=R):b+L>=1?(D=(o*I-1)*Math.pow(2,g),b+=L):(D=o*Math.pow(2,L-1)*Math.pow(2,g),b=0));g>=8;a[c+V]=255&D,V+=$,D/=256,g-=8);for(b=b<<g|D,M+=g;M>0;a[c+V]=255&b,V+=$,b/=256,M-=8);a[c+V-$]|=128*ee};function sn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}sn.Varint=0,sn.Fixed64=1,sn.Bytes=2,sn.Fixed32=5;var go,Ha=4294967296,lp=1/Ha,Dd=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yi(a){return a.type===sn.Bytes?a.readVarint()+a.pos:a.pos+1}function nm(a,o,c){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=a;g--)c.buf[g+d]=c.buf[g]}function u0(a,o){for(var c=0;c<a.length;c++)o.writeVarint(a[c])}function d0(a,o){for(var c=0;c<a.length;c++)o.writeSVarint(a[c])}function h0(a,o){for(var c=0;c<a.length;c++)o.writeFloat(a[c])}function p0(a,o){for(var c=0;c<a.length;c++)o.writeDouble(a[c])}function f0(a,o){for(var c=0;c<a.length;c++)o.writeBoolean(a[c])}function m0(a,o){for(var c=0;c<a.length;c++)o.writeFixed32(a[c])}function Tu(a,o){for(var c=0;c<a.length;c++)o.writeSFixed32(a[c])}function g0(a,o){for(var c=0;c<a.length;c++)o.writeFixed64(a[c])}function y0(a,o){for(var c=0;c<a.length;c++)o.writeSFixed64(a[c])}function ur(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function xc(a,o,c){a[c]=o,a[c+1]=o>>>8,a[c+2]=o>>>16,a[c+3]=o>>>24}function bc(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}function ky(a,o,c){1===a&&c.readMessage(Oo,o)}function Oo(a,o,c){if(3===a){const{id:d,bitmap:g,width:v,height:b,left:D,top:I,advance:M}=c.readMessage(Su,{});o.push({id:d,bitmap:new Pl({width:v+6,height:b+6},g),metrics:{width:v,height:b,left:D,top:I,advance:M}})}}function Su(a,o,c){1===a?o.id=c.readVarint():2===a?o.bitmap=c.readBytes():3===a?o.width=c.readVarint():4===a?o.height=c.readVarint():5===a?o.left=c.readSVarint():6===a?o.top=c.readSVarint():7===a&&(o.advance=c.readVarint())}function cp(a){let o=0,c=0;for(const b of a)o+=b.w*b.h,c=Math.max(c,b.w);a.sort((b,D)=>D.h-b.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let g=0,v=0;for(const b of a)for(let D=d.length-1;D>=0;D--){const I=d[D];if(!(b.w>I.w||b.h>I.h)){if(b.x=I.x,b.y=I.y,v=Math.max(v,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===I.w&&b.h===I.h){const M=d.pop();D<d.length&&(d[D]=M)}else b.h===I.h?(I.x+=b.w,I.w-=b.w):b.w===I.w?(I.y+=b.h,I.h-=b.h):(d.push({x:I.x+b.w,y:I.y,w:I.w-b.w,h:b.h}),I.y+=b.h,I.h-=b.h);break}}return{w:g,h:v,fill:o/(g*v)||0}}sn.prototype={destroy:function(){this.buf=null},readFields:function(a,o,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,v=this.pos;this.type=7&d,a(g,o,this),this.pos===v&&this.skip(d)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=ur(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=bc(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=ur(this.buf,this.pos)+ur(this.buf,this.pos+4)*Ha;return this.pos+=8,a},readSFixed64:function(){var a=ur(this.buf,this.pos)+bc(this.buf,this.pos+4)*Ha;return this.pos+=8,a},readFloat:function(){var a=ap(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=ap(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,c,d=this.buf;return o=127&(c=d[this.pos++]),c<128?o:(o|=(127&(c=d[this.pos++]))<<7,c<128?o:(o|=(127&(c=d[this.pos++]))<<14,c<128?o:(o|=(127&(c=d[this.pos++]))<<21,c<128?o:function(g,v,b){var D,I,M=b.buf;if(D=(112&(I=M[b.pos++]))>>4,I<128||(D|=(127&(I=M[b.pos++]))<<3,I<128)||(D|=(127&(I=M[b.pos++]))<<10,I<128)||(D|=(127&(I=M[b.pos++]))<<17,I<128)||(D|=(127&(I=M[b.pos++]))<<24,I<128)||(D|=(1&(I=M[b.pos++]))<<31,I<128))return function Iu(a,o,c){return c?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(g,D,v);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&Dd?Dd.decode(this.buf.subarray(o,a)):function(c,d,g){for(var v="",b=d;b<g;){var D,I,M,R=c[b],L=null,B=R>239?4:R>223?3:R>191?2:1;if(b+B>g)break;1===B?R<128&&(L=R):2===B?128==(192&(D=c[b+1]))&&(L=(31&R)<<6|63&D)<=127&&(L=null):3===B?(I=c[b+2],128==(192&(D=c[b+1]))&&128==(192&I)&&((L=(15&R)<<12|(63&D)<<6|63&I)<=2047||L>=55296&&L<=57343)&&(L=null)):4===B&&(I=c[b+2],M=c[b+3],128==(192&(D=c[b+1]))&&128==(192&I)&&128==(192&M)&&((L=(15&R)<<18|(63&D)<<12|(63&I)<<6|63&M)<=65535||L>=1114112)&&(L=null)),null===L?(L=65533,B=1):L>65535&&(L-=65536,v+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),v+=String.fromCharCode(L),b+=B}return v}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==sn.Bytes)return a.push(this.readVarint(o));var c=Yi(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==sn.Bytes)return a.push(this.readSVarint());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==sn.Bytes)return a.push(this.readBoolean());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==sn.Bytes)return a.push(this.readFloat());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==sn.Bytes)return a.push(this.readDouble());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==sn.Bytes)return a.push(this.readFixed32());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==sn.Bytes)return a.push(this.readSFixed32());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==sn.Bytes)return a.push(this.readFixed64());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==sn.Bytes)return a.push(this.readSFixed64());var o=Yi(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===sn.Varint)for(;this.buf[this.pos++]>127;);else if(o===sn.Bytes)this.pos=this.readVarint()+this.pos;else if(o===sn.Fixed32)this.pos+=4;else{if(o!==sn.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),xc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),xc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),xc(this.buf,-1&a,this.pos),xc(this.buf,Math.floor(a*lp),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),xc(this.buf,-1&a,this.pos),xc(this.buf,Math.floor(a*lp),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,c){var d,g,v,D;if(o>=0?(d=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,g=g+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),v=d,(D=c).buf[D.pos++]=127&v|128,v>>>=7,D.buf[D.pos++]=127&v|128,v>>>=7,D.buf[D.pos++]=127&v|128,v>>>=7,D.buf[D.pos++]=127&v|128,D.buf[D.pos]=127&(v>>>=7),function(v,b){var D=(7&v)<<4;b.buf[b.pos++]|=D|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(g,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(d,g,v){for(var b,D,I=0;I<g.length;I++){if((b=g.charCodeAt(I))>55295&&b<57344){if(!D){b>56319||I+1===g.length?(d[v++]=239,d[v++]=191,d[v++]=189):D=b;continue}if(b<56320){d[v++]=239,d[v++]=191,d[v++]=189,D=b;continue}b=D-55296<<10|b-56320|65536,D=null}else D&&(d[v++]=239,d[v++]=191,d[v++]=189,D=null);b<128?d[v++]=b:(b<2048?d[v++]=b>>6|192:(b<65536?d[v++]=b>>12|224:(d[v++]=b>>18|240,d[v++]=b>>12&63|128),d[v++]=b>>6&63|128),d[v++]=63&b|128)}return v}(this.buf,a,this.pos);var c=this.pos-o;c>=128&&nm(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),Eu(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Eu(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,o){this.pos++;var c=this.pos;a(o,this);var d=this.pos-c;d>=128&&nm(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,o,c){this.writeTag(a,sn.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,u0,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,d0,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,f0,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,h0,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,p0,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,m0,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,Tu,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,g0,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,y0,o)},writeBytesField:function(a,o){this.writeTag(a,sn.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,sn.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,sn.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,sn.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,sn.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,sn.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,sn.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,sn.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,sn.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,sn.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,!!o)}};class wc{constructor(o,{pixelRatio:c,version:d,stretchX:g,stretchY:v,content:b}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=g,this.stretchY=v,this.content=b,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Cc{constructor(o,c){const d={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(o,d,v),this.addImages(c,g,v);const{w:b,h:D}=cp(v),I=new mo({width:b||1,height:D||1});for(const M in o){const R=o[M],L=d[M].paddedRect;mo.copy(R.data,I,{x:0,y:0},{x:L.x+1,y:L.y+1},R.data)}for(const M in c){const R=c[M],L=g[M].paddedRect,B=L.x+1,V=L.y+1,$=R.data.width,ee=R.data.height;mo.copy(R.data,I,{x:0,y:0},{x:B,y:V},R.data),mo.copy(R.data,I,{x:0,y:ee-1},{x:B,y:V-1},{width:$,height:1}),mo.copy(R.data,I,{x:0,y:0},{x:B,y:V+ee},{width:$,height:1}),mo.copy(R.data,I,{x:$-1,y:0},{x:B-1,y:V},{width:1,height:ee}),mo.copy(R.data,I,{x:0,y:0},{x:B+$,y:V},{width:1,height:ee})}this.image=I,this.iconPositions=d,this.patternPositions=g}addImages(o,c,d){for(const g in o){const v=o[g],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};d.push(b),c[g]=new wc(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in o.updatedImages)this.patchUpdatedImage(this.iconPositions[d],o.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],o.getImage(d),c)}patchUpdatedImage(o,c,d){if(!o||!c||o.version===c.version)return;o.version=c.version;const[g,v]=o.tl;d.update(c.data,void 0,{x:g,y:v})}}et("ImagePosition",wc),et("ImageAtlas",Cc),_.WritingMode=void 0,(go=_.WritingMode||(_.WritingMode={}))[go.none=0]="none",go[go.horizontal=1]="horizontal",go[go.vertical=2]="vertical",go[go.horizontalOnly=3]="horizontalOnly";const Ed=-17;class Id{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const d=new Id;return d.scale=o||1,d.fontStack=c,d}static forImage(o){const c=new Id;return c.imageName=o,c}}class Dc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const d=new Dc;for(let g=0;g<o.sections.length;g++){const v=o.sections[g];v.image?d.addImageSection(v):d.addTextSection(v,c)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let c="";for(let d=0;d<o.length;d++){const g=o.charCodeAt(d+1)||null,v=o.charCodeAt(d-1)||null;c+=g&&bi(g)&&!yr[o[d+1]]||v&&bi(v)&&!yr[o[d-1]]||!yr[o[d]]?o[d]:yr[o[d]]}return c}(this.text)}trim(){let o=0;for(let d=0;d<this.text.length&&Ii[this.text.charCodeAt(d)];d++)o++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&Ii[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const d=new Dc;return d.text=this.text.substring(o,c),d.sectionIndex=this.sectionIndex.slice(o,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(Id.forText(o.scale,o.fontStack||c));const d=this.sections.length-1;for(let g=0;g<o.text.length;++g)this.sectionIndex.push(d)}addImageSection(o){const c=o.image?o.image.name:"";if(0===c.length)return void jn("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Id.forImage(c)),this.sectionIndex.push(this.sections.length-1)):jn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function up(a,o,c,d,g,v,b,D,I,M,R,L,B,V,$,ee){const K=Dc.fromFeature(a,g);let ue;L===_.WritingMode.vertical&&K.verticalizePunctuation();const{processBidirectionalText:ge,processStyledBidirectionalText:ae}=Or;if(ge&&1===K.sections.length){ue=[];const Te=ge(K.toString(),hp(K,M,v,o,d,V,$));for(const Je of Te){const ot=new Dc;ot.text=Je,ot.sections=K.sections;for(let qe=0;qe<Je.length;qe++)ot.sectionIndex.push(0);ue.push(ot)}}else if(ae){ue=[];const Te=ae(K.text,K.sectionIndex,hp(K,M,v,o,d,V,$));for(const Je of Te){const ot=new Dc;ot.text=Je[0],ot.sectionIndex=Je[1],ot.sections=K.sections,ue.push(ot)}}else ue=function(Te,Je){const ot=[],qe=Te.text;let $e=0;for(const Ve of Je)ot.push(Te.substring($e,Ve)),$e=Ve;return $e<qe.length&&ot.push(Te.substring($e,qe.length)),ot}(K,hp(K,M,v,o,d,V,$));const fe=[],Se={positionedLines:fe,text:K.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(Te,Je,ot,qe,$e,Ve,We,Ge,Oe,pt,nt,Rt){let kn=0,zn=Ed,Mr=0,Ti=0;const Kr="right"===Ge?1:"left"===Ge?0:.5;let ir=0;for(const Zn of $e){Zn.trim();const dr=Zn.getMaxScale(),Yr=(dr-1)*_r,Jr={positionedGlyphs:[],lineOffset:0};Te.positionedLines[ir]=Jr;const Qr=Jr.positionedGlyphs;let Mi=0;if(!Zn.length()){zn+=Ve,++ir;continue}for(let Qn=0;Qn<Zn.length();Qn++){const Vt=Zn.getSection(Qn),Oi=Zn.getSectionIndex(Qn),ei=Zn.getCharCode(Qn);let mi=0,zo=null,Bo=null,Vo=null,Uo=_r;const Ji=!(Oe===_.WritingMode.horizontal||!nt&&!Ms(ei)||nt&&(Ii[ei]||(vr=ei,Be.Arabic(vr)||Be["Arabic Supplement"](vr)||Be["Arabic Extended-A"](vr)||Be["Arabic Presentation Forms-A"](vr)||Be["Arabic Presentation Forms-B"](vr))));if(Vt.imageName){const ti=qe[Vt.imageName];if(!ti)continue;Vo=Vt.imageName,Te.iconsInText=Te.iconsInText||!0,Bo=ti.paddedRect;const Ni=ti.displaySize;Vt.scale=Vt.scale*_r/Rt,zo={width:Ni[0],height:Ni[1],left:1,top:-3,advance:Ji?Ni[1]:Ni[0]},mi=Yr+(_r-Ni[1]*Vt.scale),Uo=zo.advance;const aa=Ji?Ni[0]*Vt.scale-_r*dr:Ni[1]*Vt.scale-_r*dr;aa>0&&aa>Mi&&(Mi=aa)}else{const ti=ot[Vt.fontStack],Ni=ti&&ti[ei];if(Ni&&Ni.rect)Bo=Ni.rect,zo=Ni.metrics;else{const aa=Je[Vt.fontStack],Ld=aa&&aa[ei];if(!Ld)continue;zo=Ld.metrics}mi=(dr-Vt.scale)*_r}Ji?(Te.verticalizable=!0,Qr.push({glyph:ei,imageName:Vo,x:kn,y:zn+mi,vertical:Ji,scale:Vt.scale,fontStack:Vt.fontStack,sectionIndex:Oi,metrics:zo,rect:Bo}),kn+=Uo*Vt.scale+pt):(Qr.push({glyph:ei,imageName:Vo,x:kn,y:zn+mi,vertical:Ji,scale:Vt.scale,fontStack:Vt.fontStack,sectionIndex:Oi,metrics:zo,rect:Bo}),kn+=zo.advance*Vt.scale+pt)}0!==Qr.length&&(Mr=Math.max(kn-pt,Mr),Fy(Qr,0,Qr.length-1,Kr,Mi)),kn=0;const Fn=Ve*dr+Mi;Jr.lineOffset=Math.max(Mi,Yr),zn+=Fn,Ti=Math.max(Fn,Ti),++ir}var vr;const Vr=zn-Ed,{horizontalAlign:Ur,verticalAlign:Si}=pp(We);(function(Zn,dr,Yr,Jr,Qr,Mi,Fn,Qn,Vt){const Oi=(dr-Yr)*Qr;let ei=0;ei=Mi!==Fn?-Qn*Jr-Ed:(-Jr*Vt+.5)*Fn;for(const mi of Zn)for(const zo of mi.positionedGlyphs)zo.x+=Oi,zo.y+=ei})(Te.positionedLines,Kr,Ur,Si,Mr,Ti,Ve,Vr,$e.length),Te.top+=-Si*Vr,Te.bottom=Te.top+Vr,Te.left+=-Ur*Mr,Te.right=Te.left+Mr}(Se,o,c,d,ue,b,D,I,L,M,B,ee),!function(Te){for(const Je of Te)if(0!==Je.positionedGlyphs.length)return!1;return!0}(fe)&&Se}const Ii={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ll(a,o,c,d,g,v){if(o.imageName){const b=d[o.imageName];return b?b.displaySize[0]*o.scale*_r/v+g:0}{const b=c[o.fontStack],D=b&&b[a];return D?D.metrics.advance*o.scale+g:0}}function Ry(a,o,c,d){const g=Math.pow(a-o,2);return d?a<o?g/2:2*g:g+Math.abs(c)*c}function rm(a,o,c){let d=0;return 10===a&&(d-=1e4),c&&(d+=150),40!==a&&65288!==a||(d+=50),41!==o&&65289!==o||(d+=50),d}function im(a,o,c,d,g,v){let b=null,D=Ry(o,c,g,v);for(const I of d){const M=Ry(o-I.x,c,g,v)+I.badness;M<=D&&(b=I,D=M)}return{index:a,x:o,priorBreak:b,badness:D}}function om(a){return a?om(a.priorBreak).concat(a.index):[]}function hp(a,o,c,d,g,v,b){if("point"!==v)return[];if(!a)return[];const D=[],I=function(B,V,$,ee,K,ue){let ge=0;for(let ae=0;ae<B.length();ae++){const fe=B.getSection(ae);ge+=Ll(B.getCharCode(ae),fe,ee,K,V,ue)}return ge/Math.max(1,Math.ceil(ge/$))}(a,o,c,d,g,b),M=a.text.indexOf("\u200b")>=0;let R=0;for(let B=0;B<a.length();B++){const V=a.getSection(B),$=a.getCharCode(B);if(Ii[$]||(R+=Ll($,V,d,g,o,b)),B<a.length()-1){const ee=!((L=$)<11904||!(Be["Bopomofo Extended"](L)||Be.Bopomofo(L)||Be["CJK Compatibility Forms"](L)||Be["CJK Compatibility Ideographs"](L)||Be["CJK Compatibility"](L)||Be["CJK Radicals Supplement"](L)||Be["CJK Strokes"](L)||Be["CJK Symbols and Punctuation"](L)||Be["CJK Unified Ideographs Extension A"](L)||Be["CJK Unified Ideographs"](L)||Be["Enclosed CJK Letters and Months"](L)||Be["Halfwidth and Fullwidth Forms"](L)||Be.Hiragana(L)||Be["Ideographic Description Characters"](L)||Be["Kangxi Radicals"](L)||Be["Katakana Phonetic Extensions"](L)||Be.Katakana(L)||Be["Vertical Forms"](L)||Be["Yi Radicals"](L)||Be["Yi Syllables"](L)));(dp[$]||ee||V.imageName)&&D.push(im(B+1,R,I,D,rm($,a.getCharCode(B+1),ee&&M),!1))}}var L;return om(im(a.length(),R,I,D,0,!0))}function pp(a){let o=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function Fy(a,o,c,d,g){if(!d&&!g)return;const v=a[c],b=(a[c].x+v.metrics.advance*v.scale)*d;for(let D=o;D<=c;D++)a[D].x-=b,a[D].y+=g}function Ly(a,o,c){const{horizontalAlign:d,verticalAlign:g}=pp(c),v=o[0]-a.displaySize[0]*d,b=o[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function Td(a,o,c,d,g,v){const b=a.image;let D;if(b.content){const K=b.content,ue=b.pixelRatio||1;D=[K[0]/ue,K[1]/ue,b.displaySize[0]-K[2]/ue,b.displaySize[1]-K[3]/ue]}const I=o.left*v,M=o.right*v;let R,L,B,V;"width"===c||"both"===c?(V=g[0]+I-d[3],L=g[0]+M+d[1]):(V=g[0]+(I+M-b.displaySize[0])/2,L=V+b.displaySize[0]);const $=o.top*v,ee=o.bottom*v;return"height"===c||"both"===c?(R=g[1]+$-d[0],B=g[1]+ee+d[2]):(R=g[1]+($+ee-b.displaySize[1])/2,B=R+b.displaySize[1]),{image:b,top:R,right:L,bottom:B,left:V,collisionPadding:D}}const No=128;function sm(a,o){const{expression:c}=o;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new mn(a+1))};if("source"===c.kind)return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let v=0;for(;v<d.length&&d[v]<=a;)v++;v=Math.max(0,v-1);let b=v;for(;b<d.length&&d[b]<a+1;)b++;b=Math.min(d.length-1,b);const D=d[v],I=d[b];return"composite"===c.kind?{kind:"composite",minZoom:D,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:D,maxZoom:I,minSize:c.evaluate(new mn(D)),maxSize:c.evaluate(new mn(I)),interpolationType:g}}}class cs extends xt{constructor(o,c,d,g){super(o,c),this.angle=d,void 0!==g&&(this.segment=g)}clone(){return new cs(this.x,this.y,this.angle,this.segment)}}function am(a,o,c,d,g){if(void 0===o.segment)return!0;let v=o,b=o.segment+1,D=0;for(;D>-c/2;){if(b--,b<0)return!1;D-=a[b].dist(v),v=a[b]}D+=a[b].dist(a[b+1]),b++;const I=[];let M=0;for(;D<c/2;){const R=a[b],L=a[b+1];if(!L)return!1;let B=a[b-1].angleTo(R)-R.angleTo(L);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:D,angleDelta:B}),M+=B;D-I[0].distance>d;)M-=I.shift().angleDelta;if(M>g)return!1;b++,D+=R.dist(L)}return!0}function Mu(a){let o=0;for(let c=0;c<a.length-1;c++)o+=a[c].dist(a[c+1]);return o}function lm(a,o,c){return a?.6*o*c:0}function fp(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function mp(a,o,c,d,g,v){const b=lm(c,g,v),D=fp(c,d)*v;let I=0;const M=Mu(a)/2;for(let R=0;R<a.length-1;R++){const L=a[R],B=a[R+1],V=L.dist(B);if(I+V>M){const $=(M-I)/V,ee=Pn(L.x,B.x,$),K=Pn(L.y,B.y,$),ue=new cs(ee,K,B.angleTo(L),R);return ue._round(),!b||am(a,ue,D,b,o)?ue:void 0}I+=V}}function Sd(a,o,c,d,g,v,b,D,I){const M=lm(d,v,b),R=fp(d,g),L=R*b,B=0===a[0].x||a[0].x===I||0===a[0].y||a[0].y===I;return o-L<o/4&&(o=L+o/4),gp(a,B?o/2*D%o:(R/2+2*v)*b*D%o,o,M,c,L,B,!1,I)}function gp(a,o,c,d,g,v,b,D,I){const M=v/2,R=Mu(a);let L=0,B=o-c,V=[];for(let $=0;$<a.length-1;$++){const ee=a[$],K=a[$+1],ue=ee.dist(K),ge=K.angleTo(ee);for(;B+c<L+ue;){B+=c;const ae=(B-L)/ue,fe=Pn(ee.x,K.x,ae),Se=Pn(ee.y,K.y,ae);if(fe>=0&&fe<I&&Se>=0&&Se<I&&B-M>=0&&B+M<=R){const Te=new cs(fe,Se,ge,$);Te._round(),d&&!am(a,Te,v,d,g)||V.push(Te)}}L+=ue}return D||V.length||b||(V=gp(a,L/2,c,d,g,v,b,!0,I)),V}function cm(a,o,c,d,g){const v=[];for(let b=0;b<a.length;b++){const D=a[b];let I;for(let M=0;M<D.length-1;M++){let R=D[M],L=D[M+1];R.x<o&&L.x<o||(R.x<o?R=new xt(o,R.y+(o-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x<o&&(L=new xt(o,R.y+(o-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y<c&&L.y<c||(R.y<c?R=new xt(R.x+(c-R.y)/(L.y-R.y)*(L.x-R.x),c)._round():L.y<c&&(L=new xt(R.x+(c-R.y)/(L.y-R.y)*(L.x-R.x),c)._round()),R.x>=d&&L.x>=d||(R.x>=d?R=new xt(d,R.y+(d-R.x)/(L.x-R.x)*(L.y-R.y))._round():L.x>=d&&(L=new xt(d,R.y+(d-R.x)/(L.x-R.x)*(L.y-R.y))._round()),R.y>=g&&L.y>=g||(R.y>=g?R=new xt(R.x+(g-R.y)/(L.y-R.y)*(L.x-R.x),g)._round():L.y>=g&&(L=new xt(R.x+(g-R.y)/(L.y-R.y)*(L.x-R.x),g)._round()),I&&R.equals(I[I.length-1])||(I=[R],v.push(I)),I.push(L)))))}}return v}function um(a,o,c,d){const g=[],v=a.image,b=v.pixelRatio,D=v.paddedRect.w-2,I=v.paddedRect.h-2,M=a.right-a.left,R=a.bottom-a.top,L=v.stretchX||[[0,D]],B=v.stretchY||[[0,I]],V=(Ve,We)=>Ve+We[1]-We[0],$=L.reduce(V,0),ee=B.reduce(V,0),K=D-$,ue=I-ee;let ge=0,ae=$,fe=0,Se=ee,Te=0,Je=K,ot=0,qe=ue;if(v.content&&d){const Ve=v.content;ge=sa(L,0,Ve[0]),fe=sa(B,0,Ve[1]),ae=sa(L,Ve[0],Ve[2]),Se=sa(B,Ve[1],Ve[3]),Te=Ve[0]-ge,ot=Ve[1]-fe,Je=Ve[2]-Ve[0]-ae,qe=Ve[3]-Ve[1]-Se}const $e=(Ve,We,Ge,Oe)=>{const pt=Md(Ve.stretch-ge,ae,M,a.left),nt=yp(Ve.fixed-Te,Je,Ve.stretch,$),Rt=Md(We.stretch-fe,Se,R,a.top),kn=yp(We.fixed-ot,qe,We.stretch,ee),zn=Md(Ge.stretch-ge,ae,M,a.left),Mr=yp(Ge.fixed-Te,Je,Ge.stretch,$),Ti=Md(Oe.stretch-fe,Se,R,a.top),Kr=yp(Oe.fixed-ot,qe,Oe.stretch,ee),ir=new xt(pt,Rt),vr=new xt(zn,Rt),Vr=new xt(zn,Ti),Ur=new xt(pt,Ti),Si=new xt(nt/b,kn/b),Zn=new xt(Mr/b,Kr/b),dr=o*Math.PI/180;if(dr){const Qr=Math.sin(dr),Mi=Math.cos(dr),Fn=[Mi,-Qr,Qr,Mi];ir._matMult(Fn),vr._matMult(Fn),Ur._matMult(Fn),Vr._matMult(Fn)}const Yr=Ve.stretch+Ve.fixed,Jr=We.stretch+We.fixed;return{tl:ir,tr:vr,bl:Ur,br:Vr,tex:{x:v.paddedRect.x+1+Yr,y:v.paddedRect.y+1+Jr,w:Ge.stretch+Ge.fixed-Yr,h:Oe.stretch+Oe.fixed-Jr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Si,pixelOffsetBR:Zn,minFontScaleX:Je/b/M,minFontScaleY:qe/b/R,isSDF:c}};if(d&&(v.stretchX||v.stretchY)){const Ve=Ec(L,K,$),We=Ec(B,ue,ee);for(let Ge=0;Ge<Ve.length-1;Ge++){const Oe=Ve[Ge],pt=Ve[Ge+1];for(let nt=0;nt<We.length-1;nt++)g.push($e(Oe,We[nt],pt,We[nt+1]))}}else g.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:I+1}));return g}function sa(a,o,c){let d=0;for(const g of a)d+=Math.max(o,Math.min(c,g[1]))-Math.max(o,Math.min(c,g[0]));return d}function Ec(a,o,c){const d=[{fixed:-1,stretch:0}];for(const[g,v]of a){const b=d[d.length-1];d.push({fixed:g-b.stretch,stretch:b.stretch}),d.push({fixed:g-b.stretch,stretch:b.stretch+(v-g)})}return d.push({fixed:o+1,stretch:c}),d}function Md(a,o,c,d){return a/o*c+d}function yp(a,o,c,d){return a-o*c/d}et("Anchor",cs);class Au{constructor(o,c,d,g,v,b,D,I,M,R){if(this.boxStartIndex=o.length,M){let L=b.top,B=b.bottom;const V=b.collisionPadding;V&&(L-=V[1],B+=V[3]);let $=B-L;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let L=b.top*D-I[0],B=b.bottom*D+I[2],V=b.left*D-I[3],$=b.right*D+I[1];const ee=b.collisionPadding;if(ee&&(V-=ee[0]*D,L-=ee[1]*D,$+=ee[2]*D,B+=ee[3]*D),R){const K=new xt(V,L),ue=new xt($,L),ge=new xt(V,B),ae=new xt($,B),fe=R*Math.PI/180;K._rotate(fe),ue._rotate(fe),ge._rotate(fe),ae._rotate(fe),V=Math.min(K.x,ue.x,ge.x,ae.x),$=Math.max(K.x,ue.x,ge.x,ae.x),L=Math.min(K.y,ue.y,ge.y,ae.y),B=Math.max(K.y,ue.y,ge.y,ae.y)}o.emplaceBack(c.x,c.y,V,L,$,B,d,g,v)}this.boxEndIndex=o.length}}class Oy{constructor(o=[],c=_0){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:d}=this,g=c[o];for(;o>0;){const v=o-1>>1,b=c[v];if(d(g,b)>=0)break;c[o]=b,o=v}c[o]=g}_down(o){const{data:c,compare:d}=this,g=this.length>>1,v=c[o];for(;o<g;){let b=1+(o<<1),D=c[b];const I=b+1;if(I<this.length&&d(c[I],D)<0&&(b=I,D=c[I]),d(D,v)>=0)break;c[o]=D,o=b}c[o]=v}}function _0(a,o){return a<o?-1:a>o?1:0}function Ny(a,o=1,c=!1){let d=1/0,g=1/0,v=-1/0,b=-1/0;const D=a[0];for(let V=0;V<D.length;V++){const $=D[V];(!V||$.x<d)&&(d=$.x),(!V||$.y<g)&&(g=$.y),(!V||$.x>v)&&(v=$.x),(!V||$.y>b)&&(b=$.y)}const I=Math.min(v-d,b-g);let M=I/2;const R=new Oy([],zy);if(0===I)return new xt(d,g);for(let V=d;V<v;V+=I)for(let $=g;$<b;$+=I)R.push(new Ic(V+M,$+M,M,a));let L=function(V){let $=0,ee=0,K=0;const ue=V[0];for(let ge=0,ae=ue.length,fe=ae-1;ge<ae;fe=ge++){const Se=ue[ge],Te=ue[fe],Je=Se.x*Te.y-Te.x*Se.y;ee+=(Se.x+Te.x)*Je,K+=(Se.y+Te.y)*Je,$+=3*Je}return new Ic(ee/$,K/$,0,V)}(a),B=R.length;for(;R.length;){const V=R.pop();(V.d>L.d||!L.d)&&(L=V,c&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,B)),V.max-L.d<=o||(M=V.h/2,R.push(new Ic(V.p.x-M,V.p.y-M,M,a)),R.push(new Ic(V.p.x+M,V.p.y-M,M,a)),R.push(new Ic(V.p.x-M,V.p.y+M,M,a)),R.push(new Ic(V.p.x+M,V.p.y+M,M,a)),B+=4)}return c&&(console.log(`num probes: ${B}`),console.log(`best distance: ${L.d}`)),L.p}function zy(a,o){return o.max-a.max}function Ic(a,o,c,d){this.p=new xt(a,o),this.h=c,this.d=function(g,v){let b=!1,D=1/0;for(let I=0;I<v.length;I++){const M=v[I];for(let R=0,L=M.length,B=L-1;R<L;B=R++){const V=M[R],$=M[B];V.y>g.y!=$.y>g.y&&g.x<($.x-V.x)*(g.y-V.y)/($.y-V.y)+V.x&&(b=!b),D=Math.min(D,$h(g,V,$))}}return(b?1:-1)*Math.sqrt(D)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const Tc=Number.POSITIVE_INFINITY;function _p(a,o){return o[1]!==Tc?function(c,d,g){let v=0,b=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(c){case"top-right":case"bottom-right":case"right":v=-d;break;case"top-left":case"bottom-left":case"left":v=d}return[v,b]}(a,o[0],o[1]):function(c,d){let g=0,v=0;d<0&&(d=0);const b=d/Math.sqrt(2);switch(c){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-d;break;case"top":v=d-7}switch(c){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=d;break;case"right":g=-d}return[g,v]}(a,o[0])}function vp(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dm(a,o,c,d,g,v,b,D,I,M,R){let L=v.textMaxSize.evaluate(o,{});void 0===L&&(L=b);const B=a.layers[0].layout,V=B.get("icon-offset").evaluate(o,{},R),$=By(c.horizontal),ee=b/24,K=a.tilePixelRatio*ee,ue=a.tilePixelRatio*L/24,ge=a.tilePixelRatio*D,ae=a.tilePixelRatio*B.get("symbol-spacing"),fe=B.get("text-padding")*a.tilePixelRatio,Se=function(Oe,pt,nt,Rt=1){const kn=Oe.get("icon-padding").evaluate(pt,{},nt),zn=kn&&kn.values;return[zn[0]*Rt,zn[1]*Rt,zn[2]*Rt,zn[3]*Rt]}(B,o,R,a.tilePixelRatio),Te=B.get("text-max-angle")/180*Math.PI,Je="viewport"!==B.get("text-rotation-alignment")&&"point"!==B.get("symbol-placement"),ot="map"===B.get("icon-rotation-alignment")&&"point"!==B.get("symbol-placement"),qe=B.get("symbol-placement"),$e=ae/2,Ve=B.get("icon-text-fit");let We;d&&"none"!==Ve&&(a.allowVerticalPlacement&&c.vertical&&(We=Td(d,c.vertical,Ve,B.get("icon-text-fit-padding"),V,ee)),$&&(d=Td(d,$,Ve,B.get("icon-text-fit-padding"),V,ee)));const Ge=(Oe,pt)=>{pt.x<0||pt.x>=zt||pt.y<0||pt.y>=zt||function(nt,Rt,kn,zn,Mr,Ti,Kr,ir,vr,Vr,Ur,Si,Zn,dr,Yr,Jr,Qr,Mi,Fn,Qn,Vt,Oi,ei,mi,zo){const Bo=nt.addToLineVertexArray(Rt,kn);let Vo,Uo,Ji,ti,Ni=0,aa=0,Ld=0,Tm=0,Lu=-1,Ap=-1;const _o={};let Ou=zr.exports(""),Nu=0,Od=0;if(void 0===ir._unevaluatedLayout.getValue("text-radial-offset")?[Nu,Od]=ir.layout.get("text-offset").evaluate(Vt,{},mi).map(Qi=>Qi*_r):(Nu=ir.layout.get("text-radial-offset").evaluate(Vt,{},mi)*_r,Od=Tc),nt.allowVerticalPlacement&&zn.vertical){const Qi=ir.layout.get("text-rotate").evaluate(Vt,{},mi)+90;Ji=new Au(vr,Rt,Vr,Ur,Si,zn.vertical,Zn,dr,Yr,Qi),Kr&&(ti=new Au(vr,Rt,Vr,Ur,Si,Kr,Qr,Mi,Yr,Qi))}if(Mr){const Qi=ir.layout.get("icon-rotate").evaluate(Vt,{}),la="none"!==ir.layout.get("icon-text-fit"),zd=um(Mr,Qi,ei,la),Bd=Kr?um(Kr,Qi,ei,la):void 0;Uo=new Au(vr,Rt,Vr,Ur,Si,Mr,Qr,Mi,!1,Qi),Ni=4*zd.length;const kp=nt.iconSizeData;let zl=null;"source"===kp.kind?(zl=[No*ir.layout.get("icon-size").evaluate(Vt,{})],zl[0]>Ol&&jn(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===kp.kind&&(zl=[No*Oi.compositeIconSizes[0].evaluate(Vt,{},mi),No*Oi.compositeIconSizes[1].evaluate(Vt,{},mi)],(zl[0]>Ol||zl[1]>Ol)&&jn(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,zd,zl,Qn,Fn,Vt,_.WritingMode.none,Rt,Bo.lineStartIndex,Bo.lineLength,-1,mi),Lu=nt.icon.placedSymbolArray.length-1,Bd&&(aa=4*Bd.length,nt.addSymbols(nt.icon,Bd,zl,Qn,Fn,Vt,_.WritingMode.vertical,Rt,Bo.lineStartIndex,Bo.lineLength,-1,mi),Ap=nt.icon.placedSymbolArray.length-1)}const Pp=Object.keys(zn.horizontal);for(const Qi of Pp){const la=zn.horizontal[Qi];if(!Vo){Ou=zr.exports(la.text);const Bd=ir.layout.get("text-rotate").evaluate(Vt,{},mi);Vo=new Au(vr,Rt,Vr,Ur,Si,la,Zn,dr,Yr,Bd)}const zd=1===la.positionedLines.length;if(Ld+=xp(nt,Rt,la,Ti,ir,Yr,Vt,Jr,Bo,zn.vertical?_.WritingMode.horizontal:_.WritingMode.horizontalOnly,zd?Pp:[Qi],_o,Lu,Oi,mi),zd)break}zn.vertical&&(Tm+=xp(nt,Rt,zn.vertical,Ti,ir,Yr,Vt,Jr,Bo,_.WritingMode.vertical,["vertical"],_o,Ap,Oi,mi));const Sm=Vo?Vo.boxStartIndex:nt.collisionBoxArray.length,Mm=Vo?Vo.boxEndIndex:nt.collisionBoxArray.length,$y=Ji?Ji.boxStartIndex:nt.collisionBoxArray.length,jy=Ji?Ji.boxEndIndex:nt.collisionBoxArray.length,Hy=Uo?Uo.boxStartIndex:nt.collisionBoxArray.length,Gy=Uo?Uo.boxEndIndex:nt.collisionBoxArray.length,qy=ti?ti.boxStartIndex:nt.collisionBoxArray.length,Ga=ti?ti.boxEndIndex:nt.collisionBoxArray.length;let zi=-1;const Nd=(Qi,la)=>Qi&&Qi.circleDiameter?Math.max(Qi.circleDiameter,la):la;zi=Nd(Vo,zi),zi=Nd(Ji,zi),zi=Nd(Uo,zi),zi=Nd(ti,zi);const Zy=zi>-1?1:0;Zy&&(zi*=zo/_r),nt.glyphOffsetArray.length>=Pu.MAX_GLYPHS&&jn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Vt.sortKey&&nt.addToSortKeyRanges(nt.symbolInstances.length,Vt.sortKey),nt.symbolInstances.emplaceBack(Rt.x,Rt.y,_o.right>=0?_o.right:-1,_o.center>=0?_o.center:-1,_o.left>=0?_o.left:-1,_o.vertical||-1,Lu,Ap,Ou,Sm,Mm,$y,jy,Hy,Gy,qy,Ga,Vr,Ld,Tm,Ni,aa,Zy,0,Zn,Nu,Od,zi)}(a,pt,Oe,c,d,g,We,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,K,[fe,fe,fe,fe],Je,I,ge,Se,ot,V,o,v,M,R,b)};if("line"===qe)for(const Oe of cm(o.geometry,0,0,zt,zt)){const pt=Sd(Oe,ae,Te,c.vertical||$,d,24,ue,a.overscaling,zt);for(const nt of pt)$&&Vy(a,$.text,$e,nt)||Ge(Oe,nt)}else if("line-center"===qe){for(const Oe of o.geometry)if(Oe.length>1){const pt=mp(Oe,Te,c.vertical||$,d,24,ue);pt&&Ge(Oe,pt)}}else if("Polygon"===o.type)for(const Oe of Ns(o.geometry,0)){const pt=Ny(Oe,16);Ge(Oe[0],new cs(pt.x,pt.y,0))}else if("LineString"===o.type)for(const Oe of o.geometry)Ge(Oe,new cs(Oe[0].x,Oe[0].y,0));else if("Point"===o.type)for(const Oe of o.geometry)for(const pt of Oe)Ge([pt],new cs(pt.x,pt.y,0))}const Ol=32640;function xp(a,o,c,d,g,v,b,D,I,M,R,L,B,V,$){const ee=function(ge,ae,fe,Se,Te,Je,ot,qe){const $e=Se.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,Ve=[];for(const We of ae.positionedLines)for(const Ge of We.positionedGlyphs){if(!Ge.rect)continue;const Oe=Ge.rect||{};let pt=4,nt=!0,Rt=1,kn=0;const zn=(Te||qe)&&Ge.vertical,Mr=Ge.metrics.advance*Ge.scale/2;if(qe&&ae.verticalizable&&(kn=We.lineOffset/2-(Ge.imageName?-(_r-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*_r)),Ge.imageName){const Fn=ot[Ge.imageName];nt=Fn.sdf,Rt=Fn.pixelRatio,pt=1/Rt}const Ti=Te?[Ge.x+Mr,Ge.y]:[0,0];let Kr=Te?[0,0]:[Ge.x+Mr+fe[0],Ge.y+fe[1]-kn],ir=[0,0];zn&&(ir=Kr,Kr=[0,0]);const vr=(Ge.metrics.left-pt)*Ge.scale-Mr+Kr[0],Vr=(-Ge.metrics.top-pt)*Ge.scale+Kr[1],Ur=vr+Oe.w*Ge.scale/Rt,Si=Vr+Oe.h*Ge.scale/Rt,Zn=new xt(vr,Vr),dr=new xt(Ur,Vr),Yr=new xt(vr,Si),Jr=new xt(Ur,Si);if(zn){const Fn=new xt(-Mr,Mr-Ed),Qn=-Math.PI/2,Vt=12-Mr,Oi=new xt(22-Vt,-(Ge.imageName?Vt:0)),ei=new xt(...ir);Zn._rotateAround(Qn,Fn)._add(Oi)._add(ei),dr._rotateAround(Qn,Fn)._add(Oi)._add(ei),Yr._rotateAround(Qn,Fn)._add(Oi)._add(ei),Jr._rotateAround(Qn,Fn)._add(Oi)._add(ei)}if($e){const Fn=Math.sin($e),Qn=Math.cos($e),Vt=[Qn,-Fn,Fn,Qn];Zn._matMult(Vt),dr._matMult(Vt),Yr._matMult(Vt),Jr._matMult(Vt)}const Qr=new xt(0,0),Mi=new xt(0,0);Ve.push({tl:Zn,tr:dr,bl:Yr,br:Jr,tex:Oe,writingMode:ae.writingMode,glyphOffset:Ti,sectionIndex:Ge.sectionIndex,isSDF:nt,pixelOffsetTL:Qr,pixelOffsetBR:Mi,minFontScaleX:0,minFontScaleY:0})}return Ve}(0,c,D,g,v,b,d,a.allowVerticalPlacement),K=a.textSizeData;let ue=null;"source"===K.kind?(ue=[No*g.layout.get("text-size").evaluate(b,{})],ue[0]>Ol&&jn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===K.kind&&(ue=[No*V.compositeTextSizes[0].evaluate(b,{},$),No*V.compositeTextSizes[1].evaluate(b,{},$)],(ue[0]>Ol||ue[1]>Ol)&&jn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ee,ue,D,v,b,M,o,I.lineStartIndex,I.lineLength,B,$);for(const ge of R)L[ge]=a.text.placedSymbolArray.length-1;return 4*ee.length}function By(a){for(const o in a)return a[o];return null}function Vy(a,o,c,d){const g=a.compareText;if(o in g){const v=g[o];for(let b=v.length-1;b>=0;b--)if(d.dist(v[b])<c)return!0}else g[o]=[];return g[o].push(d),!1}const Uy=Lo.VectorTileFeature.types,bp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wp(a,o,c,d,g,v,b,D,I,M,R,L,B){const V=D?Math.min(Ol,Math.round(D[0])):0,$=D?Math.min(Ol,Math.round(D[1])):0;a.emplaceBack(o,c,Math.round(32*d),Math.round(32*g),v,b,(V<<1)+(I?1:0),$,16*M,16*R,256*L,256*B)}function hm(a,o,c){a.emplaceBack(o.x,o.y,c),a.emplaceBack(o.x,o.y,c),a.emplaceBack(o.x,o.y,c),a.emplaceBack(o.x,o.y,c)}function Cp(a){for(const o of a.sections)if(Dl(o.text))return!0;return!1}class pm{constructor(o){this.layoutVertexArray=new Po,this.indexArray=new yn,this.programConfigurations=o,this.segments=new Nt,this.dynamicLayoutVertexArray=new ko,this.opacityVertexArray=new Ro,this.placedSymbolArray=new Fe}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Fl.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Ay.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,bp,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}et("SymbolBuffers",pm);class fm{constructor(o,c,d){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Nt,this.collisionVertexArray=new hi}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,tm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}et("CollisionBuffers",fm);class Pu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gh([]),this.placementViewportMatrix=Gh([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sm(this.zoom,c["text-size"]),this.iconSizeData=sm(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),v=d.get("symbol-z-order");this.canOverlap="never"!==ku(d,"text-overlap","text-allow-overlap")||"never"!==ku(d,"icon-overlap","icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==v&&!g.isConstant(),this.sortFeaturesByY=("viewport-y"===v||"auto"===v&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===d.get("symbol-placement")&&(this.writingModes=d.get("text-writing-mode").map(b=>_.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID}createArrays(){this.text=new pm(new Di(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new pm(new Di(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Ue,this.lineVertexArray=new Qe,this.symbolInstances=new Xe}calculateGlyphDependencies(o,c,d,g,v){for(let b=0;b<o.length;b++)if(c[o.charCodeAt(b)]=!0,(d||g)&&v){const D=yr[o.charAt(b)];D&&(c[D.charCodeAt(0)]=!0)}}populate(o,c,d){const g=this.layers[0],v=g.layout,b=v.get("text-font"),D=v.get("text-field"),I=v.get("icon-image"),M=("constant"!==D.value.kind||D.value.value instanceof ne&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),R="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,L=v.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const B=c.iconDependencies,V=c.glyphDependencies,$=c.availableImages,ee=new mn(this.zoom);for(const{feature:K,id:ue,index:ge,sourceLayerIndex:ae}of o){const fe=g._featureFilter.needGeometry,Se=Tl(K,fe);if(!g._featureFilter.filter(ee,Se,d))continue;let Te,Je;if(fe||(Se.geometry=Sr(K)),M){const qe=g.getValueAndResolveTokens("text-field",Se,d,$),$e=ne.factory(qe);Cp($e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ao()||this.hasRTLText&&Or.isParsed())&&(Te=Py($e,g,Se))}if(R){const qe=g.getValueAndResolveTokens("icon-image",Se,d,$);Je=qe instanceof oe?qe:oe.fromString(qe)}if(!Te&&!Je)continue;const ot=this.sortFeaturesByKey?L.evaluate(Se,{},d):void 0;if(this.features.push({id:ue,text:Te,icon:Je,index:ge,sourceLayerIndex:ae,geometry:Se.geometry,properties:K.properties,type:Uy[K.type],sortKey:ot}),Je&&(B[Je.name]=!0),Te){const qe=b.evaluate(Se,{},d).join(","),$e="viewport"!==v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.WritingMode.vertical)>=0;for(const Ve of Te.sections)if(Ve.image)B[Ve.image.name]=!0;else{const We=on(Te.toString()),Ge=Ve.fontStack||qe,Oe=V[Ge]=V[Ge]||{};this.calculateGlyphDependencies(Ve.text,Oe,$e,this.allowVerticalPlacement,We)}}}"line"===v.get("symbol-placement")&&(this.features=function(K){const ue={},ge={},ae=[];let fe=0;function Se(qe){ae.push(K[qe]),fe++}function Te(qe,$e,Ve){const We=ge[qe];return delete ge[qe],ge[$e]=We,ae[We].geometry[0].pop(),ae[We].geometry[0]=ae[We].geometry[0].concat(Ve[0]),We}function Je(qe,$e,Ve){const We=ue[$e];return delete ue[$e],ue[qe]=We,ae[We].geometry[0].shift(),ae[We].geometry[0]=Ve[0].concat(ae[We].geometry[0]),We}function ot(qe,$e,Ve){const We=Ve?$e[0][$e[0].length-1]:$e[0][0];return`${qe}:${We.x}:${We.y}`}for(let qe=0;qe<K.length;qe++){const $e=K[qe],Ve=$e.geometry,We=$e.text?$e.text.toString():null;if(!We){Se(qe);continue}const Ge=ot(We,Ve),Oe=ot(We,Ve,!0);if(Ge in ge&&Oe in ue&&ge[Ge]!==ue[Oe]){const pt=Je(Ge,Oe,Ve),nt=Te(Ge,Oe,ae[pt].geometry);delete ue[Ge],delete ge[Oe],ge[ot(We,ae[nt].geometry,!0)]=nt,ae[pt].geometry=null}else Ge in ge?Te(Ge,Oe,Ve):Oe in ue?Je(Ge,Oe,Ve):(Se(qe),ue[Ge]=fe-1,ge[Oe]=fe-1)}return ae.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ue)=>K.sortKey-ue.sortKey)}update(o,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,d))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const d=this.lineVertexArray.length;if(void 0!==o.segment){let g=o.dist(c[o.segment+1]),v=o.dist(c[o.segment]);const b={};for(let D=o.segment+1;D<c.length;D++)b[D]={x:c[D].x,y:c[D].y,tileUnitDistanceFromAnchor:g},D<c.length-1&&(g+=c[D+1].dist(c[D]));for(let D=o.segment||0;D>=0;D--)b[D]={x:c[D].x,y:c[D].y,tileUnitDistanceFromAnchor:v},D>0&&(v+=c[D-1].dist(c[D]));for(let D=0;D<c.length;D++){const I=b[D];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,c,d,g,v,b,D,I,M,R,L,B){const V=o.indexArray,$=o.layoutVertexArray,ee=o.segments.prepareSegment(4*c.length,$,V,this.canOverlap?b.sortKey:void 0),K=this.glyphOffsetArray.length,ue=ee.vertexLength,ge=this.allowVerticalPlacement&&D===_.WritingMode.vertical?Math.PI/2:0,ae=b.text&&b.text.sections;for(let fe=0;fe<c.length;fe++){const{tl:Se,tr:Te,bl:Je,br:ot,tex:qe,pixelOffsetTL:$e,pixelOffsetBR:Ve,minFontScaleX:We,minFontScaleY:Ge,glyphOffset:Oe,isSDF:pt,sectionIndex:nt}=c[fe],Rt=ee.vertexLength,kn=Oe[1];wp($,I.x,I.y,Se.x,kn+Se.y,qe.x,qe.y,d,pt,$e.x,$e.y,We,Ge),wp($,I.x,I.y,Te.x,kn+Te.y,qe.x+qe.w,qe.y,d,pt,Ve.x,$e.y,We,Ge),wp($,I.x,I.y,Je.x,kn+Je.y,qe.x,qe.y+qe.h,d,pt,$e.x,Ve.y,We,Ge),wp($,I.x,I.y,ot.x,kn+ot.y,qe.x+qe.w,qe.y+qe.h,d,pt,Ve.x,Ve.y,We,Ge),hm(o.dynamicLayoutVertexArray,I,ge),V.emplaceBack(Rt,Rt+1,Rt+2),V.emplaceBack(Rt+1,Rt+2,Rt+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Oe[0]),fe!==c.length-1&&nt===c[fe+1].sectionIndex||o.programConfigurations.populatePaintArrays($.length,b,b.index,{},B,ae&&ae[nt])}o.placedSymbolArray.emplaceBack(I.x,I.y,K,this.glyphOffsetArray.length-K,ue,M,R,I.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],D,0,!1,0,L)}_addCollisionDebugVertex(o,c,d,g,v,b){return c.emplaceBack(0,0),o.emplaceBack(d.x,d.y,g,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(o,c,d,g,v,b,D){const I=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),M=I.vertexLength,R=v.layoutVertexArray,L=v.collisionVertexArray,B=D.anchorX,V=D.anchorY;this._addCollisionDebugVertex(R,L,b,B,V,new xt(o,c)),this._addCollisionDebugVertex(R,L,b,B,V,new xt(d,c)),this._addCollisionDebugVertex(R,L,b,B,V,new xt(d,g)),this._addCollisionDebugVertex(R,L,b,B,V,new xt(o,g)),I.vertexLength+=4;const $=v.indexArray;$.emplaceBack(M,M+1),$.emplaceBack(M+1,M+2),$.emplaceBack(M+2,M+3),$.emplaceBack(M+3,M),I.primitiveLength+=4}addDebugCollisionBoxes(o,c,d,g){for(let v=o;v<c;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fm(Nr,op.members,Fo),this.iconCollisionBox=new fm(Nr,op.members,Fo);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,d,g,v,b,D,I,M){const R={};for(let L=c;L<d;L++){const B=o.get(L);R.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.textFeatureIndex=B.featureIndex;break}for(let L=g;L<v;L++){const B=o.get(L);R.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalTextFeatureIndex=B.featureIndex;break}for(let L=b;L<D;L++){const B=o.get(L);R.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.iconFeatureIndex=B.featureIndex;break}for(let L=I;L<M;L++){const B=o.get(L);R.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},R.verticalIconFeatureIndex=B.featureIndex;break}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const d=o.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let v=d.vertexStartIndex;v<g;v+=4)o.indexArray.emplaceBack(v,v+1,v+2),o.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const c=Math.sin(o),d=Math.cos(o),g=[],v=[],b=[];for(let D=0;D<this.symbolInstances.length;++D){b.push(D);const I=this.symbolInstances.get(D);g.push(0|Math.round(c*I.anchorX+d*I.anchorY)),v.push(I.featureIndex)}return b.sort((D,I)=>g[D]-g[I]||v[I]-v[D]),b}addToSortKeyRanges(o,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,v,b)=>{g>=0&&b.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}et("SymbolBucket",Pu,{omit:["layers","collisionBoxArray","features","compareText"]}),Pu.MAX_GLYPHS=65535,Pu.addDynamicAttributes=hm;const v0=new ar({"symbol-placement":new it(we.layout_symbol["symbol-placement"]),"symbol-spacing":new it(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new it(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new it(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new gt(we.layout_symbol["icon-size"]),"icon-text-fit":new it(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new gt(we.layout_symbol["icon-image"]),"icon-rotate":new gt(we.layout_symbol["icon-rotate"]),"icon-padding":new gt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new it(we.layout_symbol["icon-keep-upright"]),"icon-offset":new gt(we.layout_symbol["icon-offset"]),"icon-anchor":new gt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(we.layout_symbol["text-rotation-alignment"]),"text-field":new gt(we.layout_symbol["text-field"]),"text-font":new gt(we.layout_symbol["text-font"]),"text-size":new gt(we.layout_symbol["text-size"]),"text-max-width":new gt(we.layout_symbol["text-max-width"]),"text-line-height":new it(we.layout_symbol["text-line-height"]),"text-letter-spacing":new gt(we.layout_symbol["text-letter-spacing"]),"text-justify":new gt(we.layout_symbol["text-justify"]),"text-radial-offset":new gt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(we.layout_symbol["text-variable-anchor"]),"text-anchor":new gt(we.layout_symbol["text-anchor"]),"text-max-angle":new it(we.layout_symbol["text-max-angle"]),"text-writing-mode":new it(we.layout_symbol["text-writing-mode"]),"text-rotate":new gt(we.layout_symbol["text-rotate"]),"text-padding":new it(we.layout_symbol["text-padding"]),"text-keep-upright":new it(we.layout_symbol["text-keep-upright"]),"text-transform":new gt(we.layout_symbol["text-transform"]),"text-offset":new gt(we.layout_symbol["text-offset"]),"text-allow-overlap":new it(we.layout_symbol["text-allow-overlap"]),"text-overlap":new it(we.layout_symbol["text-overlap"]),"text-ignore-placement":new it(we.layout_symbol["text-ignore-placement"]),"text-optional":new it(we.layout_symbol["text-optional"])});var mm={paint:new ar({"icon-opacity":new gt(we.paint_symbol["icon-opacity"]),"icon-color":new gt(we.paint_symbol["icon-color"]),"icon-halo-color":new gt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new gt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new it(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new gt(we.paint_symbol["text-opacity"]),"text-color":new gt(we.paint_symbol["text-color"],{runtimeType:kr,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new gt(we.paint_symbol["text-halo-color"]),"text-halo-width":new gt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new gt(we.paint_symbol["text-halo-blur"]),"text-translate":new it(we.paint_symbol["text-translate"]),"text-translate-anchor":new it(we.paint_symbol["text-translate-anchor"])}),layout:v0};class gm{constructor(o){if(void 0===o.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Qo,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}et("FormatSectionOverride",gm,{omit:["defaultValue"]});class Nl extends is{constructor(o){super(o,mm)}recalculate(o,c){if(super.recalculate(o,c),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const v of d)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,d,g){const v=this.layout.get(o).evaluate(c,{},d,g),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||_l(b.value)||!v?v:(D=c.properties,v.replace(/{([^{}]+)}/g,(M,R)=>R in D?String(D[R]):""));var D}createBucket(o){return new Pu(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of mm.paint.overridableProperties){if(!Nl.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),d=new gm(c),g=new ao(d,c.property.specification);let v=null;v="constant"===c.value.kind||"source"===c.value.kind?new Aa("source",g):new rt("composite",g,c.value.zoomStops),this.paint._values[o]=new di(c.property,v,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Nl.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const d=o.get("text-field"),g=mm.paint.properties[c];let v=!1;const b=D=>{for(const I of D)if(g.overrides&&g.overrides.hasOverride(I))return void(v=!0)};if("constant"===d.value.kind&&d.value.value instanceof ne)b(d.value.value.sections);else if("source"===d.value.kind){const D=M=>{v||(M instanceof st&&ye(M.value)===Dr?b(M.value.sections):M instanceof Sa?b(M.sections):M.eachChild(D))},I=d.value;I._styleExpression&&D(I._styleExpression.expression)}return v}}function ku(a,o,c){let d="never";const g=a.get(o);return g?d=g:a.get(c)&&(d="always"),d}var ym={paint:new ar({"background-color":new it(we.paint_background["background-color"]),"background-pattern":new uo(we.paint_background["background-pattern"]),"background-opacity":new it(we.paint_background["background-opacity"])})},_m={paint:new ar({"raster-opacity":new it(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(we.paint_raster["raster-brightness-max"]),"raster-saturation":new it(we.paint_raster["raster-saturation"]),"raster-contrast":new it(we.paint_raster["raster-contrast"]),"raster-resampling":new it(we.paint_raster["raster-resampling"]),"raster-fade-duration":new it(we.paint_raster["raster-fade-duration"])})};class vm extends is{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Sc={circle:class extends is{constructor(a){super(a,hy)}createBucket(a){return new Va(a)}queryRadius(a){const o=a;return Dt("circle-radius",this,o)+Dt("circle-stroke-width",this,o)+yu(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,c,d,g,v,b,D){const I=Hh(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,b),M=this.paint.get("circle-radius").evaluate(o,c)+this.paint.get("circle-stroke-width").evaluate(o,c),R="map"===this.paint.get("circle-pitch-alignment"),L=R?I:($=D,I.map(ee=>cr(ee,$))),B=R?M*b:M;var $;for(const V of d)for(const $ of V){const ee=R?$:cr($,D);let K=B;const ue=tn([],[$.x,$.y,0,1],D);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?K*=ue[3]/v.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(K*=v.cameraToCenterDistance/ue[3]),ly(L,ee,K))return!0}return!1}},heatmap:class extends is{constructor(a){super(a,Uf),this._updateColorRamp()}createBucket(a){return new Xr(a)}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends is{constructor(a){super(a,$f)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends is{constructor(a){super(a,Gf)}recalculate(a,o){super.recalculate(a,o);const c=this.paint._values["fill-outline-color"];"constant"===c.value.kind&&void 0===c.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new yc(a)}queryRadius(){return yu(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,c,d,g,v,b){return gu(Hh(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,b),d)}isTileClipped(){return!0}},"fill-extrusion":class extends is{constructor(a){super(a,Sy)}createBucket(a){return new Wf(a)}queryRadius(){return yu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,o,c,d,g,v,b,D){const I=Hh(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,b),M=this.paint.get("fill-extrusion-height").evaluate(o,c),R=this.paint.get("fill-extrusion-base").evaluate(o,c),L=function(V,$,ee,K){const ue=[];for(const ge of V){const ae=[ge.x,ge.y,0,1];tn(ae,ae,$),ue.push(new xt(ae[0]/ae[3],ae[1]/ae[3]))}return ue}(I,D),B=function(V,$,ee,K){const ue=[],ge=[],ae=K[8]*$,fe=K[9]*$,Se=K[10]*$,Te=K[11]*$,Je=K[8]*ee,ot=K[9]*ee,qe=K[10]*ee,$e=K[11]*ee;for(const Ve of V){const We=[],Ge=[];for(const Oe of Ve){const pt=Oe.x,nt=Oe.y,Rt=K[0]*pt+K[4]*nt+K[12],kn=K[1]*pt+K[5]*nt+K[13],zn=K[2]*pt+K[6]*nt+K[14],Mr=K[3]*pt+K[7]*nt+K[15],Ti=zn+Se,Kr=Mr+Te,ir=Rt+Je,vr=kn+ot,Vr=zn+qe,Ur=Mr+$e,Si=new xt((Rt+ae)/Kr,(kn+fe)/Kr);Si.z=Ti/Kr,We.push(Si);const Zn=new xt(ir/Ur,vr/Ur);Zn.z=Vr/Ur,Ge.push(Zn)}ue.push(We),ge.push(Ge)}return[ue,ge]}(d,R,M,D);return function(V,$,ee){let K=1/0;gu(ee,$)&&(K=Yf(ee,$[0]));for(let ue=0;ue<$.length;ue++){const ge=$[ue],ae=V[ue];for(let fe=0;fe<ge.length-1;fe++){const Se=ge[fe],Te=[Se,ge[fe+1],ae[fe+1],ae[fe],Se];ki(ee,Te)&&(K=Math.min(K,Yf(ee,Te)))}}return K!==1/0&&K}(B[0],B[1],L)}},line:class extends is{constructor(a){super(a,ip),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){"line-gradient"===a&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ct,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=em.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Cd(a)}queryRadius(a){const o=a,c=Du(Dt("line-width",this,o),Dt("line-gap-width",this,o)),d=Dt("line-offset",this,o);return c/2+Math.abs(d)+yu(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,c,d,g,v,b){const D=Hh(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,b),I=b/2*Du(this.paint.get("line-width").evaluate(o,c),this.paint.get("line-gap-width").evaluate(o,c)),M=this.paint.get("line-offset").evaluate(o,c);return M&&(d=function(R,L){const B=[];for(let V=0;V<R.length;V++){const $=R[V],ee=[];for(let K=0;K<$.length;K++){const ue=$[K-1],ge=$[K],ae=$[K+1],fe=0===K?new xt(0,0):ge.sub(ue)._unit()._perp(),Se=K===$.length-1?new xt(0,0):ae.sub(ge)._unit()._perp(),Te=fe._add(Se)._unit(),Je=Te.x*Se.x+Te.y*Se.y;0!==Je&&Te._mult(1/Je),ee.push(Te._mult(L)._add(ge))}B.push(ee)}return B}(d,M*b)),function(R,L,B){for(let V=0;V<L.length;V++){const $=L[V];if(R.length>=3)for(let ee=0;ee<$.length;ee++)if(Sl(R,$[ee]))return!0;if(cy(R,$,B))return!0}return!1}(D,d,I)}isTileClipped(){return!0}},symbol:Nl,background:class extends is{constructor(a){super(a,ym)}},raster:class extends is{constructor(a){super(a,_m)}}};class xm{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Dp=6371008.8;class Nn{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nn(Go(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,d=this.lat*c,g=o.lat*c,v=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((o.lng-this.lng)*c);return Dp*Math.acos(Math.min(v,1))}toBounds(o=0){const c=360*o/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new zs(new Nn(this.lng-d,this.lat-c),new Nn(this.lng+d,this.lat+c))}static convert(o){if(o instanceof Nn)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Nn(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Nn(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class zs{constructor(o,c){o&&(c?this.setSouthWest(o).setNorthEast(c):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Nn?new Nn(o.lng,o.lat):Nn.convert(o),this}setSouthWest(o){return this._sw=o instanceof Nn?new Nn(o.lng,o.lat):Nn.convert(o),this}extend(o){const c=this._sw,d=this._ne;let g,v;if(o instanceof Nn)g=o,v=o;else{if(!(o instanceof zs))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(zs.convert(o)):this.extend(Nn.convert(o)):this;if(g=o._sw,v=o._ne,!g||!v)return this}return c||d?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),d.lng=Math.max(v.lng,d.lng),d.lat=Math.max(v.lat,d.lat)):(this._sw=new Nn(g.lng,g.lat),this._ne=new Nn(v.lng,v.lat)),this}getCenter(){return new Nn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Nn(this.getWest(),this.getNorth())}getSouthEast(){return new Nn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:c,lat:d}=Nn.convert(o);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(o){return o instanceof zs?o:o&&new zs(o)}}const Fi=2*Math.PI*Dp;function bm(a){return Fi*Math.cos(a*Math.PI/180)}function wm(a){return(180+a)/360}function Cm(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Ep(a,o){return a/bm(o)}function Ru(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class Ad{constructor(o,c,d=0){this.x=+o,this.y=+c,this.z=+d}static fromLngLat(o,c=0){const d=Nn.convert(o);return new Ad(wm(d.lng),Cm(d.lat),Ep(c,d.lat))}toLngLat(){return new Nn(360*this.x-180,Ru(this.y))}toAltitude(){return this.z*bm(Ru(this.y))}meterInMercatorCoordinateUnits(){return 1/Fi*(o=Ru(this.y),1/Math.cos(o*Math.PI/180));var o}}function Dm(a,o,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[a*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}class Ip{constructor(o,c,d){if(o<0||o>25||d<0||d>=Math.pow(2,o)||c<0||c>=Math.pow(2,o))throw new Error(`x=${c}, y=${d}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=d,this.key=Fu(0,o,o,c,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,d){const g=(b=this.y,D=this.z,I=Dm(256*(v=this.x),256*(b=Math.pow(2,D)-b-1),D),M=Dm(256*(v+1),256*(b+1),D),I[0]+","+I[1]+","+M[0]+","+M[1]);var v,b,D,I,M;const R=function(L,B,V){let $,ee="";for(let K=L;K>0;K--)$=1<<K-1,ee+=(B&$?1:0)+(V&$?2:0);return ee}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===d?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,g)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new xt((o.x*c-this.x)*zt,(o.y*c-this.y)*zt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tp{constructor(o,c){this.wrap=o,this.canonical=c,this.key=Fu(o,c.z,c.z,c.x,c.y)}}class yo{constructor(o,c,d,g,v){if(o<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${d}`);this.overscaledZ=o,this.wrap=c,this.canonical=new Ip(d,+g,+v),this.key=Fu(c,o,d,g,v)}clone(){return new yo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new yo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yo(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-o;return o>this.canonical.z?Fu(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):Fu(this.wrap*+c,o,o,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new yo(c,this.wrap,c,d,g),new yo(c,this.wrap,c,d+1,g),new yo(c,this.wrap,c,d,g+1),new yo(c,this.wrap,c,d+1,g+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new yo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new Ad(o.x-this.wrap,o.y))}}function Fu(a,o,c,d,g){(a*=2)<0&&(a=-1*a-1);const v=1<<c;return(v*v*a+v*g+d).toString(36)+c.toString(36)+o.toString(36)}et("CanonicalTileID",Ip),et("OverscaledTileID",yo,{omit:["posMatrix"]});class Li{constructor(o,c,d){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&"mapbox"!==d&&"terrarium"!==d)return void jn(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const g=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=d||"mapbox";for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let b=0;b<g;b++){const D=this.get(v,b);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(o,c){const d=new Uint8Array(this.data.buffer),g=4*this._idx(o,c);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(d[g],d[g+1],d[g+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}_unpackMapbox(o,c,d){return(256*o*256+256*c+d)/10-1e4}_unpackTerrarium(o,c,d){return 256*o+c+d/256-32768}getPixels(){return new mo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,v=c*this.dim+this.dim,b=d*this.dim,D=d*this.dim+this.dim;switch(c){case-1:g=v-1;break;case 1:v=g+1}switch(d){case-1:b=D-1;break;case 1:D=b+1}const I=-c*this.dim,M=-d*this.dim;for(let R=b;R<D;R++)for(let L=g;L<v;L++)this.data[this._idx(L,R)]=o.data[this._idx(L+I,R+M)]}}et("DEMData",Li);class Pd{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const d=o[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class Sp{constructor(o,c,d,g,v){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=d,o._y=g,this.properties=o.properties,this.id=v}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)"_geometry"!==c&&"_vectorTileFeature"!==c&&(o[c]=this[c]);return o}}class kd{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Cl(zt,16,0),this.grid3D=new Cl(zt,16,0),this.featureIndexArray=new Bt,this.promoteId=c}insert(o,c,d,g,v,b){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,v);const I=b?this.grid3D:this.grid;for(let M=0;M<c.length;M++){const R=c[M],L=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const V=R[B];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}L[0]<zt&&L[1]<zt&&L[2]>=0&&L[3]>=0&&I.insert(D,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Lo.VectorTile(new sp(this.rawTileData)).layers,this.sourceLayerCoder=new Pd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,d,g){this.loadVTLayers();const v=o.params||{},b=zt/o.tileSize/o.scale,D=Ys(v.filter),I=o.queryGeometry,M=o.queryPadding*b,R=Mc(I),L=this.grid.query(R.minX-M,R.minY-M,R.maxX+M,R.maxY+M),B=Mc(o.cameraQueryGeometry),V=this.grid3D.query(B.minX-M,B.minY-M,B.maxX+M,B.maxY+M,(K,ue,ge,ae)=>function(fe,Se,Te,Je,ot){for(const $e of fe)if(Se<=$e.x&&Te<=$e.y&&Je>=$e.x&&ot>=$e.y)return!0;const qe=[new xt(Se,Te),new xt(Se,ot),new xt(Je,ot),new xt(Je,Te)];if(fe.length>2)for(const $e of qe)if(Sl(fe,$e))return!0;for(let $e=0;$e<fe.length-1;$e++)if(uy(fe[$e],fe[$e+1],qe))return!0;return!1}(o.cameraQueryGeometry,K-M,ue-M,ge+M,ae+M));for(const K of V)L.push(K);L.sort(Em);const $={};let ee;for(let K=0;K<L.length;K++){const ue=L[K];if(ue===ee)continue;ee=ue;const ge=this.featureIndexArray.get(ue);let ae=null;this.loadMatchingFeature($,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,D,v.layers,v.availableImages,c,d,g,(fe,Se,Te)=>(ae||(ae=Sr(fe)),Se.queryIntersectsFeature(I,fe,Te,ae,this.z,o.transform,b,o.pixelPosMatrix)))}return $}loadMatchingFeature(o,c,d,g,v,b,D,I,M,R,L){const B=this.bucketLayerIDs[c];if(b&&!function(K,ue){for(let ge=0;ge<K.length;ge++)if(ue.indexOf(K[ge])>=0)return!0;return!1}(b,B))return;const V=this.sourceLayerCoder.decode(d),$=this.vtLayers[V].feature(g);if(v.needGeometry){const K=Tl($,!0);if(!v.filter(new mn(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!v.filter(new mn(this.tileID.overscaledZ),$))return;const ee=this.getId($,V);for(let K=0;K<B.length;K++){const ue=B[K];if(b&&b.indexOf(ue)<0)continue;const ge=I[ue];if(!ge)continue;let ae={};ee&&R&&(ae=R.getState(ge.sourceLayer||"_geojsonTileLayer",ee));const fe=Bi({},M[ue]);fe.paint=fi(fe.paint,ge.paint,$,ae,D),fe.layout=fi(fe.layout,ge.layout,$,ae,D);const Se=!L||L($,ge,ae);if(!Se)continue;const Te=new Sp($,this.z,this.x,this.y,ee);Te.layer=fe;let Je=o[ue];void 0===Je&&(Je=o[ue]=[]),Je.push({featureIndex:g,feature:Te,intersectionZ:Se})}}lookupSymbolFeatures(o,c,d,g,v,b,D,I){const M={};this.loadVTLayers();const R=Ys(v);for(const L of o)this.loadMatchingFeature(M,d,g,L,R,b,D,I,c);return M}hasLayer(o){for(const c of this.bucketLayerIDs)for(const d of c)if(o===d)return!0;return!1}getId(o,c){let d=o.id;return this.promoteId&&(d=o.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[c]],"boolean"==typeof d&&(d=Number(d))),d}}function fi(a,o,c,d,g){return ll(a,(v,b)=>{const D=o instanceof wi?o.get(b):null;return D&&D.evaluate?D.evaluate(c,d,g):D})}function Mc(a){let o=1/0,c=1/0,d=-1/0,g=-1/0;for(const v of a)o=Math.min(o,v.x),c=Math.min(c,v.y),d=Math.max(d,v.x),g=Math.max(g,v.y);return{minX:o,minY:c,maxX:d,maxY:g}}function Em(a,o){return o-a}var Rd;et("FeatureIndex",kd,{omit:["rawTileData","sourceLayerCoder"]}),_.PerformanceMarkers=void 0,(Rd=_.PerformanceMarkers||(_.PerformanceMarkers={})).create="create",Rd.load="load",Rd.fullLoad="fullLoad";let Fd=null,Ac=[];const Mp=1e3/30,Im={mark(a){performance.mark(a)},frame(a){const o=a;null!=Fd&&Ac.push(o-Fd),Fd=o},clearMetrics(){Fd=null,Ac=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in _.PerformanceMarkers)performance.clearMarks(_.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",_.PerformanceMarkers.create,_.PerformanceMarkers.load),performance.measure("fullLoadTime",_.PerformanceMarkers.create,_.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,o=performance.getEntriesByName("fullLoadTime")[0].duration,c=Ac.length,d=1/(Ac.reduce((v,b)=>v+b,0)/c/1e3),g=Ac.filter(v=>v>Mp).reduce((v,b)=>v+(b-Mp)/Mp,0);return{loadTime:a,fullLoadTime:o,fps:d,percentDroppedFrames:g/(c+g)*100}}};_.AJAXError=ai,_.ARRAY_TYPE=pi,_.Actor=class{constructor(a,o,c){this.target=a,this.parent=o,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},tc(["receive","process"],this),this.invoker=new xm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Vi()?a:window}send(a,o,c,d,g=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[v]=c);const b=_a(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:a,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:ea(o,b)},b),{cancel:()=>{c&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const o=a.data,c=o.id;if(c&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){delete this.tasks[c];const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d()}else Vi()||o.mustQueue?(this.tasks[c]=o,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,o)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),o=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(a,o)}processTask(a,o){if("<response>"===o.type){const c=this.callbacks[a];delete this.callbacks[a],c&&(o.error?c(rs(o.error)):c(null,rs(o.data)))}else{let c=!1;const d=_a(this.globalScope)?void 0:[],g=o.hasCallback?(D,I)=>{c=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:D?ea(D):null,data:ea(I,d)},d)}:D=>{c=!0};let v=null;const b=rs(o.data);if(this.parent[o.type])v=this.parent[o.type](o.sourceMapId,b,g);else if(this.parent.getWorkerSource){const D=o.type.split(".");v=this.parent.getWorkerSource(o.sourceMapId,D[0],b.source)[D[1]](b,g)}else g(new Error(`Could not find function ${o.type}`));!c&&v&&v.cancel&&(this.cancelCallbacks[a]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},_.AlphaImage=Pl,_.CanonicalTileID=Ip,_.CollisionBoxArray=Ce,_.CollisionCircleLayoutArray=class extends F{},_.Color=H,_.DEMData=Li,_.DataConstantProperty=it,_.DictionaryCoder=Pd,_.EXTENT=zt,_.ErrorEvent=vs,_.EvaluationParameters=mn,_.Event=Yo,_.Evented=Jo,_.FeatureIndex=kd,_.FillBucket=yc,_.FillExtrusionBucket=Wf,_.GeoJSONFeature=Sp,_.ImageAtlas=Cc,_.ImagePosition=wc,_.LineBucket=Cd,_.LineStripIndexArray=class extends Y{},_.LngLat=Nn,_.LngLatBounds=zs,_.MercatorCoordinate=Ad,_.ONE_EM=_r,_.OverscaledTileID=yo,_.PerformanceUtils=Im,_.PosArray=ct,_.Properties=ar,_.QuadTriangleArray=class extends U{},_.RGBAImage=mo,_.RasterBoundsArray=class extends m{},_.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return 0===a.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},_.ResourceType=$t,_.SegmentVector=Nt,_.SymbolBucket=Pu,_.Transitionable=du,_.TriangleIndexArray=yn,_.Uniform1f=ra,_.Uniform1i=class extends ks{constructor(a,o){super(a,o),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},_.Uniform2f=class extends ks{constructor(a,o){super(a,o),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},_.Uniform3f=class extends ks{constructor(a,o){super(a,o),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},_.Uniform4f=hc,_.UniformColor=fo,_.UniformMatrix4f=class extends ks{constructor(a,o){super(a,o),this.current=Lf}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let o=1;o<16;o++)if(a[o]!==this.current[o]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},_.UnwrappedTileID=Tp,_.ValidationError=He,_.ZoomHistory=Tt,_.add=function(a,o,c){return a[0]=o[0]+c[0],a[1]=o[1]+c[1],a[2]=o[2]+c[2],a},_.addDynamicAttributes=hm,_.asyncAll=function(a,o,c){if(!a.length)return c(null,[]);let d=a.length;const g=new Array(a.length);let v=null;a.forEach((b,D)=>{o(b,(I,M)=>{I&&(v=I),g[D]=M,0==--d&&c(v,g)})})},_.bezier=wo,_.bindAll=tc,_.cacheEntryPossiblyAdded=function(a){Cr++,Cr>xa&&(a.getActor().send("enforceCacheSizeLimit",va),Cr=0)},_.clamp=be,_.clearTileCache=function(a){const o=caches.delete($i);a&&o.catch(a).then(()=>a())},_.clipLine=cm,_.clone=function(a){var o=new pi(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},_.clone$1=si,_.clone$2=function(a){var o=new pi(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o},_.collisionCircleLayout=vc,_.config=Wo,_.copy=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a},_.create=function(){var a=new pi(16);return pi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},_.create$1=Ml,_.createExpression=lt,_.createFilter=Ys,_.createLayout=qn,_.createStyleLayer=function(a){return"custom"===a.type?new vm(a):new Sc[a.type](a)},_.cross=function(a,o,c){var d=o[0],g=o[1],v=o[2],b=c[0],D=c[1],I=c[2];return a[0]=g*I-v*D,a[1]=v*b-d*I,a[2]=d*D-g*b,a},_.dot=function(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]},_.dot$1=function(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]+a[3]*o[3]},_.ease=nn,_.emitValidationErrors=sr,_.enforceCacheSizeLimit=function(a){ba(),hn&&hn.then(o=>{o.keys().then(c=>{for(let d=0;d<c.length-a;d++)o.delete(c[d])})})},_.equals=function(a,o){var c=a[0],d=a[1],g=a[2],v=a[3],b=a[4],D=a[5],I=a[6],M=a[7],R=a[8],L=a[9],B=a[10],V=a[11],$=a[12],ee=a[13],K=a[14],ue=a[15],ge=o[0],ae=o[1],fe=o[2],Se=o[3],Te=o[4],Je=o[5],ot=o[6],qe=o[7],$e=o[8],Ve=o[9],We=o[10],Ge=o[11],Oe=o[12],pt=o[13],nt=o[14],Rt=o[15];return Math.abs(c-ge)<=Ei*Math.max(1,Math.abs(c),Math.abs(ge))&&Math.abs(d-ae)<=Ei*Math.max(1,Math.abs(d),Math.abs(ae))&&Math.abs(g-fe)<=Ei*Math.max(1,Math.abs(g),Math.abs(fe))&&Math.abs(v-Se)<=Ei*Math.max(1,Math.abs(v),Math.abs(Se))&&Math.abs(b-Te)<=Ei*Math.max(1,Math.abs(b),Math.abs(Te))&&Math.abs(D-Je)<=Ei*Math.max(1,Math.abs(D),Math.abs(Je))&&Math.abs(I-ot)<=Ei*Math.max(1,Math.abs(I),Math.abs(ot))&&Math.abs(M-qe)<=Ei*Math.max(1,Math.abs(M),Math.abs(qe))&&Math.abs(R-$e)<=Ei*Math.max(1,Math.abs(R),Math.abs($e))&&Math.abs(L-Ve)<=Ei*Math.max(1,Math.abs(L),Math.abs(Ve))&&Math.abs(B-We)<=Ei*Math.max(1,Math.abs(B),Math.abs(We))&&Math.abs(V-Ge)<=Ei*Math.max(1,Math.abs(V),Math.abs(Ge))&&Math.abs($-Oe)<=Ei*Math.max(1,Math.abs($),Math.abs(Oe))&&Math.abs(ee-pt)<=Ei*Math.max(1,Math.abs(ee),Math.abs(pt))&&Math.abs(K-nt)<=Ei*Math.max(1,Math.abs(K),Math.abs(nt))&&Math.abs(ue-Rt)<=Ei*Math.max(1,Math.abs(ue),Math.abs(Rt))},_.evaluateSizeForFeature=function(a,{uSize:o,uSizeT:c},{lowerSize:d,upperSize:g}){return"source"===a.kind?d/No:"composite"===a.kind?Pn(d/No,g/No,c):o},_.evaluateSizeForZoom=function(a,o){let c=0,d=0;if("constant"===a.kind)d=a.layoutSize;else if("source"!==a.kind){const{interpolationType:g,minZoom:v,maxZoom:b}=a,D=g?be(Gi.interpolationFactor(g,o,v,b),0,1):0;"camera"===a.kind?d=Pn(a.minSize,a.maxSize,D):c=D}return{uSizeT:c,uSize:d}},_.evaluateVariableOffset=_p,_.evented=Er,_.exported=ms,_.exported$1=Xo,_.extend=Bi,_.filterObject=qo,_.fromRotation=function(a,o){var c=Math.sin(o),d=Math.cos(o);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},_.fromScaling=function(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},_.getAnchorAlignment=pp,_.getAnchorJustification=vp,_.getArrayBuffer=Ca,_.getImage=_s,_.getJSON=function(a,o){return wa(Bi(a,{type:"json"}),o)},_.getOverlapMode=ku,_.getRTLTextPluginStatus=Ao,_.getReferrer=ul,_.getVideo=function(a,o){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let d=0;d<a.length;d++){const g=window.document.createElement("source");dl(a[d])||(c.crossOrigin="Anonymous"),g.src=a[d],c.appendChild(g)}return{cancel:()=>{}}},_.identity=Gh,_.invert=function(a,o){var c=o[0],d=o[1],g=o[2],v=o[3],b=o[4],D=o[5],I=o[6],M=o[7],R=o[8],L=o[9],B=o[10],V=o[11],$=o[12],ee=o[13],K=o[14],ue=o[15],ge=c*D-d*b,ae=c*I-g*b,fe=c*M-v*b,Se=d*I-g*D,Te=d*M-v*D,Je=g*M-v*I,ot=R*ee-L*$,qe=R*K-B*$,$e=R*ue-V*$,Ve=L*K-B*ee,We=L*ue-V*ee,Ge=B*ue-V*K,Oe=ge*Ge-ae*We+fe*Ve+Se*$e-Te*qe+Je*ot;return Oe?(a[0]=(D*Ge-I*We+M*Ve)*(Oe=1/Oe),a[1]=(g*We-d*Ge-v*Ve)*Oe,a[2]=(ee*Je-K*Te+ue*Se)*Oe,a[3]=(B*Te-L*Je-V*Se)*Oe,a[4]=(I*$e-b*Ge-M*qe)*Oe,a[5]=(c*Ge-g*$e+v*qe)*Oe,a[6]=(K*fe-$*Je-ue*ae)*Oe,a[7]=(R*Je-B*fe+V*ae)*Oe,a[8]=(b*We-D*$e+M*ot)*Oe,a[9]=(d*$e-c*We-v*ot)*Oe,a[10]=($*Te-ee*fe+ue*ge)*Oe,a[11]=(L*fe-R*Te-V*ge)*Oe,a[12]=(D*qe-b*Ve-I*ot)*Oe,a[13]=(c*Ve-d*qe+g*ot)*Oe,a[14]=(ee*ae-$*Se-K*ge)*Oe,a[15]=(R*Se-L*ae+B*ge)*Oe,a):null},_.isImageBitmap=Eo,_.isSafari=_a,_.isWorker=Vi,_.keysDifference=function(a,o){const c=[];for(const d in a)d in o||c.push(d);return c},_.lazyLoadRTLTextPlugin=function(){Or.isLoading()||Or.isLoaded()||"deferred"!==Ao()||Gn()},_.makeRequest=wa,_.mapObject=ll,_.mercatorXfromLng=wm,_.mercatorYfromLat=Cm,_.mercatorZfromAltitude=Ep,_.mul=py,_.mul$1=function(a,o,c){return a[0]=o[0]*c[0],a[1]=o[1]*c[1],a[2]=o[2]*c[2],a[3]=o[3]*c[3],a},_.multiply=Bf,_.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},_.normalize=function(a,o){var c=o[0],d=o[1],g=o[2],v=c*c+d*d+g*g;return v>0&&(v=1/Math.sqrt(v)),a[0]=o[0]*v,a[1]=o[1]*v,a[2]=o[2]*v,a},_.number=Pn,_.ortho=function(a,o,c,d,g,v,b){var D=1/(o-c),I=1/(d-g),M=1/(v-b);return a[0]=-2*D,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*I,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(o+c)*D,a[13]=(g+d)*I,a[14]=(b+v)*M,a[15]=1,a},_.parseCacheControl=ya,_.parseGlyphPbf=function(a){return new sp(a).readFields(ky,[])},_.pbf=sp,_.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=zt/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const o=a.bucket.layers[0].layout,c=a.bucket.layers[0]._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new mn(a.bucket.zoom+1),a.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new mn(a.bucket.zoom+1),a.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new mn(18))};if("composite"===a.bucket.textSizeData.kind){const{minZoom:I,maxZoom:M}=a.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new mn(I),a.canonical),c["text-size"].possiblyEvaluate(new mn(M),a.canonical)]}if("composite"===a.bucket.iconSizeData.kind){const{minZoom:I,maxZoom:M}=a.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new mn(I),a.canonical),c["icon-size"].possiblyEvaluate(new mn(M),a.canonical)]}const g=o.get("text-line-height")*_r,v="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement"),b=o.get("text-keep-upright"),D=o.get("text-size");for(const I of a.bucket.features){const M=o.get("text-font").evaluate(I,{},a.canonical).join(","),R=D.evaluate(I,{},a.canonical),L=d.layoutTextSize.evaluate(I,{},a.canonical),B=d.layoutIconSize.evaluate(I,{},a.canonical),V={horizontal:{},vertical:void 0},$=I.text;let ee,K=[0,0];if($){const ae=$.toString(),fe=o.get("text-letter-spacing").evaluate(I,{},a.canonical)*_r,Se=Zr(ae)?fe:0,Te=o.get("text-anchor").evaluate(I,{},a.canonical),Je=o.get("text-variable-anchor");if(!Je){const We=o.get("text-radial-offset").evaluate(I,{},a.canonical);K=We?_p(Te,[We*_r,Tc]):o.get("text-offset").evaluate(I,{},a.canonical).map(Ge=>Ge*_r)}let ot=v?"center":o.get("text-justify").evaluate(I,{},a.canonical);const qe=o.get("symbol-placement"),$e="point"===qe?o.get("text-max-width").evaluate(I,{},a.canonical)*_r:0,Ve=()=>{a.bucket.allowVerticalPlacement&&on(ae)&&(V.vertical=up($,a.glyphMap,a.glyphPositions,a.imagePositions,M,$e,g,Te,"left",Se,K,_.WritingMode.vertical,!0,qe,L,R))};if(!v&&Je){const We="auto"===ot?Je.map(Oe=>vp(Oe)):[ot];let Ge=!1;for(let Oe=0;Oe<We.length;Oe++){const pt=We[Oe];if(!V.horizontal[pt])if(Ge)V.horizontal[pt]=V.horizontal[0];else{const nt=up($,a.glyphMap,a.glyphPositions,a.imagePositions,M,$e,g,"center",pt,Se,K,_.WritingMode.horizontal,!1,qe,L,R);nt&&(V.horizontal[pt]=nt,Ge=1===nt.positionedLines.length)}}Ve()}else{"auto"===ot&&(ot=vp(Te));const We=up($,a.glyphMap,a.glyphPositions,a.imagePositions,M,$e,g,Te,ot,Se,K,_.WritingMode.horizontal,!1,qe,L,R);We&&(V.horizontal[ot]=We),Ve(),on(ae)&&v&&b&&(V.vertical=up($,a.glyphMap,a.glyphPositions,a.imagePositions,M,$e,g,Te,ot,Se,K,_.WritingMode.vertical,!1,qe,L,R))}}let ue=!1;if(I.icon&&I.icon.name){const ae=a.imageMap[I.icon.name];ae&&(ee=Ly(a.imagePositions[I.icon.name],o.get("icon-offset").evaluate(I,{},a.canonical),o.get("icon-anchor").evaluate(I,{},a.canonical)),ue=!!ae.sdf,void 0===a.bucket.sdfIcons?a.bucket.sdfIcons=ue:a.bucket.sdfIcons!==ue&&jn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==a.bucket.pixelRatio||0!==o.get("icon-rotate").constantOr(1))&&(a.bucket.iconsNeedLinear=!0))}const ge=By(V.horizontal)||V.vertical;a.bucket.iconsInText=!!ge&&ge.iconsInText,(ge||ee)&&dm(a.bucket,I,V,ee,a.imageMap,d,L,B,K,ue,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},_.perspective=function(a,o,c,d,g){var v,b=1/Math.tan(o/2);return a[0]=b/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=g&&g!==1/0?(a[10]=(g+d)*(v=1/(d-g)),a[14]=2*g*d*v):(a[10]=-1,a[14]=-2*d),a},_.pick=function(a,o){const c={};for(let d=0;d<o.length;d++){const g=o[d];g in a&&(c[g]=a[g])}return c},_.plugin=Or,_.pointGeometry=xt,_.polygonIntersectsPolygon=ki,_.potpack=cp,_.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],_.register=et,_.registerForPluginStateChange=function(a){return a({pluginStatus:vt,pluginURL:bn}),Er.on("pluginStateChange",a),a},_.renderColorRamp=fy,_.rotateX=function(a,o,c){var d=Math.sin(c),g=Math.cos(c),v=o[4],b=o[5],D=o[6],I=o[7],M=o[8],R=o[9],L=o[10],B=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=v*g+M*d,a[5]=b*g+R*d,a[6]=D*g+L*d,a[7]=I*g+B*d,a[8]=M*g-v*d,a[9]=R*g-b*d,a[10]=L*g-D*d,a[11]=B*g-I*d,a},_.rotateZ=function(a,o,c){var d=Math.sin(c),g=Math.cos(c),v=o[0],b=o[1],D=o[2],I=o[3],M=o[4],R=o[5],L=o[6],B=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=v*g+M*d,a[1]=b*g+R*d,a[2]=D*g+L*d,a[3]=I*g+B*d,a[4]=M*g-v*d,a[5]=R*g-b*d,a[6]=L*g-D*d,a[7]=B*g-I*d,a},_.scale=function(a,o,c){var d=c[0],g=c[1],v=c[2];return a[0]=o[0]*d,a[1]=o[1]*d,a[2]=o[2]*d,a[3]=o[3]*d,a[4]=o[4]*g,a[5]=o[5]*g,a[6]=o[6]*g,a[7]=o[7]*g,a[8]=o[8]*v,a[9]=o[9]*v,a[10]=o[10]*v,a[11]=o[11]*v,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a},_.scale$1=function(a,o,c){return a[0]=o[0]*c,a[1]=o[1]*c,a[2]=o[2]*c,a},_.setCacheLimits=function(a,o){va=a,xa=o},_.setRTLTextPlugin=function(a,o,c=!1){if(vt===cu||vt===uu||vt===tr)throw new Error("setRTLTextPlugin cannot be called multiple times.");bn=ms.resolveURL(a),vt=cu,tt=o,Xi(),c||Gn()},_.spec=we,_.sphericalToCartesian=function([a,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:a*Math.cos(o)*Math.sin(c),y:a*Math.sin(o)*Math.sin(c),z:a*Math.cos(c)}},_.sqrLen=function(a){var o=a[0],c=a[1];return o*o+c*c},_.sub=function(a,o,c){return a[0]=o[0]-c[0],a[1]=o[1]-c[1],a[2]=o[2]-c[2],a},_.toEvaluationFeature=Tl,_.transformMat3=function(a,o,c){var d=o[0],g=o[1],v=o[2];return a[0]=d*c[0]+g*c[3]+v*c[6],a[1]=d*c[1]+g*c[4]+v*c[7],a[2]=d*c[2]+g*c[5]+v*c[8],a},_.transformMat4=tn,_.transformMat4$1=function(a,o,c){var d=o[0],g=o[1];return a[0]=c[0]*d+c[4]*g+c[12],a[1]=c[1]*d+c[5]*g+c[13],a},_.translate=function(a,o,c){var d,g,v,b,D,I,M,R,L,B,V,$,ee=c[0],K=c[1],ue=c[2];return o===a?(a[12]=o[0]*ee+o[4]*K+o[8]*ue+o[12],a[13]=o[1]*ee+o[5]*K+o[9]*ue+o[13],a[14]=o[2]*ee+o[6]*K+o[10]*ue+o[14],a[15]=o[3]*ee+o[7]*K+o[11]*ue+o[15]):(g=o[1],v=o[2],b=o[3],D=o[4],I=o[5],M=o[6],R=o[7],L=o[8],B=o[9],V=o[10],$=o[11],a[0]=d=o[0],a[1]=g,a[2]=v,a[3]=b,a[4]=D,a[5]=I,a[6]=M,a[7]=R,a[8]=L,a[9]=B,a[10]=V,a[11]=$,a[12]=d*ee+D*K+L*ue+o[12],a[13]=g*ee+I*K+B*ue+o[13],a[14]=v*ee+M*K+V*ue+o[14],a[15]=b*ee+R*K+$*ue+o[15]),a},_.triggerPluginCompletionEvent=Wi,_.unicodeBlockLookup=Be,_.uniqueId=function(){return Un++},_.validateCustomStyleLayer=function(a){const o=[],c=a.id;return void 0===c&&o.push({message:`layers.${c}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},_.validateLight=au,_.validateStyle=Na,_.vectorTile=Lo,_.warnOnce=jn,_.wrap=Go}),$c(0,function(_){function Wn(G){const k=typeof G;if("number"===k||"boolean"===k||"string"===k||null==G)return JSON.stringify(G);if(Array.isArray(G)){let H="[";for(const Q of G)H+=`${Wn(Q)},`;return`${H}]`}const N=Object.keys(G).sort();let j="{";for(let H=0;H<N.length;H++)j+=`${JSON.stringify(N[H])}:${Wn(G[N[H]])},`;return`${j}}`}function Ho(G){let k="";for(const N of _.refProperties)k+=`/${Wn(G[N])}`;return k}class wo{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,N){for(const H of k){this._layerConfigs[H.id]=H;const Q=this._layers[H.id]=_.createStyleLayer(H);Q._featureFilter=_.createFilter(Q.filter),this.keyCache[H.id]&&delete this.keyCache[H.id]}for(const H of N)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const j=function(H,Q){const ie={};for(let te=0;te<H.length;te++){const oe=Q&&Q[H[te].id]||Ho(H[te]);Q&&(Q[H[te].id]=oe);let _e=ie[oe];_e||(_e=ie[oe]=[]),_e.push(H[te])}const ne=[];for(const te in ie)ne.push(ie[te]);return ne}(Object.values(this._layerConfigs),this.keyCache);for(const H of j){const Q=H.map(Pe=>this._layers[Pe.id]),ie=Q[0];if("none"===ie.visibility)continue;const ne=ie.source||"";let te=this.familiesBySource[ne];te||(te=this.familiesBySource[ne]={});const oe=ie.sourceLayer||"_geojsonTileLayer";let _e=te[oe];_e||(_e=te[oe]=[]),_e.push(Q)}}}class nn{constructor(k){const N={},j=[];for(const ne in k){const te=k[ne],oe=N[ne]={};for(const _e in te){const Pe=te[+_e];if(!Pe||0===Pe.bitmap.width||0===Pe.bitmap.height)continue;const ye={x:0,y:0,w:Pe.bitmap.width+2,h:Pe.bitmap.height+2};j.push(ye),oe[_e]={rect:ye,metrics:Pe.metrics}}}const{w:H,h:Q}=_.potpack(j),ie=new _.AlphaImage({width:H||1,height:Q||1});for(const ne in k){const te=k[ne];for(const oe in te){const _e=te[+oe];if(!_e||0===_e.bitmap.width||0===_e.bitmap.height)continue;const Pe=N[ne][oe].rect;_.AlphaImage.copy(_e.bitmap,ie,{x:0,y:0},{x:Pe.x+1,y:Pe.y+1},_e.bitmap)}}this.image=ie,this.positions=N}}_.register("GlyphAtlas",nn);class be{constructor(k){this.tileID=new _.OverscaledTileID(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId}parse(k,N,j,H,Q){this.status="parsing",this.data=k,this.collisionBoxArray=new _.CollisionBoxArray;const ie=new _.DictionaryCoder(Object.keys(k.layers).sort()),ne=new _.FeatureIndex(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const te={},oe={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},_e=N.familiesBySource[this.source];for(const bt in _e){const Lt=k.layers[bt];if(!Lt)continue;1===Lt.version&&_.warnOnce(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=ie.encode(bt),vn=[];for(let Xn=0;Xn<Lt.length;Xn++){const Ln=Lt.feature(Xn),Rr=ne.getId(Ln,bt);vn.push({feature:Ln,id:Rr,index:Xn,sourceLayerIndex:Ht})}for(const Xn of _e[bt]){const Ln=Xn[0];Ln.source!==this.source&&_.warnOnce(`layer.source = ${Ln.source} does not equal this.source = ${this.source}`),Ln.minzoom&&this.zoom<Math.floor(Ln.minzoom)||Ln.maxzoom&&this.zoom>=Ln.maxzoom||"none"!==Ln.visibility&&(Go(Xn,this.zoom,j),(te[Ln.id]=Ln.createBucket({index:ne.bucketLayerIDs.length,layers:Xn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source})).populate(vn,oe,this.tileID.canonical),ne.bucketLayerIDs.push(Xn.map(Rr=>Rr.id)))}}let Pe,ye,Ke,st;const ze=_.mapObject(oe.glyphDependencies,bt=>Object.keys(bt).map(Number));Object.keys(ze).length?H.send("getGlyphs",{uid:this.uid,stacks:ze},(bt,Lt)=>{Pe||(Pe=bt,ye=Lt,Qt.call(this))}):ye={};const dt=Object.keys(oe.iconDependencies);dt.length?H.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"icons"},(bt,Lt)=>{Pe||(Pe=bt,Ke=Lt,Qt.call(this))}):Ke={};const ht=Object.keys(oe.patternDependencies);function Qt(){if(Pe)return Q(Pe);if(ye&&Ke&&st){const bt=new nn(ye),Lt=new _.ImageAtlas(Ke,st);for(const Ht in te){const vn=te[Ht];vn instanceof _.SymbolBucket?(Go(vn.layers,this.zoom,j),_.performSymbolLayout({bucket:vn,glyphMap:ye,glyphPositions:bt.positions,imageMap:Ke,imagePositions:Lt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):vn.hasPattern&&(vn instanceof _.LineBucket||vn instanceof _.FillBucket||vn instanceof _.FillExtrusionBucket)&&(Go(vn.layers,this.zoom,j),vn.addFeatures(oe,this.tileID.canonical,Lt.patternPositions))}this.status="done",Q(null,{buckets:Object.values(te).filter(Ht=>!Ht.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bt.image,imageAtlas:Lt,glyphMap:this.returnDependencies?ye:null,iconMap:this.returnDependencies?Ke:null,glyphPositions:this.returnDependencies?bt.positions:null})}}ht.length?H.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"patterns"},(bt,Lt)=>{Pe||(Pe=bt,st=Lt,Qt.call(this))}):st={},Qt.call(this)}}function Go(G,k,N){const j=new _.EvaluationParameters(k);for(const H of G)H.recalculate(j,N)}function Bi(G,k){const N=_.getArrayBuffer(G.request,(j,H,Q,ie)=>{j?k(j):H&&k(null,{vectorTile:new _.vectorTile.VectorTile(new _.pbf(H)),rawData:H,cacheControl:Q,expires:ie})});return()=>{N.cancel(),k()}}class Un{constructor(k,N,j,H){this.actor=k,this.layerIndex=N,this.availableImages=j,this.loadVectorData=H||Bi,this.loading={},this.loaded={}}loadTile(k,N){const j=k.uid;this.loading||(this.loading={});const H=!!(k&&k.request&&k.request.collectResourceTiming)&&new _.RequestPerformance(k.request),Q=this.loading[j]=new be(k);Q.abort=this.loadVectorData(k,(ie,ne)=>{if(delete this.loading[j],ie||!ne)return Q.status="done",this.loaded[j]=Q,N(ie);const te=ne.rawData,oe={};ne.expires&&(oe.expires=ne.expires),ne.cacheControl&&(oe.cacheControl=ne.cacheControl);const _e={};if(H){const Pe=H.finish();Pe&&(_e.resourceTiming=JSON.parse(JSON.stringify(Pe)))}Q.vectorTile=ne.vectorTile,Q.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Pe,ye)=>{if(Pe||!ye)return N(Pe);N(null,_.extend({rawTileData:te.slice(0)},ye,oe,_e))}),this.loaded=this.loaded||{},this.loaded[j]=Q})}reloadTile(k,N){const j=this.loaded,H=k.uid,Q=this;if(j&&j[H]){const ie=j[H];ie.showCollisionBoxes=k.showCollisionBoxes;const ne=(te,oe)=>{const _e=ie.reloadCallback;_e&&(delete ie.reloadCallback,ie.parse(ie.vectorTile,Q.layerIndex,this.availableImages,Q.actor,_e)),N(te,oe)};"parsing"===ie.status?ie.reloadCallback=ne:"done"===ie.status&&(ie.vectorTile?ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor,ne):ne())}}abortTile(k,N){const j=this.loading,H=k.uid;j&&j[H]&&j[H].abort&&(j[H].abort(),delete j[H]),N()}removeTile(k,N){const j=this.loaded,H=k.uid;j&&j[H]&&delete j[H],N()}}class tc{constructor(){this.loaded={}}loadTile(k,N){const{uid:j,encoding:H,rawImageData:Q}=k,ie=_.isImageBitmap(Q)?this.getImageData(Q):Q,ne=new _.DEMData(j,ie,H);this.loaded=this.loaded||{},this.loaded[j]=ne,N(null,ne)}getImageData(k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);const N=this.offscreenCanvasContext.getImageData(-1,-1,k.width+2,k.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new _.RGBAImage({width:N.width,height:N.height},N.data)}removeTile(k){const N=this.loaded,j=k.uid;N&&N[j]&&delete N[j]}}var ll=function G(k,N){var j,H=k&&k.type;if("FeatureCollection"===H)for(j=0;j<k.features.length;j++)G(k.features[j],N);else if("GeometryCollection"===H)for(j=0;j<k.geometries.length;j++)G(k.geometries[j],N);else if("Feature"===H)G(k.geometry,N);else if("Polygon"===H)qo(k.coordinates,N);else if("MultiPolygon"===H)for(j=0;j<k.coordinates.length;j++)qo(k.coordinates[j],N);return k};function qo(G,k){if(0!==G.length){si(G[0],k);for(var N=1;N<G.length;N++)si(G[N],!k)}}function si(G,k){for(var N=0,j=0,H=0,Q=G.length,ie=Q-1;H<Q;ie=H++){var ne=(G[H][0]-G[ie][0])*(G[ie][1]+G[H][1]),te=N+ne;j+=Math.abs(N)>=Math.abs(ne)?N-te+ne:ne-te+N,N=te}N+j>=0!=!!k&&G.reverse()}const ro=_.vectorTile.VectorTileFeature.prototype.toGeoJSON;class jn{constructor(k){this._feature=k,this.extent=_.EXTENT,this.type=k.type,this.properties=k.tags,"id"in k&&!isNaN(k.id)&&(this.id=parseInt(k.id,10))}loadGeometry(){if(1===this._feature.type){const k=[];for(const N of this._feature.geometry)k.push([new _.pointGeometry(N[0],N[1])]);return k}{const k=[];for(const N of this._feature.geometry){const j=[];for(const H of N)j.push(new _.pointGeometry(H[0],H[1]));k.push(j)}return k}}toGeoJSON(k,N,j){return ro.call(this,k,N,j)}}class Co{constructor(k){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.EXTENT,this.length=k.length,this._features=k}feature(k){return new jn(this._features[k])}}var Do={exports:{}},Vi=_.pointGeometry,ya=_.vectorTile.VectorTileFeature,Zo=io;function io(G,k){this.options=k||{},this.features=G,this.length=G.length}function Ui(G,k){this.id="number"==typeof G.id?G.id:void 0,this.type=G.type,this.rawGeometry=1===G.type?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=k||4096}io.prototype.feature=function(G){return new Ui(this.features[G],this.options.extent)},Ui.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var k=0;k<G.length;k++){for(var N=G[k],j=[],H=0;H<N.length;H++)j.push(new Vi(N[H][0],N[H][1]));this.geometry.push(j)}return this.geometry},Ui.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,k=1/0,N=-1/0,j=1/0,H=-1/0,Q=0;Q<G.length;Q++)for(var ie=G[Q],ne=0;ne<ie.length;ne++){var te=ie[ne];k=Math.min(k,te.x),N=Math.max(N,te.x),j=Math.min(j,te.y),H=Math.max(H,te.y)}return[k,j,N,H]},Ui.prototype.toGeoJSON=ya.prototype.toGeoJSON;var _a=_.pbf,Eo=Zo;function ms(G){var k=new _a;return function(N,j){for(var H in N.layers)j.writeMessage(3,xt,N.layers[H])}(G,k),k.finish()}function xt(G,k){var N;k.writeVarintField(15,G.version||1),k.writeStringField(1,G.name||""),k.writeVarintField(5,G.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<G.length;N++)j.feature=G.feature(N),k.writeMessage(2,Gr,j);var H=j.keys;for(N=0;N<H.length;N++)k.writeStringField(3,H[N]);var Q=j.values;for(N=0;N<Q.length;N++)k.writeMessage(4,va,Q[N])}function Gr(G,k){var N=G.feature;void 0!==N.id&&k.writeVarintField(1,N.id),k.writeMessage(2,Wo,G),k.writeVarintField(3,N.type),k.writeMessage(4,gs,N)}function Wo(G,k){var N=G.feature,j=G.keys,H=G.values,Q=G.keycache,ie=G.valuecache;for(var ne in N.properties){var te=N.properties[ne],oe=Q[ne];if(null!==te){void 0===oe&&(j.push(ne),Q[ne]=oe=j.length-1),k.writeVarint(oe);var _e=typeof te;"string"!==_e&&"boolean"!==_e&&"number"!==_e&&(te=JSON.stringify(te));var Pe=_e+":"+te,ye=ie[Pe];void 0===ye&&(H.push(te),ie[Pe]=ye=H.length-1),k.writeVarint(ye)}}}function $i(G,k){return(k<<3)+(7&G)}function hn(G){return G<<1^G>>31}function gs(G,k){for(var N=G.loadGeometry(),j=G.type,H=0,Q=0,ie=N.length,ne=0;ne<ie;ne++){var te=N[ne],oe=1;1===j&&(oe=te.length),k.writeVarint($i(1,oe));for(var _e=3===j?te.length-1:te.length,Pe=0;Pe<_e;Pe++){1===Pe&&1!==j&&k.writeVarint($i(2,_e-1));var ye=te[Pe].x-H,Ke=te[Pe].y-Q;k.writeVarint(hn(ye)),k.writeVarint(hn(Ke)),H+=ye,Q+=Ke}3===j&&k.writeVarint($i(7,1))}}function va(G,k){var N=typeof G;"string"===N?k.writeStringField(1,G):"boolean"===N?k.writeBooleanField(7,G):"number"===N&&(G%1!=0?k.writeDoubleField(3,G):G<0?k.writeSVarintField(6,G):k.writeVarintField(5,G))}function xa(G,k,N,j,H,Q){if(H-j<=N)return;const ie=j+H>>1;ba(G,k,ie,j,H,Q%2),xa(G,k,N,j,ie-1,Q+1),xa(G,k,N,ie+1,H,Q+1)}function ba(G,k,N,j,H,Q){for(;H>j;){if(H-j>600){const oe=H-j+1,_e=N-j+1,Pe=Math.log(oe),ye=.5*Math.exp(2*Pe/3),Ke=.5*Math.sqrt(Pe*ye*(oe-ye)/oe)*(_e-oe/2<0?-1:1);ba(G,k,N,Math.max(j,Math.floor(N-_e*ye/oe+Ke)),Math.min(H,Math.floor(N+(oe-_e)*ye/oe+Ke)),Q)}const ie=k[2*N+Q];let ne=j,te=H;for(Cr(G,k,j,N),k[2*H+Q]>ie&&Cr(G,k,j,H);ne<te;){for(Cr(G,k,ne,te),ne++,te--;k[2*ne+Q]<ie;)ne++;for(;k[2*te+Q]>ie;)te--}k[2*j+Q]===ie?Cr(G,k,j,te):(te++,Cr(G,k,te,H)),te<=N&&(j=te+1),N<=te&&(H=te-1)}}function Cr(G,k,N,j){Xo(G,N,j),Xo(k,2*N,2*j),Xo(k,2*N+1,2*j+1)}function Xo(G,k,N){const j=G[k];G[k]=G[N],G[N]=j}function fr(G,k,N,j){const H=G-N,Q=k-j;return H*H+Q*Q}Do.exports=ms,Do.exports.fromVectorTileJs=ms,Do.exports.fromGeojsonVt=function(G,k){k=k||{};var N={};for(var j in G)N[j]=new Eo(G[j].features,k),N[j].name=j,N[j].version=k.version,N[j].extent=k.extent;return ms({layers:N})},Do.exports.GeoJSONWrapper=Eo;const Ko=G=>G[0],pn=G=>G[1];class $n{constructor(k,N=Ko,j=pn,H=64,Q=Float64Array){this.nodeSize=H,this.points=k;const ie=k.length<65536?Uint16Array:Uint32Array,ne=this.ids=new ie(k.length),te=this.coords=new Q(2*k.length);for(let oe=0;oe<k.length;oe++)ne[oe]=oe,te[2*oe]=N(k[oe]),te[2*oe+1]=j(k[oe]);xa(ne,te,H,0,ne.length-1,0)}range(k,N,j,H){return function(Q,ie,ne,te,oe,_e,Pe){const ye=[0,Q.length-1,0],Ke=[];let st,ze;for(;ye.length;){const dt=ye.pop(),ht=ye.pop(),Qt=ye.pop();if(ht-Qt<=Pe){for(let Ht=Qt;Ht<=ht;Ht++)st=ie[2*Ht],ze=ie[2*Ht+1],st>=ne&&st<=oe&&ze>=te&&ze<=_e&&Ke.push(Q[Ht]);continue}const bt=Math.floor((Qt+ht)/2);st=ie[2*bt],ze=ie[2*bt+1],st>=ne&&st<=oe&&ze>=te&&ze<=_e&&Ke.push(Q[bt]);const Lt=(dt+1)%2;(0===dt?ne<=st:te<=ze)&&(ye.push(Qt),ye.push(bt-1),ye.push(Lt)),(0===dt?oe>=st:_e>=ze)&&(ye.push(bt+1),ye.push(ht),ye.push(Lt))}return Ke}(this.ids,this.coords,k,N,j,H,this.nodeSize)}within(k,N,j){return function(H,Q,ie,ne,te,oe){const _e=[0,H.length-1,0],Pe=[],ye=te*te;for(;_e.length;){const Ke=_e.pop(),st=_e.pop(),ze=_e.pop();if(st-ze<=oe){for(let Lt=ze;Lt<=st;Lt++)fr(Q[2*Lt],Q[2*Lt+1],ie,ne)<=ye&&Pe.push(H[Lt]);continue}const dt=Math.floor((ze+st)/2),ht=Q[2*dt],Qt=Q[2*dt+1];fr(ht,Qt,ie,ne)<=ye&&Pe.push(H[dt]);const bt=(Ke+1)%2;(0===Ke?ie-te<=ht:ne-te<=Qt)&&(_e.push(ze),_e.push(dt-1),_e.push(bt)),(0===Ke?ie+te>=ht:ne+te>=Qt)&&(_e.push(dt+1),_e.push(st),_e.push(bt))}return Pe}(this.ids,this.coords,k,N,j,this.nodeSize)}}const cl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},$t=Math.fround||(ai=new Float32Array(1),G=>(ai[0]=+G,ai[0]));var ai;class ul{constructor(k){this.options=_s(Object.create(cl),k),this.trees=new Array(this.options.maxZoom+1)}load(k){const{log:N,minZoom:j,maxZoom:H,nodeSize:Q}=this.options;N&&console.time("total time");const ie=`prepare ${k.length} points`;N&&console.time(ie),this.points=k;let ne=[];for(let te=0;te<k.length;te++)k[te].geometry&&ne.push(wa(k[te],te));this.trees[H+1]=new $n(ne,hl,So,Q,Float32Array),N&&console.timeEnd(ie);for(let te=H;te>=j;te--){const oe=+Date.now();ne=this._cluster(ne,te),this.trees[te]=new $n(ne,hl,So,Q,Float32Array),N&&console.log("z%d: %d clusters in %dms",te,ne.length,+Date.now()-oe)}return N&&console.timeEnd("total time"),this}getClusters(k,N){let j=((k[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,k[1]));let Q=180===k[2]?180:((k[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)j=-180,Q=180;else if(j>Q){const _e=this.getClusters([j,H,180,ie],N),Pe=this.getClusters([-180,H,Q,ie],N);return _e.concat(Pe)}const ne=this.trees[this._limitZoom(N)],te=ne.range(Yt(j),To(ie),Yt(Q),To(H)),oe=[];for(const _e of te){const Pe=ne.points[_e];oe.push(Pe.numPoints?Ca(Pe):this.points[Pe.index])}return oe}getChildren(k){const N=this._getOriginId(k),j=this._getOriginZoom(k),H="No cluster with the specified id.",Q=this.trees[j];if(!Q)throw new Error(H);const ie=Q.points[N];if(!ie)throw new Error(H);const ne=this.options.radius/(this.options.extent*Math.pow(2,j-1)),te=Q.within(ie.x,ie.y,ne),oe=[];for(const _e of te){const Pe=Q.points[_e];Pe.parentId===k&&oe.push(Pe.numPoints?Ca(Pe):this.points[Pe.index])}if(0===oe.length)throw new Error(H);return oe}getLeaves(k,N,j){const H=[];return this._appendLeaves(H,k,N=N||10,j=j||0,0),H}getTile(k,N,j){const H=this.trees[this._limitZoom(k)],Q=Math.pow(2,k),{extent:ie,radius:ne}=this.options,te=ne/ie,oe=(j-te)/Q,_e=(j+1+te)/Q,Pe={features:[]};return this._addTileFeatures(H.range((N-te)/Q,oe,(N+1+te)/Q,_e),H.points,N,j,Q,Pe),0===N&&this._addTileFeatures(H.range(1-te/Q,oe,1,_e),H.points,Q,j,Q,Pe),N===Q-1&&this._addTileFeatures(H.range(0,oe,te/Q,_e),H.points,-1,j,Q,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(k){let N=this._getOriginZoom(k)-1;for(;N<=this.options.maxZoom;){const j=this.getChildren(k);if(N++,1!==j.length)break;k=j[0].properties.cluster_id}return N}_appendLeaves(k,N,j,H,Q){const ie=this.getChildren(N);for(const ne of ie){const te=ne.properties;if(te&&te.cluster?Q+te.point_count<=H?Q+=te.point_count:Q=this._appendLeaves(k,te.cluster_id,j,H,Q):Q<H?Q++:k.push(ne),k.length===j)break}return Q}_addTileFeatures(k,N,j,H,Q,ie){for(const ne of k){const te=N[ne],oe=te.numPoints;let _e,Pe,ye;if(oe)_e=dl(te),Pe=te.x,ye=te.y;else{const ze=this.points[te.index];_e=ze.properties,Pe=Yt(ze.geometry.coordinates[0]),ye=To(ze.geometry.coordinates[1])}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Pe*Q-j)),Math.round(this.options.extent*(ye*Q-H))]],tags:_e};let st;oe?st=te.id:this.options.generateId?st=te.index:this.points[te.index].id&&(st=this.points[te.index].id),void 0!==st&&(Ke.id=st),ie.features.push(Ke)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,N){const j=[],{radius:H,extent:Q,reduce:ie,minPoints:ne}=this.options,te=H/(Q*Math.pow(2,N));for(let oe=0;oe<k.length;oe++){const _e=k[oe];if(_e.zoom<=N)continue;_e.zoom=N;const Pe=this.trees[N+1],ye=Pe.within(_e.x,_e.y,te),Ke=_e.numPoints||1;let st=Ke;for(const ze of ye){const dt=Pe.points[ze];dt.zoom>N&&(st+=dt.numPoints||1)}if(st>Ke&&st>=ne){let ze=_e.x*Ke,dt=_e.y*Ke,ht=ie&&Ke>1?this._map(_e,!0):null;const Qt=(oe<<5)+(N+1)+this.points.length;for(const bt of ye){const Lt=Pe.points[bt];if(Lt.zoom<=N)continue;Lt.zoom=N;const Ht=Lt.numPoints||1;ze+=Lt.x*Ht,dt+=Lt.y*Ht,Lt.parentId=Qt,ie&&(ht||(ht=this._map(_e,!0)),ie(ht,this._map(Lt)))}_e.parentId=Qt,j.push(Io(ze/st,dt/st,Qt,st,ht))}else if(j.push(_e),st>1)for(const ze of ye){const dt=Pe.points[ze];dt.zoom<=N||(dt.zoom=N,j.push(dt))}}return j}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,N){if(k.numPoints)return N?_s({},k.properties):k.properties;const j=this.points[k.index].properties,H=this.options.map(j);return N&&H===j?_s({},H):H}}function Io(G,k,N,j,H){return{x:$t(G),y:$t(k),zoom:1/0,id:N,parentId:-1,numPoints:j,properties:H}}function wa(G,k){const[N,j]=G.geometry.coordinates;return{x:$t(Yt(N)),y:$t(To(j)),zoom:1/0,index:k,parentId:-1}}function Ca(G){return{type:"Feature",id:G.id,properties:dl(G),geometry:{type:"Point",coordinates:[(k=G.x,360*(k-.5)),ys(G.y)]}};var k}function dl(G){const k=G.numPoints,N=k>=1e4?`${Math.round(k/1e3)}k`:k>=1e3?Math.round(k/100)/10+"k":k;return _s(_s({},G.properties),{cluster:!0,cluster_id:G.id,point_count:k,point_count_abbreviated:N})}function Yt(G){return G/360+.5}function To(G){const k=Math.sin(G*Math.PI/180),N=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return N<0?0:N>1?1:N}function ys(G){const k=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function _s(G,k){for(const N in k)G[N]=k[N];return G}function hl(G){return G.x}function So(G){return G.y}function Yo(G,k,N,j){for(var H,Q=j,ie=N-k>>1,ne=N-k,te=G[k],oe=G[k+1],_e=G[N],Pe=G[N+1],ye=k+3;ye<N;ye+=3){var Ke=vs(G[ye],G[ye+1],te,oe,_e,Pe);if(Ke>Q)H=ye,Q=Ke;else if(Ke===Q){var st=Math.abs(ye-ie);st<ne&&(H=ye,ne=st)}}Q>j&&(H-k>3&&Yo(G,k,H,j),G[H+2]=Q,N-H>3&&Yo(G,H,N,j))}function vs(G,k,N,j,H,Q){var ie=H-N,ne=Q-j;if(0!==ie||0!==ne){var te=((G-N)*ie+(k-j)*ne)/(ie*ie+ne*ne);te>1?(N=H,j=Q):te>0&&(N+=ie*te,j+=ne*te)}return(ie=G-N)*ie+(ne=k-j)*ne}function Jo(G,k,N,j){var H={id:void 0===G?null:G,type:k,geometry:N,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var ie=Q.geometry,ne=Q.type;if("Point"===ne||"MultiPoint"===ne||"LineString"===ne)we(Q,ie);else if("Polygon"===ne||"MultiLineString"===ne)for(var te=0;te<ie.length;te++)we(Q,ie[te]);else if("MultiPolygon"===ne)for(te=0;te<ie.length;te++)for(var oe=0;oe<ie[te].length;oe++)we(Q,ie[te][oe])}(H),H}function we(G,k){for(var N=0;N<k.length;N+=3)G.minX=Math.min(G.minX,k[N]),G.minY=Math.min(G.minY,k[N+1]),G.maxX=Math.max(G.maxX,k[N]),G.maxY=Math.max(G.maxY,k[N+1])}function He(G,k,N,j){if(k.geometry){var H=k.geometry.coordinates,Q=k.geometry.type,ie=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),ne=[],te=k.id;if(N.promoteId?te=k.properties[N.promoteId]:N.generateId&&(te=j||0),"Point"===Q)Hs(H,ne);else if("MultiPoint"===Q)for(var oe=0;oe<H.length;oe++)Hs(H[oe],ne);else if("LineString"===Q)oo(H,ne,ie,!1);else if("MultiLineString"===Q){if(N.lineMetrics){for(oe=0;oe<H.length;oe++)oo(H[oe],ne=[],ie,!1),G.push(Jo(te,"LineString",ne,k.properties));return}Jt(H,ne,ie,!1)}else if("Polygon"===Q)Jt(H,ne,ie,!0);else{if("MultiPolygon"!==Q){if("GeometryCollection"===Q){for(oe=0;oe<k.geometry.geometries.length;oe++)He(G,{id:te,geometry:k.geometry.geometries[oe],properties:k.properties},N,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(oe=0;oe<H.length;oe++){var _e=[];Jt(H[oe],_e,ie,!0),ne.push(_e)}}G.push(Jo(te,Q,ne,k.properties))}}function Hs(G,k){k.push(mr(G[0])),k.push(_i(G[1])),k.push(0)}function oo(G,k,N,j){for(var H,Q,ie=0,ne=0;ne<G.length;ne++){var te=mr(G[ne][0]),oe=_i(G[ne][1]);k.push(te),k.push(oe),k.push(0),ne>0&&(ie+=j?(H*oe-te*Q)/2:Math.sqrt(Math.pow(te-H,2)+Math.pow(oe-Q,2))),H=te,Q=oe}var _e=k.length-3;k[2]=1,Yo(k,0,_e,N),k[_e+2]=1,k.size=Math.abs(ie),k.start=0,k.end=k.size}function Jt(G,k,N,j){for(var H=0;H<G.length;H++){var Q=[];oo(G[H],Q,N,j),k.push(Q)}}function mr(G){return G/360+.5}function _i(G){var k=Math.sin(G*Math.PI/180),N=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return N<0?0:N>1?1:N}function Ai(G,k,N,j,H,Q,ie,ne){if(j/=k,Q>=(N/=k)&&ie<j)return G;if(ie<N||Q>=j)return null;for(var te=[],oe=0;oe<G.length;oe++){var _e=G[oe],Pe=_e.geometry,ye=_e.type,Ke=0===H?_e.minX:_e.minY,st=0===H?_e.maxX:_e.maxY;if(Ke>=N&&st<j)te.push(_e);else if(!(st<N||Ke>=j)){var ze=[];if("Point"===ye||"MultiPoint"===ye)Qo(Pe,ze,N,j,H);else if("LineString"===ye)je(Pe,ze,N,j,H,!1,ne.lineMetrics);else if("MultiLineString"===ye)Et(Pe,ze,N,j,H,!1);else if("Polygon"===ye)Et(Pe,ze,N,j,H,!0);else if("MultiPolygon"===ye)for(var dt=0;dt<Pe.length;dt++){var ht=[];Et(Pe[dt],ht,N,j,H,!0),ht.length&&ze.push(ht)}if(ze.length){if(ne.lineMetrics&&"LineString"===ye){for(dt=0;dt<ze.length;dt++)te.push(Jo(_e.id,ye,ze[dt],_e.tags));continue}"LineString"!==ye&&"MultiLineString"!==ye||(1===ze.length?(ye="LineString",ze=ze[0]):ye="MultiLineString"),"Point"!==ye&&"MultiPoint"!==ye||(ye=3===ze.length?"Point":"MultiPoint"),te.push(Jo(_e.id,ye,ze,_e.tags))}}}return te.length?te:null}function Qo(G,k,N,j,H){for(var Q=0;Q<G.length;Q+=3){var ie=G[Q+H];ie>=N&&ie<=j&&(k.push(G[Q]),k.push(G[Q+1]),k.push(G[Q+2]))}}function je(G,k,N,j,H,Q,ie){for(var ne,te,oe=Ft(G),_e=0===H?xs:It,Pe=G.start,ye=0;ye<G.length-3;ye+=3){var Ke=G[ye],st=G[ye+1],ze=G[ye+2],dt=G[ye+3],ht=G[ye+4],Qt=0===H?Ke:st,bt=0===H?dt:ht,Lt=!1;ie&&(ne=Math.sqrt(Math.pow(Ke-dt,2)+Math.pow(st-ht,2))),Qt<N?bt>N&&(te=_e(oe,Ke,st,dt,ht,N),ie&&(oe.start=Pe+ne*te)):Qt>j?bt<j&&(te=_e(oe,Ke,st,dt,ht,j),ie&&(oe.start=Pe+ne*te)):kr(oe,Ke,st,ze),bt<N&&Qt>=N&&(te=_e(oe,Ke,st,dt,ht,N),Lt=!0),bt>j&&Qt<=j&&(te=_e(oe,Ke,st,dt,ht,j),Lt=!0),!Q&&Lt&&(ie&&(oe.end=Pe+ne*te),k.push(oe),oe=Ft(G)),ie&&(Pe+=ne)}var Ht=G.length-3;Ke=G[Ht],st=G[Ht+1],ze=G[Ht+2],(Qt=0===H?Ke:st)>=N&&Qt<=j&&kr(oe,Ke,st,ze),Ht=oe.length-3,Q&&Ht>=3&&(oe[Ht]!==oe[0]||oe[Ht+1]!==oe[1])&&kr(oe,oe[0],oe[1],oe[2]),oe.length&&k.push(oe)}function Ft(G){var k=[];return k.size=G.size,k.start=G.start,k.end=G.end,k}function Et(G,k,N,j,H,Q){for(var ie=0;ie<G.length;ie++)je(G[ie],k,N,j,H,Q,!1)}function kr(G,k,N,j){G.push(k),G.push(N),G.push(j)}function xs(G,k,N,j,H,Q){var ie=(Q-k)/(j-k);return G.push(Q),G.push(N+(H-N)*ie),G.push(1),ie}function It(G,k,N,j,H,Q){var ie=(Q-N)/(H-N);return G.push(k+(j-k)*ie),G.push(Q),G.push(1),ie}function es(G,k){for(var N=[],j=0;j<G.length;j++){var H,Q=G[j],ie=Q.type;if("Point"===ie||"MultiPoint"===ie||"LineString"===ie)H=Dr(Q.geometry,k);else if("MultiLineString"===ie||"Polygon"===ie){H=[];for(var ne=0;ne<Q.geometry.length;ne++)H.push(Dr(Q.geometry[ne],k))}else if("MultiPolygon"===ie)for(H=[],ne=0;ne<Q.geometry.length;ne++){for(var te=[],oe=0;oe<Q.geometry[ne].length;oe++)te.push(Dr(Q.geometry[ne][oe],k));H.push(te)}N.push(Jo(Q.id,ie,H,Q.tags))}return N}function Dr(G,k){var N=[];N.size=G.size,void 0!==G.start&&(N.start=G.start,N.end=G.end);for(var j=0;j<G.length;j+=3)N.push(G[j]+k,G[j+1],G[j+2]);return N}function Da(G,k){if(G.transformed)return G;var N,j,H,Q=1<<G.z,ie=G.x,ne=G.y;for(N=0;N<G.features.length;N++){var te=G.features[N],oe=te.geometry,_e=te.type;if(te.geometry=[],1===_e)for(j=0;j<oe.length;j+=2)te.geometry.push(or(oe[j],oe[j+1],k,Q,ie,ne));else for(j=0;j<oe.length;j++){var Pe=[];for(H=0;H<oe[j].length;H+=2)Pe.push(or(oe[j][H],oe[j][H+1],k,Q,ie,ne));te.geometry.push(Pe)}}return G.transformed=!0,G}function or(G,k,N,j,H,Q){return[Math.round(N*(G*j-H)),Math.round(N*(k*j-Q))]}function li(G,k,N,j,H){for(var Q=k===H.maxZoom?0:H.tolerance/((1<<k)*H.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:j,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<G.length;ne++){ie.numFeatures++,_n(ie,G[ne],Q,H);var te=G[ne].minX,oe=G[ne].minY,_e=G[ne].maxX,Pe=G[ne].maxY;te<ie.minX&&(ie.minX=te),oe<ie.minY&&(ie.minY=oe),_e>ie.maxX&&(ie.maxX=_e),Pe>ie.maxY&&(ie.maxY=Pe)}return ie}function _n(G,k,N,j){var H=k.geometry,Q=k.type,ie=[];if("Point"===Q||"MultiPoint"===Q)for(var ne=0;ne<H.length;ne+=3)ie.push(H[ne]),ie.push(H[ne+1]),G.numPoints++,G.numSimplified++;else if("LineString"===Q)pl(ie,H,G,N,!1,!1);else if("MultiLineString"===Q||"Polygon"===Q)for(ne=0;ne<H.length;ne++)pl(ie,H[ne],G,N,"Polygon"===Q,0===ne);else if("MultiPolygon"===Q)for(var te=0;te<H.length;te++){var oe=H[te];for(ne=0;ne<oe.length;ne++)pl(ie,oe[ne],G,N,!0,0===ne)}if(ie.length){var _e=k.tags||null;if("LineString"===Q&&j.lineMetrics){for(var Pe in _e={},k.tags)_e[Pe]=k.tags[Pe];_e.mapbox_clip_start=H.start/H.size,_e.mapbox_clip_end=H.end/H.size}var ye={geometry:ie,type:"Polygon"===Q||"MultiPolygon"===Q?3:"LineString"===Q||"MultiLineString"===Q?2:1,tags:_e};null!==k.id&&(ye.id=k.id),G.features.push(ye)}}function pl(G,k,N,j,H,Q){var ie=j*j;if(j>0&&k.size<(H?ie:j))N.numPoints+=k.length/3;else{for(var ne=[],te=0;te<k.length;te+=3)(0===j||k[te+2]>ie)&&(N.numSimplified++,ne.push(k[te]),ne.push(k[te+1])),N.numPoints++;H&&function(oe,_e){for(var Pe=0,ye=0,Ke=oe.length,st=Ke-2;ye<Ke;st=ye,ye+=2)Pe+=(oe[ye]-oe[st])*(oe[ye+1]+oe[st+1]);if(Pe>0===_e)for(ye=0,Ke=oe.length;ye<Ke/2;ye+=2){var ze=oe[ye],dt=oe[ye+1];oe[ye]=oe[Ke-2-ye],oe[ye+1]=oe[Ke-1-ye],oe[Ke-2-ye]=ze,oe[Ke-1-ye]=dt}}(ne,Q),G.push(ne)}}function so(G,k){var N=(k=this.options=function(H,Q){for(var ie in Q)H[ie]=Q[ie];return H}(Object.create(this.options),k)).debug;if(N&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var H,Q,ie,ne,te,oe,j=function(H,Q){var ie=[];if("FeatureCollection"===H.type)for(var ne=0;ne<H.features.length;ne++)He(ie,H.features[ne],Q,ne);else He(ie,"Feature"===H.type?H:{geometry:H},Q);return ie}(G,k);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=H=j,te=Ai(H,1,-1-(ie=(Q=k).buffer/Q.extent),ie,0,-1,2,Q),oe=Ai(H,1,1-ie,2+ie,0,-1,2,Q),(te||oe)&&(ne=Ai(H,1,-ie,1+ie,0,-1,2,Q)||[],te&&(ne=es(te,1).concat(ne)),oe&&(ne=ne.concat(es(oe,-1)))),(j=ne).length&&this.splitTile(j,0,0,0),N&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bs(G,k,N){return 32*((1<<G)*N+k)+G}function ws(G,k){const N=G.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);const j=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!j)return k(null,null);const H=new Co(j.features);let Q=Do.exports(H);0===Q.byteOffset&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),k(null,{vectorTile:H,rawData:Q.buffer})}so.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},so.prototype.splitTile=function(G,k,N,j,H,Q,ie){for(var ne=[G,k,N,j],te=this.options,oe=te.debug;ne.length;){j=ne.pop(),N=ne.pop(),k=ne.pop(),G=ne.pop();var _e=1<<k,Pe=bs(k,N,j),ye=this.tiles[Pe];if(!ye&&(oe>1&&console.time("creation"),ye=this.tiles[Pe]=li(G,k,N,j,te),this.tileCoords.push({z:k,x:N,y:j}),oe)){oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,N,j,ye.numFeatures,ye.numPoints,ye.numSimplified),console.timeEnd("creation"));var Ke="z"+k;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(ye.source=G,H){if(k===te.maxZoom||k===H)continue;var st=1<<H-k;if(N!==Math.floor(Q/st)||j!==Math.floor(ie/st))continue}else if(k===te.indexMaxZoom||ye.numPoints<=te.indexMaxPoints)continue;if(ye.source=null,0!==G.length){oe>1&&console.time("clipping");var ze,dt,ht,Qt,bt,Lt,Ht=.5*te.buffer/te.extent,vn=.5-Ht,Xn=.5+Ht,Ln=1+Ht;ze=dt=ht=Qt=null,bt=Ai(G,_e,N-Ht,N+Xn,0,ye.minX,ye.maxX,te),Lt=Ai(G,_e,N+vn,N+Ln,0,ye.minX,ye.maxX,te),G=null,bt&&(ze=Ai(bt,_e,j-Ht,j+Xn,1,ye.minY,ye.maxY,te),dt=Ai(bt,_e,j+vn,j+Ln,1,ye.minY,ye.maxY,te),bt=null),Lt&&(ht=Ai(Lt,_e,j-Ht,j+Xn,1,ye.minY,ye.maxY,te),Qt=Ai(Lt,_e,j+vn,j+Ln,1,ye.minY,ye.maxY,te),Lt=null),oe>1&&console.timeEnd("clipping"),ne.push(ze||[],k+1,2*N,2*j),ne.push(dt||[],k+1,2*N,2*j+1),ne.push(ht||[],k+1,2*N+1,2*j),ne.push(Qt||[],k+1,2*N+1,2*j+1)}}},so.prototype.getTile=function(G,k,N){var j=this.options,H=j.extent,Q=j.debug;if(G<0||G>24)return null;var ie=1<<G,ne=bs(G,k=(k%ie+ie)%ie,N);if(this.tiles[ne])return Da(this.tiles[ne],H);Q>1&&console.log("drilling down to z%d-%d-%d",G,k,N);for(var te,oe=G,_e=k,Pe=N;!te&&oe>0;)oe--,_e=Math.floor(_e/2),Pe=Math.floor(Pe/2),te=this.tiles[bs(oe,_e,Pe)];return te&&te.source?(Q>1&&console.log("found parent tile z%d-%d-%d",oe,_e,Pe),Q>1&&console.time("drilling down"),this.splitTile(te.source,oe,_e,Pe,G,k,N),Q>1&&console.timeEnd("drilling down"),this.tiles[ne]?Da(this.tiles[ne],H):null):null};class Gs extends Un{constructor(k,N,j,H){super(k,N,j,ws),H&&(this.loadGeoJSON=H)}loadData(k,N){var j;null===(j=this._pendingRequest)||void 0===j||j.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const H=!!(k&&k.request&&k.request.collectResourceTiming)&&new _.RequestPerformance(k.request);this._pendingCallback=N,this._pendingRequest=this.loadGeoJSON(k,(Q,ie)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!ie)return N(Q);if("object"!=typeof ie)return N(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{ll(ie,!0);try{if(k.filter){const te=_.createExpression(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===te.result)throw new Error(te.value.map(_e=>`${_e.key}: ${_e.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(_e=>te.value.evaluate({zoom:0},_e))}}this._geoJSONIndex=k.cluster?new ul(function({superclusterOptions:te,clusterProperties:oe}){if(!oe||!te)return te;const _e={},Pe={},ye={accumulated:null,zoom:0},Ke={properties:null},st=Object.keys(oe);for(const ze of st){const[dt,ht]=oe[ze],Qt=_.createExpression(ht),bt=_.createExpression("string"==typeof dt?[dt,["accumulated"],["get",ze]]:dt);_e[ze]=Qt.value,Pe[ze]=bt.value}return te.map=ze=>{Ke.properties=ze;const dt={};for(const ht of st)dt[ht]=_e[ht].evaluate(ye,Ke);return dt},te.reduce=(ze,dt)=>{Ke.properties=dt;for(const ht of st)ye.accumulated=ze[ht],ze[ht]=Pe[ht].evaluate(ye,Ke)},te}(k)).load(ie.features):new so(te=ie,k.geojsonVtOptions)}catch(te){return N(te)}this.loaded={};const ne={};if(H){const te=H.finish();te&&(ne.resourceTiming={},ne.resourceTiming[k.source]=JSON.parse(JSON.stringify(te)))}N(null,ne)}var te})}reloadTile(k,N){const j=this.loaded;return j&&j[k.uid]?super.reloadTile(k,N):this.loadTile(k,N)}loadGeoJSON(k,N){if(k.request)return _.getJSON(k.request,N);if("string"==typeof k.data)try{N(null,JSON.parse(k.data))}catch{N(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`))}else N(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(k,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()}getClusterExpansionZoom(k,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(j){N(j)}}getClusterChildren(k,N){try{N(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(j){N(j)}}getClusterLeaves(k,N){try{N(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(j){N(j)}}}class Cs{constructor(k){this.self=k,this.actor=new _.Actor(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Un,geojson:Gs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,j)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=j},this.self.registerRTLTextPlugin=N=>{if(_.plugin.isParsed())throw new Error("RTL text plugin already registered.");_.plugin.applyArabicShaping=N.applyArabicShaping,_.plugin.processBidirectionalText=N.processBidirectionalText,_.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}setReferrer(k,N){this.referrer=N}setImages(k,N,j){this.availableImages[k]=N;for(const H in this.workerSources[k]){const Q=this.workerSources[k][H];for(const ie in Q)Q[ie].availableImages=N}j()}setLayers(k,N,j){this.getLayerIndex(k).replace(N),j()}updateLayers(k,N,j){this.getLayerIndex(k).update(N.layers,N.removedIds),j()}loadTile(k,N,j){this.getWorkerSource(k,N.type,N.source).loadTile(N,j)}loadDEMTile(k,N,j){this.getDEMWorkerSource(k,N.source).loadTile(N,j)}reloadTile(k,N,j){this.getWorkerSource(k,N.type,N.source).reloadTile(N,j)}abortTile(k,N,j){this.getWorkerSource(k,N.type,N.source).abortTile(N,j)}removeTile(k,N,j){this.getWorkerSource(k,N.type,N.source).removeTile(N,j)}removeDEMTile(k,N){this.getDEMWorkerSource(k,N.source).removeTile(N)}removeSource(k,N,j){if(!this.workerSources[k]||!this.workerSources[k][N.type]||!this.workerSources[k][N.type][N.source])return;const H=this.workerSources[k][N.type][N.source];delete this.workerSources[k][N.type][N.source],void 0!==H.removeSource?H.removeSource(N,j):j()}loadWorkerSource(k,N,j){try{this.self.importScripts(N.url),j()}catch(H){j(H.toString())}}syncRTLPluginState(k,N,j){try{_.plugin.setState(N);const H=_.plugin.getPluginURL();if(_.plugin.isLoaded()&&!_.plugin.isParsed()&&null!=H){this.self.importScripts(H);const Q=_.plugin.isParsed();j(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),Q)}}catch(H){j(H.toString())}}getAvailableImages(k){let N=this.availableImages[k];return N||(N=[]),N}getLayerIndex(k){let N=this.layerIndexes[k];return N||(N=this.layerIndexes[k]=new wo),N}getWorkerSource(k,N,j){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][N]||(this.workerSources[k][N]={}),this.workerSources[k][N][j]||(this.workerSources[k][N][j]=new this.workerSourceTypes[N]({send:(Q,ie,ne)=>{this.actor.send(Q,ie,ne,k)}},this.getLayerIndex(k),this.getAvailableImages(k))),this.workerSources[k][N][j]}getDEMWorkerSource(k,N){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][N]||(this.demWorkerSources[k][N]=new tc),this.demWorkerSources[k][N]}enforceCacheSizeLimit(k,N){_.enforceCacheSizeLimit(N)}}return _.isWorker()&&(self.worker=new Cs(self)),Cs}),$c(0,function(_){var Wn=Ho;function Ho(m){return s=m,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,y,x=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(x);try{y=new Worker(C),p=!0}catch{p=!1}return y&&y.terminate(),URL.revokeObjectURL(C),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var y=p.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===p.width}()||(void 0===wo[u=s&&s.failIfMajorPerformanceCaveat]&&(wo[u]=function(p){var y,C,T,S,x=(C=p,T=document.createElement("canvas"),(S=Object.create(Ho.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,T.getContext("webgl",S)||T.getContext("experimental-webgl",S));if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),!0===x.getShaderParameter(y,x.COMPILE_STATUS))}(u)),!wo[u]||document.documentMode));var s,u}var wo={};function nn(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let u=0;u<m.length;u++)if(!nn(m[u],s[u]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==s){if("object"!=typeof s||Object.keys(m).length!==Object.keys(s).length)return!1;for(const u in m)if(!nn(m[u],s[u]))return!1;return!0}return m===s}Ho.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class be{static testProp(s){if(!be.docStyle)return s[0];for(let u=0;u<s.length;u++)if(s[u]in be.docStyle)return s[u];return s[0]}static create(s,u,p){const y=window.document.createElement(s);return void 0!==u&&(y.className=u),p&&p.appendChild(y),y}static createNS(s,u){return window.document.createElementNS(s,u)}static disableDrag(){be.docStyle&&be.selectProp&&(be.userSelect=be.docStyle[be.selectProp],be.docStyle[be.selectProp]="none")}static enableDrag(){be.docStyle&&be.selectProp&&(be.docStyle[be.selectProp]=be.userSelect)}static setTransform(s,u){s.style[be.transformProp]=u}static addEventListener(s,u,p,y={}){s.addEventListener(u,p,"passive"in y?y:y.capture)}static removeEventListener(s,u,p,y={}){s.removeEventListener(u,p,"passive"in y?y:y.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",be.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",be.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",be.suppressClickInternal,!0)},0)}static mousePos(s,u){const p=s.getBoundingClientRect();return new _.pointGeometry(u.clientX-p.left-s.clientLeft,u.clientY-p.top-s.clientTop)}static touchPos(s,u){const p=s.getBoundingClientRect(),y=[];for(let x=0;x<u.length;x++)y.push(new _.pointGeometry(u[x].clientX-p.left-s.clientLeft,u[x].clientY-p.top-s.clientTop));return y}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}be.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,be.selectProp=be.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),be.transformProp=be.testProp(["transform","WebkitTransform"]);class Go{constructor(s){this._transformRequestFn=s}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}normalizeSpriteURL(s,u,p){const y=function(x){const C=x.match(Bi);if(!C)throw new Error(`Unable to parse URL "${x}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(s);return y.path+=`${u}${p}`,function(x){const C=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${C}`}(y)}setTransformRequest(s){this._transformRequestFn=s}}const Bi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class Un{constructor(s,u,p,y){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(u,y)}update(s,u,p){const{width:y,height:x}=s,C=!(this.size&&this.size[0]===y&&this.size[1]===x||p),{context:T}=this,{gl:S}=T;if(this.useMipmap=!(!u||!u.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!u||!1!==u.premultiply)),C)this.size=[y,x],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||_.isImageBitmap(s)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,s):S.texImage2D(S.TEXTURE_2D,0,this.format,y,x,0,this.format,S.UNSIGNED_BYTE,s.data);else{const{x:A,y:F}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||_.isImageBitmap(s)?S.texSubImage2D(S.TEXTURE_2D,0,A,F,S.RGBA,S.UNSIGNED_BYTE,s):S.texSubImage2D(S.TEXTURE_2D,0,A,F,y,x,S.RGBA,S.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(s,u,p){const{context:y}=this,{gl:x}=y;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),s!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,s),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||s),this.filter=s),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function tc(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class ll extends _.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new _.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,p);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,u){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,u)&&(this.images[s]=u)}_validate(s,u){let p=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new _.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new _.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new _.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,u){if(!s)return!0;let p=0;for(const y of s){if(y[0]<p||y[1]<y[0]||u<y[1])return!1;p=y[1]}return!0}_validateContent(s,u){return!(s&&(4!==s.length||s[0]<0||u.data.width<s[0]||s[1]<0||u.data.height<s[1]||s[2]<0||u.data.width<s[2]||s[3]<0||u.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,u){const p=this.images[s];if(p.data.width!==u.data.width||p.data.height!==u.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=p.version+1,this.images[s]=u,this.updatedImages[s]=!0}removeImage(s){const u=this.images[s];delete this.images[s],delete this.patterns[s],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,u){let p=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(p=!1);this.isLoaded()||p?this._notify(s,u):this.requestors.push({ids:s,callback:u})}_notify(s,u){const p={};for(const y of s){this.images[y]||this.fire(new _.Event("styleimagemissing",{id:y}));const x=this.images[y];x?p[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!(!x.userImage||!x.userImage.render)}:_.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,p)}getPixelSize(){const{width:s,height:u}=this.atlasImage;return{width:s,height:u}}getPattern(s){const u=this.patterns[s],p=this.getImage(s);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{const y={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new _.ImagePosition(y,p);this.patterns[s]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const u=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Un(s,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:u,h:p}=_.potpack(s),y=this.atlasImage;y.resize({width:u||1,height:p||1});for(const x in this.patterns){const{bin:C}=this.patterns[x],T=C.x+1,S=C.y+1,A=this.images[x].data,F=A.width,z=A.height;_.RGBAImage.copy(A,y,{x:0,y:0},{x:T,y:S},{width:F,height:z}),_.RGBAImage.copy(A,y,{x:0,y:z-1},{x:T,y:S-1},{width:F,height:1}),_.RGBAImage.copy(A,y,{x:0,y:0},{x:T,y:S+z},{width:F,height:1}),_.RGBAImage.copy(A,y,{x:F-1,y:0},{x:T-1,y:S},{width:1,height:z}),_.RGBAImage.copy(A,y,{x:0,y:0},{x:T+F,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const u of s){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const p=this.images[u];p||_.warnOnce(`Image with ID: "${u}" was not found`),tc(p)&&this.updateImage(u,p)}}}const qo=1e20;function si(m,s,u,p,y,x,C,T,S){for(let A=s;A<s+p;A++)ro(m,u*x+A,x,y,C,T,S);for(let A=u;A<u+y;A++)ro(m,A*x+s,1,p,C,T,S)}function ro(m,s,u,p,y,x,C){x[0]=0,C[0]=-qo,C[1]=qo,y[0]=m[s];for(let T=1,S=0,A=0;T<p;T++){y[T]=m[s+T*u];const F=T*T;do{const z=x[S];A=(y[T]-y[z]+F-z*z)/(T-z)/2}while(A<=C[S]&&--S>-1);S++,x[S]=T,C[S]=A,C[S+1]=qo}for(let T=0,S=0;T<p;T++){for(;C[S+1]<T;)S++;const A=x[S],F=T-A;m[s+T*u]=y[A]+F*F}}class jn{constructor(s,u){this.requestManager=s,this.localIdeographFontFamily=u,this.entries={}}setURL(s){this.url=s}getGlyphs(s,u){const p=[];for(const y in s)for(const x of s[y])p.push({stack:y,id:x});_.asyncAll(p,({stack:y,id:x},C)=>{let T=this.entries[y];T||(T=this.entries[y]={glyphs:{},requests:{},ranges:{}});let S=T.glyphs[x];if(void 0!==S)return void C(null,{stack:y,id:x,glyph:S});if(S=this._tinySDF(T,y,x),S)return T.glyphs[x]=S,void C(null,{stack:y,id:x,glyph:S});const A=Math.floor(x/256);if(256*A>65535)return void C(new Error("glyphs > 65535 not supported"));if(T.ranges[A])return void C(null,{stack:y,id:x,glyph:S});let F=T.requests[A];F||(F=T.requests[A]=[],jn.loadGlyphRange(y,A,this.url,this.requestManager,(z,U)=>{if(U){for(const X in U)this._doesCharSupportLocalGlyph(+X)||(T.glyphs[+X]=U[+X]);T.ranges[A]=!0}for(const X of F)X(z,U);delete T.requests[A]})),F.push((z,U)=>{z?C(z):U&&C(null,{stack:y,id:x,glyph:U[x]||null})})},(y,x)=>{if(y)u(y);else if(x){const C={};for(const{stack:T,id:S,glyph:A}of x)(C[T]||(C[T]={}))[S]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};u(null,C)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(_.unicodeBlockLookup["CJK Unified Ideographs"](s)||_.unicodeBlockLookup["Hangul Syllables"](s)||_.unicodeBlockLookup.Hiragana(s)||_.unicodeBlockLookup.Katakana(s))}_tinySDF(s,u,p){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(p))return;let x=s.tinySDF;if(!x){let T="400";/bold/i.test(u)?T="900":/medium/i.test(u)?T="500":/light/i.test(u)&&(T="200"),x=s.tinySDF=new jn.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:y,fontWeight:T})}const C=x.draw(String.fromCharCode(p));return{id:p,bitmap:new _.AlphaImage({width:C.width||30,height:C.height||30},C.data),metrics:{width:C.glyphWidth||24,height:C.glyphHeight||24,left:C.glyphLeft||0,top:C.glyphTop-27||-8,advance:C.glyphAdvance||24}}}}jn.loadGlyphRange=function(m,s,u,p,y){const x=256*s,C=x+255,T=p.transformRequest(u.replace("{fontstack}",m).replace("{range}",`${x}-${C}`),_.ResourceType.Glyphs);_.getArrayBuffer(T,(S,A)=>{if(S)y(S);else if(A){const F={};for(const z of _.parseGlyphPbf(A))F[z.id]=z;y(null,F)}})},jn.TinySDF=class{constructor({fontSize:m=24,buffer:s=3,radius:u=8,cutoff:p=.25,fontFamily:y="sans-serif",fontWeight:x="normal",fontStyle:C="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=u;const T=this.size=m+4*s,S=this._createCanvas(T),A=this.ctx=S.getContext("2d",{willReadFrequently:!0});A.font=`${C} ${x} ${m}px ${y}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:y,actualBoundingBoxRight:x}=this.ctx.measureText(m),C=Math.ceil(u),T=Math.min(this.size-this.buffer,Math.ceil(x-y)),S=Math.min(this.size-this.buffer,C+Math.ceil(p)),A=T+2*this.buffer,F=S+2*this.buffer,z=Math.max(A*F,0),U=new Uint8ClampedArray(z),X={data:U,width:A,height:F,glyphWidth:T,glyphHeight:S,glyphTop:C,glyphLeft:0,glyphAdvance:s};if(0===T||0===S)return X;const{ctx:q,buffer:W,gridInner:re,gridOuter:se}=this;q.clearRect(W,W,T,S),q.fillText(m,W,W+C);const de=q.getImageData(W,W,T,S);se.fill(qo,0,z),re.fill(0,0,z);for(let Y=0;Y<S;Y++)for(let me=0;me<T;me++){const pe=de.data[4*(Y*T+me)+3]/255;if(0===pe)continue;const Ce=(Y+W)*A+me+W;if(1===pe)se[Ce]=0,re[Ce]=qo;else{const De=.5-pe;se[Ce]=De>0?De*De:0,re[Ce]=De<0?De*De:0}}si(se,0,0,A,F,A,this.f,this.v,this.z),si(re,W,W,T,S,A,this.f,this.v,this.z);for(let Y=0;Y<z;Y++){const me=Math.sqrt(se[Y])-Math.sqrt(re[Y]);U[Y]=Math.round(255-255*(me/this.radius+this.cutoff))}return X}};const Co=new _.Properties({anchor:new _.DataConstantProperty(_.spec.light.anchor),position:new class{constructor(){this.specification=_.spec.light.position}possiblyEvaluate(m,s){return _.sphericalToCartesian(m.expression.evaluate(s))}interpolate(m,s,u){return{x:_.number(m.x,s.x,u),y:_.number(m.y,s.y,u),z:_.number(m.z,s.z,u)}}},color:new _.DataConstantProperty(_.spec.light.color),intensity:new _.DataConstantProperty(_.spec.light.intensity)}),Do="-transition";class Vi extends _.Evented{constructor(s){super(),this._transitionable=new _.Transitionable(Co),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u={}){if(!this._validate(_.validateLight,s,u))for(const p in s){const y=s[p];p.endsWith(Do)?this._transitionable.setTransition(p.slice(0,-11),y):this._transitionable.setValue(p,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,p){return(!p||!1!==p.validate)&&_.emitValidationErrors(this,s.call(_.validateStyle,_.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:_.spec})))}}class ya{constructor(s,u){this.width=s,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,u){const p=s.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,u)),this.dashEntry[p]}getDashRanges(s,u,p){const y=[];let x=s.length%2==1?-s[s.length-1]*p:0,C=s[0]*p,T=!0;y.push({left:x,right:C,isDash:T,zeroLength:0===s[0]});let S=s[0];for(let A=1;A<s.length;A++){T=!T;const F=s[A];x=S*p,S+=F,C=S*p,y.push({left:x,right:C,isDash:T,zeroLength:0===F})}return y}addRoundDash(s,u,p){const y=u/2;for(let x=-p;x<=p;x++){const C=this.width*(this.nextRow+p+x);let T=0,S=s[T];for(let A=0;A<this.width;A++){A/S.right>1&&(S=s[++T]);const F=Math.abs(A-S.left),z=Math.abs(A-S.right),U=Math.min(F,z);let X;const q=x/p*(y+1);if(S.isDash){const W=y-Math.abs(q);X=Math.sqrt(U*U+W*W)}else X=y-Math.sqrt(U*U+q*q);this.data[C+A]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(s){for(let T=s.length-1;T>=0;--T){const S=s[T],A=s[T+1];S.zeroLength?s.splice(T,1):A&&A.isDash===S.isDash&&(A.left=S.left,s.splice(T,1))}const u=s[0],p=s[s.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const y=this.width*this.nextRow;let x=0,C=s[x];for(let T=0;T<this.width;T++){T/C.right>1&&(C=s[++x]);const S=Math.abs(T-C.left),A=Math.abs(T-C.right),F=Math.min(S,A);this.data[y+T]=Math.max(0,Math.min(255,(C.isDash?F:-F)+128))}}addDash(s,u){const p=u?7:0,y=2*p+1;if(this.nextRow+y>this.height)return _.warnOnce("LineAtlas out of space"),null;let x=0;for(let T=0;T<s.length;T++)x+=s[T];if(0!==x){const T=this.width/x,S=this.getDashRanges(s,this.width,T);u?this.addRoundDash(S,T,p):this.addRegularDash(S)}const C={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=y,this.dirty=!0,C}bind(s){const u=s.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}class Zo{constructor(s,u){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=_.uniqueId();const p=this.workerPool.acquire(this.id);for(let y=0;y<p.length;y++){const x=new Zo.Actor(p[y],u,this.id);x.name=`Worker ${y}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,u,p){_.asyncAll(this.actors,(y,x)=>{y.send(s,u,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function io(m,s,u){const p=function(y,x){if(y)return u(y);if(x){const C=_.pick(_.extend(x,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(C.vectorLayers=x.vector_layers,C.vectorLayerIds=C.vectorLayers.map(T=>T.id)),u(null,C)}};return m.url?_.getJSON(s.transformRequest(m.url,_.ResourceType.Source),p):_.exported.frame(()=>p(null,m))}Zo.Actor=_.Actor;class Ui{constructor(s,u,p){this.bounds=_.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const u=Math.pow(2,s.z),p=Math.floor(_.mercatorXfromLng(this.bounds.getWest())*u),y=Math.floor(_.mercatorYfromLat(this.bounds.getNorth())*u),x=Math.ceil(_.mercatorXfromLng(this.bounds.getEast())*u),C=Math.ceil(_.mercatorYfromLat(this.bounds.getSouth())*u);return s.x>=p&&s.x<x&&s.y>=y&&s.y<C}}class _a extends _.Evented{constructor(s,u,p,y){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,_.extend(this,_.pick(u,["url","scheme","tileSize","promoteId"])),this._options=_.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=io(this._options,this.map._requestManager,(s,u)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s?this.fire(new _.ErrorEvent(s)):u&&(_.extend(this,u),u.bounds&&(this.tileBounds=new Ui(u.bounds,this.minzoom,this.maxzoom)),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return _.extend({},this._options)}loadTile(s,u){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(p,_.ResourceType.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(C,T){return delete s.request,s.aborted?u(null):C&&404!==C.status?u(C):(T&&T.resourceTiming&&(s.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&s.setExpiryData(T),s.loadVectorData(T,this.map.painter),_.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state?"loading"===s.state?s.reloadCallback=u:s.request=s.actor.send("reloadTile",y,x.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",y,x.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Eo extends _.Evented{constructor(s,u,p,y){super(),this.id=s,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=_.extend({type:"raster"},u),_.extend(this,_.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=io(this._options,this.map._requestManager,(s,u)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new _.ErrorEvent(s)):u&&(_.extend(this,u),u.bounds&&(this.tileBounds=new Ui(u.bounds,this.minzoom,this.maxzoom)),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return _.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,u){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=_.getImage(this.map._requestManager.transformRequest(p,_.ResourceType.Tile),(y,x,C)=>{if(delete s.request,s.aborted)s.state="unloaded",u(null);else if(y)s.state="errored",u(y);else if(x){this.map._refreshExpiredTiles&&s.setExpiryData(C);const T=this.map.painter.context,S=T.gl;s.texture=this.map.painter.getTileTexture(x.width),s.texture?s.texture.update(x,{useMipmap:!0}):(s.texture=new Un(T,x,S.RGBA,{useMipmap:!0}),s.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),T.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax)),s.state="loaded",_.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(s,u){s.request&&(s.request.cancel(),delete s.request),u()}unloadTile(s,u){s.texture&&this.map.painter.saveTileTexture(s.texture),u()}hasTransition(){return!1}}let ms;class xt extends Eo{constructor(s,u,p,y){super(s,u,p,y),this.type="raster-dem",this.maxzoom=22,this._options=_.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(s,u){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function y(x,C){x&&(s.state="errored",u(x)),C&&(s.dem=C,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",u(null))}s.request=_.getImage(this.map._requestManager.transformRequest(p,_.ResourceType.Tile),function(x,C){if(delete s.request,s.aborted)s.state="unloaded",u(null);else if(x)s.state="errored",u(x);else if(C){this.map._refreshExpiredTiles&&s.setExpiryData(C),delete C.cacheControl,delete C.expires;const T=_.isImageBitmap(C)&&(null==ms&&(ms=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),ms)?C:_.exported.getImageData(C,1),S={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:T,encoding:this.encoding};s.actor&&"expired"!==s.state||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",S,y.bind(this)))}}.bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)}_getNeighboringTiles(s){const u=s.canonical,p=Math.pow(2,u.z),y=(u.x-1+p)%p,x=0===u.x?s.wrap-1:s.wrap,C=(u.x+1+p)%p,T=u.x+1===p?s.wrap+1:s.wrap,S={};return S[new _.OverscaledTileID(s.overscaledZ,x,u.z,y,u.y).key]={backfilled:!1},S[new _.OverscaledTileID(s.overscaledZ,T,u.z,C,u.y).key]={backfilled:!1},u.y>0&&(S[new _.OverscaledTileID(s.overscaledZ,x,u.z,y,u.y-1).key]={backfilled:!1},S[new _.OverscaledTileID(s.overscaledZ,s.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},S[new _.OverscaledTileID(s.overscaledZ,T,u.z,C,u.y-1).key]={backfilled:!1}),u.y+1<p&&(S[new _.OverscaledTileID(s.overscaledZ,x,u.z,y,u.y+1).key]={backfilled:!1},S[new _.OverscaledTileID(s.overscaledZ,s.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},S[new _.OverscaledTileID(s.overscaledZ,T,u.z,C,u.y+1).key]={backfilled:!1}),S}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class Gr extends _.Evented{constructor(s,u,p,y){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(y),this._data=u.data,this._options=_.extend({},u),this._collectResourceTiming=u.collectResourceTiming,void 0!==u.maxzoom&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const x=_.EXTENT/this.tileSize;this.workerOptions=_.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(void 0!==u.buffer?u.buffer:128)*x,tolerance:(void 0!==u.tolerance?u.tolerance:.375)*x,extent:_.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:void 0!==u.clusterMaxZoom?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:_.EXTENT,radius:(u.clusterRadius||50)*x,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData("content"),this}getClusterExpansionZoom(s,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},u),this}getClusterChildren(s,u){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},u),this}getClusterLeaves(s,u,p,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:u,offset:p},y),this}_updateWorkerData(s){const u=_.extend({},this.workerOptions),p=this._data;"string"==typeof p?(u.request=this.map._requestManager.transformRequest(_.exported.resolveURL(p),_.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(p),this._pendingLoads++,this.fire(new _.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,u,(y,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return void this.fire(new _.Event("dataabort",{dataType:"source",sourceDataType:s}));let C=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(C=x.resourceTiming[this.id].slice(0)),y)return void this.fire(new _.ErrorEvent(y));const T={dataType:"source",sourceDataType:s};this._collectResourceTiming&&C&&C.length>0&&_.extend(T,{resourceTiming:C}),this.fire(new _.Event("data",T))})}loaded(){return 0===this._pendingLoads}loadTile(s,u){const p=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const y={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(p,y,(x,C)=>(delete s.request,s.unloadVectorData(),s.aborted?u(null):x?u(x):(s.loadVectorData(C,this.map.painter,"reloadTile"===p),u(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return _.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Wo=_.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $i extends _.Evented{constructor(s,u,p,y){super(),this.id=s,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=u}load(s,u){this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this.url=this.options.url,_.getImage(this.map._requestManager.transformRequest(this.url,_.ResourceType.Image),(p,y)=>{this._loaded=!0,p?this.fire(new _.ErrorEvent(p)):y&&(this.image=y,s&&(this.coordinates=s),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const u=s.map(_.MercatorCoordinate.fromLngLat);this.tileID=function(y){let x=1/0,C=1/0,T=-1/0,S=-1/0;for(const U of y)x=Math.min(x,U.x),C=Math.min(C,U.y),T=Math.max(T,U.x),S=Math.max(S,U.y);const A=Math.max(T-x,S-C),F=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,F);return new _.CanonicalTileID(F,Math.floor((x+T)/2*z),Math.floor((C+S)/2*z))}(u),this.minzoom=this.maxzoom=this.tileID.z;const p=u.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new _.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,_.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,_.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,_.EXTENT,_.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Wo.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Un(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const p in this.tiles){const y=this.tiles[p];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(s,u){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},u(null)):(s.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class hn extends $i{constructor(s,u,p,y){super(s,u,p,y),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const s=this.options;this.urls=[];for(const u of s.urls)this.urls.push(this.map._requestManager.transformRequest(u,_.ResourceType.Source).url);_.getVideo(this.urls,(u,p)=>{this._loaded=!0,u?this.fire(new _.ErrorEvent(u)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const u=this.video.seekable;s<u.start(0)||s>u.end(0)?this.fire(new _.ErrorEvent(new _.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Wo.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new Un(s,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const p in this.tiles){const y=this.tiles[p];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class gs extends $i{constructor(s,u,p,y){super(s,u,p,y),u.coordinates?Array.isArray(u.coordinates)&&4===u.coordinates.length&&!u.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(C=>"number"!=typeof C))||this.fire(new _.ErrorEvent(new _.ValidationError(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new _.ErrorEvent(new _.ValidationError(`sources.${s}`,null,'missing required property "coordinates"'))),u.animate&&"boolean"!=typeof u.animate&&this.fire(new _.ErrorEvent(new _.ValidationError(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),u.canvas?"string"==typeof u.canvas||u.canvas instanceof HTMLCanvasElement||this.fire(new _.ErrorEvent(new _.ValidationError(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new _.ErrorEvent(new _.ValidationError(`sources.${s}`,null,'missing required property "canvas"'))),this.options=u,this.animate=void 0===u.animate||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new _.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const u=this.map.painter.context,p=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Wo.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Un(u,this.canvas,p.RGBA,{premultiply:!0});for(const y in this.tiles){const x=this.tiles[y];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const va={vector:_a,raster:Eo,"raster-dem":xt,geojson:Gr,video:hn,image:$i,canvas:gs};function xa(m,s){const u=_.create();return _.translate(u,u,[1,1,0]),_.scale(u,u,[.5*m.width,.5*m.height,1]),_.multiply(u,u,m.calculatePosMatrix(s.toUnwrapped()))}function ba(m,s,u,p,y,x){const C=function(z,U,X){if(z)for(const q of z){const W=U[q];if(W&&W.source===X&&"fill-extrusion"===W.type)return!0}else for(const q in U){const W=U[q];if(W.source===X&&"fill-extrusion"===W.type)return!0}return!1}(y&&y.layers,s,m.id),T=x.maxPitchScaleFactor(),S=m.tilesIn(p,T,C);S.sort(Cr);const A=[];for(const z of S)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(s,u,m._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,y,x,T,xa(m.transform,z.tileID))});const F=function(z){const U={},X={};for(const q of z){const W=q.queryResults,re=q.wrappedTileID,se=X[re]=X[re]||{};for(const de in W){const Y=W[de],me=se[de]=se[de]||{},pe=U[de]=U[de]||[];for(const Ce of Y)me[Ce.featureIndex]||(me[Ce.featureIndex]=!0,pe.push(Ce))}}return U}(A);for(const z in F)F[z].forEach(U=>{const X=U.feature,q=m.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=q});return F}function Cr(m,s){const u=m.tileID,p=s.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}class Xo{constructor(s,u){this.tileID=s,this.uid=_.uniqueId(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const u=s+this.timeAdded;u<_.exported.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.textures.forEach(u=>s.saveTileTexture(u)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(s,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(y,x){const C={};if(!x)return C;for(const T of y){const S=T.layerIds.map(A=>x.getLayer(A)).filter(Boolean);if(0!==S.length){T.layers=S,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(A=>S.filter(F=>F.id===A)[0]));for(const A of S)C[A.id]=T}}return C}(s.buckets,u.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof _.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof _.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,_.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(y).queryRadius(x))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new _.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const y=this.buckets[p];y.uploadPending()&&y.upload(s)}const u=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Un(s,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Un(s,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,u,p,y,x,C,T,S,A,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:F,transform:S,params:T,queryPadding:this.queryPadding*A},s,u,p):{}}querySourceFeatures(s,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),x=u?u.sourceLayer:"",C=y._geojsonTileLayer||y[x];if(!C)return;const T=_.createFilter(u&&u.filter),{z:S,x:A,y:F}=this.tileID.canonical,z={z:S,x:A,y:F};for(let U=0;U<C.length;U++){const X=C.feature(U);if(T.needGeometry){const re=_.toEvaluationFeature(X,!0);if(!T.filter(new _.EvaluationParameters(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!T.filter(new _.EvaluationParameters(this.tileID.overscaledZ),X))continue;const q=p.getId(X,x),W=new _.GeoJSONFeature(X,S,A,F,q);W.tile=z,s.push(W)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const u=this.expirationTime;if(s.cacheControl){const p=_.parseCacheControl(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(u)if(this.expirationTime<u)y=!0;else{const x=this.expirationTime-u;x?this.expirationTime=p+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(s,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(s).length)return;const p=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!u.style.hasLayer(y))continue;const x=this.buckets[y],C=x.layers[0].sourceLayer||"_geojsonTileLayer",T=p[C],S=s[C];if(!T||!S||0===Object.keys(S).length)continue;x.update(S,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=u&&u.style&&u.style.getLayer(y);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=_.exported.now()+s}setDependencies(s,u){const p={};for(const y of u)p[y]=!0;this.dependencies[s]=p}hasDependency(s,u){for(const p of s){const y=this.dependencies[p];if(y)for(const x of u)if(y[x])return!0}return!1}}class fr{constructor(s,u){this.max=s,this.onRemove=u,this.reset()}reset(){for(const s in this.data)for(const u of this.data[s])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(s,u,p){const y=s.wrapped().key;void 0===this.data[y]&&(this.data[y]=[]);const x={value:u,timeout:void 0};if(void 0!==p&&(x.timeout=setTimeout(()=>{this.remove(s,x)},p)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value}getByKey(s){const u=this.data[s];return u?u[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,u){if(!this.has(s))return this;const p=s.wrapped().key,y=void 0===u?0:this.data[p].indexOf(u),x=this.data[p][y];return this.data[p].splice(y,1),x.timeout&&clearTimeout(x.timeout),0===this.data[p].length&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(s){const u=[];for(const p in this.data)for(const y of this.data[p])s(y.value)||u.push(y);for(const p of u)this.remove(p.value.tileID,p)}}class Ko{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,p){const y=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][y]=this.stateChanges[s][y]||{},_.extend(this.stateChanges[s][y],p),null===this.deletedStates[s]){this.deletedStates[s]={};for(const x in this.state[s])x!==y&&(this.deletedStates[s][x]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][y]){this.deletedStates[s][y]={};for(const x in this.state[s][y])p[x]||(this.deletedStates[s][y][x]=null)}else for(const x in p)this.deletedStates[s]&&this.deletedStates[s][y]&&null===this.deletedStates[s][y][x]&&delete this.deletedStates[s][y][x]}removeFeatureState(s,u,p){if(null===this.deletedStates[s])return;const y=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&void 0!==u)null!==this.deletedStates[s][y]&&(this.deletedStates[s][y]=this.deletedStates[s][y]||{},this.deletedStates[s][y][p]=null);else if(void 0!==u)if(this.stateChanges[s]&&this.stateChanges[s][y])for(p in this.deletedStates[s][y]={},this.stateChanges[s][y])this.deletedStates[s][y][p]=null;else this.deletedStates[s][y]=null;else this.deletedStates[s]=null}getState(s,u){const p=String(u),y=_.extend({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(null===this.deletedStates[s])return{};if(this.deletedStates[s]){const x=this.deletedStates[s][u];if(null===x)return{};for(const C in x)delete y[C]}return y}initializeTileState(s,u){s.setFeatureState(this.state,u)}coalesceChanges(s,u){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const C in this.stateChanges[y])this.state[y][C]||(this.state[y][C]={}),_.extend(this.state[y][C],this.stateChanges[y][C]),x[C]=this.state[y][C];p[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(null===this.deletedStates[y])for(const C in this.state[y])x[C]={},this.state[y][C]={};else for(const C in this.deletedStates[y]){if(null===this.deletedStates[y][C])this.state[y][C]={};else for(const T of Object.keys(this.deletedStates[y][C]))delete this.state[y][C][T];x[C]=this.state[y][C]}p[y]=p[y]||{},_.extend(p[y],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(p).length)for(const y in s)s[y].setFeatureState(p,u)}}class pn extends _.Evented{constructor(s,u,p){super(),this.id=s,this.dispatcher=p,this.on("data",y=>{"source"===y.dataType&&"metadata"===y.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===y.dataType&&"content"===y.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(y,x,C,T){const S=new va[x.type](y,x,C,T);if(S.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${S.id}`);return _.bindAll(["load","abort","unload","serialize","prepare"],S),S}(s,u,p,this),this._tiles={},this._cache=new fr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ko}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const u=this._tiles[s];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,u){return this._source.loadTile(s,u)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new _.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort($n).map(s=>s.key)}getRenderableIds(s){const u=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&u.push(this._tiles[p]);return s?u.sort((p,y)=>{const x=p.tileID,C=y.tileID,T=new _.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),S=new _.pointGeometry(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||S.y-T.y||S.x-T.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort($n).map(p=>p.key)}hasRenderableParent(s){const u=this.findLoadedParent(s,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(s,u){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(u||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(s,"reloading")}}_reloadTile(s,u){const p=this._tiles[s];p&&("loading"!==p.state&&(p.state=u),this._loadTile(p,this._tileLoaded.bind(this,p,s,u)))}_tileLoaded(s,u,p,y){if(y)return s.state="errored",void(404!==y.status?this._source.fire(new _.ErrorEvent(y,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=_.exported.now(),"expired"===p&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),"raster-dem"===this.getSource().type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new _.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const u=this.getRenderableIds();for(let y=0;y<u.length;y++){const x=u[y];if(s.neighboringTiles&&s.neighboringTiles[x]){const C=this.getTileByID(x);p(s,C),p(C,s)}}function p(y,x){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let C=x.tileID.canonical.x-y.tileID.canonical.x;const T=x.tileID.canonical.y-y.tileID.canonical.y,S=Math.pow(2,y.tileID.canonical.z),A=x.tileID.key;0===C&&0===T||Math.abs(T)>1||(Math.abs(C)>1&&(1===Math.abs(C+S)?C+=S:1===Math.abs(C-S)&&(C-=S)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,C,T),y.neighboringTiles&&y.neighboringTiles[A]&&(y.neighboringTiles[A].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u,p,y){for(const x in this._tiles){let C=this._tiles[x];if(y[x]||!C.hasData()||C.tileID.overscaledZ<=u||C.tileID.overscaledZ>p)continue;let T=C.tileID;for(;C&&C.tileID.overscaledZ>u+1;){const A=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[A.key],C&&C.hasData()&&(T=A)}let S=T;for(;S.overscaledZ>u;)if(S=S.scaledTo(S.overscaledZ-1),s[S.key]){y[T.key]=T;break}}}findLoadedParent(s,u){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=s.overscaledZ-1;p>=u;p--){const y=s.scaledTo(p),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(s){const u=this._tiles[s.key];return u&&u.hasData()?u:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const u=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,y=Math.floor(u*p*5),x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(s){const u=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,u){const p={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+u),p[x.tileID.key]=x}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}update(s,u){if(this.transform=s,this.terrain=u,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new _.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(p=p.filter(A=>this._source.hasTile(A)))):p=[];const y=s.coveringZoomLevel(this._source),x=Math.max(y-pn.maxOverzooming,this._source.minzoom),C=Math.max(y+pn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const F of p)if(F.canonical.z>this._source.minzoom){const z=F.scaledTo(F.canonical.z-1);A[z.key]=z;const U=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));A[U.key]=U}p=p.concat(Object.values(A))}const T=this._updateRetainedTiles(p,y);if(cl(this._source.type)){const A={},F={},z=Object.keys(T);for(const U of z){const X=T[U],q=this._tiles[U];if(!q||q.fadeEndTime&&q.fadeEndTime<=_.exported.now())continue;const W=this.findLoadedParent(X,x);W&&(this._addTile(W.tileID),A[W.tileID.key]=W.tileID),F[U]=X}this._retainLoadedChildren(F,y,C,T);for(const U in A)T[U]||(this._coveredTiles[U]=!0,T[U]=A[U]);if(u){const U={},X={};for(const q of p)this._tiles[q.key].hasData()?U[q.key]=q:X[q.key]=q;for(const q in X){const W=X[q].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(U[W[0].key]=T[W[0].key]=W[0],U[W[1].key]=T[W[1].key]=W[1],U[W[2].key]=T[W[2].key]=W[2],U[W[3].key]=T[W[3].key]=W[3],delete X[q])}for(const q in X){const W=this.findLoadedParent(X[q],this._source.minzoom);if(W){U[W.tileID.key]=T[W.tileID.key]=W.tileID;for(const re in U)U[re].isChildOf(W.tileID)&&delete U[re]}}for(const q in this._tiles)U[q]||(this._coveredTiles[q]=!0)}}for(const A in T)this._tiles[A].clearFadeHold();const S=_.keysDifference(this._tiles,T);for(const A of S){const F=this._tiles[A];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,u){const p={},y={},x=Math.max(u-pn.maxOverzooming,this._source.minzoom),C=Math.max(u+pn.maxUnderzooming,this._source.minzoom),T={};for(const S of s){const A=this._addTile(S);p[S.key]=S,A.hasData()||u<this._source.maxzoom&&(T[S.key]=S)}this._retainLoadedChildren(T,u,C,p);for(const S of s){let A=this._tiles[S.key];if(A.hasData())continue;if(u+1>this._source.maxzoom){const z=S.children(this._source.maxzoom)[0],U=this.getTile(z);if(U&&U.hasData()){p[z.key]=z;continue}}else{const z=S.children(this._source.maxzoom);if(p[z[0].key]&&p[z[1].key]&&p[z[2].key]&&p[z[3].key])continue}let F=A.wasRequested();for(let z=S.overscaledZ-1;z>=x;--z){const U=S.scaledTo(z);if(y[U.key]||(y[U.key]=!0,A=this.getTile(U),!A&&F&&(A=this._addTile(U)),A&&(p[U.key]=U,F=A.wasRequested(),A.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const u=[];let p,y=this._tiles[s].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}u.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;y=x}for(const x of u)this._loadedParentTiles[x]=p}}_addTile(s){let u=this._tiles[s.key];if(u)return u;u=this._cache.getAndRemove(s),u&&(this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,u)));const p=u;return u||(u=new Xo(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(u,this._tileLoaded.bind(this,u,s.key,u.state))),u.uses++,this._tiles[s.key]=u,p||this._source.fire(new _.Event("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=u.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,u,p){const y=[],x=this.transform;if(!x)return y;const C=p?x.getCameraQueryGeometry(s):s,T=s.map(q=>x.pointCoordinate(q,this.terrain)),S=C.map(q=>x.pointCoordinate(q,this.terrain)),A=this.getIds();let F=1/0,z=1/0,U=-1/0,X=-1/0;for(const q of S)F=Math.min(F,q.x),z=Math.min(z,q.y),U=Math.max(U,q.x),X=Math.max(X,q.y);for(let q=0;q<A.length;q++){const W=this._tiles[A[q]];if(W.holdingForFade())continue;const re=W.tileID,se=Math.pow(2,x.zoom-W.tileID.overscaledZ),de=u*W.queryPadding*_.EXTENT/W.tileSize/se,Y=[re.getTilePoint(new _.MercatorCoordinate(F,z)),re.getTilePoint(new _.MercatorCoordinate(U,X))];if(Y[0].x-de<_.EXTENT&&Y[0].y-de<_.EXTENT&&Y[1].x+de>=0&&Y[1].y+de>=0){const me=T.map(Ce=>re.getTilePoint(Ce)),pe=S.map(Ce=>re.getTilePoint(Ce));y.push({tile:W,tileID:re,queryGeometry:me,cameraQueryGeometry:pe,scale:se})}}return y}getVisibleCoordinates(s){const u=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of u)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(cl(this._source.type))for(const s in this._tiles){const u=this._tiles[s];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=_.exported.now())return!0}return!1}setFeatureState(s,u,p){this._state.updateState(s=s||"_geojsonTileLayer",u,p)}removeFeatureState(s,u,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,p)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,p){const y=this._tiles[s];y&&y.setDependencies(u,p)}reloadTilesForDependencies(s,u){for(const p in this._tiles)this._tiles[p].hasDependency(s,u)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,u))}}function $n(m,s){const u=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-u||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function cl(m){return"raster"===m||"image"===m||"video"===m}pn.maxOverzooming=10,pn.maxUnderzooming=3;const $t="mapboxgl_preloaded_worker_pool";class ai{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ai.workerCount;)this.workers.push(new Worker(po.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$t]}numActive(){return Object.keys(this.active).length}}const ul=Math.floor(_.exported.hardwareConcurrency/2);let Io;function wa(){return Io||(Io=new ai),Io}function Ca(m,s){const u={};for(const p in m)"ref"!==p&&(u[p]=m[p]);return _.refProperties.forEach(p=>{p in s&&(u[p]=s[p])}),u}function dl(m){m=m.slice();const s=Object.create(null);for(let u=0;u<m.length;u++)s[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=Ca(m[u],s[m[u].ref]));return m}ai.workerCount=Math.max(Math.min(ul,6),1);const Yt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function To(m,s,u){u.push({command:Yt.addSource,args:[m,s[m]]})}function ys(m,s,u){s.push({command:Yt.removeSource,args:[m]}),u[m]=!0}function _s(m,s,u,p){ys(m,u,p),To(m,s,u)}function hl(m,s,u){let p;for(p in m[u])if(Object.prototype.hasOwnProperty.call(m[u],p)&&"data"!==p&&!nn(m[u][p],s[u][p]))return!1;for(p in s[u])if(Object.prototype.hasOwnProperty.call(s[u],p)&&"data"!==p&&!nn(m[u][p],s[u][p]))return!1;return!0}function So(m,s,u,p,y,x){let C;for(C in s=s||{},m=m||{})Object.prototype.hasOwnProperty.call(m,C)&&(nn(m[C],s[C])||u.push({command:x,args:[p,C,s[C],y]}));for(C in s)Object.prototype.hasOwnProperty.call(s,C)&&!Object.prototype.hasOwnProperty.call(m,C)&&(nn(m[C],s[C])||u.push({command:x,args:[p,C,s[C],y]}))}function Yo(m){return m.id}function vs(m,s){return m[s.id]=s,m}class Jo{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=_.clamp(s,0,1);let u=1,p=this._distances[u];const y=s*this.paddedLength+this.padding;for(;p<y&&u<this._distances.length;)p=this._distances[++u];const x=u-1,C=this._distances[x],T=p-C,S=T>0?(y-C)/T:0;return this.points[x].mult(1-S).add(this.points[u].mult(S))}}function we(m,s){let u=!0;return"always"===m||"never"!==m&&"never"!==s||(u=!1),u}class He{constructor(s,u,p){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(u/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,p,y,x){this._forEachCell(u,p,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(s,u,p,y){this._forEachCell(u-y,p-y,u+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(p),this.circles.push(y)}_insertBoxCell(s,u,p,y,x,C){this.boxCells[x].push(C)}_insertCircleCell(s,u,p,y,x,C){this.circleCells[x].push(C)}_query(s,u,p,y,x,C,T){if(p<0||s>this.width||y<0||u>this.height)return[];const S=[];if(s<=0&&u<=0&&this.width<=p&&this.height<=y){if(x)return[{key:null,x1:s,y1:u,x2:p,y2:y}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const F=this.circles[3*A],z=this.circles[3*A+1],U=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:F-U,y1:z-U,x2:F+U,y2:z+U})}}else this._forEachCell(s,u,p,y,this._queryCell,S,{hitTest:x,overlapMode:C,seenUids:{box:{},circle:{}}},T);return S}query(s,u,p,y){return this._query(s,u,p,y,!1,null)}hitTest(s,u,p,y,x,C){return this._query(s,u,p,y,!0,x,C).length>0}hitTestCircle(s,u,p,y,x){const C=s-p,T=s+p,S=u-p,A=u+p;if(T<0||C>this.width||A<0||S>this.height)return!1;const F=[];return this._forEachCell(C,S,T,A,this._queryCellCircle,F,{hitTest:!0,overlapMode:y,circle:{x:s,y:u,radius:p},seenUids:{box:{},circle:{}}},x),F.length>0}_queryCell(s,u,p,y,x,C,T,S){const{seenUids:A,hitTest:F,overlapMode:z}=T,U=this.boxCells[x];if(null!==U){const q=this.bboxes;for(const W of U)if(!A.box[W]){A.box[W]=!0;const re=4*W,se=this.boxKeys[W];if(s<=q[re+2]&&u<=q[re+3]&&p>=q[re+0]&&y>=q[re+1]&&(!S||S(se))&&(!F||!we(z,se.overlapMode))&&(C.push({key:se,x1:q[re],y1:q[re+1],x2:q[re+2],y2:q[re+3]}),F))return!0}}const X=this.circleCells[x];if(null!==X){const q=this.circles;for(const W of X)if(!A.circle[W]){A.circle[W]=!0;const re=3*W,se=this.circleKeys[W];if(this._circleAndRectCollide(q[re],q[re+1],q[re+2],s,u,p,y)&&(!S||S(se))&&(!F||!we(z,se.overlapMode))){const de=q[re],Y=q[re+1],me=q[re+2];if(C.push({key:se,x1:de-me,y1:Y-me,x2:de+me,y2:Y+me}),F)return!0}}}return!1}_queryCellCircle(s,u,p,y,x,C,T,S){const{circle:A,seenUids:F,overlapMode:z}=T,U=this.boxCells[x];if(null!==U){const q=this.bboxes;for(const W of U)if(!F.box[W]){F.box[W]=!0;const re=4*W,se=this.boxKeys[W];if(this._circleAndRectCollide(A.x,A.y,A.radius,q[re+0],q[re+1],q[re+2],q[re+3])&&(!S||S(se))&&!we(z,se.overlapMode))return C.push(!0),!0}}const X=this.circleCells[x];if(null!==X){const q=this.circles;for(const W of X)if(!F.circle[W]){F.circle[W]=!0;const re=3*W,se=this.circleKeys[W];if(this._circlesCollide(q[re],q[re+1],q[re+2],A.x,A.y,A.radius)&&(!S||S(se))&&!we(z,se.overlapMode))return C.push(!0),!0}}}_forEachCell(s,u,p,y,x,C,T,S){const A=this._convertToXCellCoord(s),F=this._convertToYCellCoord(u),z=this._convertToXCellCoord(p),U=this._convertToYCellCoord(y);for(let X=A;X<=z;X++)for(let q=F;q<=U;q++)if(x.call(this,s,u,p,y,this.xCellCount*q+X,C,T,S))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,p,y,x,C){const T=y-s,S=x-u,A=p+C;return A*A>T*T+S*S}_circleAndRectCollide(s,u,p,y,x,C,T){const S=(C-y)/2,A=Math.abs(s-(y+S));if(A>S+p)return!1;const F=(T-x)/2,z=Math.abs(u-(x+F));if(z>F+p)return!1;if(A<=S||z<=F)return!0;const U=A-S,X=z-F;return U*U+X*X<=p*p}}function Hs(m,s,u,p,y){const x=_.create();return s?(_.scale(x,x,[1/y,1/y,1]),u||_.rotateZ(x,x,p.angle)):_.multiply(x,p.labelPlaneMatrix,m),x}function oo(m,s,u,p,y){if(s){const x=_.clone(m);return _.scale(x,x,[y,y,1]),u||_.rotateZ(x,x,-p.angle),x}return p.glCoordMatrix}function Jt(m,s,u){let p;u?(p=[m.x,m.y,u(m.x,m.y),1],_.transformMat4(p,p,s)):(p=[m.x,m.y,0,1],es(p,p,s));const y=p[3];return{point:new _.pointGeometry(p[0]/y,p[1]/y),signedDistanceFromCamera:y}}function mr(m,s){return.5+m/s*.5}function _i(m,s){const u=m[0]/m[3],p=m[1]/m[3];return u>=-s[0]&&u<=s[0]&&p>=-s[1]&&p<=s[1]}function Ai(m,s,u,p,y,x,C,T,S,A){const F=p?m.textSizeData:m.iconSizeData,z=_.evaluateSizeForZoom(F,u.transform.zoom),U=[256/u.width*2+1,256/u.height*2+1],X=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;X.clear();const q=m.lineVertexArray,W=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,re=u.transform.width/u.transform.height;let se=!1;for(let de=0;de<W.length;de++){const Y=W.get(de);if(Y.hidden||Y.writingMode===_.WritingMode.vertical&&!se){It(Y.numGlyphs,X);continue}let me;if(se=!1,A?(me=[Y.anchorX,Y.anchorY,A(Y.anchorX,Y.anchorY),1],_.transformMat4(me,me,s)):(me=[Y.anchorX,Y.anchorY,0,1],es(me,me,s)),!_i(me,U)){It(Y.numGlyphs,X);continue}const pe=mr(u.transform.cameraToCenterDistance,me[3]),Ce=_.evaluateSizeForFeature(F,z,Y),De=C?Ce/pe:Ce*pe,Fe=new _.pointGeometry(Y.anchorX,Y.anchorY),ve=Jt(Fe,y,A).point,Xe={},Ue=Ft(Y,De,!1,T,s,y,x,m.glyphOffsetArray,q,X,ve,Fe,Xe,re,S,A);se=Ue.useVertical,(Ue.notEnoughRoom||se||Ue.needsFlipping&&Ft(Y,De,!0,T,s,y,x,m.glyphOffsetArray,q,X,ve,Fe,Xe,re,S,A).notEnoughRoom)&&It(Y.numGlyphs,X)}p?m.text.dynamicLayoutVertexBuffer.updateData(X):m.icon.dynamicLayoutVertexBuffer.updateData(X)}function Qo(m,s,u,p,y,x,C,T,S,A,F,z,U){const X=T.glyphStartIndex+T.numGlyphs,q=T.lineStartIndex,W=T.lineStartIndex+T.lineLength,re=s.getoffsetX(T.glyphStartIndex),se=s.getoffsetX(X-1),de=kr(m*re,u,p,y,x,C,T.segment,q,W,S,A,F,z,U);if(!de)return null;const Y=kr(m*se,u,p,y,x,C,T.segment,q,W,S,A,F,z,U);return Y?{first:de,last:Y}:null}function je(m,s,u,p){return m===_.WritingMode.horizontal&&Math.abs(u.y-s.y)>Math.abs(u.x-s.x)*p?{useVertical:!0}:(m===_.WritingMode.vertical?s.y<u.y:s.x>u.x)?{needsFlipping:!0}:null}function Ft(m,s,u,p,y,x,C,T,S,A,F,z,U,X,q,W){const re=s/24,se=m.lineOffsetX*re,de=m.lineOffsetY*re;let Y;if(m.numGlyphs>1){const me=m.glyphStartIndex+m.numGlyphs,pe=m.lineStartIndex,Ce=m.lineStartIndex+m.lineLength,De=Qo(re,T,se,de,u,F,z,m,S,x,U,q,W);if(!De)return{notEnoughRoom:!0};const Fe=Jt(De.first.point,C,W).point,ve=Jt(De.last.point,C,W).point;if(p&&!u){const Xe=je(m.writingMode,Fe,ve,X);if(Xe)return Xe}Y=[De.first];for(let Xe=m.glyphStartIndex+1;Xe<me-1;Xe++)Y.push(kr(re*T.getoffsetX(Xe),se,de,u,F,z,m.segment,pe,Ce,S,x,U,q,W));Y.push(De.last)}else{if(p&&!u){const pe=Jt(z,y,W).point,Ce=m.lineStartIndex+m.segment+1,De=new _.pointGeometry(S.getx(Ce),S.gety(Ce)),Fe=Jt(De,y,W),ve=Fe.signedDistanceFromCamera>0?Fe.point:Et(z,De,pe,1,y,W),Xe=je(m.writingMode,pe,ve,X);if(Xe)return Xe}const me=kr(re*T.getoffsetX(m.glyphStartIndex),se,de,u,F,z,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,S,x,U,q,W);if(!me)return{notEnoughRoom:!0};Y=[me]}for(const me of Y)_.addDynamicAttributes(A,me.point,me.angle);return{}}function Et(m,s,u,p,y,x){const C=Jt(m.add(m.sub(s)._unit()),y,x).point,T=u.sub(C);return u.add(T._mult(p/T.mag()))}function kr(m,s,u,p,y,x,C,T,S,A,F,z,U,X){const q=p?m-s:m+s;let W=q>0?1:-1,re=0;p&&(W*=-1,re=Math.PI),W<0&&(re+=Math.PI);let se=W>0?T+C:T+C+1,de=y,Y=y,me=0,pe=0;const Ce=Math.abs(q),De=[];for(;me+pe<=Ce;){if(se+=W,se<T||se>=S)return null;if(Y=de,De.push(de),de=z[se],void 0===de){const Qe=new _.pointGeometry(A.getx(se),A.gety(se)),Pt=Jt(Qe,F,X);if(Pt.signedDistanceFromCamera>0)de=z[se]=Pt.point;else{const Bt=se-W;de=Et(0===me?x:new _.pointGeometry(A.getx(Bt),A.gety(Bt)),Qe,Y,Ce-me+1,F,X)}}me+=pe,pe=Y.dist(de)}const Fe=(Ce-me)/pe,ve=de.sub(Y),Xe=ve.mult(Fe)._add(Y);Xe._add(ve._unit()._perp()._mult(u*W));const Ue=re+Math.atan2(de.y-Y.y,de.x-Y.x);return De.push(Xe),{point:Xe,angle:U?Ue:0,path:De}}const xs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function It(m,s){for(let u=0;u<m;u++){const p=s.length;s.resize(p+4),s.float32.set(xs,3*p)}}function es(m,s,u){const p=s[0],y=s[1];return m[0]=u[0]*p+u[4]*y+u[12],m[1]=u[1]*p+u[5]*y+u[13],m[3]=u[3]*p+u[7]*y+u[15],m}const Dr=100;class Da{constructor(s,u=new He(s.width+200,s.height+200,25),p=new He(s.width+200,s.height+200,25)){this.transform=s,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Dr,this.screenBottomBoundary=s.height+Dr,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,u,p,y,x,C){const T=this.projectAndGetPerspectiveRatio(y,s.anchorPointX,s.anchorPointY,C),S=p*T.perspectiveRatio,A=s.x1*S+T.point.x,F=s.y1*S+T.point.y,z=s.x2*S+T.point.x,U=s.y2*S+T.point.y;return!this.isInsideGrid(A,F,z,U)||"always"!==u&&this.grid.hitTest(A,F,z,U,u,x)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,F,z,U],offscreen:this.isOffscreen(A,F,z,U)}}placeCollisionCircles(s,u,p,y,x,C,T,S,A,F,z,U,X,q){const W=[],re=new _.pointGeometry(u.anchorX,u.anchorY),se=Jt(re,C,q),de=mr(this.transform.cameraToCenterDistance,se.signedDistanceFromCamera),Y=(F?x/de:x*de)/_.ONE_EM,me=Jt(re,T,q).point,pe=Qo(Y,y,u.lineOffsetX*Y,u.lineOffsetY*Y,!1,me,re,u,p,T,{},!1,q);let Ce=!1,De=!1,Fe=!0;if(pe){const ve=.5*U*de+X,Xe=new _.pointGeometry(-100,-100),Ue=new _.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Qe=new Jo,Pt=pe.first,Bt=pe.last;let ct=[];for(let jt=Pt.path.length-1;jt>=1;jt--)ct.push(Pt.path[jt]);for(let jt=1;jt<Bt.path.length;jt++)ct.push(Bt.path[jt]);const dn=2.5*ve;if(S){const jt=ct.map(Wt=>Jt(Wt,S,q));ct=jt.some(Wt=>Wt.signedDistanceFromCamera<=0)?[]:jt.map(Wt=>Wt.point)}let wn=[];if(ct.length>0){const jt=ct[0].clone(),Wt=ct[0].clone();for(let Cn=1;Cn<ct.length;Cn++)jt.x=Math.min(jt.x,ct[Cn].x),jt.y=Math.min(jt.y,ct[Cn].y),Wt.x=Math.max(Wt.x,ct[Cn].x),Wt.y=Math.max(Wt.y,ct[Cn].y);wn=jt.x>=Xe.x&&Wt.x<=Ue.x&&jt.y>=Xe.y&&Wt.y<=Ue.y?[ct]:Wt.x<Xe.x||jt.x>Ue.x||Wt.y<Xe.y||jt.y>Ue.y?[]:_.clipLine([ct],Xe.x,Xe.y,Ue.x,Ue.y)}for(const jt of wn){Qe.reset(jt,.25*ve);let Wt=0;Wt=Qe.length<=.5*ve?1:Math.ceil(Qe.paddedLength/dn)+1;for(let Cn=0;Cn<Wt;Cn++){const Ir=Cn/Math.max(Wt-1,1),Po=Qe.lerp(Ir),ko=Po.x+Dr,Ro=Po.y+Dr;W.push(ko,Ro,ve,0);const Nr=ko-ve,hi=Ro-ve,yn=ko+ve,Fo=Ro+ve;if(Fe=Fe&&this.isOffscreen(Nr,hi,yn,Fo),De=De||this.isInsideGrid(Nr,hi,yn,Fo),"always"!==s&&this.grid.hitTestCircle(ko,Ro,ve,s,z)&&(Ce=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!A&&Ce||!De||de<this.perspectiveRatioCutoff?[]:W,offscreen:Fe,collisionDetected:Ce}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let p=1/0,y=1/0,x=-1/0,C=-1/0;for(const F of s){const z=new _.pointGeometry(F.x+Dr,F.y+Dr);p=Math.min(p,z.x),y=Math.min(y,z.y),x=Math.max(x,z.x),C=Math.max(C,z.y),u.push(z)}const T=this.grid.query(p,y,x,C).concat(this.ignoredGrid.query(p,y,x,C)),S={},A={};for(const F of T){const z=F.key;if(void 0===S[z.bucketInstanceId]&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const U=[new _.pointGeometry(F.x1,F.y1),new _.pointGeometry(F.x2,F.y1),new _.pointGeometry(F.x2,F.y2),new _.pointGeometry(F.x1,F.y2)];_.polygonIntersectsPolygon(u,U)&&(S[z.bucketInstanceId][z.featureIndex]=!0,void 0===A[z.bucketInstanceId]&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(s,u,p,y,x,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:x,collisionGroupID:C,overlapMode:u},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,p,y,x,C){const T=p?this.ignoredGrid:this.grid,S={bucketInstanceId:y,featureIndex:x,collisionGroupID:C,overlapMode:u};for(let A=0;A<s.length;A+=4)T.insertCircle(S,s[A],s[A+1],s[A+2])}projectAndGetPerspectiveRatio(s,u,p,y){let x;return y?(x=[u,p,y(u,p),1],_.transformMat4(x,x,s)):(x=[u,p,0,1],es(x,x,s)),{point:new _.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+Dr,(-x[1]/x[3]+1)/2*this.transform.height+Dr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(s,u,p,y){return p<Dr||s>=this.screenRightBoundary||y<Dr||u>this.screenBottomBoundary}isInsideGrid(s,u,p,y){return p>=0&&s<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=_.identity([]);return _.translate(s,s,[-100,-100,0]),s}}function or(m,s,u){return s*(_.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}class li{constructor(s,u,p,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):y&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class _n{constructor(s,u,p,y,x){this.text=new li(s?s.text:null,u,p,x),this.icon=new li(s?s.icon:null,u,y,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pl{constructor(s,u,p){this.text=s,this.icon=u,this.skipFade=p}}class so{constructor(){this.invProjMatrix=_.create(),this.viewportMatrix=_.create(),this.circles=[]}}class bs{constructor(s,u,p,y,x){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=x}}class ws{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[s]}}function Gs(m,s,u,p,y){const{horizontalAlign:x,verticalAlign:C}=_.getAnchorAlignment(m),T=-(x-.5)*s,S=-(C-.5)*u,A=_.evaluateVariableOffset(m,p);return new _.pointGeometry(T+A[0]*y,S+A[1]*y)}function Cs(m,s,u,p,y,x){const{x1:C,x2:T,y1:S,y2:A,anchorPointX:F,anchorPointY:z}=m,U=new _.pointGeometry(s,u);return p&&U._rotate(y?x:-x),{x1:C+U.x,y1:S+U.y,x2:T+U.x,y2:A+U.y,anchorPointX:F,anchorPointY:z}}class G{constructor(s,u,p,y,x){this.transform=s.clone(),this.terrain=u,this.collisionIndex=new Da(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new ws(y),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,u,p,y){const x=p.getBucket(u),C=p.latestFeatureIndex;if(!x||!C||u.id!==x.layerIds[0])return;const T=p.collisionBoxArray,S=x.layers[0].layout,A=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),F=p.tileSize/_.EXTENT,z=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),U="map"===S.get("text-pitch-alignment"),X="map"===S.get("text-rotation-alignment"),q=or(p,1,this.transform.zoom),W=Hs(z,U,X,this.transform,q);let re=null;if(U){const de=oo(z,U,X,this.transform,q);re=_.multiply([],this.transform.labelPlaneMatrix,de)}this.retainedQueryData[x.bucketInstanceId]=new bs(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,p.tileID);const se={bucket:x,layout:S,posMatrix:z,textLabelPlaneMatrix:W,labelToScreenMatrix:re,scale:A,textPixelRatio:F,holdingForFade:p.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:_.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const de of x.sortKeyRanges){const{sortKey:Y,symbolInstanceStart:me,symbolInstanceEnd:pe}=de;s.push({sortKey:Y,symbolInstanceStart:me,symbolInstanceEnd:pe,parameters:se})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:se})}attemptAnchorPlacement(s,u,p,y,x,C,T,S,A,F,z,U,X,q,W,re){const se=[U.textOffset0,U.textOffset1],de=Gs(s,p,y,se,x),Y=this.collisionIndex.placeCollisionBox(Cs(u,de.x,de.y,C,T,this.transform.angle),z,S,A,F.predicate,re);if((!W||0!==this.collisionIndex.placeCollisionBox(Cs(W,de.x,de.y,C,T,this.transform.angle),z,S,A,F.predicate,re).box.length)&&Y.box.length>0){let me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(me=this.prevPlacement.variableOffsets[U.crossTileID].anchor),0===U.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:se,width:p,height:y,anchor:s,textBoxScale:x,prevAnchor:me},this.markUsedJustification(X,s,U,q),X.allowVerticalPlacement&&(this.markUsedOrientation(X,q,U),this.placedOrientations[U.crossTileID]=q),{shift:de,placedGlyphBoxes:Y}}}placeLayerBucketPart(s,u,p){const{bucket:y,layout:x,posMatrix:C,textLabelPlaneMatrix:T,labelToScreenMatrix:S,textPixelRatio:A,holdingForFade:F,collisionBoxArray:z,partiallyEvaluatedTextSize:U,collisionGroup:X}=s.parameters,q=x.get("text-optional"),W=x.get("icon-optional"),re=_.getOverlapMode(x,"text-overlap","text-allow-overlap"),se="always"===re,de=_.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),Y="always"===de,me="map"===x.get("text-rotation-alignment"),pe="map"===x.get("text-pitch-alignment"),Ce="none"!==x.get("icon-text-fit"),De="viewport-y"===x.get("symbol-z-order"),Fe=se&&(Y||!y.hasIconData()||W),ve=Y&&(se||!y.hasTextData()||q);!y.collisionArrays&&z&&y.deserializeCollisionBoxes(z);const Xe=(Ue,Qe)=>{if(u[Ue.crossTileID])return;if(F)return void(this.placements[Ue.crossTileID]=new pl(!1,!1,!1));let Pt=!1,Bt=!1,ct=!0,dn=null,wn={box:null,offscreen:null},jt={box:null,offscreen:null},Wt=null,Cn=null,Ir=null,Po=0,ko=0,Ro=0;Qe.textFeatureIndex?Po=Qe.textFeatureIndex:Ue.useRuntimeCollisionCircles&&(Po=Ue.featureIndex),Qe.verticalTextFeatureIndex&&(ko=Qe.verticalTextFeatureIndex);const Nr=this.retainedQueryData[y.bucketInstanceId].tileID,hi=this.terrain?(rr,Nt)=>this.terrain.getElevation(Nr,rr,Nt):null;for(const rr of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Nt=Qe[rr];Nt&&(Nt.elevation=hi?hi(Nt.anchorPointX,Nt.anchorPointY):0)}const yn=Qe.textBox;if(yn){const rr=en=>{let Tr=_.WritingMode.horizontal;if(y.allowVerticalPlacement&&!en&&this.prevPlacement){const zr=this.prevPlacement.placedOrientations[Ue.crossTileID];zr&&(this.placedOrientations[Ue.crossTileID]=zr,Tr=zr,this.markUsedOrientation(y,Tr,Ue))}return Tr},Nt=(en,Tr)=>{if(y.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Qe.verticalTextBox){for(const zr of y.writingModes)if(zr===_.WritingMode.vertical?(wn=Tr(),jt=wn):wn=en(),wn&&wn.box&&wn.box.length)break}else wn=en()};if(x.get("text-variable-anchor")){let en=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ue.crossTileID]){const Rn=this.prevPlacement.variableOffsets[Ue.crossTileID];en.indexOf(Rn.anchor)>0&&(en=en.filter(Ci=>Ci!==Rn.anchor),en.unshift(Rn.anchor))}const Tr=(Rn,Ci,na)=>{const za=Rn.x2-Rn.x1,Ba=Rn.y2-Rn.y1,Nh=Ue.textBoxScale,fd=Ce&&"never"===de?Ci:null;let ss={box:[],offscreen:!1};const ks="never"!==re?2*en.length:en.length;for(let ra=0;ra<ks;++ra){const hc=this.attemptAnchorPlacement(en[ra%en.length],Rn,za,Ba,Nh,me,pe,A,C,X,ra>=en.length?re:"never",Ue,y,na,fd,hi);if(hc&&(ss=hc.placedGlyphBoxes,ss&&ss.box&&ss.box.length)){Pt=!0,dn=hc.shift;break}}return ss};Nt(()=>Tr(yn,Qe.iconBox,_.WritingMode.horizontal),()=>{const Rn=Qe.verticalTextBox;return y.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&Ue.numVerticalGlyphVertices>0&&Rn?Tr(Rn,Qe.verticalIconBox,_.WritingMode.vertical):{box:null,offscreen:null}}),wn&&(Pt=wn.box,ct=wn.offscreen);const zr=rr(wn&&wn.box);if(!Pt&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[Ue.crossTileID];Rn&&(this.variableOffsets[Ue.crossTileID]=Rn,this.markUsedJustification(y,Rn.anchor,Ue,zr))}}else{const en=(Tr,zr)=>{const Rn=this.collisionIndex.placeCollisionBox(Tr,re,A,C,X.predicate,hi);return Rn&&Rn.box&&Rn.box.length&&(this.markUsedOrientation(y,zr,Ue),this.placedOrientations[Ue.crossTileID]=zr),Rn};Nt(()=>en(yn,_.WritingMode.horizontal),()=>{const Tr=Qe.verticalTextBox;return y.allowVerticalPlacement&&Ue.numVerticalGlyphVertices>0&&Tr?en(Tr,_.WritingMode.vertical):{box:null,offscreen:null}}),rr(wn&&wn.box&&wn.box.length)}}if(Wt=wn,Pt=Wt&&Wt.box&&Wt.box.length>0,ct=Wt&&Wt.offscreen,Ue.useRuntimeCollisionCircles){const rr=y.text.placedSymbolArray.get(Ue.centerJustifiedTextSymbolIndex),Nt=_.evaluateSizeForFeature(y.textSizeData,U,rr),en=x.get("text-padding");Cn=this.collisionIndex.placeCollisionCircles(re,rr,y.lineVertexArray,y.glyphOffsetArray,Nt,C,T,S,p,pe,X.predicate,Ue.collisionCircleDiameter,en,hi),Cn.circles.length&&Cn.collisionDetected&&!p&&_.warnOnce("Collisions detected, but collision boxes are not shown"),Pt=se||Cn.circles.length>0&&!Cn.collisionDetected,ct=ct&&Cn.offscreen}if(Qe.iconFeatureIndex&&(Ro=Qe.iconFeatureIndex),Qe.iconBox){const rr=Nt=>{const en=Ce&&dn?Cs(Nt,dn.x,dn.y,me,pe,this.transform.angle):Nt;return this.collisionIndex.placeCollisionBox(en,de,A,C,X.predicate,hi)};jt&&jt.box&&jt.box.length&&Qe.verticalIconBox?(Ir=rr(Qe.verticalIconBox),Bt=Ir.box.length>0):(Ir=rr(Qe.iconBox),Bt=Ir.box.length>0),ct=ct&&Ir.offscreen}const Fo=q||0===Ue.numHorizontalGlyphVertices&&0===Ue.numVerticalGlyphVertices,hu=W||0===Ue.numIconVertices;if(Fo||hu?hu?Fo||(Bt=Bt&&Pt):Pt=Bt&&Pt:Bt=Pt=Bt&&Pt,Pt&&Wt&&Wt.box&&this.collisionIndex.insertCollisionBox(Wt.box,re,x.get("text-ignore-placement"),y.bucketInstanceId,jt&&jt.box&&ko?ko:Po,X.ID),Bt&&Ir&&this.collisionIndex.insertCollisionBox(Ir.box,de,x.get("icon-ignore-placement"),y.bucketInstanceId,Ro,X.ID),Cn&&(Pt&&this.collisionIndex.insertCollisionCircles(Cn.circles,re,x.get("text-ignore-placement"),y.bucketInstanceId,Po,X.ID),p)){const rr=y.bucketInstanceId;let Nt=this.collisionCircleArrays[rr];void 0===Nt&&(Nt=this.collisionCircleArrays[rr]=new so);for(let en=0;en<Cn.circles.length;en+=4)Nt.circles.push(Cn.circles[en+0]),Nt.circles.push(Cn.circles[en+1]),Nt.circles.push(Cn.circles[en+2]),Nt.circles.push(Cn.collisionDetected?1:0)}if(0===Ue.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===y.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ue.crossTileID]=new pl(Pt||Fe,Bt||ve,ct||y.justReloaded),u[Ue.crossTileID]=!0};if(De){if(0!==s.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const Ue=y.getSortedSymbolIndexes(this.transform.angle);for(let Qe=Ue.length-1;Qe>=0;--Qe){const Pt=Ue[Qe];Xe(y.symbolInstances.get(Pt),y.collisionArrays[Pt])}}else for(let Ue=s.symbolInstanceStart;Ue<s.symbolInstanceEnd;Ue++)Xe(y.symbolInstances.get(Ue),y.collisionArrays[Ue]);if(p&&y.bucketInstanceId in this.collisionCircleArrays){const Ue=this.collisionCircleArrays[y.bucketInstanceId];_.invert(Ue.invProjMatrix,C),Ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(s,u,p,y){let x;x=y===_.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[_.getAnchorJustification(u)];const C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const T of C)T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=x>=0&&T!==x?0:p.crossTileID)}markUsedOrientation(s,u,p){const y=u===_.WritingMode.horizontal||u===_.WritingMode.horizontalOnly?u:0,x=u===_.WritingMode.vertical?u:0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const T of C)s.text.placedSymbolArray.get(T).placedOrientation=y;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(s):1,x=u?u.opacities:{},C=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],F=x[S];F?(this.opacities[S]=new _n(F,y,A.text,A.icon),p=p||A.text!==F.text.placed||A.icon!==F.icon.placed):(this.opacities[S]=new _n(null,y,A.text,A.icon,A.skipFade),p=p||A.text||A.icon)}for(const S in x){const A=x[S];if(!this.opacities[S]){const F=new _n(A,y,!1,!1);F.isHidden()||(this.opacities[S]=F,p=p||A.text.placed||A.icon.placed)}}for(const S in C)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=C[S]);for(const S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);if(u&&void 0===u.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u){const p={};for(const y of u){const x=y.getBucket(s);x&&y.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,y.collisionBoxArray)}}updateBucketOpacities(s,u,p){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0].layout,x=new _n(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),T=y.get("icon-allow-overlap"),S=y.get("text-variable-anchor"),A="map"===y.get("text-rotation-alignment"),F="map"===y.get("text-pitch-alignment"),z="none"!==y.get("icon-text-fit"),U=new _n(null,0,C&&(T||!s.hasIconData()||y.get("icon-optional")),T&&(C||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const X=(q,W,re)=>{for(let se=0;se<W/4;se++)q.opacityVertexArray.emplaceBack(re)};for(let q=0;q<s.symbolInstances.length;q++){const W=s.symbolInstances.get(q),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:se,crossTileID:de}=W;let Y=this.opacities[de];u[de]?Y=x:Y||(Y=U,this.opacities[de]=Y),u[de]=!0;const me=W.numIconVertices>0,pe=this.placedOrientations[W.crossTileID],Ce=pe===_.WritingMode.vertical,De=pe===_.WritingMode.horizontal||pe===_.WritingMode.horizontalOnly;if(re>0||se>0){const Fe=oe(Y.text);X(s.text,re,Ce?_e:Fe),X(s.text,se,De?_e:Fe);const ve=Y.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Qe=>{Qe>=0&&(s.text.placedSymbolArray.get(Qe).hidden=ve||Ce?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=ve||De?1:0);const Xe=this.variableOffsets[W.crossTileID];Xe&&this.markUsedJustification(s,Xe.anchor,W,pe);const Ue=this.placedOrientations[W.crossTileID];Ue&&(this.markUsedJustification(s,"left",W,Ue),this.markUsedOrientation(s,Ue,W))}if(me){const Fe=oe(Y.icon),ve=!(z&&W.verticalPlacedIconSymbolIndex&&Ce);W.placedIconSymbolIndex>=0&&(X(s.icon,W.numIconVertices,ve?Fe:_e),s.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=Y.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(s.icon,W.numVerticalIconVertices,ve?_e:Fe),s.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Fe=s.collisionArrays[q];if(Fe){let ve=new _.pointGeometry(0,0);if(Fe.textBox||Fe.verticalTextBox){let Ue=!0;if(S){const Qe=this.variableOffsets[de];Qe?(ve=Gs(Qe.anchor,Qe.width,Qe.height,Qe.textOffset,Qe.textBoxScale),A&&ve._rotate(F?this.transform.angle:-this.transform.angle)):Ue=!1}Fe.textBox&&k(s.textCollisionBox.collisionVertexArray,Y.text.placed,!Ue||Ce,ve.x,ve.y),Fe.verticalTextBox&&k(s.textCollisionBox.collisionVertexArray,Y.text.placed,!Ue||De,ve.x,ve.y)}const Xe=!(De||!Fe.verticalIconBox);Fe.iconBox&&k(s.iconCollisionBox.collisionVertexArray,Y.icon.placed,Xe,z?ve.x:0,z?ve.y:0),Fe.verticalIconBox&&k(s.iconCollisionBox.collisionVertexArray,Y.icon.placed,!Xe,z?ve.x:0,z?ve.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=q.invProjMatrix,s.placementViewportMatrix=q.viewportMatrix,s.collisionCircleArray=q.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function k(m,s,u,p,y){m.emplaceBack(s?1:0,u?1:0,p||0,y||0),m.emplaceBack(s?1:0,u?1:0,p||0,y||0),m.emplaceBack(s?1:0,u?1:0,p||0,y||0),m.emplaceBack(s?1:0,u?1:0,p||0,y||0)}const N=Math.pow(2,25),j=Math.pow(2,24),H=Math.pow(2,17),Q=Math.pow(2,16),ie=Math.pow(2,9),ne=Math.pow(2,8),te=Math.pow(2,1);function oe(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const s=m.placed?1:0,u=Math.floor(127*m.opacity);return u*N+s*j+u*H+s*Q+u*ie+s*ne+u*te+s}const _e=0;class Pe{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,u,p,y,x){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(C,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((T,S)=>T.sortKey-S.sortKey));this._currentPartIndex<C.length;)if(u.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class ye{constructor(s,u,p,y,x,C,T,S){this.placement=new G(s,u,C,T,S),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,u,p){const y=_.exported.now(),x=()=>{const C=_.exported.now()-y;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=u[s[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=T)&&(!C.maxzoom||C.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Pe(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Ke=512/_.EXTENT/2;class st{constructor(s,u,p){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let y=0;y<u.length;y++){const x=u.get(y),C=x.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,s)})}}getScaledCoordinates(s,u){const p=Ke/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*_.EXTENT+s.anchorX)*p),y:Math.floor((u.canonical.y*_.EXTENT+s.anchorY)*p)}}findMatches(s,u,p){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let x=0;x<s.length;x++){const C=s.get(x);if(C.crossTileID)continue;const T=this.indexedSymbolInstances[C.key];if(!T)continue;const S=this.getScaledCoordinates(C,u);for(const A of T)if(Math.abs(A.coord.x-S.x)<=y&&Math.abs(A.coord.y-S.y)<=y&&!p[A.crossTileID]){p[A.crossTileID]=!0,C.crossTileID=A.crossTileID;break}}}}class ze{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(0!==u)for(const p in this.indexes){const y=this.indexes[p],x={};for(const C in y){const T=y[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),x[T.tileID.key]=T}this.indexes[p]=x}this.lng=s}addBucket(s,u,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const y=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const C=this.indexes[x];if(Number(x)>s.overscaledZ)for(const T in C){const S=C[T];S.tileID.isChildOf(s)&&S.findMatches(u.symbolInstances,s,y)}else{const T=C[s.scaledTo(Number(x)).key];T&&T.findMatches(u.symbolInstances,s,y)}}for(let x=0;x<u.symbolInstances.length;x++){const C=u.symbolInstances.get(x);C.crossTileID||(C.crossTileID=p.generate(),y[C.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new st(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const p in u.indexedSymbolInstances)for(const y of u.indexedSymbolInstances[p])delete this.usedCrossTileIDs[s][y.crossTileID]}removeStaleBuckets(s){let u=!1;for(const p in this.indexes){const y=this.indexes[p];for(const x in y)s[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[x]),delete y[x],u=!0)}return u}}class ht{constructor(){this.layerIndexes={},this.crossTileIDs=new ze,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,p){let y=this.layerIndexes[s.id];void 0===y&&(y=this.layerIndexes[s.id]=new dt);let x=!1;const C={};y.handleWrapJump(p);for(const T of u){const S=T.getBucket(s);S&&s.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(T.tileID,S,this.crossTileIDs)&&(x=!0),C[S.bucketInstanceId]=!0)}return y.removeStaleBuckets(C)&&(x=!0),x}pruneUnusedLayers(s){const u={};s.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}var Qt=_.createLayout([{name:"a_pos",type:"Int16",components:2}]);class bt extends _.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=s._cache.max,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const s in this._tiles){const u=this._tiles[s];u.textures.forEach(p=>p.destroy()),u.textures=[]}}update(s,u){this.sourceCache.update(s,u),this._renderableTilesKeys=[];for(const p of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),_.ortho(p.posMatrix,0,_.EXTENT,0,_.EXTENT,0,1),this._tiles[p.key]=new Xo(p,this.tileSize))}removeOutdated(s){const u={};this.renderHistory=this.renderHistory.filter((p,y)=>this.renderHistory.indexOf(p)===y).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)u[p]=!0;for(const p of this.renderHistory)u[p]=!0;for(const p in this._tiles)u[p]||(this._tiles[p].clearTextures(s),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const u={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(y.canonical.equals(s.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16),_.ortho(x.posMatrix,0,_.EXTENT,0,_.EXTENT,0,1),u[p]=x}else if(y.canonical.isChildOf(s.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16);const C=y.canonical.z-s.canonical.z,T=y.canonical.x-(y.canonical.x>>C<<C),S=y.canonical.y-(y.canonical.y>>C<<C),A=_.EXTENT>>C;_.ortho(x.posMatrix,0,A,0,A,0,1),_.translate(x.posMatrix,x.posMatrix,[-T*A,-S*A,0]),u[p]=x}else if(s.canonical.isChildOf(y.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16);const C=s.canonical.z-y.canonical.z,T=s.canonical.x-(s.canonical.x>>C<<C),S=s.canonical.y-(s.canonical.y>>C<<C),A=_.EXTENT>>C;_.ortho(x.posMatrix,0,_.EXTENT,0,_.EXTENT,0,1),_.translate(x.posMatrix,x.posMatrix,[T*A,S*A,0]),_.scale(x.posMatrix,x.posMatrix,[1/2**C,1/2**C,0]),u[p]=x}}return u}getSourceTile(s,u){const p=this.sourceCache._source;let y=s.overscaledZ-this.deltaZoom;if(y>p.maxzoom&&(y=p.maxzoom),y<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(y).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!x||!x.dem)&&u)for(;y>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(s.scaledTo(y--).key);return x}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(u=>u.timeLoaded>=s)}}class Lt{constructor(s,u,p){this.style=s,this.sourceCache=new bt(u),this.options=p,this.exaggeration="number"==typeof p.exaggeration?p.exaggeration:1,this.elevationOffset="number"==typeof p.elevationOffset?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(s,u,p,y=_.EXTENT){if(!(u>=0&&u<y&&p>=0&&p<y))return this.elevationOffset;let x=0;const C=this.getTerrainData(s);if(C.tile&&C.tile.dem){const T=_.transformMat4$1([],[u/y*_.EXTENT,p/y*_.EXTENT],C.u_terrain_matrix),S=[T[0]*C.tile.dem.dim,T[1]*C.tile.dem.dim],A=[Math.floor(S[0]),Math.floor(S[1])],F=C.tile.dem.get(A[0],A[1]),z=C.tile.dem.get(A[0],A[1]+1),U=C.tile.dem.get(A[0]+1,A[1]),X=C.tile.dem.get(A[0]+1,A[1]+1);x=_.number(_.number(F,z,S[0]-A[0]),_.number(U,X,S[0]-A[0]),S[1]-A[1])}return x}rememberForRerender(s,u){for(const p in this.sourceCache._tiles){const y=this.sourceCache._tiles[p];(y.tileID.equals(u)||y.tileID.isChildOf(u))&&(s===this.sourceCache.sourceCache.id&&(y.timeLoaded=Date.now()),this._rerender[s]=this._rerender[s]||{},this._rerender[s][y.tileID.key]=!0)}}needsRerender(s,u){return this._rerender[s]&&this._rerender[s][u.key]}clearRerenderCache(){this._rerender={}}getElevation(s,u,p,y=_.EXTENT){return(this.getDEMElevation(s,u,p,y)+this.elevationOffset)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const y=this.style.map.painter.context,x=new _.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Un(y,x,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Un(y,new _.RGBAImage({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=_.identity([])}const u=this.sourceCache.getSourceTile(s,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const y=this.style.map.painter.context;u.demTexture=this.style.map.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new Un(y,u.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),u.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const p=u&&u+u.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const y=this.sourceCache.sourceCache._source.maxzoom;let x=s.canonical.z-u.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=y?x=s.canonical.z-y:_.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=s.canonical.x-(s.canonical.x>>x<<x),T=s.canonical.y-(s.canonical.y>>x<<x),S=_.fromScaling(new Float64Array(16),[1/(_.EXTENT<<x),1/(_.EXTENT<<x),0]);_.translate(S,S,[C*_.EXTENT,T*_.EXTENT,0]),this._demMatrixCache[s.key]={matrix:S,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getRTTFramebuffer(){const s=this.style.map.painter;if(!this._rttFramebuffer){const u=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=s.context.createFramebuffer(u,u,!0),this._rttFramebuffer.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,u))}return this._rttFramebuffer}getFramebuffer(s){const u=this.style.map.painter,p=u.width/devicePixelRatio,y=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Un(u.context,{width:p,height:y,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Un(u.context,{width:p,height:y,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,y,!0),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,y))),this._fbo.colorAttachment.set("coords"===s?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,C=0;x<this._coordsTextureSize;x++)for(let T=0;T<this._coordsTextureSize;T++,C+=4)u[C+0]=255&T,u[C+1]=255&x,u[C+2]=T>>8<<4|x>>8,u[C+3]=0;const p=new _.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),y=new Un(s,p,s.gl.RGBA,{premultiply:!1});return y.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(s){const u=new Uint8Array(4),p=this.style.map.painter,y=p.context,x=y.gl;y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(s.x,p.height/devicePixelRatio-s.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,u),y.bindFramebuffer.set(null);const C=u[0]+(u[2]>>4<<8),T=u[1]+((15&u[2])<<8),S=this.coordsIndex[255-u[3]],A=S&&this.sourceCache.getTileByID(S);if(!A)return null;const F=this._coordsTextureSize,z=(1<<A.tileID.canonical.z)*F;return new _.MercatorCoordinate((A.tileID.canonical.x*F+C)/z,(A.tileID.canonical.y*F+T)/z,this.getElevation(A.tileID,C,T,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.style.map.painter.context,u=new _.PosArray,p=new _.TriangleIndexArray,y=this.meshSize,x=_.EXTENT/y,C=y*y;for(let T=0;T<=y;T++)for(let S=0;S<=y;S++)u.emplaceBack(S*x,T*x);for(let T=0;T<C;T+=y+1)for(let S=0;S<y;S++)p.emplaceBack(S+T,y+S+T+1,y+S+T+2),p.emplaceBack(S+T,y+S+T+2,S+T+1);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(u,Qt.members),segments:_.SegmentVector.simpleSegment(0,0,u.length,p.length)},this._mesh}getMinMaxElevation(s){const u=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=(u.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(u.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ht=(m,s)=>_.emitValidationErrors(m,s&&s.filter(u=>"source.canvas"!==u.identifier)),vn=_.pick(Yt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Xn=_.pick(Yt,["setCenter","setZoom","setBearing","setPitch"]),Ln=function(){const m={},s=_.spec.$version;for(const u in _.spec.$root){const p=_.spec.$root[u];if(p.required){let y=null;y="version"===u?s:"array"===p.type?[]:{},null!=y&&(m[u]=y)}}return m}();class Rr extends _.Evented{constructor(s,u={}){super(),this.map=s,this.dispatcher=new Zo(wa(),this),this.imageManager=new ll,this.imageManager.setEventedParent(this),this.glyphManager=new jn(s._requestManager,u.localIdeographFontFamily),this.lineAtlas=new ya(256,512),this.crossTileSymbolIndex=new ht,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new _.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",_.getReferrer());const p=this;this._rtlTextPluginCallback=Rr.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,C)=>{if(_.triggerPluginCompletionEvent(x),C&&C.every(T=>T))for(const T in p.sourceCaches)p.sourceCaches[T].reload()})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const x=this.sourceCaches[y.sourceId];if(!x)return;const C=x.getSource();if(C&&C.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===C.id&&this._validateLayer(S)}})}loadURL(s,u={}){this.fire(new _.Event("dataloading",{dataType:"style"}));const p="boolean"!=typeof u.validate||u.validate,y=this.map._requestManager.transformRequest(s,_.ResourceType.Style);this._request=_.getJSON(y,(x,C)=>{this._request=null,x?this.fire(new _.ErrorEvent(x)):C&&this._load(C,p)})}loadJSON(s,u={}){this.fire(new _.Event("dataloading",{dataType:"style"})),this._request=_.exported.frame(()=>{this._request=null,this._load(s,!1!==u.validate)})}loadEmpty(){this.fire(new _.Event("dataloading",{dataType:"style"})),this._load(Ln,!1)}_load(s,u){if(u&&Ht(this,_.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const y in s.sources)this.addSource(y,s.sources[y],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);const p=dl(this.stylesheet.layers);this._order=p.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of p)y=_.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Vi(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new _.Event("data",{dataType:"style"})),this.fire(new _.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(u,p,y,x){let C,T,S;const A=y>1?"@2x":"";let F=_.getJSON(p.transformRequest(p.normalizeSpriteURL(u,A,".json"),_.ResourceType.SpriteJSON),(X,q)=>{F=null,S||(S=X,C=q,U())}),z=_.getImage(p.transformRequest(p.normalizeSpriteURL(u,A,".png"),_.ResourceType.SpriteImage),(X,q)=>{z=null,S||(S=X,T=q,U())});function U(){if(S)x(S);else if(C&&T){const X=_.exported.getImageData(T),q={};for(const W in C){const{width:re,height:se,x:de,y:Y,sdf:me,pixelRatio:pe,stretchX:Ce,stretchY:De,content:Fe}=C[W],ve=new _.RGBAImage({width:re,height:se});_.RGBAImage.copy(X,ve,{x:de,y:Y},{x:0,y:0},{width:re,height:se}),q[W]={data:ve,pixelRatio:pe,sdf:me,stretchX:Ce,stretchY:De,content:Fe}}x(null,q)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}}(s,this.map._requestManager,this.map.getPixelRatio(),(u,p)=>{if(this._spriteRequest=null,u)this.fire(new _.ErrorEvent(u));else if(p)for(const y in p)this.imageManager.addImage(y,p[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new _.Event("data",{dataType:"style"}))})}_validateLayer(s){const u=this.sourceCaches[s.source];if(!u)return;const p=s.sourceLayer;if(!p)return;const y=u.getSource();("geojson"===y.type||y.vectorLayerIds&&-1===y.vectorLayerIds.indexOf(p))&&this.fire(new _.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${y.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const u=[];for(const p of s){const y=this._layers[p];"custom"!==y.type&&u.push(y.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const u=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const C in this._updatedSources){const T=this._updatedSources[C];if("reload"===T)this._reloadSource(C);else{if("clear"!==T)throw new Error(`Invalid action ${T}`);this._clearSource(C)}}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const y in this.sourceCaches){const x=this.sourceCaches[y];p[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const y in p){const x=this.sourceCaches[y];p[y]!==x.used&&x.fire(new _.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(s),this.z=s.zoom,u&&this.fire(new _.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(s){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),s){const u=this.sourceCaches[s.source];if(!u)throw new Error(`cannot load terrain, because there exists no source with ID: ${s.source}`);this.terrain=new Lt(this,u,s),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===s.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):"geojson"===p.source.type&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new _.Event("terrain",{terrain:s}))}setState(s){if(this._checkLoaded(),Ht(this,_.validateStyle(s)))return!1;(s=_.clone$1(s)).layers=dl(s.layers);const u=function(y,x){if(!y)return[{command:Yt.setStyle,args:[x]}];let C=[];try{if(!nn(y.version,x.version))return[{command:Yt.setStyle,args:[x]}];nn(y.center,x.center)||C.push({command:Yt.setCenter,args:[x.center]}),nn(y.zoom,x.zoom)||C.push({command:Yt.setZoom,args:[x.zoom]}),nn(y.bearing,x.bearing)||C.push({command:Yt.setBearing,args:[x.bearing]}),nn(y.pitch,x.pitch)||C.push({command:Yt.setPitch,args:[x.pitch]}),nn(y.sprite,x.sprite)||C.push({command:Yt.setSprite,args:[x.sprite]}),nn(y.glyphs,x.glyphs)||C.push({command:Yt.setGlyphs,args:[x.glyphs]}),nn(y.transition,x.transition)||C.push({command:Yt.setTransition,args:[x.transition]}),nn(y.light,x.light)||C.push({command:Yt.setLight,args:[x.light]});const T={},S=[];!function(F,z,U,X){let q;for(q in z=z||{},F=F||{})Object.prototype.hasOwnProperty.call(F,q)&&(Object.prototype.hasOwnProperty.call(z,q)||ys(q,U,X));for(q in z)Object.prototype.hasOwnProperty.call(z,q)&&(Object.prototype.hasOwnProperty.call(F,q)?nn(F[q],z[q])||("geojson"===F[q].type&&"geojson"===z[q].type&&hl(F,z,q)?U.push({command:Yt.setGeoJSONSourceData,args:[q,z[q].data]}):_s(q,z,U,X)):To(q,z,U))}(y.sources,x.sources,S,T);const A=[];y.layers&&y.layers.forEach(F=>{T[F.source]?C.push({command:Yt.removeLayer,args:[F.id]}):A.push(F)}),C=C.concat(S),function(F,z,U){z=z||[];const X=(F=F||[]).map(Yo),q=z.map(Yo),W=F.reduce(vs,{}),re=z.reduce(vs,{}),se=X.slice(),de=Object.create(null);let Y,me,pe,Ce,De,Fe,ve;for(Y=0,me=0;Y<X.length;Y++)pe=X[Y],Object.prototype.hasOwnProperty.call(re,pe)?me++:(U.push({command:Yt.removeLayer,args:[pe]}),se.splice(se.indexOf(pe,me),1));for(Y=0,me=0;Y<q.length;Y++)pe=q[q.length-1-Y],se[se.length-1-Y]!==pe&&(Object.prototype.hasOwnProperty.call(W,pe)?(U.push({command:Yt.removeLayer,args:[pe]}),se.splice(se.lastIndexOf(pe,se.length-me),1)):me++,Fe=se[se.length-Y],U.push({command:Yt.addLayer,args:[re[pe],Fe]}),se.splice(se.length-Y,0,pe),de[pe]=!0);for(Y=0;Y<q.length;Y++)if(pe=q[Y],Ce=W[pe],De=re[pe],!de[pe]&&!nn(Ce,De))if(nn(Ce.source,De.source)&&nn(Ce["source-layer"],De["source-layer"])&&nn(Ce.type,De.type)){for(ve in So(Ce.layout,De.layout,U,pe,null,Yt.setLayoutProperty),So(Ce.paint,De.paint,U,pe,null,Yt.setPaintProperty),nn(Ce.filter,De.filter)||U.push({command:Yt.setFilter,args:[pe,De.filter]}),nn(Ce.minzoom,De.minzoom)&&nn(Ce.maxzoom,De.maxzoom)||U.push({command:Yt.setLayerZoomRange,args:[pe,De.minzoom,De.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&(0===ve.indexOf("paint.")?So(Ce[ve],De[ve],U,pe,ve.slice(6),Yt.setPaintProperty):nn(Ce[ve],De[ve])||U.push({command:Yt.setLayerProperty,args:[pe,ve,De[ve]]}));for(ve in De)Object.prototype.hasOwnProperty.call(De,ve)&&!Object.prototype.hasOwnProperty.call(Ce,ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&(0===ve.indexOf("paint.")?So(Ce[ve],De[ve],U,pe,ve.slice(6),Yt.setPaintProperty):nn(Ce[ve],De[ve])||U.push({command:Yt.setLayerProperty,args:[pe,ve,De[ve]]}))}else U.push({command:Yt.removeLayer,args:[pe]}),Fe=se[se.lastIndexOf(pe)+1],U.push({command:Yt.addLayer,args:[De,Fe]})}(A,x.layers,C)}catch(T){console.warn("Unable to compute style diff:",T),C=[{command:Yt.setStyle,args:[x]}]}return C}(this.serialize(),s).filter(y=>!(y.command in Xn));if(0===u.length)return!1;const p=u.filter(y=>!(y.command in vn));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);return u.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=s,!0}addImage(s,u){if(this.getImage(s))return this.fire(new _.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,u),this._afterImageUpdated(s)}updateImage(s,u){this.imageManager.updateImage(s,u)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new _.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new _.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,u,p={}){if(this._checkLoaded(),void 0!==this.sourceCaches[s])throw new Error(`Source "${s}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(_.validateStyle.source,`sources.${s}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=this.sourceCaches[s]=new pn(s,u,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:s})),y.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),void 0===this.sourceCaches[s])throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new _.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const u=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],u.fire(new _.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,u){if(this._checkLoaded(),void 0===this.sourceCaches[s])throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if("geojson"!==p.type)throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,u,p={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new _.ErrorEvent(new Error(`Layer "${y}" already exists on this map.`)));let x;if("custom"===s.type){if(Ht(this,_.validateCustomStyleLayer(s)))return;x=_.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(y,s.source),s=_.clone$1(s),s=_.extend(s,{source:y})),this._validate(_.validateStyle.layer,`layers.${y}`,s,{arrayIndex:-1},p))return;x=_.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize()}const C=u?this._order.indexOf(u):this._order.length;if(u&&-1===C)this.fire(new _.ErrorEvent(new Error(`Cannot add layer "${y}" before non-existing layer "${u}".`)));else{if(this._order.splice(C,0,y),this._layerOrderChanged=!0,this._layers[y]=x,this._removedLayers[y]&&x.source&&"custom"!==x.type){const T=this._removedLayers[y];delete this._removedLayers[y],T.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(s,u){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new _.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===u)return;const p=this._order.indexOf(s);this._order.splice(p,1);const y=u?this._order.indexOf(u):this._order.length;u&&-1===y?this.fire(new _.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${u}".`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const u=this._layers[s];if(!u)return void this.fire(new _.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));u.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=u,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],u.onRemove&&u.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,u,p){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===u&&y.maxzoom===p||(null!=u&&(y.minzoom=u),null!=p&&(y.maxzoom=p),this._updateLayer(y)):this.fire(new _.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,u,p={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!nn(y.filter,u))return null==u?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(_.validateStyle.filter,`layers.${y.id}.filter`,u,null,p)||(y.filter=_.clone$1(u),this._updateLayer(y)))}else this.fire(new _.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return _.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,u,p,y={}){this._checkLoaded();const x=this.getLayer(s);x?nn(x.getLayoutProperty(u),p)||(x.setLayoutProperty(u,p,y),this._updateLayer(x)):this.fire(new _.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,u){const p=this.getLayer(s);if(p)return p.getLayoutProperty(u);this.fire(new _.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,u,p,y={}){this._checkLoaded();const x=this.getLayer(s);x?nn(x.getPaintProperty(u),p)||(x.setPaintProperty(u,p,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new _.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,u){return this.getLayer(s).getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();const p=s.source,y=s.sourceLayer,x=this.sourceCaches[p];if(void 0===x)return void this.fire(new _.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const C=x.getSource().type;"geojson"===C&&y?this.fire(new _.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==C||y?(void 0===s.id&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(y,s.id,u)):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,u){this._checkLoaded();const p=s.source,y=this.sourceCaches[p];if(void 0===y)return void this.fire(new _.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=y.getSource().type,C="vector"===x?s.sourceLayer:void 0;"vector"!==x||C?u&&"string"!=typeof s.id&&"number"!=typeof s.id?this.fire(new _.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(C,s.id,u):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const u=s.source,p=s.sourceLayer,y=this.sourceCaches[u];if(void 0!==y)return"vector"!==y.getSource().type||p?(void 0===s.id&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),y.getFeatureState(p,s.id)):void this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new _.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return _.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return _.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:_.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&"raster"!==this.sourceCaches[s.source].getSource().type&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const u=C=>"fill-extrusion"===this._layers[C].type,p={},y=[];for(let C=this._order.length-1;C>=0;C--){const T=this._order[C];if(u(T)){p[T]=C;for(const S of s){const A=S[T];if(A)for(const F of A)y.push(F)}}}y.sort((C,T)=>T.intersectionZ-C.intersectionZ);const x=[];for(let C=this._order.length-1;C>=0;C--){const T=this._order[C];if(u(T))for(let S=y.length-1;S>=0;S--){const A=y[S].feature;if(p[A.layer.id]<C)break;x.push(A),y.pop()}else for(const S of s){const A=S[T];if(A)for(const F of A)x.push(F.feature)}}return x}queryRenderedFeatures(s,u,p){u&&u.filter&&this._validate(_.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const y={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new _.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of u.layers){const T=this._layers[C];if(!T)return this.fire(new _.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];y[T.source]=!0}}const x=[];u.availableImages=this._availableImages;for(const C in this.sourceCaches)u.layers&&!y[C]||x.push(ba(this.sourceCaches[C],this._layers,this._serializedLayers,s,u,p));return this.placement&&x.push(function(C,T,S,A,F,z,U){const X={},q=z.queryRenderedSymbols(A),W=[];for(const re of Object.keys(q).map(Number))W.push(U[re]);W.sort(Cr);for(const re of W){const se=re.featureIndex.lookupSymbolFeatures(q[re.bucketInstanceId],T,re.bucketIndex,re.sourceLayerIndex,F.filter,F.layers,F.availableImages,C);for(const de in se){const Y=X[de]=X[de]||[],me=se[de];me.sort((pe,Ce)=>{const De=re.featureSortOrder;if(De){const Fe=De.indexOf(pe.featureIndex);return De.indexOf(Ce.featureIndex)-Fe}return Ce.featureIndex-pe.featureIndex});for(const pe of me)Y.push(pe)}}for(const re in X)X[re].forEach(se=>{const de=se.feature,Y=S[C[re].source].getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=Y});return X}(this._layers,this._serializedLayers,this.sourceCaches,s,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,u){u&&u.filter&&this._validate(_.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const p=this.sourceCaches[s];return p?function(y,x){const C=y.getRenderableIds().map(A=>y.getTileByID(A)),T=[],S={};for(let A=0;A<C.length;A++){const F=C[A],z=F.tileID.canonical.key;S[z]||(S[z]=!0,F.querySourceFeatures(T,x))}return T}(p,u):[]}addSourceType(s,u,p){return Rr.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(Rr.setSourceType(s,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:u.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,u={}){this._checkLoaded();const p=this.light.getLight();let y=!1;for(const C in s)if(!nn(s[C],p[C])){y=!0;break}if(!y)return;const x={now:_.exported.now(),transition:_.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,u),this.light.updateTransitions(x)}_validate(s,u,p,y,x={}){return(!x||!1!==x.validate)&&Ht(this,s.call(_.validateStyle,_.extend({key:u,style:this.serialize(),value:p,styleSpec:_.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),_.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const u=this.sourceCaches[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const u in this.sourceCaches)this.sourceCaches[u].update(s,this.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,u,p,y,x=!1){let C=!1,T=!1;const S={};for(const A of this._order){const F=this._layers[A];if("symbol"!==F.type)continue;if(!S[F.source]){const U=this.sourceCaches[F.source];S[F.source]=U.getRenderableIds(!0).map(X=>U.getTileByID(X)).sort((X,q)=>q.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(q.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(F,S[F.source],s.center.lng);C=C||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||0===p)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.exported.now(),s.zoom))&&(this.pauseablePlacement=new ye(s,this.terrain,this._order,x,u,p,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.exported.now()),T=!0),C&&this.pauseablePlacement.placement.setStale()),T||C)for(const A of this._order){const F=this._layers[A];"symbol"===F.type&&this.placement.updateLayerOpacities(F,S[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,u,p){this.imageManager.getImages(u.icons,p),this._updateTilesForChangedImages();const y=this.sourceCaches[u.source];y&&y.setDependencies(u.tileID.key,u.type,u.icons)}getGlyphs(s,u,p){this.glyphManager.getGlyphs(u.stacks,p)}getResource(s,u,p){return _.makeRequest(u,p)}}Rr.getSourceType=function(m){return va[m]},Rr.setSourceType=function(m,s){va[m]=s},Rr.registerForPluginStateChange=_.registerForPluginStateChange;var qs="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const fl={prelude:Dn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:Dn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Dn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Dn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:Dn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:Dn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Dn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Dn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Dn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:Dn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:Dn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:Dn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:Dn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:Dn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:Dn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Dn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:Dn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:Dn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:Dn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:Dn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Dn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:Dn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Dn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:Dn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",qs),terrainDepth:Dn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",qs),terrainCoords:Dn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",qs)};function Dn(m,s){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),y=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=x?x.concat(y):y,T={};return{fragmentSource:m=m.replace(u,(S,A,F,z,U)=>(T[U]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${U}\nvarying ${F} ${z} ${U};\n#else\nuniform ${F} ${z} u_${U};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${U}\n    ${F} ${z} ${U} = u_${U};\n#endif\n`)),vertexSource:s=s.replace(u,(S,A,F,z,U)=>{const X="float"===z?"vec2":"vec4",q=U.match(/color/)?"color":X;return T[U]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${U}\nuniform lowp float u_${U}_t;\nattribute ${F} ${X} a_${U};\nvarying ${F} ${z} ${U};\n#else\nuniform ${F} ${z} u_${U};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${U}\n    ${U} = a_${U};\n#else\n    ${F} ${z} ${U} = u_${U};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${U}\n    ${U} = unpack_mix_${q}(a_${U}, u_${U}_t);\n#else\n    ${F} ${z} ${U} = u_${U};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${U}\nuniform lowp float u_${U}_t;\nattribute ${F} ${X} a_${U};\n#else\nuniform ${F} ${z} u_${U};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${U}\n    ${F} ${z} ${U} = a_${U};\n#else\n    ${F} ${z} ${U} = u_${U};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${U}\n    ${F} ${z} ${U} = unpack_mix_${q}(a_${U}, u_${U}_t);\n#else\n    ${F} ${z} ${U} = u_${U};\n#endif\n`}),staticAttributes:p,staticUniforms:C}}class jc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,u,p,y,x,C,T,S,A){this.context=s;let F=this.boundPaintVertexBuffers.length!==y.length;for(let z=0;!F&&z<y.length;z++)this.boundPaintVertexBuffers[z]!==y[z]&&(F=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===p&&!F&&this.boundIndexBuffer===x&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===S&&this.boundDynamicVertexBuffer3===A?(s.bindVertexArrayOES.set(this.vao),T&&T.bind(),x&&x.dynamicDraw&&x.bind(),S&&S.bind(),A&&A.bind()):this.freshBind(u,p,y,x,C,T,S,A)}freshBind(s,u,p,y,x,C,T,S){let A;const F=s.numAttributes,z=this.context,U=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=S;else{A=z.currentNumAttributes||0;for(let X=F;X<A;X++)U.disableVertexAttribArray(X)}u.enableAttributes(U,s);for(const X of p)X.enableAttributes(U,s);C&&C.enableAttributes(U,s),T&&T.enableAttributes(U,s),S&&S.enableAttributes(U,s),u.bind(),u.setVertexAttribPointers(U,s,x);for(const X of p)X.bind(),X.setVertexAttribPointers(U,s,x);C&&(C.bind(),C.setVertexAttribPointers(U,s,x)),y&&y.bind(),T&&(T.bind(),T.setVertexAttribPointers(U,s,x)),S&&(S.bind(),S.setVertexAttribPointers(U,s,x)),z.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hc(m){const s=[];for(let u=0;u<m.length;u++){if(null===m[u])continue;const p=m[u].split(" ");s.push(p.pop())}return s}class Gc{constructor(s,u,p,y,x,C,T){const S=s.gl;this.program=S.createProgram();const A=Hc(p.staticAttributes),F=y?y.getBinderAttributes():[],z=A.concat(F),U=fl.prelude.staticUniforms?Hc(fl.prelude.staticUniforms):[],X=p.staticUniforms?Hc(p.staticUniforms):[],q=y?y.getBinderUniforms():[],W=U.concat(X).concat(q),re=[];for(const De of W)re.indexOf(De)<0&&re.push(De);const se=y?y.defines():[];C&&se.push("#define OVERDRAW_INSPECTOR;"),T&&se.push("#define TERRAIN3D;");const de=se.concat(fl.prelude.fragmentSource,p.fragmentSource).join("\n"),Y=se.concat(fl.prelude.vertexSource,p.vertexSource).join("\n"),me=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(me,de),S.compileShader(me),S.attachShader(this.program,me);const pe=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(pe,Y),S.compileShader(pe),S.attachShader(this.program,pe),this.attributes={};const Ce={};this.numAttributes=z.length;for(let De=0;De<this.numAttributes;De++)z[De]&&(S.bindAttribLocation(this.program,De,z[De]),this.attributes[z[De]]=De);S.linkProgram(this.program),S.deleteShader(pe),S.deleteShader(me);for(let De=0;De<re.length;De++){const Fe=re[De];if(Fe&&!Ce[Fe]){const ve=S.getUniformLocation(this.program,Fe);ve&&(Ce[Fe]=ve)}}var De,Fe;this.fixedUniforms=x(s,Ce),this.terrainUniforms={u_depth:new _.Uniform1i(De=s,(Fe=Ce).u_depth),u_terrain:new _.Uniform1i(De,Fe.u_terrain),u_terrain_dim:new _.Uniform1f(De,Fe.u_terrain_dim),u_terrain_matrix:new _.UniformMatrix4f(De,Fe.u_terrain_matrix),u_terrain_unpack:new _.Uniform4f(De,Fe.u_terrain_unpack),u_terrain_offset:new _.Uniform1f(De,Fe.u_terrain_offset),u_terrain_exaggeration:new _.Uniform1f(De,Fe.u_terrain_exaggeration)},this.binderUniforms=y?y.getUniforms(s,Ce):[]}draw(s,u,p,y,x,C,T,S,A,F,z,U,X,q,W,re,se,de){const Y=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(y),s.setColorMode(x),s.setCullFace(C),S){s.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,S.depthTexture),s.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,S.texture);for(const pe in this.terrainUniforms)this.terrainUniforms[pe].set(S[pe])}for(const pe in this.fixedUniforms)this.fixedUniforms[pe].set(T[pe]);W&&W.setUniforms(s,this.binderUniforms,X,{zoom:q});let me=0;switch(u){case Y.LINES:me=2;break;case Y.TRIANGLES:me=3;break;case Y.LINE_STRIP:me=1}for(const pe of U.get()){const Ce=pe.vaos||(pe.vaos={});(Ce[A]||(Ce[A]=new jc)).bind(s,this,F,W?W.getPaintVertexBuffers():[],z,pe.vertexOffset,re,se,de),Y.drawElements(u,pe.primitiveLength*me,Y.UNSIGNED_SHORT,pe.primitiveOffset*me*2)}}}function nd(m,s,u){const p=1/or(u,1,s.transform.tileZoom),y=Math.pow(2,u.tileID.overscaledZ),x=u.tileSize*Math.pow(2,s.transform.tileZoom)/y,C=x*(u.tileID.canonical.x+u.tileID.wrap*y),T=x*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[C>>16,T>>16],u_pixel_coord_lower:[65535&C,65535&T]}}const qc=(m,s,u,p)=>{const y=s.style.light,x=y.properties.get("position"),C=[x.x,x.y,x.z],T=_.create$1();"viewport"===y.properties.get("anchor")&&_.fromRotation(T,-s.transform.angle),_.transformMat3(C,C,T);const S=y.properties.get("color");return{u_matrix:m,u_lightpos:C,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+u,u_opacity:p}},gr=(m,s,u,p,y,x,C)=>_.extend(qc(m,s,u,p),nd(x,s,C),{u_height_factor:-Math.pow(2,y.overscaledZ)/C.tileSize/8}),nc=m=>({u_matrix:m}),wt=(m,s,u,p)=>_.extend(nc(m),nd(u,s,p)),Zc=(m,s)=>({u_matrix:m,u_world:s}),rc=(m,s,u,p,y)=>_.extend(wt(m,s,u,p),{u_world:y}),ji=(m,s,u,p)=>{const y=m.transform;let x,C;if("map"===p.paint.get("circle-pitch-alignment")){const T=or(u,1,y.zoom);x=!0,C=[T,T]}else x=!1,C=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+("map"===p.paint.get("circle-pitch-scale")),u_matrix:m.translatePosMatrix(s.posMatrix,u,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:C}},Zs=(m,s,u)=>{const p=or(u,1,s.zoom),y=Math.pow(2,s.zoom-u.tileID.overscaledZ),x=u.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*y),s.pixelsToGLUnits[1]/(p*y)],u_overscale_factor:x}},ml=(m,s,u=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:u}),rn=m=>({u_matrix:m}),Ea=(m,s,u,p)=>({u_matrix:m,u_extrude_scale:or(s,1,u),u_intensity:p});function Kn(m,s){const u=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new _.MercatorCoordinate(0,p/u).toLngLat().lat,new _.MercatorCoordinate(0,(p+1)/u).toLngLat().lat]}const Ds=(m,s,u,p)=>{const y=m.transform;return{u_matrix:Ws(m,s,u,p),u_ratio:1/or(s,1,y.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Wc=(m,s,u,p,y)=>_.extend(Ds(m,s,u,y),{u_image:0,u_image_height:p}),En=(m,s,u,p,y)=>{const x=m.transform,C=Pn(s,x);return{u_matrix:Ws(m,s,u,y),u_texsize:s.imageAtlasTexture.size,u_ratio:1/or(s,1,x.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[C,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Ct=(m,s,u,p,y,x)=>{const C=m.lineAtlas,T=Pn(s,m.transform),S="round"===u.layout.get("line-cap"),A=C.getDash(p.from,S),F=C.getDash(p.to,S),z=A.width*y.fromScale,U=F.width*y.toScale;return _.extend(Ds(m,s,u,x),{u_patternscale_a:[T/z,-A.height/2],u_patternscale_b:[T/U,-F.height/2],u_sdfgamma:C.width/(256*Math.min(z,U)*m.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:F.y,u_mix:y.t})};function Pn(m,s){return 1/or(m,1,s.tileZoom)}function Ws(m,s,u,p){return m.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Dh=(m,s,u,p,y)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:u,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(x=y.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Xc(y.paint.get("raster-hue-rotate"))};var x,C};function Xc(m){m*=Math.PI/180;const s=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const Ne=(m,s,u,p,y,x,C,T,S,A)=>{const F=y.transform;return{u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:F.width/F.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:C,u_coord_matrix:T,u_is_text:+S,u_pitch_with_map:+p,u_texsize:A,u_texture:0}},Xs=(m,s,u,p,y,x,C,T,S,A,F)=>{const z=y.transform;return _.extend(Ne(m,s,u,p,y,x,C,T,S,A),{u_gamma_scale:p?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+F})},At=(m,s,u,p,y,x,C,T,S,A)=>_.extend(Xs(m,s,u,p,y,x,C,T,!0,S,!0),{u_texsize_icon:A,u_texture_icon:1}),xn=(m,s,u)=>({u_matrix:m,u_opacity:s,u_color:u}),Eh=(m,s,u,p,y,x)=>_.extend(function(C,T,S,A){const F=S.imageManager.getPattern(C.from.toString()),z=S.imageManager.getPattern(C.to.toString()),{width:U,height:X}=S.imageManager.getPixelSize(),q=Math.pow(2,A.tileID.overscaledZ),W=A.tileSize*Math.pow(2,S.transform.tileZoom)/q,re=W*(A.tileID.canonical.x+A.tileID.wrap*q),se=W*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[U,X],u_mix:T.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/or(A,1,S.transform.tileZoom),u_pixel_coord_upper:[re>>16,se>>16],u_pixel_coord_lower:[65535&re,65535&se]}}(p,x,u,y),{u_matrix:m,u_opacity:s}),rd={fillExtrusion:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_lightpos:new _.Uniform3f(m,s.u_lightpos),u_lightintensity:new _.Uniform1f(m,s.u_lightintensity),u_lightcolor:new _.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new _.Uniform1f(m,s.u_vertical_gradient),u_opacity:new _.Uniform1f(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_lightpos:new _.Uniform3f(m,s.u_lightpos),u_lightintensity:new _.Uniform1f(m,s.u_lightintensity),u_lightcolor:new _.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new _.Uniform1f(m,s.u_vertical_gradient),u_height_factor:new _.Uniform1f(m,s.u_height_factor),u_image:new _.Uniform1i(m,s.u_image),u_texsize:new _.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new _.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new _.Uniform3f(m,s.u_scale),u_fade:new _.Uniform1f(m,s.u_fade),u_opacity:new _.Uniform1f(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_image:new _.Uniform1i(m,s.u_image),u_texsize:new _.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new _.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new _.Uniform3f(m,s.u_scale),u_fade:new _.Uniform1f(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_world:new _.Uniform2f(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_world:new _.Uniform2f(m,s.u_world),u_image:new _.Uniform1i(m,s.u_image),u_texsize:new _.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new _.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new _.Uniform3f(m,s.u_scale),u_fade:new _.Uniform1f(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new _.Uniform1f(m,s.u_camera_to_center_distance),u_scale_with_map:new _.Uniform1i(m,s.u_scale_with_map),u_pitch_with_map:new _.Uniform1i(m,s.u_pitch_with_map),u_extrude_scale:new _.Uniform2f(m,s.u_extrude_scale),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_matrix:new _.UniformMatrix4f(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_camera_to_center_distance:new _.Uniform1f(m,s.u_camera_to_center_distance),u_pixels_to_tile_units:new _.Uniform1f(m,s.u_pixels_to_tile_units),u_extrude_scale:new _.Uniform2f(m,s.u_extrude_scale),u_overscale_factor:new _.Uniform1f(m,s.u_overscale_factor)}),collisionCircle:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_inv_matrix:new _.UniformMatrix4f(m,s.u_inv_matrix),u_camera_to_center_distance:new _.Uniform1f(m,s.u_camera_to_center_distance),u_viewport_size:new _.Uniform2f(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new _.UniformColor(m,s.u_color),u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_overlay:new _.Uniform1i(m,s.u_overlay),u_overlay_scale:new _.Uniform1f(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new _.Uniform1f(m,s.u_extrude_scale),u_intensity:new _.Uniform1f(m,s.u_intensity),u_matrix:new _.UniformMatrix4f(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_world:new _.Uniform2f(m,s.u_world),u_image:new _.Uniform1i(m,s.u_image),u_color_ramp:new _.Uniform1i(m,s.u_color_ramp),u_opacity:new _.Uniform1f(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_image:new _.Uniform1i(m,s.u_image),u_latrange:new _.Uniform2f(m,s.u_latrange),u_light:new _.Uniform2f(m,s.u_light),u_shadow:new _.UniformColor(m,s.u_shadow),u_highlight:new _.UniformColor(m,s.u_highlight),u_accent:new _.UniformColor(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_image:new _.Uniform1i(m,s.u_image),u_dimension:new _.Uniform2f(m,s.u_dimension),u_zoom:new _.Uniform1f(m,s.u_zoom),u_unpack:new _.Uniform4f(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_ratio:new _.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_ratio:new _.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(m,s.u_units_to_pixels),u_image:new _.Uniform1i(m,s.u_image),u_image_height:new _.Uniform1f(m,s.u_image_height)}),linePattern:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_texsize:new _.Uniform2f(m,s.u_texsize),u_ratio:new _.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_image:new _.Uniform1i(m,s.u_image),u_units_to_pixels:new _.Uniform2f(m,s.u_units_to_pixels),u_scale:new _.Uniform3f(m,s.u_scale),u_fade:new _.Uniform1f(m,s.u_fade)}),lineSDF:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_ratio:new _.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(m,s.u_units_to_pixels),u_patternscale_a:new _.Uniform2f(m,s.u_patternscale_a),u_patternscale_b:new _.Uniform2f(m,s.u_patternscale_b),u_sdfgamma:new _.Uniform1f(m,s.u_sdfgamma),u_image:new _.Uniform1i(m,s.u_image),u_tex_y_a:new _.Uniform1f(m,s.u_tex_y_a),u_tex_y_b:new _.Uniform1f(m,s.u_tex_y_b),u_mix:new _.Uniform1f(m,s.u_mix)}),raster:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_tl_parent:new _.Uniform2f(m,s.u_tl_parent),u_scale_parent:new _.Uniform1f(m,s.u_scale_parent),u_buffer_scale:new _.Uniform1f(m,s.u_buffer_scale),u_fade_t:new _.Uniform1f(m,s.u_fade_t),u_opacity:new _.Uniform1f(m,s.u_opacity),u_image0:new _.Uniform1i(m,s.u_image0),u_image1:new _.Uniform1i(m,s.u_image1),u_brightness_low:new _.Uniform1f(m,s.u_brightness_low),u_brightness_high:new _.Uniform1f(m,s.u_brightness_high),u_saturation_factor:new _.Uniform1f(m,s.u_saturation_factor),u_contrast_factor:new _.Uniform1f(m,s.u_contrast_factor),u_spin_weights:new _.Uniform3f(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new _.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new _.Uniform1f(m,s.u_size_t),u_size:new _.Uniform1f(m,s.u_size),u_camera_to_center_distance:new _.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new _.Uniform1f(m,s.u_pitch),u_rotate_symbol:new _.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new _.Uniform1f(m,s.u_fade_change),u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new _.Uniform1i(m,s.u_is_text),u_pitch_with_map:new _.Uniform1i(m,s.u_pitch_with_map),u_texsize:new _.Uniform2f(m,s.u_texsize),u_texture:new _.Uniform1i(m,s.u_texture)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new _.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new _.Uniform1f(m,s.u_size_t),u_size:new _.Uniform1f(m,s.u_size),u_camera_to_center_distance:new _.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new _.Uniform1f(m,s.u_pitch),u_rotate_symbol:new _.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new _.Uniform1f(m,s.u_fade_change),u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new _.Uniform1i(m,s.u_is_text),u_pitch_with_map:new _.Uniform1i(m,s.u_pitch_with_map),u_texsize:new _.Uniform2f(m,s.u_texsize),u_texture:new _.Uniform1i(m,s.u_texture),u_gamma_scale:new _.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(m,s.u_is_halo)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new _.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new _.Uniform1f(m,s.u_size_t),u_size:new _.Uniform1f(m,s.u_size),u_camera_to_center_distance:new _.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new _.Uniform1f(m,s.u_pitch),u_rotate_symbol:new _.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new _.Uniform1f(m,s.u_fade_change),u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new _.Uniform1i(m,s.u_is_text),u_pitch_with_map:new _.Uniform1i(m,s.u_pitch_with_map),u_texsize:new _.Uniform2f(m,s.u_texsize),u_texsize_icon:new _.Uniform2f(m,s.u_texsize_icon),u_texture:new _.Uniform1i(m,s.u_texture),u_texture_icon:new _.Uniform1i(m,s.u_texture_icon),u_gamma_scale:new _.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(m,s.u_is_halo)}),background:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_opacity:new _.Uniform1f(m,s.u_opacity),u_color:new _.UniformColor(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_opacity:new _.Uniform1f(m,s.u_opacity),u_image:new _.Uniform1i(m,s.u_image),u_pattern_tl_a:new _.Uniform2f(m,s.u_pattern_tl_a),u_pattern_br_a:new _.Uniform2f(m,s.u_pattern_br_a),u_pattern_tl_b:new _.Uniform2f(m,s.u_pattern_tl_b),u_pattern_br_b:new _.Uniform2f(m,s.u_pattern_br_b),u_texsize:new _.Uniform2f(m,s.u_texsize),u_mix:new _.Uniform1f(m,s.u_mix),u_pattern_size_a:new _.Uniform2f(m,s.u_pattern_size_a),u_pattern_size_b:new _.Uniform2f(m,s.u_pattern_size_b),u_scale_a:new _.Uniform1f(m,s.u_scale_a),u_scale_b:new _.Uniform1f(m,s.u_scale_b),u_pixel_coord_upper:new _.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new _.Uniform1f(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_texture:new _.Uniform1i(m,s.u_texture)}),terrainDepth:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix)}),terrainCoords:(m,s)=>({u_matrix:new _.UniformMatrix4f(m,s.u_matrix),u_texture:new _.Uniform1i(m,s.u_texture),u_terrain_coords_id:new _.Uniform1f(m,s.u_terrain_coords_id)})};class Kc{constructor(s,u,p){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ia={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ci{constructor(s,u,p,y){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let p=0;p<this.attributes.length;p++){const y=u.attributes[this.attributes[p].name];void 0!==y&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,u,p){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],C=u.attributes[x.name];void 0!==C&&s.vertexAttribPointer(C,x.components,s[Ia[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ln{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class id extends ln{getDefault(){return _.Color.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ff extends ln{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Hi extends ln{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class ic extends ln{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ih extends ln{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Gi extends ln{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class od extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class oc extends ln{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Yc extends ln{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class Jc extends ln{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class sd extends ln{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class ui extends ln{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class cn extends ln{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class ad extends ln{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Qc extends ln{getDefault(){return _.Color.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Th extends ln{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class ft extends ln{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class gl extends ln{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class qi extends ln{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class sc extends ln{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Sh extends ln{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ld extends ln{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Mh extends ln{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class cd extends ln{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ta extends ln{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Sa extends ln{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ac extends ln{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class eu extends ln{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class _t extends ln{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class lc extends ln{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class tu extends ln{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Fr extends ln{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class Es extends Fr{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ah extends Fr{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class fn{constructor(s,u,p,y){this.context=s,this.width=u,this.height=p;const x=s.gl,C=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Es(s,C),y&&(this.depthAttachment=new Ah(s,C)),x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class On{constructor(s,u,p){this.blendFunction=s,this.blendColor=u,this.mask=p}}On.Replace=[1,0],On.disabled=new On(On.Replace,_.Color.transparent,[!1,!1,!1,!1]),On.unblended=new On(On.Replace,_.Color.transparent,[!0,!0,!0,!0]),On.alphaBlended=new On([1,771],_.Color.transparent,[!0,!0,!0,!0]);class Ph{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new id(this),this.clearDepth=new Ff(this),this.clearStencil=new Hi(this),this.colorMask=new ic(this),this.depthMask=new Ih(this),this.stencilMask=new Gi(this),this.stencilFunc=new od(this),this.stencilOp=new oc(this),this.stencilTest=new Yc(this),this.depthRange=new Jc(this),this.depthTest=new sd(this),this.depthFunc=new ui(this),this.blend=new cn(this),this.blendFunc=new ad(this),this.blendColor=new Qc(this),this.blendEquation=new Th(this),this.cullFace=new ft(this),this.cullFaceSide=new gl(this),this.frontFace=new qi(this),this.program=new sc(this),this.activeTexture=new Sh(this),this.viewport=new ld(this),this.bindFramebuffer=new Mh(this),this.bindRenderbuffer=new cd(this),this.bindTexture=new Ta(this),this.bindVertexBuffer=new Sa(this),this.bindElementBuffer=new ac(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new eu(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new lc(this),this.pixelStoreUnpackFlipY=new tu(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u){return new Kc(this,s,u)}createVertexBuffer(s,u,p){return new ci(this,s,u,p)}createRenderbuffer(s,u,p){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,s,u,p),this.bindRenderbuffer.set(null),x}createFramebuffer(s,u,p){return new fn(this,s,u,p)}clear({color:s,depth:u}){const p=this.gl;let y=0;s&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p.clear(y)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){nn(s.blendFunction,On.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Gt{constructor(s,u,p){this.func=s,this.mask=u,this.range=p}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);class In{constructor(s,u,p,y,x,C){this.test=s,this.ref=u,this.mask=p,this.fail=y,this.depthFail=x,this.pass=C}}In.disabled=new In({func:519,mask:0},0,0,7680,7680,7680);class Tn{constructor(s,u,p){this.enable=s,this.mode=u,this.frontFace=p}}let yl;function Ma(m,s,u,p,y,x,C){const T=m.context,S=T.gl,A=m.useProgram("collisionBox"),F=[];let z=0,U=0;for(let Y=0;Y<p.length;Y++){const me=p[Y],pe=s.getTile(me),Ce=pe.getBucket(u);if(!Ce)continue;let De=me.posMatrix;0===y[0]&&0===y[1]||(De=m.translatePosMatrix(me.posMatrix,pe,y,x));const Fe=C?Ce.textCollisionBox:Ce.iconCollisionBox,ve=Ce.collisionCircleArray;if(ve.length>0){const Xe=_.create(),Ue=De;_.mul(Xe,Ce.placementInvProjMatrix,m.transform.glCoordMatrix),_.mul(Xe,Xe,Ce.placementViewportMatrix),F.push({circleArray:ve,circleOffset:U,transform:Ue,invTransform:Xe,coord:me}),z+=ve.length/4,U=z}Fe&&A.draw(T,S.LINES,Gt.disabled,In.disabled,m.colorModeForRenderPass(),Tn.disabled,Zs(De,m.transform,pe),m.style.terrain&&m.style.terrain.getTerrainData(me),u.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,m.transform.zoom,null,null,Fe.collisionVertexBuffer)}if(!C||!F.length)return;const X=m.useProgram("collisionCircle"),q=new _.CollisionCircleLayoutArray;q.resize(4*z),q._trim();let W=0;for(const Y of F)for(let me=0;me<Y.circleArray.length/4;me++){const pe=4*me,Ce=Y.circleArray[pe+0],De=Y.circleArray[pe+1],Fe=Y.circleArray[pe+2],ve=Y.circleArray[pe+3];q.emplace(W++,Ce,De,Fe,ve,0),q.emplace(W++,Ce,De,Fe,ve,1),q.emplace(W++,Ce,De,Fe,ve,2),q.emplace(W++,Ce,De,Fe,ve,3)}(!yl||yl.length<2*z)&&(yl=function(Y){const me=2*Y,pe=new _.QuadTriangleArray;pe.resize(me),pe._trim();for(let Ce=0;Ce<me;Ce++){const De=6*Ce;pe.uint16[De+0]=4*Ce+0,pe.uint16[De+1]=4*Ce+1,pe.uint16[De+2]=4*Ce+2,pe.uint16[De+3]=4*Ce+2,pe.uint16[De+4]=4*Ce+3,pe.uint16[De+5]=4*Ce+0}return pe}(z));const re=T.createIndexBuffer(yl,!0),se=T.createVertexBuffer(q,_.collisionCircleLayout.members,!0);for(const Y of F){const me={u_matrix:Y.transform,u_inv_matrix:Y.invTransform,u_camera_to_center_distance:(de=m.transform).cameraToCenterDistance,u_viewport_size:[de.width,de.height]};X.draw(T,S.TRIANGLES,Gt.disabled,In.disabled,m.colorModeForRenderPass(),Tn.disabled,me,m.style.terrain&&m.style.terrain.getTerrainData(Y.coord),u.id,se,re,_.SegmentVector.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}var de;se.destroy(),re.destroy()}Tn.disabled=new Tn(!1,1029,2305),Tn.backCCW=new Tn(!0,1029,2305);const kh=_.identity(new Float32Array(16));function ud(m,s,u,p,y,x){const{horizontalAlign:C,verticalAlign:T}=_.getAnchorAlignment(m),S=-(C-.5)*s,A=-(T-.5)*u,F=_.evaluateVariableOffset(m,p);return new _.pointGeometry((S/y+F[0])*x,(A/y+F[1])*x)}function Ks(m,s,u,p,y,x,C,T,S,A,F){const z=m.text.placedSymbolArray,U=m.text.dynamicLayoutVertexArray,X=m.icon.dynamicLayoutVertexArray,q={};U.clear();for(let W=0;W<z.length;W++){const re=z.get(W),de=re.hidden||!re.crossTileID||m.allowVerticalPlacement&&!re.placedOrientation?null:p[re.crossTileID];if(de){const Y=new _.pointGeometry(re.anchorX,re.anchorY),me=Jt(Y,u?C:x,F),pe=mr(y.cameraToCenterDistance,me.signedDistanceFromCamera);let Ce=_.evaluateSizeForFeature(m.textSizeData,S,re)*pe/_.ONE_EM;u&&(Ce*=m.tilePixelRatio/T);const{width:De,height:Fe,anchor:ve,textOffset:Xe,textBoxScale:Ue}=de,Qe=ud(ve,De,Fe,Xe,Ue,Ce),Pt=u?Jt(Y.add(Qe),x,F).point:me.point.add(s?Qe.rotate(-y.angle):Qe),Bt=m.allowVerticalPlacement&&re.placedOrientation===_.WritingMode.vertical?Math.PI/2:0;for(let ct=0;ct<re.numGlyphs;ct++)_.addDynamicAttributes(U,Pt,Bt);A&&re.associatedIconIndex>=0&&(q[re.associatedIconIndex]={shiftedAnchor:Pt,angle:Bt})}else It(re.numGlyphs,U)}if(A){X.clear();const W=m.icon.placedSymbolArray;for(let re=0;re<W.length;re++){const se=W.get(re);if(se.hidden)It(se.numGlyphs,X);else{const de=q[re];if(de)for(let Y=0;Y<se.numGlyphs;Y++)_.addDynamicAttributes(X,de.shiftedAnchor,de.angle);else It(se.numGlyphs,X)}}m.icon.dynamicLayoutVertexBuffer.updateData(X)}m.text.dynamicLayoutVertexBuffer.updateData(U)}function Rh(m,s,u){return u.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ao(m,s,u,p,y,x,C,T,S,A,F,z){const U=m.context,X=U.gl,q=m.transform,W="map"===T,re="map"===S,se="viewport"!==T&&"point"!==u.layout.get("symbol-placement"),de=W&&!re&&!se,Y=!u.layout.get("symbol-sort-key").isConstant();let me=!1;const pe=m.depthModeForSublayer(0,Gt.ReadOnly),Ce=u.layout.get("text-variable-anchor"),De=[];for(const Fe of p){const ve=s.getTile(Fe),Xe=ve.getBucket(u);if(!Xe)continue;const Ue=y?Xe.text:Xe.icon;if(!Ue||!Ue.segments.get().length)continue;const Qe=Ue.programConfigurations.get(u.id),Pt=y||Xe.sdfIcons,Bt=y?Xe.textSizeData:Xe.iconSizeData,ct=re||0!==q.pitch,dn=m.useProgram(Rh(Pt,y,Xe),Qe),wn=_.evaluateSizeForZoom(Bt,q.zoom),jt=m.style.terrain&&m.style.terrain.getTerrainData(Fe);let Wt,Cn,Ir,Po,ko=[0,0],Ro=null;if(y)Cn=ve.glyphAtlasTexture,Ir=X.LINEAR,Wt=ve.glyphAtlasTexture.size,Xe.iconsInText&&(ko=ve.imageAtlasTexture.size,Ro=ve.imageAtlasTexture,Po=ct||m.options.rotating||m.options.zooming||"composite"===Bt.kind||"camera"===Bt.kind?X.LINEAR:X.NEAREST);else{const Ci=1!==u.layout.get("icon-size").constantOr(0)||Xe.iconsNeedLinear;Cn=ve.imageAtlasTexture,Ir=Pt||m.options.rotating||m.options.zooming||Ci||ct?X.LINEAR:X.NEAREST,Wt=ve.imageAtlasTexture.size}const Nr=or(ve,1,m.transform.zoom),hi=Hs(Fe.posMatrix,re,W,m.transform,Nr),yn=oo(Fe.posMatrix,re,W,m.transform,Nr),Fo=Ce&&Xe.hasTextData(),hu="none"!==u.layout.get("icon-text-fit")&&Fo&&Xe.hasIconData();if(se){const Ci=m.style.terrain?(za,Ba)=>m.style.terrain.getElevation(Fe,za,Ba):null,na="map"===u.layout.get("text-rotation-alignment");Ai(Xe,Fe.posMatrix,m,y,hi,yn,re,A,na,Ci)}const rr=m.translatePosMatrix(Fe.posMatrix,ve,x,C),Nt=se||y&&Ce||hu?kh:hi,en=m.translatePosMatrix(yn,ve,x,C,!0),Tr=Pt&&0!==u.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let zr;zr=Pt?Xe.iconsInText?At(Bt.kind,wn,de,re,m,rr,Nt,en,Wt,ko):Xs(Bt.kind,wn,de,re,m,rr,Nt,en,y,Wt,!0):Ne(Bt.kind,wn,de,re,m,rr,Nt,en,y,Wt);const Rn={program:dn,buffers:Ue,uniformValues:zr,atlasTexture:Cn,atlasTextureIcon:Ro,atlasInterpolation:Ir,atlasInterpolationIcon:Po,isSDF:Pt,hasHalo:Tr};if(Y&&Xe.canOverlap){me=!0;const Ci=Ue.segments.get();for(const na of Ci)De.push({segments:new _.SegmentVector([na]),sortKey:na.sortKey,state:Rn,terrainData:jt})}else De.push({segments:Ue.segments,sortKey:0,state:Rn,terrainData:jt})}me&&De.sort((Fe,ve)=>Fe.sortKey-ve.sortKey);for(const Fe of De){const ve=Fe.state;if(U.activeTexture.set(X.TEXTURE0),ve.atlasTexture.bind(ve.atlasInterpolation,X.CLAMP_TO_EDGE),ve.atlasTextureIcon&&(U.activeTexture.set(X.TEXTURE1),ve.atlasTextureIcon&&ve.atlasTextureIcon.bind(ve.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),ve.isSDF){const Xe=ve.uniformValues;ve.hasHalo&&(Xe.u_is_halo=1,_l(ve.buffers,Fe.segments,u,m,ve.program,pe,F,z,Xe,Fe.terrainData)),Xe.u_is_halo=0}_l(ve.buffers,Fe.segments,u,m,ve.program,pe,F,z,ve.uniformValues,Fe.terrainData)}}function _l(m,s,u,p,y,x,C,T,S,A){const F=p.context;y.draw(F,F.gl.TRIANGLES,x,C,T,Tn.disabled,S,A,u.id,m.layoutVertexBuffer,m.indexBuffer,s,u.paint,p.transform.zoom,m.programConfigurations.get(u.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function lt(m,s,u,p,y,x,C){const T=m.context.gl,S=u.paint.get("fill-pattern"),A=S&&S.constantOr(1),F=u.getCrossfadeParameters();let z,U,X,q,W;C?(U=A&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=T.LINES):(U=A?"fillPattern":"fill",z=T.TRIANGLES);for(const re of p){const se=s.getTile(re);if(A&&!se.patternsLoaded())continue;const de=se.getBucket(u);if(!de)continue;const Y=de.programConfigurations.get(u.id),me=m.useProgram(U,Y),pe=m.style.terrain&&m.style.terrain.getTerrainData(re);A&&(m.context.activeTexture.set(T.TEXTURE0),se.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Y.updatePaintBuffers(F));const Ce=S.constantOr(null);if(Ce&&se.imageAtlas){const ve=se.imageAtlas,Xe=ve.patternPositions[Ce.to.toString()],Ue=ve.patternPositions[Ce.from.toString()];Xe&&Ue&&Y.setConstantPatternPositions(Xe,Ue)}const De=pe?re:null,Fe=m.translatePosMatrix(De?De.posMatrix:re.posMatrix,se,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(C){q=de.indexBuffer2,W=de.segments2;const ve=[T.drawingBufferWidth,T.drawingBufferHeight];X="fillOutlinePattern"===U&&A?rc(Fe,m,F,se,ve):Zc(Fe,ve)}else q=de.indexBuffer,W=de.segments,X=A?wt(Fe,m,F,se):nc(Fe);me.draw(m.context,z,y,m.stencilModeForClipping(re),x,Tn.disabled,X,pe,u.id,de.layoutVertexBuffer,q,W,u.paint,m.transform.zoom,Y)}}function Aa(m,s,u,p,y,x,C){const T=m.context,S=T.gl,A=u.paint.get("fill-extrusion-pattern"),F=A.constantOr(1),z=u.getCrossfadeParameters(),U=u.paint.get("fill-extrusion-opacity");for(const X of p){const q=s.getTile(X),W=q.getBucket(u);if(!W)continue;const re=m.style.terrain&&m.style.terrain.getTerrainData(X),se=W.programConfigurations.get(u.id),de=m.useProgram(F?"fillExtrusionPattern":"fillExtrusion",se);F&&(m.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),se.updatePaintBuffers(z));const Y=A.constantOr(null);if(Y&&q.imageAtlas){const De=q.imageAtlas,Fe=De.patternPositions[Y.to.toString()],ve=De.patternPositions[Y.from.toString()];Fe&&ve&&se.setConstantPatternPositions(Fe,ve)}const me=m.translatePosMatrix(X.posMatrix,q,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),pe=u.paint.get("fill-extrusion-vertical-gradient"),Ce=F?gr(me,m,pe,U,X,z,q):qc(me,m,pe,U);de.draw(T,T.gl.TRIANGLES,y,x,C,Tn.backCCW,Ce,re,u.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,u.paint,m.transform.zoom,se,m.style.terrain&&W.centroidVertexBuffer)}}function rt(m,s,u,p,y,x,C){const T=m.context,S=T.gl,A=u.fbo;if(!A)return;const F=m.useProgram("hillshade"),z=m.style.terrain&&m.style.terrain.getTerrainData(s);T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),F.draw(T,S.TRIANGLES,y,x,C,Tn.disabled,((U,X,q,W)=>{const re=q.paint.get("hillshade-shadow-color"),se=q.paint.get("hillshade-highlight-color"),de=q.paint.get("hillshade-accent-color");let Y=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===q.paint.get("hillshade-illumination-anchor")&&(Y-=U.transform.angle);const me=!U.options.moving;return{u_matrix:W?W.posMatrix:U.transform.calculatePosMatrix(X.tileID.toUnwrapped(),me),u_image:0,u_latrange:Kn(0,X.tileID),u_light:[q.paint.get("hillshade-exaggeration"),Y],u_shadow:re,u_highlight:se,u_accent:de}})(m,u,p,z?s:null),z,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function vl(m,s,u,p,y,x){const C=m.context,T=C.gl,S=s.dem;if(S&&S.data){const A=S.dim,F=S.stride,z=S.getPixels();if(C.activeTexture.set(T.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(F),s.demTexture){const X=s.demTexture;X.update(z,{premultiply:!1}),X.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else s.demTexture=new Un(C,z,T.RGBA,{premultiply:!1}),s.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);C.activeTexture.set(T.TEXTURE0);let U=s.fbo;if(!U){const X=new Un(C,{width:A,height:A,data:null},T.RGBA);X.bind(T.LINEAR,T.CLAMP_TO_EDGE),U=s.fbo=C.createFramebuffer(A,A,!0),U.colorAttachment.set(X.texture)}C.bindFramebuffer.set(U.framebuffer),C.viewport.set([0,0,A,A]),m.useProgram("hillshadePrepare").draw(C,T.TRIANGLES,p,y,x,Tn.disabled,((X,q)=>{const W=q.stride,re=_.create();return _.ortho(re,0,_.EXTENT,-_.EXTENT,0,0,1),_.translate(re,re,[0,-_.EXTENT,0]),{u_matrix:re,u_image:1,u_dimension:[W,W],u_zoom:X.overscaledZ,u_unpack:q.getUnpackVector()}})(s.tileID,S),null,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Pa(m,s,u,p,y,x){const C=p.paint.get("raster-fade-duration");if(!x&&C>0){const T=_.exported.now(),S=(T-m.timeAdded)/C,A=s?(T-s.timeAdded)/C:-1,F=u.getSource(),z=y.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),U=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),X=U&&m.refreshedUponExpiration?1:_.clamp(U?S:1-A,0,1);return m.refreshedUponExpiration&&S>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const Is=new _.Color(1,0,0,1),lo=new _.Color(0,1,0,1),dd=new _.Color(0,0,1,1),nu=new _.Color(1,0,1,1),Mo=new _.Color(0,1,1,1);function qr(m,s,u,p){vi(m,0,s+u/2,m.transform.width,u,p)}function Lr(m,s,u,p){vi(m,s-u/2,0,u,m.transform.height,p)}function vi(m,s,u,p,y,x){const C=m.context,T=C.gl;T.enable(T.SCISSOR_TEST),T.scissor(s*m.pixelRatio,u*m.pixelRatio,p*m.pixelRatio,y*m.pixelRatio),C.clear({color:x}),T.disable(T.SCISSOR_TEST)}function un(m,s,u){const p=m.context,y=p.gl,x=u.posMatrix,C=m.useProgram("debug"),T=Gt.disabled,S=In.disabled,A=m.colorModeForRenderPass(),F="$debug",z=m.style.terrain&&m.style.terrain.getTerrainData(u);p.activeTexture.set(y.TEXTURE0),m.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE);const U=s.getTileByID(u.key).latestRawTileData,X=Math.floor((U&&U.byteLength||0)/1024),q=s.getTile(u).tileSize,W=512/Math.min(q,512)*(u.overscaledZ/m.transform.zoom)*.5;let re=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(re+=` => ${u.overscaledZ}`),function(se,de){se.initDebugOverlayCanvas();const Y=se.debugOverlayCanvas,me=se.context.gl,pe=se.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,Y.width,Y.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(de,5,5),pe.strokeText(de,5,5),se.debugOverlayTexture.update(Y),se.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(m,`${re} ${X}kB`),C.draw(p,y.TRIANGLES,T,S,On.alphaBlended,Tn.disabled,ml(x,_.Color.transparent,W),null,F,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),C.draw(p,y.LINE_STRIP,T,S,A,Tn.disabled,ml(x,_.Color.red),z,F,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ys(m,s,u){const p=m.context,y=p.gl,x=m.colorModeForRenderPass(),C=new Gt(y.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D),T=m.useProgram("terrain"),S=s.getTerrainMesh(),A=s.getTerrainData(u.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,s.getRTTFramebuffer().colorAttachment.get());const F=m.transform.calculatePosMatrix(u.tileID.toUnwrapped());T.draw(p,y.TRIANGLES,C,In.disabled,x,Tn.backCCW,{u_matrix:F,u_texture:0},A,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}function cc(m,s,u,p){const y=m.context,x=u.tileSize*s.qualityFactor;u.textures[p]||(u.textures[p]=m.getTileTexture(x)||new Un(y,{width:x,height:x,data:null},y.gl.RGBA),u.textures[p].bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),0===p&&s.sourceCache.renderHistory.unshift(u.tileID.key));const C=s.getRTTFramebuffer();C.colorAttachment.set(u.textures[p].texture),y.bindFramebuffer.set(C.framebuffer),y.viewport.set([0,0,x,x])}class uc{constructor(s){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=s,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=s.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const s=this.painter.style,u=s.terrain;for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const y=s.sourceCaches[p].getVisibleCoordinates();for(const x of y){const C=u.sourceCache.getTerrainCoords(x);for(const T in C)this._coordsDescendingInv[p][T]||(this._coordsDescendingInv[p][T]=[]),this._coordsDescendingInv[p][T].push(C[T])}}for(const p of s._order){const y=s._layers[p],x=y.source;if(this._renderToTexture[y.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const C in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][C]=this._coordsDescendingInv[x][C].map(T=>T.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const y in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[y][p.tileID.key];x&&x!==p.textureCoords[y]&&p.clearTextures(this.painter),u.needsRerender(y,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),u.clearRerenderCache(),u.sourceCache.removeOutdated(this.painter),this}renderLayer(s){const u=s.type,p=this.painter,y=p.style._order,x=p.currentLayer,C=x+1===y.length;if(this._renderToTexture[u]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(y[x]),!C))return!0;if(this._renderToTexture[this._prevType]||"hillshade"===u||this._renderToTexture[u]&&C){this._prevType=u;const T=this._stacks.length-1,S=this._stacks[T]||[];for(const A of this._renderableTiles){if(cc(p,p.style.terrain,A,T),this._rerender[A.tileID.key]){p.context.clear({color:_.Color.transparent});for(let F=0;F<S.length;F++){const z=p.style._layers[S[F]],U=z.source?this._coordsDescendingInv[z.source][A.tileID.key]:[A.tileID];p._renderTileClippingMasks(z,U),p.renderLayer(p,p.style.sourceCaches[z.source],z,U),z.source&&(A.textureCoords[z.source]=this._coordsDescendingInvStr[z.source][A.tileID.key])}}Ys(p,p.style.terrain,A)}if("hillshade"===u){this._stacks.push([y[x]]);for(const A of this._renderableTiles){const F=this._coordsDescendingInv[s.source][A.tileID.key];cc(p,p.style.terrain,A,this._stacks.length-1),p.context.clear({color:_.Color.transparent}),p._renderTileClippingMasks(s,F),p.renderLayer(p,p.style.sourceCaches[s.source],s,F),Ys(p,p.style.terrain,A)}return!0}return this._renderToTexture[u]}return!1}}const ka={symbol:function(m,s,u,p,y){if("translucent"!==m.renderPass)return;const x=In.disabled,C=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(T,S,A,F,z,U,X){const q=S.transform,W="map"===z,re="map"===U;for(const se of T){const de=F.getTile(se),Y=de.getBucket(A);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const me=_.evaluateSizeForZoom(Y.textSizeData,q.zoom),pe=or(de,1,S.transform.zoom),Ce=Hs(se.posMatrix,re,W,S.transform,pe),De="none"!==A.layout.get("icon-text-fit")&&Y.hasIconData();if(me){const Fe=Math.pow(2,q.zoom-de.tileID.overscaledZ);Ks(Y,W,re,X,q,Ce,se.posMatrix,Fe,me,De,S.style.terrain?(ve,Xe)=>S.style.terrain.getElevation(se,ve,Xe):null)}}}(p,m,u,s,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y),0!==u.paint.get("icon-opacity").constantOr(1)&&ao(m,s,u,p,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),x,C),0!==u.paint.get("text-opacity").constantOr(1)&&ao(m,s,u,p,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),x,C),s.map.showCollisionBoxes&&(Ma(m,s,u,p,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Ma(m,s,u,p,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,u,p){if("translucent"!==m.renderPass)return;const y=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),C=u.paint.get("circle-stroke-opacity"),T=!u.layout.get("circle-sort-key").isConstant();if(0===y.constantOr(1)&&(0===x.constantOr(1)||0===C.constantOr(1)))return;const S=m.context,A=S.gl,F=m.depthModeForSublayer(0,Gt.ReadOnly),z=In.disabled,U=m.colorModeForRenderPass(),X=[];for(let q=0;q<p.length;q++){const W=p[q],re=s.getTile(W),se=re.getBucket(u);if(!se)continue;const de=se.programConfigurations.get(u.id),Y=m.useProgram("circle",de),me=se.layoutVertexBuffer,pe=se.indexBuffer,Ce=m.style.terrain&&m.style.terrain.getTerrainData(W),De={programConfiguration:de,program:Y,layoutVertexBuffer:me,indexBuffer:pe,uniformValues:ji(m,W,re,u),terrainData:Ce};if(T){const Fe=se.segments.get();for(const ve of Fe)X.push({segments:new _.SegmentVector([ve]),sortKey:ve.sortKey,state:De})}else X.push({segments:se.segments,sortKey:0,state:De})}T&&X.sort((q,W)=>q.sortKey-W.sortKey);for(const q of X){const{programConfiguration:W,program:re,layoutVertexBuffer:se,indexBuffer:de,uniformValues:Y,terrainData:me}=q.state;re.draw(S,A.TRIANGLES,F,z,U,Tn.disabled,Y,me,u.id,se,de,q.segments,u.paint,m.transform.zoom,W)}},heatmap:function(m,s,u,p){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const y=m.context,x=y.gl,C=In.disabled,T=new On([x.ONE,x.ONE],_.Color.transparent,[!0,!0,!0,!0]);(function(S,A,F){const z=S.gl;S.activeTexture.set(z.TEXTURE1),S.viewport.set([0,0,A.width/4,A.height/4]);let U=F.heatmapFbo;if(U)z.bindTexture(z.TEXTURE_2D,U.colorAttachment.get()),S.bindFramebuffer.set(U.framebuffer);else{const X=z.createTexture();z.bindTexture(z.TEXTURE_2D,X),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),U=F.heatmapFbo=S.createFramebuffer(A.width/4,A.height/4,!1),function(q,W,re,se){const de=q.gl;de.texImage2D(de.TEXTURE_2D,0,de.RGBA,W.width/4,W.height/4,0,de.RGBA,q.extRenderToTextureHalfFloat?q.extTextureHalfFloat.HALF_FLOAT_OES:de.UNSIGNED_BYTE,null),se.colorAttachment.set(re)}(S,A,X,U)}})(y,m,u),y.clear({color:_.Color.transparent});for(let S=0;S<p.length;S++){const A=p[S];if(s.hasRenderableParent(A))continue;const F=s.getTile(A),z=F.getBucket(u);if(!z)continue;const U=z.programConfigurations.get(u.id),X=m.useProgram("heatmap",U),{zoom:q}=m.transform;X.draw(y,x.TRIANGLES,Gt.disabled,C,T,Tn.disabled,Ea(A.posMatrix,F,q,u.paint.get("heatmap-intensity")),null,u.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,u.paint,m.transform.zoom,U)}y.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(y,x){const C=y.context,T=C.gl,S=x.heatmapFbo;if(!S)return;C.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S.colorAttachment.get()),C.activeTexture.set(T.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new Un(C,x.colorRamp,T.RGBA)),A.bind(T.LINEAR,T.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(C,T.TRIANGLES,Gt.disabled,In.disabled,y.colorModeForRenderPass(),Tn.disabled,((F,z,U,X)=>{const q=_.create();_.ortho(q,0,F.width,F.height,0,0,1);const W=F.context.gl;return{u_matrix:q,u_world:[W.drawingBufferWidth,W.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}})(y,x),null,x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(m,u))},line:function(m,s,u,p){if("translucent"!==m.renderPass)return;const y=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(0===y.constantOr(1)||0===x.constantOr(1))return;const C=m.depthModeForSublayer(0,Gt.ReadOnly),T=m.colorModeForRenderPass(),S=u.paint.get("line-dasharray"),A=u.paint.get("line-pattern"),F=A.constantOr(1),z=u.paint.get("line-gradient"),U=u.getCrossfadeParameters(),X=F?"linePattern":S?"lineSDF":z?"lineGradient":"line",q=m.context,W=q.gl;let re=!0;for(const se of p){const de=s.getTile(se);if(F&&!de.patternsLoaded())continue;const Y=de.getBucket(u);if(!Y)continue;const me=Y.programConfigurations.get(u.id),pe=m.context.program.get(),Ce=m.useProgram(X,me),De=re||Ce.program!==pe,Fe=m.style.terrain&&m.style.terrain.getTerrainData(se),ve=A.constantOr(null);if(ve&&de.imageAtlas){const Qe=de.imageAtlas,Pt=Qe.patternPositions[ve.to.toString()],Bt=Qe.patternPositions[ve.from.toString()];Pt&&Bt&&me.setConstantPatternPositions(Pt,Bt)}const Xe=Fe?se:null,Ue=F?En(m,de,u,U,Xe):S?Ct(m,de,u,S,U,Xe):z?Wc(m,de,u,Y.lineClipsArray.length,Xe):Ds(m,de,u,Xe);if(F)q.activeTexture.set(W.TEXTURE0),de.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),me.updatePaintBuffers(U);else if(S&&(De||m.lineAtlas.dirty))q.activeTexture.set(W.TEXTURE0),m.lineAtlas.bind(q);else if(z){const Qe=Y.gradients[u.id];let Pt=Qe.texture;if(u.gradientVersion!==Qe.version){let Bt=256;if(u.stepInterpolant){const ct=s.getSource().maxzoom,dn=se.canonical.z===ct?Math.ceil(1<<m.transform.maxZoom-se.canonical.z):1;Bt=_.clamp(_.nextPowerOfTwo(Y.maxLineLength/_.EXTENT*1024*dn),256,q.maxTextureSize)}Qe.gradient=_.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Bt,image:Qe.gradient||void 0,clips:Y.lineClipsArray}),Qe.texture?Qe.texture.update(Qe.gradient):Qe.texture=new Un(q,Qe.gradient,W.RGBA),Qe.version=u.gradientVersion,Pt=Qe.texture}q.activeTexture.set(W.TEXTURE0),Pt.bind(u.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Ce.draw(q,W.TRIANGLES,C,m.stencilModeForClipping(se),T,Tn.disabled,Ue,Fe,u.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,u.paint,m.transform.zoom,me,Y.layoutVertexBuffer2),re=!1}},fill:function(m,s,u,p){const y=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(0===x.constantOr(1))return;const C=m.colorModeForRenderPass(),T=u.paint.get("fill-pattern"),S=m.opaquePassEnabledForLayer()&&!T.constantOr(1)&&1===y.constantOr(_.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(m.renderPass===S){const A=m.depthModeForSublayer(1,"opaque"===m.renderPass?Gt.ReadWrite:Gt.ReadOnly);lt(m,s,u,p,A,C,!1)}if("translucent"===m.renderPass&&u.paint.get("fill-antialias")){const A=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly);lt(m,s,u,p,A,C,!0)}},"fill-extrusion":function(m,s,u,p){const y=u.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===m.renderPass){const x=new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D);if(1!==y||u.paint.get("fill-extrusion-pattern").constantOr(1))Aa(m,s,u,p,x,In.disabled,On.disabled),Aa(m,s,u,p,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const C=m.colorModeForRenderPass();Aa(m,s,u,p,x,In.disabled,C)}}},hillshade:function(m,s,u,p){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const y=m.context,x=m.depthModeForSublayer(0,Gt.ReadOnly),C=m.colorModeForRenderPass(),[T,S]="translucent"===m.renderPass?m.stencilConfigForOverlap(p):[{},p];for(const A of S){const F=s.getTile(A);void 0!==F.needsHillshadePrepare&&F.needsHillshadePrepare&&"offscreen"===m.renderPass?vl(m,F,u,x,In.disabled,C):"translucent"===m.renderPass&&rt(m,A,F,u,x,T[A.overscaledZ],C)}y.viewport.set([0,0,m.width,m.height])},raster:function(m,s,u,p){if("translucent"!==m.renderPass||0===u.paint.get("raster-opacity")||!p.length)return;const y=m.context,x=y.gl,C=s.getSource(),T=m.useProgram("raster"),S=m.colorModeForRenderPass(),[A,F]=C instanceof $i?[{},p]:m.stencilConfigForOverlap(p),z=F[F.length-1].overscaledZ,U=!m.options.moving;for(const X of F){const q=m.depthModeForSublayer(X.overscaledZ-z,1===u.paint.get("raster-opacity")?Gt.ReadWrite:Gt.ReadOnly,x.LESS),W=s.getTile(X);W.registerFadeDuration(u.paint.get("raster-fade-duration"));const re=s.findLoadedParent(X,0),se=Pa(W,re,s,u,m.transform,m.style.terrain);let de,Y;const me="nearest"===u.paint.get("raster-resampling")?x.NEAREST:x.LINEAR;y.activeTexture.set(x.TEXTURE0),W.texture.bind(me,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(x.TEXTURE1),re?(re.texture.bind(me,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),de=Math.pow(2,re.tileID.overscaledZ-W.tileID.overscaledZ),Y=[W.tileID.canonical.x*de%1,W.tileID.canonical.y*de%1]):W.texture.bind(me,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const pe=m.style.terrain&&m.style.terrain.getTerrainData(X),Ce=pe?X:null,De=Ce?Ce.posMatrix:m.transform.calculatePosMatrix(X.toUnwrapped(),U),Fe=Dh(De,Y||[0,0],de||1,se,u);C instanceof $i?T.draw(y,x.TRIANGLES,q,In.disabled,S,Tn.disabled,Fe,pe,u.id,C.boundsBuffer,m.quadTriangleIndexBuffer,C.boundsSegments):T.draw(y,x.TRIANGLES,q,A[X.overscaledZ],S,Tn.disabled,Fe,pe,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,s,u,p){const y=u.paint.get("background-color"),x=u.paint.get("background-opacity");if(0===x)return;const C=m.context,T=C.gl,S=m.transform,A=S.tileSize,F=u.paint.get("background-pattern");if(m.isPatternMissing(F))return;const z=!F&&1===y.a&&1===x&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==z)return;const U=In.disabled,X=m.depthModeForSublayer(0,"opaque"===z?Gt.ReadWrite:Gt.ReadOnly),q=m.colorModeForRenderPass(),W=m.useProgram(F?"backgroundPattern":"background"),re=p||S.coveringTiles({tileSize:A,terrain:m.style.terrain});F&&(C.activeTexture.set(T.TEXTURE0),m.imageManager.bind(m.context));const se=u.getCrossfadeParameters();for(const de of re){const Y=p?de.posMatrix:m.transform.calculatePosMatrix(de.toUnwrapped()),me=F?Eh(Y,x,m,F,{tileID:de,tileSize:A},se):xn(Y,x,y),pe=m.style.terrain&&m.style.terrain.getTerrainData(de);W.draw(C,T.TRIANGLES,X,U,q,Tn.disabled,me,pe,u.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,s,u){for(let p=0;p<u.length;p++)un(m,s,u[p])},custom:function(m,s,u){const p=m.context,y=u.implementation;if("offscreen"===m.renderPass){const x=y.prerender;x&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),x.call(y,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(In.disabled);const x="3d"===y.renderingMode?new Gt(m.context.gl.LEQUAL,Gt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Gt.ReadOnly);p.setDepthMode(x),y.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class co{constructor(s,u){this.context=new Ph(s),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:_.create(),renderTime:0},this.setup(),this.numSublayers=pn.maxUnderzooming+pn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ht,this.gpuTimers={}}resize(s,u,p){if(this.width=s*p,this.height=u*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const s=this.context,u=new _.PosArray;u.emplaceBack(0,0),u.emplaceBack(_.EXTENT,0),u.emplaceBack(0,_.EXTENT),u.emplaceBack(_.EXTENT,_.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(u,Qt.members),this.tileExtentSegments=_.SegmentVector.simpleSegment(0,0,4,2);const p=new _.PosArray;p.emplaceBack(0,0),p.emplaceBack(_.EXTENT,0),p.emplaceBack(0,_.EXTENT),p.emplaceBack(_.EXTENT,_.EXTENT),this.debugBuffer=s.createVertexBuffer(p,Qt.members),this.debugSegments=_.SegmentVector.simpleSegment(0,0,4,5);const y=new _.RasterBoundsArray;y.emplaceBack(0,0,0,0),y.emplaceBack(_.EXTENT,0,_.EXTENT,0),y.emplaceBack(0,_.EXTENT,0,_.EXTENT),y.emplaceBack(_.EXTENT,_.EXTENT,_.EXTENT,_.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(y,Wo.members),this.rasterBoundsSegments=_.SegmentVector.simpleSegment(0,0,4,2);const x=new _.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,Qt.members),this.viewportSegments=_.SegmentVector.simpleSegment(0,0,4,2);const C=new _.LineStripIndexArray;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(C);const T=new _.TriangleIndexArray;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T),this.emptyTexture=new Un(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const S=this.context.gl;this.stencilClearMode=new In({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=_.create();_.ortho(p,0,this.width,this.height,0,0,1),_.scale(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,u.TRIANGLES,Gt.disabled,this.stencilClearMode,On.disabled,Tn.disabled,rn(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,u){if(this.currentStencilSource===s.source||!s.isTileClipped()||!u||!u.length)return;this.currentStencilSource=s.source;const p=this.context,y=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(On.disabled),p.setDepthMode(Gt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of u){const T=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,S=this.style.terrain&&this.style.terrain.getTerrainData(C);x.draw(p,y.TRIANGLES,Gt.disabled,new In({func:y.ALWAYS,mask:0},T,255,y.KEEP,y.KEEP,y.REPLACE),On.disabled,Tn.disabled,rn(C.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new In({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){const u=this.context.gl;return new In({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){const u=this.context.gl,p=s.sort((C,T)=>T.overscaledZ-C.overscaledZ),y=p[p.length-1].overscaledZ,x=p[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const C={};for(let T=0;T<x;T++)C[T+y]=new In({func:u.GEQUAL,mask:255},T+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[C,p]}return[{[y]:In.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new On([s.CONSTANT_COLOR,s.ONE],new _.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?On.unblended:On.alphaBlended}depthModeForSublayer(s,u,p){if(!this.opaquePassEnabledForLayer())return Gt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Gt(p||this.context.gl.LEQUAL,u,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,u){this.style=s,this.options=u,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(_.exported.now()),this.imageManager.beginFrame();const p=this.style._order,y=this.style.sourceCaches,x=this.style.terrain&&new uc(this);for(const A in y){const F=y[A];F.used&&F.prepare(this.context)}const C={},T={},S={};for(const A in y){const F=y[A];C[A]=F.getVisibleCoordinates(),T[A]=C[A].slice().reverse(),S[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}if(x){this.opaquePassCutoff=0;const A=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!_.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(_.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,z){const U=F.context,X=U.gl,q=On.unblended,W=new Gt(X.LEQUAL,Gt.ReadWrite,[0,1]),re=z.getTerrainMesh(),se=z.sourceCache.getRenderableTiles(),de=F.useProgram("terrainDepth");U.bindFramebuffer.set(z.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),U.clear({color:_.Color.transparent,depth:1});for(const Y of se){const me=z.getTerrainData(Y.tileID),pe=F.transform.calculatePosMatrix(Y.tileID.toUnwrapped());de.draw(U,X.TRIANGLES,W,In.disabled,q,Tn.backCCW,{u_matrix:pe},me,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain),function(F,z){const U=F.context,X=U.gl,q=On.unblended,W=new Gt(X.LEQUAL,Gt.ReadWrite,[0,1]),re=z.getTerrainMesh(),se=z.getCoordsTexture(),de=z.sourceCache.getRenderableTiles(),Y=F.useProgram("terrainCoords");U.bindFramebuffer.set(z.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),U.clear({color:_.Color.transparent,depth:1}),z.coordsIndex=[];for(const me of de){const pe=z.getTerrainData(me.tileID);U.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,se.texture);const Ce=F.transform.calculatePosMatrix(me.tileID.toUnwrapped());Y.draw(U,X.TRIANGLES,W,In.disabled,q,Tn.backCCW,{u_matrix:Ce,u_terrain_coords_id:(255-z.coordsIndex.length)/255,u_texture:0},pe,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),z.coordsIndex.push(me.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const A of p){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const z=T[F.source];("custom"===F.type||z.length)&&this.renderLayer(this,y[F.source],F,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?_.Color.black:_.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!x)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],F=y[A.source],z=C[A.source];this._renderTileClippingMasks(A,z),this.renderLayer(this,F,A,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],F=y[A.source];if(x&&x.renderLayer(A))continue;const z=("symbol"===A.type?S:T)[A.source];this._renderTileClippingMasks(A,C[A.source]),this.renderLayer(this,F,A,z)}if(this.options.showTileBoundaries){let A,F;Object.values(this.style._layers).forEach(z=>{z.source&&!z.isHidden(this.transform.zoom)&&(z.source!==(F&&F.id)&&(F=this.style.sourceCaches[z.source]),(!A||A.getSource().maxzoom<F.getSource().maxzoom)&&(A=F))}),A&&ka.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;qr(A,A.transform.height-(F.top||0),3,Is),qr(A,F.bottom||0,3,lo),Lr(A,F.left||0,3,dd),Lr(A,A.transform.width-(F.right||0),3,nu);const z=A.transform.centerPoint;var U,X,q,W;vi(U=A,(X=z.x)-1,(q=A.transform.height-z.y)-10,2,20,W=Mo),vi(U,X-10,q-1,20,2,W)}(this),this.context.setDefault()}renderLayer(s,u,p,y){p.isHidden(this.transform.zoom)||("background"===p.type||"custom"===p.type||(y||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),ka[p.type](s,u,p,y,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let p=this.gpuTimers[s.id];p||(p=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),p.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const u={};for(const p in s){const y=s[p],x=this.context.extTimerQuery,C=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),u[p]=C}return u}translatePosMatrix(s,u,p,y,x){if(!p[0]&&!p[1])return s;const C=x?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(C){const A=Math.sin(C),F=Math.cos(C);p=[p[0]*F-p[1]*A,p[0]*A+p[1]*F]}const T=[x?p[0]:or(u,p[0],this.transform.zoom),x?p[1]:or(u,p[1],this.transform.zoom),0],S=new Float32Array(16);return _.translate(S,s,T),S}saveTileTexture(s){const u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const u=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!u||!p}useProgram(s,u){this.cache=this.cache||{};const p=s+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Gc(this.context,s,fl[s],u,rd[s],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Un(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ts{constructor(s,u){this.points=s,this.planes=u}static fromInvProjectionMatrix(s,u,p){const y=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const S=1/(T=_.transformMat4([],T,s))[3]/u*y;return _.mul$1(T,T,[S,S,1/T[3],S])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const S=_.sub([],x[T[0]],x[T[1]]),A=_.sub([],x[T[2]],x[T[1]]),F=_.normalize([],_.cross([],S,A)),z=-_.dot(F,x[T[1]]);return F.concat(z)});return new Ts(x,C)}}class Ra{constructor(s,u){this.min=s,this.max=u,this.center=_.scale$1([],_.add([],this.min,this.max),.5)}quadrant(s){const u=[s%2==0,s<2],p=_.clone$2(this.min),y=_.clone$2(this.max);for(let x=0;x<u.length;x++)p[x]=u[x]?this.min[x]:this.center[x],y[x]=u[x]?this.center[x]:this.max[x];return y[2]=this.max[2],new Ra(p,y)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let y=0;y<s.planes.length;y++){const x=s.planes[y];let C=0;for(let T=0;T<u.length;T++)_.dot$1(x,u[T])>=0&&C++;if(0===C)return 0;C!==u.length&&(p=!1)}if(p)return 2;for(let y=0;y<3;y++){let x=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let T=0;T<s.points.length;T++){const S=s.points[T][y]-this.min[y];x=Math.min(x,S),C=Math.max(C,S)}if(C<0||x>this.max[y]-this.min[y])return 0}return 1}}class Js{constructor(s=0,u=0,p=0,y=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=p,this.right=y}interpolate(s,u,p){return null!=u.top&&null!=s.top&&(this.top=_.number(s.top,u.top,p)),null!=u.bottom&&null!=s.bottom&&(this.bottom=_.number(s.bottom,u.bottom,p)),null!=u.left&&null!=s.left&&(this.left=_.number(s.left,u.left,p)),null!=u.right&&null!=s.right&&(this.right=_.number(s.right,u.right,p)),this}getCenter(s,u){const p=_.clamp((this.left+s-this.right)/2,0,s),y=_.clamp((this.top+u-this.bottom)/2,0,u);return new _.pointGeometry(p,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Js(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Qs{constructor(s,u,p,y,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=void 0===x||!!x,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new _.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Js,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new Qs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s._elevation=this._elevation,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new _.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const u=-_.wrap(s,-180,180)*Math.PI/180;var p,y,x,C,T,S,A,F,z,U;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(p=new _.ARRAY_TYPE(4),_.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),y=this.rotationMatrix,C=this.angle,T=(x=this.rotationMatrix)[0],S=x[1],A=x[2],F=x[3],z=Math.sin(C),U=Math.cos(C),y[0]=T*U+A*z,y[1]=S*U+F*z,y[2]=T*-z+A*U,y[3]=S*-z+F*U)}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const u=_.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,p){this._unmodified=!1,this._edgeInsets.interpolate(s,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){const u=[new _.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new _.pointGeometry(0,0)),y=this.pointCoordinate(new _.pointGeometry(this.width,0)),x=this.pointCoordinate(new _.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new _.pointGeometry(0,this.height)),T=Math.floor(Math.min(p.x,y.x,x.x,C.x)),S=Math.floor(Math.max(p.x,y.x,x.x,C.x)),A=1;for(let F=T-A;F<=S+A;F++)0!==F&&u.push(new _.UnwrappedTileID(F,s))}return u}coveringTiles(s){var u,p;let y=this.coveringZoomLevel(s);const x=y;if(void 0!==s.minzoom&&y<s.minzoom)return[];void 0!==s.maxzoom&&y>s.maxzoom&&(y=s.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),T=_.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,y),A=[S*C.x,S*C.y,0],F=[S*T.x,S*T.y,0],z=Ts.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,y);let U=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=y);const X=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,q=Y=>({aabb:new Ra([Y*S,0,0],[(Y+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),W=[],re=[],se=y,de=s.reparseOverscaled?x:y;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)W.push(q(-Y)),W.push(q(Y));for(W.push(q(0));W.length>0;){const Y=W.pop(),me=Y.x,pe=Y.y;let Ce=Y.fullyVisible;if(!Ce){const Qe=Y.aabb.intersects(z);if(0===Qe)continue;Ce=2===Qe}const De=s.terrain?A:F,Fe=Y.aabb.distanceX(De),ve=Y.aabb.distanceY(De),Xe=Math.max(Math.abs(Fe),Math.abs(ve));if(Y.zoom===se||Xe>X+(1<<se-Y.zoom)-2&&Y.zoom>=U){const Qe=se-Y.zoom,Pt=A[0]-.5-(me<<Qe),Bt=A[1]-.5-(pe<<Qe);re.push({tileID:new _.OverscaledTileID(Y.zoom===se?de:Y.zoom,Y.wrap,Y.zoom,me,pe),distanceSq:_.sqrLen([F[0]-.5-me,F[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(Pt*Pt+Bt*Bt)})}else for(let Qe=0;Qe<4;Qe++){const Pt=(me<<1)+Qe%2,Bt=(pe<<1)+(Qe>>1),ct=Y.zoom+1;let dn=Y.aabb.quadrant(Qe);if(s.terrain){const wn=new _.OverscaledTileID(ct,Y.wrap,ct,Pt,Bt),jt=s.terrain.getMinMaxElevation(wn),Wt=null!==(u=jt.minElevation)&&void 0!==u?u:this.elevation,Cn=null!==(p=jt.maxElevation)&&void 0!==p?p:this.elevation;dn=new Ra([dn.min[0],dn.min[1],Wt],[dn.max[0],dn.max[1],Cn])}W.push({aabb:dn,zoom:ct,x:Pt,y:Bt,wrap:Y.wrap,fullyVisible:Ce})}}return re.sort((Y,me)=>Y.distanceSq-me.distanceSq).map(Y=>Y.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const u=_.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new _.pointGeometry(_.mercatorXfromLng(s.lng)*this.worldSize,_.mercatorYfromLat(u)*this.worldSize)}unproject(s){return new _.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(s){this.freezeElevation||(this.elevation=s?this.getElevation(this._center,s):0)}getElevation(s,u){const p=_.MercatorCoordinate.fromLngLat(s),y=(1<<this.tileZoom)*_.EXTENT,x=p.x*y,C=p.y*y,T=Math.floor(x/_.EXTENT),S=Math.floor(C/_.EXTENT),A=new _.OverscaledTileID(this.tileZoom,0,this.tileZoom,T,S);return u.getElevation(A,x%_.EXTENT,C%_.EXTENT,_.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const u=this.pointLocation(this.centerPoint,s),p=this.getElevation(u,s);if(!(this.elevation-p))return;const y=this.getCameraPosition(),x=_.MercatorCoordinate.fromLngLat(y.lngLat,y.altitude),C=_.MercatorCoordinate.fromLngLat(u,p),T=x.x-C.x,S=x.y-C.y,A=x.z-C.z,F=Math.sqrt(T*T+S*S+A*A),z=this.scaleZoom(this.cameraToCenterDistance/F/this.tileSize);this._elevation=p,this._center=u,this.zoom=z}setLocationAtPoint(s,u){const p=this.pointCoordinate(u),y=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(s),C=new _.MercatorCoordinate(x.x-(p.x-y.x),x.y-(p.y-y.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,u){return u?this.coordinatePoint(this.locationCoordinate(s),this.getElevation(s,u),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,u){return this.coordinateLocation(this.pointCoordinate(s,u))}locationCoordinate(s){return _.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,u){if(u){const U=u.pointCoordinate(s);if(null!=U)return U}const p=[s.x,s.y,0,1],y=[s.x,s.y,1,1];_.transformMat4(p,p,this.pixelMatrixInverse),_.transformMat4(y,y,this.pixelMatrixInverse);const x=p[3],C=y[3],T=p[1]/x,S=y[1]/C,A=p[2]/x,F=y[2]/C,z=A===F?0:(0-A)/(F-A);return new _.MercatorCoordinate(_.number(p[0]/x,y[0]/C,z)/this.worldSize,_.number(T,S,z)/this.worldSize)}coordinatePoint(s,u=0,p=this.pixelMatrix){const y=[s.x*this.worldSize,s.y*this.worldSize,u,1];return _.transformMat4(y,y,p),new _.pointGeometry(y[0]/y[3],y[1]/y[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return(new _.LngLatBounds).extend(this.pointLocation(new _.pointGeometry(0,s))).extend(this.pointLocation(new _.pointGeometry(this.width,s))).extend(this.pointLocation(new _.pointGeometry(this.width,this.height))).extend(this.pointLocation(new _.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new _.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,u=!1){const p=s.key,y=u?this._alignedPosMatrixCache:this._posMatrixCache;if(y[p])return y[p];const x=s.canonical,C=this.worldSize/this.zoomScale(x.z),T=x.x+Math.pow(2,x.z)*s.wrap,S=_.identity(new Float64Array(16));return _.translate(S,S,[T*C,x.y*C,0]),_.scale(S,S,[C/_.EXTENT,C/_.EXTENT,1]),_.multiply(S,u?this.alignedProjMatrix:this.projMatrix,S),y[p]=new Float32Array(S),y[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,u,p,y,x=-90,C=90,T=-180,S=180;const A=this.size,F=this._unmodified;if(this.latRange){const X=this.latRange;x=_.mercatorYfromLat(X[1])*this.worldSize,C=_.mercatorYfromLat(X[0])*this.worldSize,s=C-x<A.y?A.y/(C-x):0}if(this.lngRange){const X=this.lngRange;T=_.wrap(_.mercatorXfromLng(X[0])*this.worldSize,0,this.worldSize),S=_.wrap(_.mercatorXfromLng(X[1])*this.worldSize,0,this.worldSize),S<T&&(S+=this.worldSize),u=S-T<A.x?A.x/(S-T):0}const z=this.point,U=Math.max(u||0,s||0);if(U)return this.center=this.unproject(new _.pointGeometry(u?(S+T)/2:z.x,s?(C+x)/2:z.y)),this.zoom+=this.scaleZoom(U),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const X=z.y,q=A.y/2;X-q<x&&(y=x+q),X+q>C&&(y=C-q)}if(this.lngRange){const X=(T+S)/2,q=_.wrap(z.x,X-this.worldSize/2,X+this.worldSize/2),W=A.x/2;q-W<T&&(p=T+W),q+W>S&&(p=S-W)}void 0===p&&void 0===y||(this.center=this.unproject(new _.pointGeometry(void 0!==p?p:z.x,void 0!==y?y:z.y)).wrap()),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,u=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=_.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let y=_.identity(new Float64Array(16));_.scale(y,y,[this.width/2,-this.height/2,1]),_.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=_.identity(new Float64Array(16)),_.scale(y,y,[1,-1,1]),_.translate(y,y,[-1,-1,0]),_.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=Math.PI/2+this._pitch,C=this._fov*(.5+s.y/this.height),T=Math.sin(C)*this.cameraToSeaLevelDistance/Math.sin(_.clamp(Math.PI-x-C,.01,Math.PI-.01)),S=this.getHorizon(),A=2*Math.atan(S/this.cameraToCenterDistance)*(.5+s.y/(2*S)),F=Math.sin(A)*this.cameraToSeaLevelDistance/Math.sin(_.clamp(Math.PI-x-A,.01,Math.PI-.01)),z=Math.cos(Math.PI/2-this._pitch)*T+this.cameraToSeaLevelDistance,U=Math.cos(Math.PI/2-this._pitch)*F+this.cameraToSeaLevelDistance,X=1.01*Math.min(z,U),q=this.height/50;y=new Float64Array(16),_.perspective(y,this._fov,this.width/this.height,q,X),y[8]=2*-s.x/this.width,y[9]=2*s.y/this.height,_.scale(y,y,[1,-1,1]),_.translate(y,y,[0,0,-this.cameraToCenterDistance]),_.rotateX(y,y,this._pitch),_.rotateZ(y,y,this.angle),_.translate(y,y,[-u,-p,0]),this.mercatorMatrix=_.scale([],y,[this.worldSize,this.worldSize,this.worldSize]),_.scale(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=_.multiply(new Float64Array(16),this.labelPlaneMatrix,y),_.translate(y,y,[0,0,-this.elevation]),this.projMatrix=y,this.invProjMatrix=_.invert([],y),this.pixelMatrix3D=_.multiply(new Float64Array(16),this.labelPlaneMatrix,y);const W=this.width%2/2,re=this.height%2/2,se=Math.cos(this.angle),de=Math.sin(this.angle),Y=u-Math.round(u)+se*W+de*re,me=p-Math.round(p)+se*re+de*W,pe=new Float64Array(y);if(_.translate(pe,pe,[Y>.5?Y-1:Y,me>.5?me-1:me,0]),this.alignedProjMatrix=pe,y=_.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new _.pointGeometry(0,0)),u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return _.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new _.pointGeometry(0,s))}getCameraQueryGeometry(s){const u=this.getCameraPoint();if(1===s.length)return[s[0],u];{let p=u.x,y=u.y,x=u.x,C=u.y;for(const T of s)p=Math.min(p,T.x),y=Math.min(y,T.y),x=Math.max(x,T.x),C=Math.max(C,T.y);return[new _.pointGeometry(p,y),new _.pointGeometry(x,y),new _.pointGeometry(x,C),new _.pointGeometry(p,C),new _.pointGeometry(p,y)]}}}class ru{constructor(s){this._hashName=s&&encodeURIComponent(s),_.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(u,p){let y=!1,x=null;const C=()=>{x=null,y&&(u(),x=setTimeout(C,300),y=!1)};return()=>(y=!0,x||C(),x)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),C=Math.round(u.lng*x)/x,T=Math.round(u.lat*x)/x,S=this._map.getBearing(),A=this._map.getPitch();let F="";if(F+=s?`/${C}/${T}/${p}`:`${p}/${T}/${C}`,(S||A)&&(F+="/"+Math.round(10*S)/10),A&&(F+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let U=!1;const X=window.location.hash.slice(1).split("&").map(q=>{const W=q.split("=")[0];return W===z?(U=!0,`${W}=${F}`):q}).filter(q=>q);return U||X.push(`${z}=${F}`),`#${X.join("&")}`}return`#${F}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const Fa={linearity:.3,easing:_.bezier(0,0,.3,1)},La=_.extend({deceleration:2500,maxSpeed:1400},Fa),iu=_.extend({deceleration:20,maxSpeed:1400},Fa),ou=_.extend({deceleration:1e3,maxSpeed:360},Fa),Oa=_.extend({deceleration:1e3,maxSpeed:90},Fa);class su{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=_.exported.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new _.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const x=bl(u.pan.mag(),p,_.extend({},La,s||{}));y.offset=u.pan.mult(x.amount/u.pan.mag()),y.center=this._map.transform.center,xl(y,x)}if(u.zoom){const x=bl(u.zoom,p,iu);y.zoom=this._map.transform.zoom+x.amount,xl(y,x)}if(u.bearing){const x=bl(u.bearing,p,ou);y.bearing=this._map.transform.bearing+_.clamp(x.amount,-179,179),xl(y,x)}if(u.pitch){const x=bl(u.pitch,p,Oa);y.pitch=this._map.transform.pitch+x.amount,xl(y,x)}if(y.zoom||y.bearing){const x=void 0===u.pinchAround?u.around:u.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.extend(y,{noMoveStart:!0})}}function xl(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function bl(m,s,u){const{maxSpeed:p,linearity:y,deceleration:x}=u,C=_.clamp(m*y/(s/1e3),-p,p),T=Math.abs(C)/(x*y);return{easing:u.easing,duration:1e3*T,amount:C*(T/2)}}class Hn extends _.Event{constructor(s,u,p,y={}){const x=be.mousePos(u.getCanvasContainer(),p),C=u.unproject(x);super(s,_.extend({point:x,lngLat:C,originalEvent:p},y)),this._defaultPrevented=!1,this.target=u}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class wl extends _.Event{constructor(s,u,p){const y="touchend"===s?p.changedTouches:p.touches,x=be.touchPos(u.getCanvasContainer(),y),C=x.map(S=>u.unproject(S)),T=x.reduce((S,A,F,z)=>S.add(A.div(z.length)),new _.pointGeometry(0,0));super(s,{points:x,point:T,lngLats:C,lngLat:u.unproject(T),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class xi extends _.Event{constructor(s,u,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Fh{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new xi(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new Hn(s.type,this._map,s))}mouseup(s){this._map.fire(new Hn(s.type,this._map,s))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Hn(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Hn(s.type,this._map,s))}mouseover(s){this._map.fire(new Hn(s.type,this._map,s))}mouseout(s){this._map.fire(new Hn(s.type,this._map,s))}touchstart(s){return this._firePreventable(new wl(s.type,this._map,s))}touchmove(s){this._map.fire(new wl(s.type,this._map,s))}touchend(s){this._map.fire(new wl(s.type,this._map,s))}touchcancel(s){this._map.fire(new wl(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ss{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Hn(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Hn(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hd{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&0===s.button&&(be.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=p,this._box||(this._box=be.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const x=Math.min(y.x,p.x),C=Math.max(y.x,p.x),T=Math.min(y.y,p.y),S=Math.max(y.y,p.y);be.setTransform(this._box,`translate(${x}px,${T}px)`),this._box.style.width=C-x+"px",this._box.style.height=S-T+"px"}mouseupWindow(s,u){if(!this._active||0!==s.button)return;const p=this._startPos,y=u;if(this.reset(),be.suppressClick(),p.x!==y.x||p.y!==y.y)return this._map.fire(new _.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(be.remove(this._box),this._box=null),be.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new _.Event(s,{originalEvent:u}))}}function ts(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const u={};for(let p=0;p<m.length;p++)u[m[p].identifier]=s[p];return u}class Na{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const x=new _.pointGeometry(0,0);for(const C of y)x._add(C);return x.div(y.length)}(u),this.touches=ts(p,u)))}touchmove(s,u,p){if(this.aborted||!this.centroid)return;const y=ts(p,u);for(const x in this.touches){const T=y[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,u,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class au{constructor(s){this.singleTap=new Na(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,u,p){this.singleTap.touchstart(s,u,p)}touchmove(s,u,p){this.singleTap.touchmove(s,u,p)}touchend(s,u,p){const y=this.singleTap.touchend(s,u,p);if(y){const x=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(y)<30;if(x&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Lh{constructor(){this._zoomIn=new au({numTouches:1,numTaps:2}),this._zoomOut=new au({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,p){this._zoomIn.touchstart(s,u,p),this._zoomOut.touchstart(s,u,p)}touchmove(s,u,p){this._zoomIn.touchmove(s,u,p),this._zoomOut.touchmove(s,u,p)}touchend(s,u,p){const y=this._zoomIn.touchend(s,u,p),x=this._zoomOut.touchend(s,u,p);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(y)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Oh={0:1,2:2};class sr{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,u){return!1}_move(s,u){return{}}mousedown(s,u){if(this._lastPoint)return;const p=be.mouseButton(s);this._correctButton(s,p)&&(this._lastPoint=u,this._eventButton=p)}mousemoveWindow(s,u){const p=this._lastPoint;if(p)if(s.preventDefault(),function(y,x){const C=Oh[x];return void 0===y.buttons||(y.buttons&C)!==C}(s,this._eventButton))this.reset();else if(this._moved||!(u.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(p,u)}mouseupWindow(s){this._lastPoint&&be.mouseButton(s)===this._eventButton&&(this._moved&&be.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cl extends sr{mousedown(s,u){super.mousedown(s,u),this._lastPoint&&(this._active=!0)}_correctButton(s,u){return 0===u&&!s.ctrlKey}_move(s,u){return{around:u,panDelta:u.sub(s)}}}class ns extends sr{_correctButton(s,u){return 0===u&&s.ctrlKey||2===u}_move(s,u){const p=.8*(u.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){s.preventDefault()}}class et extends sr{_correctButton(s,u){return 0===u&&s.ctrlKey||2===u}_move(s,u){const p=-.5*(u.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){s.preventDefault()}}class Zi{constructor(s,u){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new _.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,u,p){return this._calculateTransform(s,u,p)}touchmove(s,u,p){if(this._map._cooperativeGestures&&(2===this._minTouches&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,u,p)}touchend(s,u,p){this._calculateTransform(s,u,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,p){p.length>0&&(this._active=!0);const y=ts(p,u),x=new _.pointGeometry(0,0),C=new _.pointGeometry(0,0);let T=0;for(const A in y){const F=y[A],z=this._touches[A];z&&(x._add(F),C._add(F.sub(z)),T++,y[A]=F)}if(this._touches=y,T<this._minTouches||!C.mag())return;const S=C.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(T),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ea{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,u,p){return{}}touchstart(s,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,p){if(!this._firstTwoTouches)return;s.preventDefault();const[y,x]=this._firstTwoTouches,C=rs(p,u,y),T=rs(p,u,x);if(!C||!T)return;const S=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],S,s)}touchend(s,u,p){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,C=rs(p,u,y),T=rs(p,u,x);C&&T||(this._active&&be.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rs(m,s,u){for(let p=0;p<m.length;p++)if(m[p].identifier===u)return s[p]}function Tt(m,s){return Math.log(m/s)/Math.LN2}class Be extends ea{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Tt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tt(this._distance,p),pinchAround:u}}}function on(m,s){return 180*m.angleWith(s)/Math.PI}class Zr extends ea{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:on(this._vector,p),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,p=on(s,this._startVector);return Math.abs(p)<u}}function Wr(m){return Math.abs(m.y)>Math.abs(m.x)}class Ms extends ea{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,u,p){super.touchstart(s,u,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,Wr(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const y=s[0].sub(this._lastPoints[0]),x=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,x,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(s,u,p){if(void 0!==this._valid)return this._valid;const y=s.mag()>=2,x=u.mag()>=2;if(!y&&!x)return;if(!y||!x)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const C=s.y>0==u.y>0;return Wr(s)&&Wr(u)&&C}}const bi={panStep:100,bearingStep:15,pitchStep:10};class lu{constructor(){const s=bi;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,p=0,y=0,x=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:T=>{const S=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:pd,zoom:u?Math.round(S)+u*(s.shiftKey?2:1):S,bearing:T.getBearing()+p*this._bearingStep,pitch:T.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-C*this._panStep],center:T.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pd(m){return m*(2-m)}const Dl=4.000244140625;class cu{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,_.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;s.preventDefault()}let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=_.exported.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==u&&u%Dl==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=be.mousePos(this._el,s);this._around=_.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(0!==this._delta){const T="wheel"===this._type&&Math.abs(this._delta)>Dl?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&0!==S&&(S=1/S);const A="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(A*S))),"wheel"===this._type&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u="number"==typeof this._targetZoom?this._targetZoom:s.zoom,p=this._startZoom,y=this._easing;let x,C=!1;if("wheel"===this._type&&p&&y){const T=Math.min((_.exported.now()-this._lastWheelEventTime)/200,1),S=y(T);x=_.number(p,u,S),T<1?this._frameId||(this._frameId=!0):C=!0}else x=u,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:x-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=_.ease;if(this._prevEase){const p=this._prevEase,y=(_.exported.now()-p.start)/p.duration,x=p.easing(y+.01)-p.easing(y),C=.27/Math.sqrt(x*x+1e-4)*.01,T=Math.sqrt(.0729-C*C);u=_.bezier(C,T,.25,1)}return this._prevEase={start:_.exported.now(),duration:s,easing:u},u}reset(){this._active=!1}}class uu{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tr{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,u){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tt{constructor(){this._tap=new au({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,u,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=u[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,u,p))}touchmove(s,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=u[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,u,p)}touchend(s,u,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(s,u,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vt{constructor(s,u,p){this._el=s,this._mousePan=u,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bn{constructor(s,u,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wi{constructor(s,u,p,y){this._el=s,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xi=m=>m.zoom||m.drag||m.pitch||m.rotate;class Er extends _.Event{}function Ao(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Gn{constructor(s,u){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new su(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),_.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,C]of this._listeners)be.addEventListener(y,x,y===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[s,u,p]of this._listeners)be.removeEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new Fh(u,s));const y=u.boxZoom=new hd(u,s);this._add("boxZoom",y);const x=new Lh,C=new tr;u.doubleClickZoom=new uu(C,x),this._add("tapZoom",x),this._add("clickZoom",C);const T=new tt;this._add("tapDragZoom",T);const S=u.touchPitch=new Ms(u);this._add("touchPitch",S);const A=new ns(s),F=new et(s);u.dragRotate=new bn(s,A,F),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const z=new Cl(s),U=new Zi(s,u);u.dragPan=new vt(p,z,U),this._add("mousePan",z),this._add("touchPan",U,["touchZoom","touchRotate"]);const X=new Zr,q=new Be;u.touchZoomRotate=new Wi(p,q,X,T),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]);const W=u.scrollZoom=new cu(u,this);this._add("scrollZoom",W,["mousePan"]);const re=u.keyboard=new lu;this._add("keyboard",re),this._add("blockableMapEvent",new Ss(u));for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[se]&&u[se].enable(s[se])}_add(s,u,p){this._handlers.push({handlerName:s,handler:u,allowed:p}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xi(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,u,p){for(const y in s)if(y!==p&&(!u||u.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const u=[];for(const p of s)this._el.contains(p.target)&&u.push(p);return u}handleEvent(s,u){if("blur"===s.type)return void this.stop(!0);this._updatingCamera=!0;const p="renderFrame"===s.type?void 0:s,y={needsRenderFrame:!1},x={},C={},T=s.touches,S=T?this._getMapTouches(T):void 0,A=S?be.touchPos(this._el,S):be.mousePos(this._el,s);for(const{handlerName:U,handler:X,allowed:q}of this._handlers){if(!X.isEnabled())continue;let W;this._blockedByActive(C,q,U)?X.reset():X[u||s.type]&&(W=X[u||s.type](s,A,S),this.mergeHandlerResult(y,x,W,U,p),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||X.isActive())&&(C[U]=X)}const F={};for(const U in this._previousActiveHandlers)C[U]||(F[U]=p);this._previousActiveHandlers=C,(Object.keys(F).length||Ao(y))&&(this._changes.push([y,x,F]),this._triggerRenderFrame()),(Object.keys(C).length||Ao(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=y;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(s,u,p,y,x){if(!p)return;_.extend(s,p);const C={handlerName:y,originalEvent:p.originalEvent||x};void 0!==p.zoomDelta&&(u.zoom=C),void 0!==p.panDelta&&(u.drag=C),void 0!==p.pitchDelta&&(u.pitch=C),void 0!==p.bearingDelta&&(u.rotate=C)}_applyChanges(){const s={},u={},p={};for(const[y,x,C]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new _.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(s.around=y.around),void 0!==y.pinchAround&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),_.extend(u,x),_.extend(p,C);this._updateMapTransform(s,u,p),this._changes=[]}_updateMapTransform(s,u,p){const y=this._map,x=y.transform,C=y.style&&y.style.terrain;if(!(Ao(s)||C&&this._drag))return this._fireEvents(u,p,!0);let{panDelta:T,zoomDelta:S,bearingDelta:A,pitchDelta:F,around:z,pinchAround:U}=s;void 0!==U&&(z=U),y._stop(!0),z=z||y.transform.centerPoint;const X=x.pointLocation(T?z.sub(T):z);A&&(x.bearing+=A),F&&(x.pitch+=F),S&&(x.zoom+=S),C?u.drag&&!this._drag?(this._drag={center:x.centerPoint,lngLat:x.pointLocation(z),point:z,handlerName:u.drag.handlerName},y.fire(new _.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(y.fire(new _.Event("freezeElevation",{freeze:!1})),this._drag=null):u.drag&&this._drag&&(x.center=x.pointLocation(x.centerPoint.sub(T))):x.setLocationAtPoint(X,z),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,p,!0)}_fireEvents(s,u,p){const y=Xi(this._eventsInProgress),x=Xi(s),C={};for(const F in s){const{originalEvent:z}=s[F];this._eventsInProgress[F]||(C[`${F}start`]=z),this._eventsInProgress[F]=s[F]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in C)this._fireEvent(F,C[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in s){const{originalEvent:z}=s[F];this._fireEvent(F,z)}const T={};let S;for(const F in this._eventsInProgress){const{handlerName:z,originalEvent:U}=this._eventsInProgress[F];this._handlersById[z].isActive()||(delete this._eventsInProgress[F],S=u[z]||U,T[`${F}end`]=S)}for(const F in T)this._fireEvent(F,T[F]);const A=Xi(this._eventsInProgress);if(p&&(y||x)&&!A){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=U=>0!==U&&-this._bearingSnap<U&&U<this._bearingSnap;F?(z(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:S})):(this._map.fire(new _.Event("moveend",{originalEvent:S})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new _.Event(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Er("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Or={extend:(m,...s)=>_.extend(m,...s),run(m){m()},logToElement(m,s=!1,u="log"){const p=window.document.getElementById(u);p&&(s&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class mn extends _.Evented{constructor(s,u){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,_.bindAll(["_renderFrameCallback"],this)}getCenter(){return new _.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,p){return s=_.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,_.extend({offset:s},u),p)}panTo(s,u,p){return this.easeTo(_.extend({center:s},u),p)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,p){return this.easeTo(_.extend({zoom:s},u),p)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,p){return this.easeTo(_.extend({bearing:s},u),p)}resetNorth(s,u){return this.rotateTo(0,_.extend({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(_.extend({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=_.LngLatBounds.convert(s);const p=u&&u.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,u)}_cameraForBoxAndBearing(s,u,p,y){const x={top:0,bottom:0,right:0,left:0};if("number"==typeof(y=_.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding){const pe=y.padding;y.padding={top:pe,bottom:pe,right:pe,left:pe}}y.padding=_.extend(x,y.padding);const C=this.transform,T=C.padding,S=C.project(_.LngLat.convert(s)),A=C.project(_.LngLat.convert(u)),F=S.rotate(-p*Math.PI/180),z=A.rotate(-p*Math.PI/180),U=new _.pointGeometry(Math.max(F.x,z.x),Math.max(F.y,z.y)),X=new _.pointGeometry(Math.min(F.x,z.x),Math.min(F.y,z.y)),q=U.sub(X),W=(C.width-(T.left+T.right+y.padding.left+y.padding.right))/q.x,re=(C.height-(T.top+T.bottom+y.padding.top+y.padding.bottom))/q.y;if(re<0||W<0)return void _.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(C.scaleZoom(C.scale*Math.min(W,re)),y.maxZoom),de=_.pointGeometry.convert(y.offset),Y=new _.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(p*Math.PI/180),me=de.add(Y).mult(C.scale/C.zoomScale(se));return{center:C.unproject(S.add(A).div(2).sub(me)),zoom:se,bearing:p}}fitBounds(s,u,p){return this._fitInternal(this.cameraForBounds(s,u),u,p)}fitScreenCoordinates(s,u,p,y,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(_.pointGeometry.convert(s)),this.transform.pointLocation(_.pointGeometry.convert(u)),p,y),y,x)}_fitInternal(s,u,p){return s?(delete(u=_.extend(s,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(s,u){this.stop();const p=this.transform;let y=!1,x=!1,C=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(y=!0,p.zoom=+s.zoom),void 0!==s.center&&(p.center=_.LngLat.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(x=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(C=!0,p.pitch=+s.pitch),null==s.padding||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this.fire(new _.Event("movestart",u)).fire(new _.Event("move",u)),y&&this.fire(new _.Event("zoomstart",u)).fire(new _.Event("zoom",u)).fire(new _.Event("zoomend",u)),x&&this.fire(new _.Event("rotatestart",u)).fire(new _.Event("rotate",u)).fire(new _.Event("rotateend",u)),C&&this.fire(new _.Event("pitchstart",u)).fire(new _.Event("pitch",u)).fire(new _.Event("pitchend",u)),this.fire(new _.Event("moveend",u))}calculateCameraOptionsFromTo(s,u,p,y=0){const x=_.MercatorCoordinate.fromLngLat(s,u),C=_.MercatorCoordinate.fromLngLat(p,y),T=C.x-x.x,S=C.y-x.y,A=C.z-x.z,F=Math.hypot(T,S,A);if(0===F)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(T,S),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),X=180*Math.atan2(T,-S)/Math.PI;let q=180*Math.acos(z/F)/Math.PI;return q=A<0?90-q:90+q,{center:C.toLngLat(),zoom:U,pitch:q,bearing:X}}easeTo(s,u){this._stop(!1,s.easeId),(!1===(s=_.extend({offset:[0,0],duration:500,easing:_.ease},s)).animate||!s.essential&&_.exported.prefersReducedMotion)&&(s.duration=0);const p=this.transform,y=this.getZoom(),x=this.getBearing(),C=this.getPitch(),T=this.getPadding(),S="zoom"in s?+s.zoom:y,A="bearing"in s?this._normalizeBearing(s.bearing,x):x,F="pitch"in s?+s.pitch:C,z="padding"in s?s.padding:p.padding,U=_.pointGeometry.convert(s.offset);let X=p.centerPoint.add(U);const q=p.pointLocation(X),W=_.LngLat.convert(s.center||q);this._normalizeCenter(W);const re=p.project(q),se=p.project(W).sub(re),de=p.zoomScale(S-y);let Y,me;s.around&&(Y=_.LngLat.convert(s.around),me=p.locationPoint(Y));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==y,this._rotating=this._rotating||x!==A,this._pitching=this._pitching||F!==C,this._padding=!p.isPaddingEqual(z),this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,pe),this._ease(Ce=>{if(this._zooming&&(p.zoom=_.number(y,S,Ce)),this._rotating&&(p.bearing=_.number(x,A,Ce)),this._pitching&&(p.pitch=_.number(C,F,Ce)),this._padding&&(p.interpolatePadding(T,z,Ce),X=p.centerPoint.add(U)),Y)p.setLocationAtPoint(Y,me);else{const De=p.zoomScale(p.zoom-y),Fe=S>y?Math.min(2,de):Math.max(.5,de),ve=Math.pow(Fe,1-Ce),Xe=p.unproject(re.add(se.mult(Ce*ve)).mult(De));p.setLocationAtPoint(p.renderWorldCopies?Xe.wrap():Xe,X)}this._fireMoveEvents(u)},Ce=>{this._afterEase(u,Ce)},s),this}_prepareEase(s,u,p={}){this._moving=!0,this.fire(new _.Event("freezeElevation",{freeze:!0})),u||p.moving||this.fire(new _.Event("movestart",s)),this._zooming&&!p.zooming&&this.fire(new _.Event("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new _.Event("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new _.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new _.Event("move",s)),this._zooming&&this.fire(new _.Event("zoom",s)),this._rotating&&this.fire(new _.Event("rotate",s)),this._pitching&&this.fire(new _.Event("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.fire(new _.Event("freezeElevation",{freeze:!1}));const p=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new _.Event("zoomend",s)),y&&this.fire(new _.Event("rotateend",s)),x&&this.fire(new _.Event("pitchend",s)),this.fire(new _.Event("moveend",s))}flyTo(s,u){if(!s.essential&&_.exported.prefersReducedMotion){const ct=_.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ct,u)}this.stop(),s=_.extend({offset:[0,0],speed:1.2,curve:1.42,easing:_.ease},s);const p=this.transform,y=this.getZoom(),x=this.getBearing(),C=this.getPitch(),T=this.getPadding(),S="zoom"in s?_.clamp(+s.zoom,p.minZoom,p.maxZoom):y,A="bearing"in s?this._normalizeBearing(s.bearing,x):x,F="pitch"in s?+s.pitch:C,z="padding"in s?s.padding:p.padding,U=p.zoomScale(S-y),X=_.pointGeometry.convert(s.offset);let q=p.centerPoint.add(X);const W=p.pointLocation(q),re=_.LngLat.convert(s.center||W);this._normalizeCenter(re);const se=p.project(W),de=p.project(re).sub(se);let Y=s.curve;const me=Math.max(p.width,p.height),pe=me/U,Ce=de.mag();if("minZoom"in s){const ct=_.clamp(Math.min(s.minZoom,y,S),p.minZoom,p.maxZoom),dn=me/p.zoomScale(ct-y);Y=Math.sqrt(dn/Ce*2)}const De=Y*Y;function Fe(ct){const dn=(pe*pe-me*me+(ct?-1:1)*De*De*Ce*Ce)/(2*(ct?pe:me)*De*Ce);return Math.log(Math.sqrt(dn*dn+1)-dn)}function ve(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Xe(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const Ue=Fe(0);let Qe=function(ct){return Xe(Ue)/Xe(Ue+Y*ct)},Pt=function(ct){return me*((Xe(Ue)*(ve(dn=Ue+Y*ct)/Xe(dn))-ve(Ue))/De)/Ce;var dn},Bt=(Fe(1)-Ue)/Y;if(Math.abs(Ce)<1e-6||!isFinite(Bt)){if(Math.abs(me-pe)<1e-6)return this.easeTo(s,u);const ct=pe<me?-1:1;Bt=Math.abs(Math.log(pe/me))/Y,Pt=function(){return 0},Qe=function(dn){return Math.exp(ct*Y*dn)}}return s.duration="duration"in s?+s.duration:1e3*Bt/("screenSpeed"in s?+s.screenSpeed/Y:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=x!==A,this._pitching=F!==C,this._padding=!p.isPaddingEqual(z),this._prepareEase(u,!1),this._ease(ct=>{const dn=ct*Bt,wn=1/Qe(dn);p.zoom=1===ct?S:y+p.scaleZoom(wn),this._rotating&&(p.bearing=_.number(x,A,ct)),this._pitching&&(p.pitch=_.number(C,F,ct)),this._padding&&(p.interpolatePadding(T,z,ct),q=p.centerPoint.add(X));const jt=1===ct?re:p.unproject(se.add(de.mult(Pt(dn))).mult(wn));p.setLocationAtPoint(p.renderWorldCopies?jt.wrap():jt,q),this._fireMoveEvents(u)},()=>this._afterEase(u),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,u)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,u,p){!1===p.animate||0===p.duration?(s(1),u()):(this._easeStart=_.exported.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((_.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,u){s=_.wrap(s,-180,180);const p=Math.abs(s-u);return Math.abs(s-360-u)<p&&(s-=360),Math.abs(s+360-u)<p&&(s+=360),s}_normalizeCenter(s){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const p=s.lng-u.center.lng;s.lng+=p>180?-360:p<-180?360:0}}class St{constructor(s={}){this.options=s,_.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=be.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=be.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=be.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){be.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,u){const p=this._map._getUIString(`AttributionControl.${u}`);s.title=p,s.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType&&"terrain"!==s.type||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(y=>"string"!=typeof y?"":y)):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style.sourceCaches;for(const y in u){const x=u[y];if(x.used||x.usedForTerrain){const C=x.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s=s.filter(y=>String(y).trim()),s.sort((y,x)=>y.length-x.length),s=s.filter((y,x)=>{for(let C=x+1;C<s.length;C++)if(s[C].indexOf(y)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class As{constructor(s={}){this.options=s,_.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=be.create("div","maplibregl-ctrl mapboxgl-ctrl");const u=be.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){be.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&u.classList.add("maplibregl-compact","mapboxgl-compact"):u.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class du{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const y of p)if(y.id===s)return void(y.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const ta={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},nr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},El={showCompass:!0,showZoom:!0,visualizePitch:!1};class di{constructor(s,u,p=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new ns({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new et({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),_.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),be.addEventListener(u,"mousedown",this.mousedown),be.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),be.addEventListener(u,"touchmove",this.touchmove),be.addEventListener(u,"touchend",this.touchend),be.addEventListener(u,"touchcancel",this.reset)}down(s,u){this.mouseRotate.mousedown(s,u),this.mousePitch&&this.mousePitch.mousedown(s,u),be.disableDrag()}move(s,u){const p=this.map,y=this.mouseRotate.mousemoveWindow(s,u);if(y&&y.bearingDelta&&p.setBearing(p.getBearing()+y.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(s,u);x&&x.pitchDelta&&p.setPitch(p.getPitch()+x.pitchDelta)}}off(){const s=this.element;be.removeEventListener(s,"mousedown",this.mousedown),be.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),be.removeEventListener(s,"touchmove",this.touchmove),be.removeEventListener(s,"touchend",this.touchend),be.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){be.enableDrag(),be.removeEventListener(window,"mousemove",this.mousemove),be.removeEventListener(window,"mouseup",this.mouseup)}mousedown(s){this.down(_.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),be.mousePos(this.element,s)),be.addEventListener(window,"mousemove",this.mousemove),be.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.move(s,be.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=be.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=be.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function wi(m,s,u){if(m=new _.LngLat(m.lng,m.lat),s){const p=new _.LngLat(m.lng-360,m.lat),y=new _.LngLat(m.lng+360,m.lat),x=u.locationPoint(m).distSqr(s);u.locationPoint(p).distSqr(s)<x?m=p:u.locationPoint(y).distSqr(s)<x&&(m=y)}for(;Math.abs(m.lng-u.center.lng)>180;){const p=u.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=u.width&&p.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const it={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gt(m,s,u){const p=m.classList;for(const y in it)p.remove(`maplibregl-${u}-anchor-${y}`,`mapboxgl-${u}-anchor-${y}`);p.add(`maplibregl-${u}-anchor-${s}`,`mapboxgl-${u}-anchor-${s}`)}class Pi extends _.Evented{constructor(s,u){if(super(),(s instanceof HTMLElement||u)&&(s=_.extend({element:s},u)),_.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&"auto"!==s.pitchAlignment?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=_.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=be.create("div"),this._element.setAttribute("aria-label","Map marker");const p=be.createNS("http://www.w3.org/2000/svg","svg"),y=41,x=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${y}px`),p.setAttributeNS(null,"width",`${x}px`),p.setAttributeNS(null,"viewBox",`0 0 ${x} ${y}`);const C=be.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const T=be.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const S=be.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const de of A){const Y=be.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",de.rx),Y.setAttributeNS(null,"ry",de.ry),S.appendChild(Y)}const F=be.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const z=be.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(z);const U=be.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const X=be.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(X);const q=be.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const W=be.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=be.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const se=be.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),W.appendChild(re),W.appendChild(se),T.appendChild(S),T.appendChild(F),T.appendChild(U),T.appendChild(q),T.appendChild(W),p.appendChild(T),p.setAttributeNS(null,"height",y*this._scale+"px"),p.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(p),this._offset=_.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),gt(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),be.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=_.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const u=s.code,p=s.charCode||s.keyCode;"Space"!==u&&"Enter"!==u&&32!==p&&13!==p||this.togglePopup()}_onMapClick(s){const u=s.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=wi(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let u="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?u=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(u=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),s&&"moveend"!==s.type||(this._pos=this._pos.round()),be.setTransform(this._element,`${it[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${u}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const y=this._map.unproject(this._pos),x=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=y.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(s){return this._offset=_.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new _.Event("dragstart"))),this.fire(new _.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new _.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&"auto"!==s?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const uo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ho,ar=0,Ot=!1;const is={maxWidth:100,unit:"metric"};function dc(m,s,u){const p=u&&u.maxWidth||100,y=m._container.clientHeight/2,x=m.unproject([0,y]),C=m.unproject([p,y]),T=x.distanceTo(C);if(u&&"imperial"===u.unit){const S=3.2808*T;S>5280?os(s,p,S/5280,m._getUIString("ScaleControl.Miles")):os(s,p,S,m._getUIString("ScaleControl.Feet"))}else u&&"nautical"===u.unit?os(s,p,T/1852,m._getUIString("ScaleControl.NauticalMiles")):T>=1e3?os(s,p,T/1e3,m._getUIString("ScaleControl.Kilometers")):os(s,p,T,m._getUIString("ScaleControl.Meters"))}function os(m,s,u,p){const y=function(x){const C=Math.pow(10,`${Math.floor(x)}`.length-1);let T=x/C;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A}(T),C*T}(u);m.style.width=s*(y/u)+"px",m.innerHTML=`${y}&nbsp;${p}`}const gn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ps(m){if(m){if("number"==typeof m){const s=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new _.pointGeometry(0,0),top:new _.pointGeometry(0,m),"top-left":new _.pointGeometry(s,s),"top-right":new _.pointGeometry(-s,s),bottom:new _.pointGeometry(0,-m),"bottom-left":new _.pointGeometry(s,-s),"bottom-right":new _.pointGeometry(-s,-s),left:new _.pointGeometry(m,0),right:new _.pointGeometry(-m,0)}}if(m instanceof _.pointGeometry||Array.isArray(m)){const s=_.pointGeometry.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:_.pointGeometry.convert(m.center||[0,0]),top:_.pointGeometry.convert(m.top||[0,0]),"top-left":_.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":_.pointGeometry.convert(m["top-right"]||[0,0]),bottom:_.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":_.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":_.pointGeometry.convert(m["bottom-right"]||[0,0]),left:_.pointGeometry.convert(m.left||[0,0]),right:_.pointGeometry.convert(m.right||[0,0])}}return Ps(new _.pointGeometry(0,0))}const po={supported:Wn,setRTLTextPlugin:_.setRTLTextPlugin,getRTLTextPluginStatus:_.getRTLTextPluginStatus,Map:class extends mn{constructor(m){var s;if(_.PerformanceUtils.mark(_.PerformanceMarkers.create),null!=(m=_.extend({},nr,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Qs(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new du,this._controls=[],this._mapId=_.uniqueId(),this._locale=_.extend({},ta,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=null!==(s=m.pixelRatio)&&void 0!==s?s:devicePixelRatio,this._requestManager=new Go(m.transformRequest),"string"==typeof m.container){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),_.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Gn(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new ru("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,_.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new St({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new As,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update("style"===u.dataType),this.fire(new _.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new _.Event(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new _.Event("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(m,s){if(void 0===s&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return-1!==s.indexOf("bottom")?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,u,p){return null==p&&this.style.terrain&&(p=this.transform.getElevation(u,this.style.terrain)),super.calculateCameraOptionsFromTo(m,s,u,p)}resize(m){const s=this._containerDimensions(),u=s[0],p=s[1];this._resizeCanvas(u,p,this.getPixelRatio()),this.transform.resize(u,p),this.painter.resize(u,p,this.getPixelRatio());const y=!this._moving;return y&&(this.stop(),this.fire(new _.Event("movestart",m)).fire(new _.Event("move",m))),this.fire(new _.Event("resize",m)),y&&this.fire(new _.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[s,u]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(s,u,m),this.painter.resize(s,u,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(_.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(_.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(_.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,s,u){if("mouseenter"===m||"mouseover"===m){let p=!1;return{layer:s,listener:u,delegates:{mousemove:x=>{const C=this.getLayer(s)?this.queryRenderedFeatures(x.point,{layers:[s]}):[];C.length?p||(p=!0,u.call(this,new Hn(m,this,x.originalEvent,{features:C}))):p=!1},mouseout:()=>{p=!1}}}}if("mouseleave"===m||"mouseout"===m){let p=!1;return{layer:s,listener:u,delegates:{mousemove:C=>{(this.getLayer(s)?this.queryRenderedFeatures(C.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,u.call(this,new Hn(m,this,C.originalEvent)))},mouseout:C=>{p&&(p=!1,u.call(this,new Hn(m,this,C.originalEvent)))}}}}{const p=y=>{const x=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];x.length&&(y.features=x,u.call(this,y),delete y.features)};return{layer:s,listener:u,delegates:{[m]:p}}}}on(m,s,u){if(void 0===u)return super.on(m,s);const p=this._createDelegatedListener(m,s,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(m,s,u){if(void 0===u)return super.once(m,s);const p=this._createDelegatedListener(m,s,u);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(m,s,u){return void 0===u?super.off(m,s):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const y=this._delegatedListeners[m];for(let x=0;x<y.length;x++){const C=y[x];if(C.layer===s&&C.listener===u){for(const T in C.delegates)this.off(T,C.delegates[T]);return y.splice(x,1),this}}})(),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let u;if(void 0!==s||void 0===m||m instanceof _.pointGeometry||Array.isArray(m)||(s=m,m=void 0),s=s||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof _.pointGeometry||"number"==typeof m[0])u=[_.pointGeometry.convert(m)];else{const p=_.pointGeometry.convert(m[0]),y=_.pointGeometry.convert(m[1]);u=[p,new _.pointGeometry(y.x,p.y),y,new _.pointGeometry(p.x,y.y),p]}return this.style.queryRenderedFeatures(u,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return!1!==(s=_.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(null==s)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Rr(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Rr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if("string"==typeof m){const u=this._requestManager.transformRequest(m,_.ResourceType.Style);_.getJSON(u,(p,y)=>{p?this.fire(new _.ErrorEvent(p)):y&&this._updateDiff(y,s)})}else"object"==typeof m&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m)&&this._update(!0)}catch(u){_.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():_.warnOnce("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(void 0!==s)return s.loaded();this.fire(new _.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const u=m[s]._tiles;for(const p in u){const y=u[p];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(m,s,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,u)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s,{pixelRatio:u=1,sdf:p=!1,stretchX:y,stretchY:x,content:C}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||_.isImageBitmap(s)){const{width:T,height:S,data:A}=_.exported.getImageData(s);this.style.addImage(m,{data:new _.RGBAImage({width:T,height:S},A),pixelRatio:u,stretchX:y,stretchY:x,content:C,sdf:p,version:0})}else{if(void 0===s.width||void 0===s.height)return this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:S,data:A}=s,F=s;this.style.addImage(m,{data:new _.RGBAImage({width:T,height:S},new Uint8Array(A)),pixelRatio:u,stretchX:y,stretchY:x,content:C,sdf:p,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}}updateImage(m,s){const u=this.style.getImage(m);if(!u)return this.fire(new _.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||_.isImageBitmap(s)?_.exported.getImageData(s):s,{width:y,height:x,data:C}=p;if(void 0===y||void 0===x)return this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==u.data.width||x!==u.data.height)return this.fire(new _.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(s instanceof HTMLImageElement||_.isImageBitmap(s));u.data.replace(C,T),this.style.updateImage(m,u)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new _.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){_.getImage(this._requestManager.transformRequest(m,_.ResourceType.Image),s)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,s,u){return this.style.setLayerZoomRange(m,s,u),this._update(!0)}setFilter(m,s,u={}){return this.style.setFilter(m,s,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,u,p={}){return this.style.setPaintProperty(m,s,u,p),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,u,p={}){return this.style.setLayoutProperty(m,s,u,p),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const s=this._canvasContainer=be.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=be.create("canvas","maplibregl-canvas mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions();this._resizeCanvas(u[0],u[1],this.getPixelRatio());const p=this._controlContainer=be.create("div","maplibregl-control-container mapboxgl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{y[x]=be.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=be.create("div","maplibregl-cooperative-gesture-screen",m);let s="Control",u="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(u="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",s="Meta"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${u}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,document.addEventListener("keydown",p=>{p.key===s&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===s&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,s,u){this._canvas.width=u*m,this._canvas.height=u*s,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m=_.extend({},Wn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);s?(this.painter=new co(s,this.transform),_.exported$1.testSupport(s)):this.fire(new _.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new _.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new _.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,s,u){return!s&&u<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let s,u=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,s),u=_.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,T=_.exported.now();this.style.zoomHistory.update(C,T);const S=new _.EvaluationParameters(C,{now:T,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=S.crossFadingFactor();1===A&&A===this._crossFadingFactor||(y=!0,this._crossFadingFactor=A),this.style.update(S)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new _.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,_.PerformanceUtils.mark(_.PerformanceMarkers.load),this.fire(new _.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const C=_.exported.now()-u;p.endQueryEXT(p.TIME_ELAPSED_EXT,s),setTimeout(()=>{const T=p.getQueryObjectEXT(s,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s),this.fire(new _.Event("gpu-timing-frame",{cpuTime:C,gpuTime:T}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const T=this.painter.queryGpuTimers(C);this.fire(new _.Event("gpu-timing-layer",{layerTimes:T}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new _.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,_.PerformanceUtils.mark(_.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),be.remove(this._canvasContainer),be.remove(this._controlContainer),this._cooperativeGestures&&be.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),_.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new _.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=_.exported.frame(m=>{_.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,s){_.setCacheLimits(m,s)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=_.extend({},El,m),this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(_.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),be.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),be.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(_.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=be.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),s=m===this._map.getMaxZoom(),u=m===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new di(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){be.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const u=be.create("button",m,this._container);return u.type="button",u.addEventListener("click",s),u}_setButtonTitle(m,s){const u=this._map._getUIString(`NavigationControl.${s}`);m.title=u,m.setAttribute("aria-label",u)}},GeolocateControl:class extends _.Evented{constructor(m){super(),this.options=_.extend({},uo,m),_.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var s;return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,void 0!==ho?s(ho):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(u=>{ho="denied"!==u.state,s(ho)}):(ho=!!window.navigator.geolocation,s(ho)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),be.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ar=0,Ot=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),u=m.coords;return s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new _.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new _.Event("geolocate",m)),this._finish()}}_updateCamera(m){const s=new _.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,p=this._map.getBearing(),y=_.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(u),y,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new _.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,s=this._map.unproject([0,m]),u=this._map.unproject([1,m]),p=s.distanceTo(u),y=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&Ot)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new _.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=be.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),be.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===m){_.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=be.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Pi(this._dotElement),this._circleElement=be.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new _.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return _.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new _.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ar--,Ot=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new _.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new _.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ar++,ar>1?(m={maximumAge:6e5,timeout:0},Ot=!0):(m=this.options.positionOptions,Ot=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:St,LogoControl:As,ScaleControl:class{constructor(m){this.options=_.extend({},is,m),_.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){dc(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){be.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,dc(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:_.warnOnce("Full screen control 'container' must be a DOM element.")),_.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=be.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",_.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){be.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=be.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);be.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,_.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=be.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=be.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),be.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){be.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends _.Evented{constructor(m){super(),this.options=_.extend(Object.create(gn),m),_.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new _.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&be.remove(this._content),this._container&&(be.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new _.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=_.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=m;p=u.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=be.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=be.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=be.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=be.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wi(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const s=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let u=this.options.anchor;const p=Ps(this.options.offset);if(!u){const x=this._container.offsetWidth,C=this._container.offsetHeight;let T;T=s.y+p.bottom.y<C?["top"]:s.y>this._map.transform.height-C?["bottom"]:[],s.x<x/2?T.push("left"):s.x>this._map.transform.width-x/2&&T.push("right"),u=0===T.length?"bottom":T.join("-")}const y=s.add(p[u]).round();be.setTransform(this._container,`${it[u]} translate(${y.x}px,${y.y}px)`),gt(this._container,u,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(qn);m&&m.focus()}_onClose(){this.remove()}},Marker:Pi,Style:Rr,LngLat:_.LngLat,LngLatBounds:_.LngLatBounds,Point:_.pointGeometry,MercatorCoordinate:_.MercatorCoordinate,Evented:_.Evented,AJAXError:_.AJAXError,config:_.config,CanvasSource:gs,GeoJSONSource:Gr,ImageSource:$i,RasterDEMTileSource:xt,RasterTileSource:Eo,VectorTileSource:_a,VideoSource:hn,prewarm:function(){wa().acquire($t)},clearPrewarmedResources:function(){const m=Io;m&&(m.isPreloaded()&&1===m.numActive()?(m.release($t),Io=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return ai.workerCount},set workerCount(m){ai.workerCount=m},get maxParallelImageRequests(){return _.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){_.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){_.clearTileCache(m)},workerUrl:"",addProtocol(m,s){_.config.REGISTERED_PROTOCOLS[m]=s},removeProtocol(m){delete _.config.REGISTERED_PROTOCOLS[m]}};return Or.extend(po,{isSafari:_.isSafari,getPerformanceMetrics:_.PerformanceUtils.getPerformanceMetrics}),po}),An}()}},wh=>{wh(wh.s=836)}]);