{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/auth.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction GestionLieuxComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"form\", 13);\n    i0.ɵɵlistener(\"ngSubmit\", function GestionLieuxComponent_div_9_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.save());\n    });\n    i0.ɵɵelementStart(2, \"h3\", 14);\n    i0.ɵɵtext(3, \"Cr\\u00E9er un nouveau lieu\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\")(5, \"label\", 15);\n    i0.ɵɵtext(6, \"Instructions\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"textarea\", 16);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_textarea_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.model.instructions = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"h5\", 17);\n    i0.ɵɵtext(9, \"Adresse\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 18)(11, \"input\", 19);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_11_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.model.adresse.nomAdresse = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"input\", 20);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.model.adresse.numeroEtRue = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 21)(14, \"input\", 22);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.model.adresse.codePostal = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"input\", 23);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.model.adresse.ville = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"input\", 24);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_16_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.model.adresse.region = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 25)(18, \"input\", 26);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_18_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.model.adresse.pays = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"input\", 27);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_19_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.model.adresse.complement = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"input\", 28);\n    i0.ɵɵlistener(\"ngModelChange\", function GestionLieuxComponent_div_9_Template_input_ngModelChange_20_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.model.adresse.etage = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(21, \"div\", 29)(22, \"button\", 30);\n    i0.ɵɵtext(23, \"Enregistrer\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function GestionLieuxComponent_div_9_Template_button_click_24_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.showForm = false);\n    });\n    i0.ɵɵtext(25, \"Annuler\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.instructions);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.nomAdresse);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.numeroEtRue);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.codePostal);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.ville);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.region);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.pays);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.complement);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.model.adresse.etage);\n  }\n}\nfunction GestionLieuxComponent_tr_21_button_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 36);\n    i0.ɵɵlistener(\"click\", function GestionLieuxComponent_tr_21_button_6_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const l_r15 = i0.ɵɵnextContext().$implicit;\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.edit(l_r15));\n    });\n    i0.ɵɵtext(1, \"Edit\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction GestionLieuxComponent_tr_21_button_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 37);\n    i0.ɵɵlistener(\"click\", function GestionLieuxComponent_tr_21_button_7_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const l_r15 = i0.ɵɵnextContext().$implicit;\n      const ctx_r21 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r21.remove(l_r15));\n    });\n    i0.ɵɵtext(1, \"Supprimer\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction GestionLieuxComponent_tr_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 32)(1, \"td\", 33);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 33);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 9);\n    i0.ɵɵtemplate(6, GestionLieuxComponent_tr_21_button_6_Template, 2, 0, \"button\", 34);\n    i0.ɵɵtemplate(7, GestionLieuxComponent_tr_21_button_7_Template, 2, 0, \"button\", 35);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const l_r15 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(l_r15.nom || l_r15.nomLieu || \"\\u2014\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(l_r15.instructions || \"\\u2014\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isOwnedByCurrentUser(l_r15));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isOwnedByCurrentUser(l_r15));\n  }\n}\nfunction GestionLieuxComponent_p_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 38);\n    i0.ɵɵtext(1, \"Aucun lieu trouv\\u00E9.\");\n    i0.ɵɵelementEnd();\n  }\n}\nlet GestionLieuxComponent = /*#__PURE__*/(() => {\n  class GestionLieuxComponent {\n    constructor(api, auth, router) {\n      this.api = api;\n      this.auth = auth;\n      this.router = router;\n      this.lieux = [];\n      this.model = {};\n      this.showForm = false;\n      this.currentUserId = null;\n    }\n    ngOnInit() {\n      this.load();\n      this.resolveCurrentUser();\n    }\n    load() {\n      this.api.list('lieux/mine').subscribe(d => this.lieux = d || []);\n    }\n    resolveCurrentUser() {\n      const pseudo = this.auth.getPseudoFromToken();\n      if (!pseudo) return;\n      this.api.list('utilisateurs').subscribe(u => {\n        const found = (u || []).find(x => x.pseudo === pseudo || x.adresseMail === pseudo);\n        if (found) this.currentUserId = found.id;\n      });\n    }\n    save() {\n      const payload = {\n        ...this.model\n      };\n      if (!this.model.id && this.currentUserId) payload.utilisateur = {\n        id: this.currentUserId\n      };\n      if (this.model.id) this.api.update('lieux', this.model.id, payload).subscribe(() => this.load());else this.api.create('lieux', payload).subscribe(() => this.load());\n      this.model = {};\n      this.showForm = false;\n    }\n    edit(l) {\n      this.model = {\n        ...l\n      };\n      if (!this.model.adresse) this.model.adresse = {};\n      this.showForm = true;\n    }\n    remove(l) {\n      this.api.delete('lieux', l.id).subscribe(() => this.load());\n    }\n    // show add form\n    addNew() {\n      this.model = {};\n      if (!this.model.adresse) this.model.adresse = {};\n      this.showForm = true;\n    }\n    // helper to compute ownership like in GestionBornes\n    isOwnedByCurrentUser(l) {\n      try {\n        const pseudo = this.auth.getPseudoFromToken();\n        if (pseudo && l && l.utilisateur && l.utilisateur.pseudo) return l.utilisateur.pseudo === pseudo;\n        if (this.currentUserId && l && l.utilisateur && l.utilisateur.id) return l.utilisateur.id === this.currentUserId;\n        return false;\n      } catch (e) {\n        return false;\n      }\n    }\n    static {\n      this.ɵfac = function GestionLieuxComponent_Factory(t) {\n        return new (t || GestionLieuxComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: GestionLieuxComponent,\n        selectors: [[\"gestion-lieux\"]],\n        decls: 23,\n        vars: 3,\n        consts: [[1, \"max-w-4xl\", \"mx-auto\", \"p-4\", \"card\", \"bg-surface\"], [1, \"flex\", \"items-center\", \"justify-between\", \"mb-4\"], [1, \"text-xl\", \"mb-0\", \"text-foreground\"], [\"aria-label\", \"Ajouter\", 1, \"fab-neon\", \"p-3\", \"rounded-full\", \"text-sm\", 3, \"click\"], [\"routerLink\", \"/lieux/new\", 1, \"ml-2\", \"p-2\", \"border\", \"rounded\", \"hidden\"], [\"class\", \"mb-4\", 4, \"ngIf\"], [1, \"table-wrap\", \"overflow-auto\", \"bg-surface-weak\", \"rounded-lg\", \"p-2\"], [1, \"min-w-full\"], [1, \"text-left\", \"text-sm\", \"muted\"], [1, \"px-4\", \"py-3\"], [\"class\", \"border-t border-surface-weak hover:bg-surface-weak transition\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"mt-4 text-gray-600\", 4, \"ngIf\"], [1, \"mb-4\"], [1, \"space-y-4\", 3, \"ngSubmit\"], [1, \"text-lg\", \"font-semibold\", \"text-white\"], [1, \"block\", \"mb-1\", \"text-white\"], [\"name\", \"instructions\", 1, \"p-2\", \"border\", \"rounded\", \"w-full\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [1, \"font-semibold\", \"text-white\"], [1, \"p-2\", \"border\", \"rounded\", \"bg-surface-weak\"], [\"name\", \"adrNom\", \"placeholder\", \"Nom adresse\", 1, \"p-2\", \"border\", \"rounded\", \"w-full\", \"mt-1\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"adrNumeroRue\", \"placeholder\", \"Num\\u00E9ro et rue\", 1, \"p-2\", \"border\", \"rounded\", \"w-full\", \"mt-1\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [1, \"grid\", \"grid-cols-3\", \"gap-2\", \"mt-1\"], [\"name\", \"adrCp\", \"placeholder\", \"Code postal\", 1, \"p-2\", \"border\", \"rounded\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"adrVille\", \"placeholder\", \"Ville\", 1, \"p-2\", \"border\", \"rounded\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"adrRegion\", \"placeholder\", \"R\\u00E9gion\", 1, \"p-2\", \"border\", \"rounded\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [1, \"grid\", \"grid-cols-2\", \"gap-2\", \"mt-1\"], [\"name\", \"adrPays\", \"placeholder\", \"Pays\", 1, \"p-2\", \"border\", \"rounded\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"adrCompl\", \"placeholder\", \"Compl\\u00E9ment\", 1, \"p-2\", \"border\", \"rounded\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"adrEtage\", \"placeholder\", \"\\u00C9tage\", 1, \"p-2\", \"border\", \"rounded\", \"w-full\", \"mt-1\", \"text-white\", \"bg-transparent\", 3, \"ngModel\", \"ngModelChange\"], [1, \"flex\", \"space-x-2\", \"mt-4\"], [\"type\", \"submit\", 1, \"px-4\", \"py-2\", \"btn-cyan\"], [\"type\", \"button\", 1, \"px-4\", \"py-2\", \"btn-danger\", 3, \"click\"], [1, \"border-t\", \"border-surface-weak\", \"hover:bg-surface-weak\", \"transition\"], [1, \"px-4\", \"py-3\", \"text-black\"], [\"class\", \"px-2 py-1 rounded bg-surface-weak text-foreground mr-2\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"px-2 py-1 rounded bg-red-600 text-inverse\", 3, \"click\", 4, \"ngIf\"], [1, \"px-2\", \"py-1\", \"rounded\", \"bg-surface-weak\", \"text-foreground\", \"mr-2\", 3, \"click\"], [1, \"px-2\", \"py-1\", \"rounded\", \"bg-red-600\", \"text-inverse\", 3, \"click\"], [1, \"mt-4\", \"text-gray-600\"]],\n        template: function GestionLieuxComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\", 2);\n            i0.ɵɵtext(3, \"Gestion des lieux\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\")(5, \"button\", 3);\n            i0.ɵɵlistener(\"click\", function GestionLieuxComponent_Template_button_click_5_listener() {\n              return ctx.addNew();\n            });\n            i0.ɵɵtext(6, \"\\uFF0B\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"button\", 4);\n            i0.ɵɵtext(8, \"(dev new)\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(9, GestionLieuxComponent_div_9_Template, 26, 9, \"div\", 5);\n            i0.ɵɵelementStart(10, \"div\", 6)(11, \"table\", 7)(12, \"thead\")(13, \"tr\", 8)(14, \"th\", 9);\n            i0.ɵɵtext(15, \"Nom\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"th\", 9);\n            i0.ɵɵtext(17, \"Instructions\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"th\", 9);\n            i0.ɵɵtext(19, \"Actions\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(20, \"tbody\");\n            i0.ɵɵtemplate(21, GestionLieuxComponent_tr_21_Template, 8, 4, \"tr\", 10);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(22, GestionLieuxComponent_p_22_Template, 2, 0, \"p\", 11);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(9);\n            i0.ɵɵproperty(\"ngIf\", ctx.showForm);\n            i0.ɵɵadvance(12);\n            i0.ɵɵproperty(\"ngForOf\", ctx.lieux);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.lieux || ctx.lieux.length === 0);\n          }\n        },\n        dependencies: [i4.NgForOf, i4.NgIf, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.NgModel, i5.NgForm, i3.RouterLink],\n        styles: [\"[_nghost-%COMP%]{display:block}\"]\n      });\n    }\n  }\n  return GestionLieuxComponent;\n})();\nexport { GestionLieuxComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}