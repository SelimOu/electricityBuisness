{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction ReservationComponent_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const b_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", b_r3.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(b_r3.nomBorne || b_r3.nom);\n  }\n}\nfunction ReservationComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Prix estim\\u00E9: \", ctx_r1.estimatedPrice, \" \\u20AC\");\n  }\n}\nfunction ReservationComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \"Date de fin doit \\u00EAtre apr\\u00E8s la date de d\\u00E9but\");\n    i0.ɵɵelementEnd();\n  }\n}\nlet ReservationComponent = /*#__PURE__*/(() => {\n  class ReservationComponent {\n    constructor(api, route) {\n      this.api = api;\n      this.route = route;\n      this.model = {};\n      this.bornes = [];\n      this.selectedBorne = null;\n      this.estimatedPrice = 0;\n    }\n    ngOnInit() {\n      this.api.list('bornes').subscribe(b => {\n        this.bornes = b || [];\n        const bid = Number(this.route.snapshot.queryParamMap.get('borne'));\n        if (bid) this.selectBorneById(bid);\n      });\n    }\n    selectBorneById(id) {\n      this.selectedBorne = this.bornes.find(x => x.id === id) || null;\n      this.model.borneId = id;\n      this.calculatePrice();\n    }\n    calculatePrice() {\n      if (!this.selectedBorne || !this.model.debut || !this.model.fin) {\n        this.estimatedPrice = 0;\n        return;\n      }\n      const d1 = new Date(this.model.debut);\n      const d2 = new Date(this.model.fin);\n      if (d2.getTime() <= d1.getTime()) {\n        this.estimatedPrice = 0;\n        return;\n      }\n      const minutes = Math.max(0, (d2.getTime() - d1.getTime()) / 60000);\n      const tarif = Number(this.selectedBorne.tarif) || 0;\n      this.estimatedPrice = +(minutes * tarif).toFixed(2);\n    }\n    reserve() {\n      const d1 = new Date(this.model.debut || 0);\n      const d2 = new Date(this.model.fin || 0);\n      if (d2.getTime() <= d1.getTime()) {\n        alert('La date de fin doit être après la date de début');\n        return;\n      }\n      const payload = {\n        idBorne: Number(this.model.borneId),\n        idUtilisateur: this.model.utilisateurId || null,\n        dateDebut: this.model.debut,\n        dateFin: this.model.fin,\n        prixMinuteHisto: Number(this.selectedBorne?.tarif) || 0,\n        etat: 'CONFIRMED'\n      };\n      this.api.create('reservations', payload).subscribe(() => alert('Réservé'), err => alert('Erreur'));\n    }\n    static {\n      this.ɵfac = function ReservationComponent_Factory(t) {\n        return new (t || ReservationComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ReservationComponent,\n        selectors: [[\"reservation\"]],\n        decls: 20,\n        vars: 7,\n        consts: [[1, \"max-w-md\", \"mx-auto\", \"p-4\", \"bg-surface\"], [1, \"text-xl\", \"mb-4\", \"text-foreground\"], [1, \"space-y-3\", 3, \"ngSubmit\"], [\"name\", \"borneId\", 1, \"w-full\", \"p-2\", \"border\", \"rounded\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"datetime-local\", \"name\", \"debut\", 1, \"w-full\", \"p-2\", \"border\", \"rounded\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"type\", \"datetime-local\", \"name\", \"fin\", 1, \"w-full\", \"p-2\", \"border\", \"rounded\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"class\", \"text-lg font-semibold\", 4, \"ngIf\"], [\"class\", \"text-red-600\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"bg-blue-600\", \"text-inverse\", \"px-4\", \"py-2\", \"rounded\", 3, \"disabled\"], [3, \"value\"], [1, \"text-lg\", \"font-semibold\"], [1, \"text-red-600\"]],\n        template: function ReservationComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\", 1);\n            i0.ɵɵtext(2, \"Cr\\u00E9er une r\\u00E9servation\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"form\", 2);\n            i0.ɵɵlistener(\"ngSubmit\", function ReservationComponent_Template_form_ngSubmit_3_listener() {\n              return ctx.reserve();\n            });\n            i0.ɵɵelementStart(4, \"label\");\n            i0.ɵɵtext(5, \"Choisir une borne\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"select\", 3);\n            i0.ɵɵlistener(\"ngModelChange\", function ReservationComponent_Template_select_ngModelChange_6_listener($event) {\n              return ctx.model.borneId = $event;\n            })(\"change\", function ReservationComponent_Template_select_change_6_listener() {\n              return ctx.selectBorneById(ctx.model.borneId);\n            });\n            i0.ɵɵelementStart(7, \"option\", 4);\n            i0.ɵɵtext(8, \"-- choisir --\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(9, ReservationComponent_option_9_Template, 2, 2, \"option\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(10, \"label\");\n            i0.ɵɵtext(11, \"Date d\\u00E9but\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"input\", 6);\n            i0.ɵɵlistener(\"ngModelChange\", function ReservationComponent_Template_input_ngModelChange_12_listener($event) {\n              return ctx.model.debut = $event;\n            })(\"change\", function ReservationComponent_Template_input_change_12_listener() {\n              return ctx.calculatePrice();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"label\");\n            i0.ɵɵtext(14, \"Date fin\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"input\", 7);\n            i0.ɵɵlistener(\"ngModelChange\", function ReservationComponent_Template_input_ngModelChange_15_listener($event) {\n              return ctx.model.fin = $event;\n            })(\"change\", function ReservationComponent_Template_input_change_15_listener() {\n              return ctx.calculatePrice();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(16, ReservationComponent_div_16_Template, 2, 1, \"div\", 8);\n            i0.ɵɵtemplate(17, ReservationComponent_div_17_Template, 2, 0, \"div\", 9);\n            i0.ɵɵelementStart(18, \"button\", 10);\n            i0.ɵɵtext(19, \"R\\u00E9server\");\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngModel\", ctx.model.borneId);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.bornes);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngModel\", ctx.model.debut);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngModel\", ctx.model.fin);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.estimatedPrice > 0);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.estimatedPrice === 0 && ctx.model.debut && ctx.model.fin);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"disabled\", !ctx.model.borneId || !ctx.model.debut || !ctx.model.fin || ctx.estimatedPrice === 0);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.NgModel, i4.NgForm],\n        styles: [\"[_nghost-%COMP%]{display:block}\"]\n      });\n    }\n  }\n  return ReservationComponent;\n})();\nexport { ReservationComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}