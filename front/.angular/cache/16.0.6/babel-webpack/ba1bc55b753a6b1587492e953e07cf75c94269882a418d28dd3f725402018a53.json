{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction GestionBornesComponent_tr_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\", 12)(1, \"td\", 13);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\", 13);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\", 13);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 9)(8, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function GestionBornesComponent_tr_22_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const b_r2 = restoredCtx.$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.edit(b_r2));\n    });\n    i0.ɵɵtext(9, \"Edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function GestionBornesComponent_tr_22_Template_button_click_10_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const b_r2 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.remove(b_r2));\n    });\n    i0.ɵɵtext(11, \"Supprimer\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const b_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.nomBorne || b_r2.nom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.coordGPS);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", b_r2.tarif, \" \\u20AC/min\");\n  }\n}\nfunction GestionBornesComponent_li_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\", 16)(1, \"div\")(2, \"div\", 17);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 18);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 19);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 20)(9, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function GestionBornesComponent_li_24_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const b_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.edit(b_r6));\n    });\n    i0.ɵɵtext(10, \"Edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function GestionBornesComponent_li_24_Template_button_click_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const b_r6 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.remove(b_r6));\n    });\n    i0.ɵɵtext(12, \"Supprimer\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const b_r6 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(b_r6.nomBorne || b_r6.nom);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate3(\"\", b_r6.coordGPS, \" \\u2014 \", b_r6.tarif, \"\\u20AC/min \\u2014 \", b_r6.puissance, \" kW\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Lieu: \", (b_r6.lieu == null ? null : b_r6.lieu.nom) || \"\\u2014\", \"\");\n  }\n}\nlet GestionBornesComponent = /*#__PURE__*/(() => {\n  class GestionBornesComponent {\n    constructor(api) {\n      this.api = api;\n      this.bornes = [];\n      this.model = {};\n      this.lieux = [];\n      this.medias = [];\n    }\n    ngOnInit() {\n      this.load();\n      this.loadLieux();\n    }\n    loadLieux() {\n      this.api.list('lieux').subscribe(d => this.lieux = d || []);\n    }\n    loadMedias() {\n      this.api.list('medias').subscribe(d => this.medias = d || []);\n    }\n    load() {\n      this.api.list('bornes').subscribe(d => this.bornes = d || []);\n    }\n    save() {\n      const payload = {\n        ...this.model\n      };\n      if (this.model.lieuId) payload.lieu = {\n        id: this.model.lieuId\n      };\n      if (this.model.mediaId) payload.media = {\n        id: this.model.mediaId\n      };\n      if (this.model.id) {\n        this.api.update('bornes', this.model.id, payload).subscribe(() => {\n          // if media selected, ensure media references this borne\n          if (this.model.mediaId) {\n            this.api.update('medias', this.model.mediaId, {\n              borne: {\n                id: this.model.id\n              }\n            }).subscribe(() => this.load(), () => this.load());\n          } else this.load();\n        });\n      } else {\n        // create and then, if media selected, attach media to created borne\n        this.api.create('bornes', payload).subscribe(created => {\n          if (this.model.mediaId && created && created.id) {\n            this.api.update('medias', this.model.mediaId, {\n              borne: {\n                id: created.id\n              }\n            }).subscribe(() => this.load(), () => this.load());\n          } else this.load();\n        }, () => alert('Erreur création borne'));\n      }\n      this.model = {};\n    }\n    edit(b) {\n      this.model = {\n        ...b\n      };\n    }\n    remove(b) {\n      if (!confirm('Supprimer cette borne ?')) return;\n      // check reservations\n      this.api.list('reservations').subscribe(r => {\n        const active = (r || []).find(x => Number(x.idBorne) === Number(b.id) && x.etat && x.etat !== 'CANCELLED');\n        if (active) {\n          alert('Impossible: cette borne a des réservations actives.');\n          return;\n        }\n        this.api.delete('bornes', b.id).subscribe(() => this.load(), () => alert('Erreur suppression'));\n      }, () => {\n        // if reservations endpoint fails, fallback to direct delete with confirmation\n        if (confirm('Impossible de vérifier les réservations. Supprimer quand même ?')) this.api.delete('bornes', b.id).subscribe(() => this.load());\n      });\n    }\n    static {\n      this.ɵfac = function GestionBornesComponent_Factory(t) {\n        return new (t || GestionBornesComponent)(i0.ɵɵdirectiveInject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: GestionBornesComponent,\n        selectors: [[\"gestion-bornes\"]],\n        decls: 25,\n        vars: 2,\n        consts: [[1, \"max-w-3xl\", \"mx-auto\", \"p-4\", \"card\", \"bg-surface\"], [1, \"text-xl\", \"mb-4\", \"text-foreground\"], [1, \"space-y-2\", \"mb-4\", 3, \"ngSubmit\"], [1, \"flex\", \"items-center\", \"justify-between\", \"mb-4\"], [1, \"text-lg\", \"font-semibold\"], [\"aria-label\", \"Ajouter\", 1, \"fab-neon\", \"p-3\", \"rounded-full\", \"text-sm\", 3, \"click\"], [1, \"table-wrap\", \"overflow-auto\", \"bg-surface-weak\", \"rounded-lg\", \"p-2\"], [1, \"min-w-full\"], [1, \"text-left\", \"text-sm\", \"muted\"], [1, \"px-4\", \"py-3\"], [\"class\", \"border-t border-surface-weak hover:bg-surface-weak transition\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"p-2 border-b flex justify-between items-center\", 4, \"ngFor\", \"ngForOf\"], [1, \"border-t\", \"border-surface-weak\", \"hover:bg-surface-weak\", \"transition\"], [1, \"px-4\", \"py-3\", \"text-foreground\"], [1, \"px-2\", \"py-1\", \"rounded\", \"bg-surface-weak\", \"text-foreground\", \"mr-2\", 3, \"click\"], [1, \"px-2\", \"py-1\", \"rounded\", \"bg-red-600\", \"text-inverse\", 3, \"click\"], [1, \"p-2\", \"border-b\", \"flex\", \"justify-between\", \"items-center\"], [1, \"font-semibold\"], [1, \"text-sm\", \"text-gray-600\"], [1, \"text-xs\", \"text-gray-500\"], [1, \"space-x-2\"], [1, \"px-2\", \"py-1\", \"border\", \"rounded\", 3, \"click\"], [1, \"px-2\", \"py-1\", \"btn-danger\", 3, \"click\"]],\n        template: function GestionBornesComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\", 1);\n            i0.ɵɵtext(2, \"Gestion des bornes\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"form\", 2);\n            i0.ɵɵlistener(\"ngSubmit\", function GestionBornesComponent_Template_form_ngSubmit_3_listener() {\n              return ctx.save();\n            });\n            i0.ɵɵelementStart(4, \"div\", 3)(5, \"h3\", 4);\n            i0.ɵɵtext(6, \"Gestion des bornes\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function GestionBornesComponent_Template_button_click_7_listener() {\n              return ctx.model = {};\n            });\n            i0.ɵɵtext(8, \"\\uFF0B\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"div\", 6)(10, \"table\", 7)(11, \"thead\")(12, \"tr\", 8)(13, \"th\", 9);\n            i0.ɵɵtext(14, \"Nom\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"th\", 9);\n            i0.ɵɵtext(16, \"CoordGPS\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"th\", 9);\n            i0.ɵɵtext(18, \"Tarif\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"th\", 9);\n            i0.ɵɵtext(20, \"Actions\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(21, \"tbody\");\n            i0.ɵɵtemplate(22, GestionBornesComponent_tr_22_Template, 12, 3, \"tr\", 10);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(23, \"ul\");\n            i0.ɵɵtemplate(24, GestionBornesComponent_li_24_Template, 13, 5, \"li\", 11);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(22);\n            i0.ɵɵproperty(\"ngForOf\", ctx.bornes);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", ctx.bornes);\n          }\n        },\n        dependencies: [i2.NgForOf, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.NgForm],\n        styles: [\"[_nghost-%COMP%]{display:block}\"]\n      });\n    }\n  }\n  return GestionBornesComponent;\n})();\nexport { GestionBornesComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}