{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet GestionLieuxComponent = class GestionLieuxComponent {\n  constructor(api, auth, router) {\n    this.api = api;\n    this.auth = auth;\n    this.router = router;\n    this.lieux = [];\n    this.model = {};\n    this.showForm = false;\n    this.currentUserId = null;\n  }\n  ngOnInit() {\n    this.load();\n    this.resolveCurrentUser();\n  }\n  load() {\n    this.api.list('lieux/mine').subscribe(d => this.lieux = d || []);\n  }\n  resolveCurrentUser() {\n    const pseudo = this.auth.getPseudoFromToken();\n    if (!pseudo) return;\n    this.api.list('utilisateurs').subscribe(u => {\n      const found = (u || []).find(x => x.pseudo === pseudo || x.adresseMail === pseudo);\n      if (found) this.currentUserId = found.id;\n    });\n  }\n  save() {\n    const payload = {\n      ...this.model\n    };\n    if (!this.model.id && this.currentUserId) payload.utilisateur = {\n      id: this.currentUserId\n    };\n    if (this.model.id) this.api.update('lieux', this.model.id, payload).subscribe(() => this.load());else this.api.create('lieux', payload).subscribe(() => this.load());\n    this.model = {};\n    this.showForm = false;\n  }\n  edit(l) {\n    this.model = {\n      ...l\n    };\n  }\n  remove(l) {\n    this.api.delete('lieux', l.id).subscribe(() => this.load());\n  }\n  // show add form\n  addNew() {\n    this.model = {};\n    this.showForm = true;\n  }\n  // helper to compute ownership like in GestionBornes\n  isOwnedByCurrentUser(l) {\n    try {\n      const pseudo = this.auth.getPseudoFromToken();\n      if (pseudo && l && l.utilisateur && l.utilisateur.pseudo) return l.utilisateur.pseudo === pseudo;\n      if (this.currentUserId && l && l.utilisateur && l.utilisateur.id) return l.utilisateur.id === this.currentUserId;\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n};\nGestionLieuxComponent = __decorate([Component({\n  selector: 'gestion-lieux',\n  templateUrl: './gestion-lieux.component.html',\n  styleUrls: ['./gestion-lieux.component.css']\n})], GestionLieuxComponent);\nexport { GestionLieuxComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}